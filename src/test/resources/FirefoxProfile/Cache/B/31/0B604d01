BrowserSniffer = new function()
{
var BrowserSniffer = this;
var agent = navigator.userAgent.toLowerCase();
BrowserSniffer.isIpad = function()
{
return (agent.indexOf("ipad") != -1);
},
BrowserSniffer.isIphone = function()
{
return (agent.indexOf("iphone") != -1);
},
BrowserSniffer.isIOS = function()
{
return (agent.indexOf("ipad") != -1) || (agent.indexOf("iphone") != -1);
},
BrowserSniffer.isAndroid = function()
{
return (agent.indexOf("android") != -1 || agent.indexOf("silk-accelerated=true") != -1);
},
BrowserSniffer.isSafari = function()
{
var _bSafari=false
if(document.childNodes && !document.all && !navigator.taintEnabled) _bSafari = true;
return _bSafari;
},
BrowserSniffer.isIE = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie")!=-1)
},
BrowserSniffer.isIE6 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 6")!=-1)
},
BrowserSniffer.isIE7 = function()
{
var ie8 = (navigator.appVersion.toLowerCase().indexOf("msie 8")!=-1)
var ie7 = (navigator.appVersion.toLowerCase().indexOf("msie 7")!=-1)
return (ie7 || ie8)
},
BrowserSniffer.isIE8 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 8")!=-1)
},
BrowserSniffer.isIE9 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 9")!=-1)
},
BrowserSniffer.isOpera = function()
{
return (agent.indexOf("opera")!=-1)
},
BrowserSniffer.isFirefox = function()
{
return (agent.indexOf("firefox")!=-1)
},
BrowserSniffer.isFirefox4 = function()
{
return (agent.indexOf("firefox/4") > -1)
},
BrowserSniffer.isMozilla = function()
{
return (agent.indexOf("mozilla/5")!=-1)
},
BrowserSniffer.isChrome = function()
{
return (agent.indexOf("chrome") > -1)
},
BrowserSniffer.isWin = function()
{
return ("Win32"==navigator.platform||"Windows"==navigator.platform)
},
BrowserSniffer.isMac = function()
{
return (agent.indexOf("mac")!=-1)
},
BrowserSniffer.isChrome = function()
{
return (agent.indexOf("chrome") > -1)
},
BrowserSniffer.isSamsungDroidCharge = function()
{
return (agent.indexOf("SCH-I510") > -1)
}
}
kSaveCookieDate= "Sunday, 1-Nov-20 12:00:00 GMT"
kExpCookieDate= "Friday, 12-Dec-00 12:00:00 GMT"
kTTOLocCookieDate= "Thursday, 1-Nov-12 12:00:00 GMT"
kNextYearCookieDate = "Thursday, 1-Nov-12 12:00:00 GMT"
kNameSpaceCookieDelimeter = "%--%"
kNameSpaceCookieSeparator = "-|@|-"
kPublicDomain= ".intuit.com"
kTTODomain= ".turbotaxonline.intuit.com"
function getCookie( n){
var d=document,srch=n+'=',p,e
if(d.cookie.length>0){
p=d.cookie.indexOf(srch)
if(-1!=p){
p+=srch.length
e=d.cookie.indexOf(';',p)
if(-1==e)e=d.cookie.length
return unescape(d.cookie.substring(p,e))
}
}
d=null
return "";
}
function setCookie(str,val,persist,nonsecure,exdate )
{
var c
var saveDate = kSaveCookieDate
if (isDefined(exdate)) saveDate=exdate
val=escape(val)
if(persist) {
c=str+"="+val+";expires="+saveDate+";domain="+kTTODomain+"; path=/;"
}
else {
c=str+"="+val+"; domain="+kTTODomain+"; path=/;"
}
if (!nonsecure)
c+="secure"
document.cookie = c
}
function setPublicCookie(str,val,persist,nonsecure,exdate )
{
val=escape(val)
var c
var saveDate = kSaveCookieDate
if (isDefined(exdate)) saveDate=exdate
if(persist) c=str+"="+val+";expires="+saveDate+";domain="+kPublicDomain+"; path=/;"
else c=str+"="+val+"; domain="+kPublicDomain+"; path=/;"
if (!nonsecure)
c+="secure"
document.cookie = c
}
function setNameSpaceCookie(nspace,str,val,persist,nonsecure,exdate ,p )
{
var cookie
val=escape(val)
var newVal = str+kNameSpaceCookieDelimeter+val
var nsp = getCookie(nspace);
if (!nsp || nsp==""){
setCookie(nspace,newVal,persist,nonsecure,exdate)
}
else{
var newCookieVal=""
var bFound=false
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
if (i>0)
newCookieVal += kNameSpaceCookieSeparator
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (!isDefined(pr)) continue;
if (str==pr[0]) {
newCookieVal += newVal
bFound=true
}
else{
newCookieVal += curVals[i]
}
}
if (!bFound)
newCookieVal = newCookieVal + kNameSpaceCookieSeparator + newVal
if(p) {
setPublicCookie(nspace,newCookieVal,persist,nonsecure,exdate)
} else {
setCookie(nspace,newCookieVal,persist,nonsecure,exdate)
}
}
}
function getNameSpaceCookie(nspace,str){
var nsp = getCookie(nspace);
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr) && str==pr[0]) {
return unescape(pr[1])
}
}
return ""
}
function getNameSpaceCookieObject(nspace){
var nsp = getCookie(nspace);
var curVals = nsp.split(kNameSpaceCookieSeparator)
var prs = new Object;
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr))
prs[pr[0]]= unescape(pr[1])
}
return prs
}
function clearCookieInNameSpace(nspace,str,persist,nonsecure,exdate ) {
var nsp = getCookie(nspace);
expireCookie(nspace)
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr) && str!=pr[0]) {
setNameSpaceCookie(nspace,pr[0],unescape(pr[1]),persist,nonsecure,exdate)
}
}
}
function expireCookie( Name, path, domain) {
path = path ? path : "/";
domain = (domain || domain === '') ? domain : kPublicDomain;
document.cookie=Name+"=0; expires="+kExpCookieDate+"; domain="+domain+"; path=" + path + "; max-age=0"
document.cookie=Name+"=0; expires="+kExpCookieDate+"; domain="+domain+"; path=" + path + "; max-age=0"
}
function clearAuthCookies(){
expireCookie("email");
expireCookie("AUTH_NS");
}
function clearSessionCookie() {
expireCookie("JSESSIONID", "/services", "");
}
function setCustomerTypeCookie(customerType)
{
setCookie('customerType',customerType)
}
function getCustomerTypeCookie()
{
return getCookie('customerType')
}
function setReturningUser()
{
setCustomerTypeCookie(1)
}
function setTTOLocationCookie(cookieValue)
{
setPublicCookie('tto_location', cookieValue, true, true, kTTOLocCookieDate)
}
function getTTOLocationCookie()
{
return getCookie('tto_location')
}
function updateTTOLocation(mktid,tab1,tab2,sku)
{
var list = 1
var last = 1
var t1 = isDefined(tab1)?tab1:-1
var t2 = isDefined(tab2)?tab2:-1
var ct = getCustomerTypeCookie()?getCustomerTypeCookie():-2
var sku = sku?sku:-1
var priorYrSku = (typeof TTOModel == "undefined")?null:TTOModel.getPriorYrSku()
var tl = getTTOLocationCookie()
if(tl != ""){
var tmp = tl.split("#")
list = tmp[0]
last = tmp[1]
py = tmp[6]
priorYrSku = priorYrSku?priorYrSku:py?py:-1
}
if (-1 != mktid){
last = mktid
list = list|mktid
}
tl = list + '#' + last + '#' + t1 + '#' + t2 + '#a=' + ct + '#' + sku + '#' + priorYrSku
setTTOLocationCookie(tl)
}
function setPriorYearSkuCookie(pysku)
{
var sku = pysku?pysku:-1
if ((typeof TTOModel != "undefined")){
TTOModel.setPriorYrSku(sku)
}
}
function zEventCancelListener(e){
var evt=new zEvent(e)
evt.cancel()
}
function zEventClearStatusBar(e){
window.status="";
return true;
}
function zEventSelectElement(e){
var evt=new zEvent(e)
try{
evt.element.select()
}
catch(e){}
}
function zEventKeyFilter(e)
{
var evt = new zEvent(e);
if (evt.which == 8)
{
if (evt.element.tagName == "INPUT" && (evt.element.type == "file" || evt.element.type == "password" || evt.element.type == "text" || evt.element.type == "tel"))
return;
else if (evt.element.tagName == "TEXTAREA")
return;
;
evt.cancel();
}
}
function zEvent( o){
var t=this
if(o)t.eventObj=o
else {
t.eventObj=window.event
if(!t.eventObj){
var i,cnt=window.frames.length
for(i=0;i<cnt;i++){
try {
t.eventObj = window.frames[i].event
} catch (ex) {}
if(t.eventObj)break
}
}
}
var e=t.eventObj
if(e){
t.type=e.type
if (e.target)t.element=e.target
else if(e.srcElement)t.element=e.srcElement
if(e.which)t.which=e.which
else if(e.keyCode)t.which=e.keyCode
e=null
}
}
function _zEventCancel(){
var e=this.eventObj
if(e){
try {
e.preventDefault()
e.stopPropagation()
e.cancelBubble=true
e.returnValue=false
}
catch (ex){
e.cancelBubble=true
e.returnValue=false
}
}
}
p=zEvent.prototype
p.eventObj=null
p.type=null
p.which=null
p.element=null
p.cancel=_zEventCancel
p=null
Animator = new function() {
var Animator = this;
var kIEOpacityFilter="DXImageTransform.Microsoft.Alpha";
Animator.run = function(efx, iterations, intervalTime, callback)
{
if(!(efx instanceof Array)) efx = new Array(efx);
var itr = 0, cnt = efx.length;
if(isUndefined(callback)) callback = null;
function _cancel()
{
if(tmrId)
{
itr = iterations;
_tick();
}
}
function _tick()
{
itr++;
var percent = itr/iterations;
for(var i=0; i < cnt; ++i) if(efx[i]) efx[i](percent);
if(percent > 1)
{
clearInterval(tmrId);
tmrId = null;
if(callback) callback();
}
}
for(var i=0; i < cnt; ++i) if(efx[i]) break;
if(i == cnt)
{
if(callback) callback();
return null;
}
var tmrId = setInterval(_tick, intervalTime);
return _cancel;
}
Animator.fade = function(e, start, end, callback)
{
if(start > 100) start = 100;
if(start < 0) start = 0;
if(end > 100) end = 100;
if(end < 0) end = 0;
Animator.setOpacity(e, start);
return function(percent)
{
if(percent < 1)
{
Animator.setOpacity(e, start + Math.floor((end - start) * percent));
show(e);
}
else if(1 == percent)
{
Animator.setOpacity(e, end);
if(0 == end)
{
hide(e);
Animator.setOpacity(e, 100);
}
}
else if(percent > 1 && isDefined(callback)) callback(e);
}
}
Animator.setOpacity=function(e,opacity){
if(opacity>100)opacity=100;
if(opacity<0)opacity=0;
if(!BrowserSniffer.isIE9() && (e.filters!=undefined&&e.filters!=null)){
if(Animator.hasOpacityFilter(e))
e.filters.item(kIEOpacityFilter).Opacity=opacity;
}
else{
var v=opacity/100;
if(v<0)v=0;
if(v>0.99)v=100;
e.style.opacity=v;
}
}
Animator.hasOpacityFilter=function(e){
return(e.filters!=undefined&&e.filters!=null&&e.filters.length>0&&e.filters.item(kIEOpacityFilter));
}
Animator.fadeColor = function(e, func, fromClrStr, toClrStr, callback)
{
var fromClr = new zColor(fromClrStr), endClr = new zColor(toClrStr);
return function(percent)
{
if(percent < 1)
{
var rInc = Math.floor((endClr.red - fromClr.red) * percent);
var gInc = Math.floor((endClr.green - fromClr.green) * percent);
var bInc = Math.floor((endClr.blue - fromClr.blue) * percent);
var cur = fromClr.clone();
cur.add(rInc, gInc, bInc);
func(e, cur.toString());
}
else if(1 == percent) func(e, toClrStr);
else if(percent > 1 && isDefined(callback)) callback(e);
}
}
Animator.resize = function(e, w1, h1, w2, h2, bAccel, callback)
{
if(isUndefined(w2) && isUndefined(h2)) return null;
if(isDefined(w2))
{
if(isUndefined(w1) || w1 == w2) return null;
e.style.width = w1 + "px";
}
if(isDefined(h2))
{
if(isUndefined(h1) || h1 == h2) return null;
e.style.height = h1 + "px";
}
return function(percent)
{
if(percent < 1)
{
if(bAccel) percent *= percent;
if(null != w2) e.style.width = (w1 + Math.floor((w2 - w1) * percent)) + "px";
if(null != h2) e.style.height = (h1 + Math.floor((h2 - h1) * percent)) + "px";
}
else if(percent >= 1)
{
if(null != w2) e.style.width = w2 + "px";
if(null != h2) e.style.height = h2 + "px";
if(percent > 1 && isDefined(callback)) callback(e);
}
}
}
Animator.move = function(e, x1, y1, x2, y2, bAccel, callback)
{
var startX = x1, startY = y1;
if(null != x1) e.style.left = x1 + "px";
if(null != y1) e.style.top = y1 + "px";
show(e);
return function(percent)
{
if(percent < 1)
{
if(bAccel) percent *= percent;
if(null != x1) e.style.left = (x1 + Math.floor((x2 - startX) * percent)) + "px";
if(null != y1) e.style.top = (y1 + Math.floor((y2 - startY) * percent)) + "px";
}
else if(1 == percent)
{
if(null != x1) e.style.left = x2 + "px";
if(null != y1) e.style.top = y2 + "px";
}
else if(percent > 1 && isDefined(callback)) callback(e);
}
}
}
zColor = function(hex)
{
var reHex = /^#/;
var reHexVal = /^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/;
var reRGB = /^rgb/;
var reRGBVal = /^rgb.*\((\d+),\s*(\d+),\s*(\d+)/;
if(!hex) return;
if(hex.match(reRGB))
{
var a = hex.match(reRGBVal);
if(!a || a.length != 4) throw "invalid";
this.red = parseInt(a[1]);
this.green = parseInt(a[2]);
this.blue = parseInt(a[3]);
}
else if(hex.match(reHex))
{
var a = hex.match(reHexVal);
if(!a || a.length != 4) throw "invalid";
this.red = parseInt(a[1], 16);
this.green = parseInt(a[2], 16);
this.blue = parseInt(a[3], 16);
}
else
{
hex = hex.toLowerCase();
switch(hex)
{
case "black": break;
case "red": this.red = 255; break;
case "white": this.red=255; this.green=255; this.blue=255; break;
default: throw hex + " unknown";
}
}
}
zColor.prototype = {
red : 0,
green : 0,
blue : 0,
copyTo : function(c)
{
if(!c) return;
c.red = this.red;
c.green = this.green;
c.blue = this.blue;
},
clone : function()
{
var c = new zColor();
this.copyTo(c);
return c;
},
add : function(r, g, b)
{
this.red += r;
if(this.red < 0 ) this.red = 0;
if(this.red > 255) this.red = 255;
this.green += g;
if(this.green < 0 ) this.green = 0;
if(this.green > 255) this.green = 255;
this.blue += b;
if(this.blue < 0 ) this.blue = 0;
if(this.blue > 255) this.blue = 255;
},
isEqual : function(cmp) {return (cmp && this.red == cmp.red && this.green == cmp.green && this.blue == cmp.blue);},
toString : function()
{
var clr = '#';
var n, s;
for(var i=0; i<3; ++i)
{
switch(i)
{
case 0: n = this.red; break;
case 1: n = this.green; break;
case 2: n = this.blue; break;
}
s = Math.round(n).toString(16);
if(s.length < 2) clr += '0';
clr += s;
}
return clr;
}
}
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
Dictionary = Class.extend({
_maxSize : 0,
_arr : [],
construct : function(maxSize) {
this._maxSize = maxSize || Infinity;
this._arr = [];
},
getIndexForKey : function(key) {
for(var i = 0, len = this._arr.length; i < len; i++) {
if(this._arr[i].key === key)
return i;
}
return -1;
},
add : function(key, value) {
var foundIndex = this.getIndexForKey(key);
var obj = {};
obj.key = key;
obj.val = value;
if(foundIndex == -1) {
if(this._arr.length < this._maxSize) {
this._arr.push(obj);
}
}
else {
this._arr[foundIndex] = obj;
}
},
remove : function(key) {
var foundIndex = this.getIndexForKey(key);
if(foundIndex > -1) {
this._arr.splice(foundIndex, 1);
}
},
get : function(key) {
var foundIndex = this.getIndexForKey(key);
return this._arr[foundIndex] ? this._arr[foundIndex].val : null;
},
each : function( cb) {
var that = this;
for(var i = 0, len = this._arr.length; i < len; i++) {
cb(that._arr[i].key, that._arr[i].val);
}
},
size : function() {
return this._arr.length;
},
clear : function() {
this._arr = [];
}
});
function BeaconRequest () {
var t = this ;
t.ProcessBeaconRequest = new Array() ;
}
function ProcessBeaconRequest () {
var t = this ;
t.TransactionID = "" ;
t.BeaconRequestData = null ;
}
function BeaconRequestData () {
var t = this ;
t.Screen = "" ;
t.EventType = "" ;
t.Tab = "" ;
t.SubTab= "" ;
t.TopicId= "" ;
t.DialogTitle = "";
t.FederalRefundAmount = "" ;
t.ProductId = "" ;
t.CustomerType = "" ;
t.TaxSessionLocation = "" ;
t.ClientProfileData = null ;
t.Param = new Array() ;
}
var eOmnitureBeacon = 0
var eOffermaticaBeacon= 1
var eDoubleClickBeacon= 2
var eDoubleClick2Beacon= 3
var eDigitalGrit= 4
var eCommissionJunction= 5
var eTTComTracking= 6
var eOmnitureOtherBeacon= 7
var eOffermatica2Beacon= 8
var beaconQueueSize = 5
var maxClientRetry = 5
var head = document.getElementsByTagName('head').item(0)
var scriptTagSID = document.getElementById("SIDScript")
if(!scriptTagSID)
{
var script = document.createElement('script')
script.src = "/scripts/sessionId.js"
script.type = 'text/javascript'
script.id = "SIDScript"
head.appendChild(script)
}
TrackingService = (function(){
var _instance = {
queueBeacon : function (transId, beaconData ) {
transId = decodeURIComponent(transId)
var dictObj = _beaconDictionary.get(transId);
if (! dictObj) {
var dictObj = new BeaconDictionaryObj();
_beaconDictionary.add(transId, dictObj);
}
dictObj.addBeacon(beaconData)
},
addBeacon : function (beaconData ) {
var bea = _createBeacon(beaconData)
if (bea)
bea.render()
},
setTTLocationInfo : function (info ) {
for (var n in info) {
_ttcomLocation[n] = info[n];
}
},
fireTTLocation : function () {
updateTTOLocation(
_ttcomLocation.mktid,
_ttcomLocation.tab1,
_ttcomLocation.tab2,
_ttcomLocation.sku
)
},
sendMetrics : function (transId, authId, genericBeaconDataTO ) {
transId = decodeURIComponent(transId)
if (genericBeaconDataTO) {
_setGenericBeaconData(transId, genericBeaconDataTO)
if( genericBeaconDataTO.pageIsBeaconed){
_fireBeaconEvent(authId)
} else{
this.fireBeacons(transId)
}
}
else {
this.fireBeacons(transId)
}
},
fireBeacons : function(transId) {
var dictObj = _beaconDictionary.get(transId);
if(dictObj == null)
return;
for (var i=0; i<dictObj._beaconList.length; i++){
var b = dictObj._beaconList[i]
var g = dictObj._genericBeaconData
for (var o in g) {
if ( (null == b[o] || "" === b[o]) && (null != g[o] && "" !== g[o]))
b[o] = g[o];
}
var bcn = _createBeacon(b);
if (bcn) bcn.render();
}
_beaconDictionary.remove(transId)
}
};
var kBeaconEventsURL = "/services/beacon-events",
kBeaconFireEventRequest = "fireEvent" ,
kPrepareBeaconRequest = "prepareBeacons",
_waitingForResponse = false,
_beaconDictionary = new Dictionary(beaconQueueSize),
_beaconQueue = new Array(),
_ttcomLocation = {};
BeaconDictionaryObj = Class.extend({
construct: function () {
this._genericBeaconData = null,
this._beaconList = new Array()
},
addBeacon : function (data) {
this._beaconList.push(data)
}
});
function _setGenericBeaconData(transId, data) {
var dictObj = _beaconDictionary.get(transId);
if (! dictObj) {
var dictObj = new BeaconDictionaryObj();
_beaconDictionary.add(decodeURIComponent(transId), dictObj);
}
dictObj._genericBeaconData = data
}
function _renderQueuedBeacons (beaconDataTO) {
var profileData = "";
if (beaconDataTO && beaconDataTO.profileData)
profileData = beaconDataTO.profileData;
for (var i=0; i<_beaconQueue.length; i++) {
var beac = _beaconQueue[i];
beac.data.profileData = profileData;
beac.render();
}
delete _beaconQueue;
_beaconQueue = new Array();
}
function _createBeacon(beaconTO) {
var bcn = null;
switch(beaconTO.type){
case eOmnitureBeacon:
case eOmnitureOtherBeacon:
bcn = new OmnitureBeacon(beaconTO)
break
case eOffermaticaBeacon:
case eOffermatica2Beacon:
bcn = new OffermaticaBeacon(beaconTO)
break
case eDoubleClickBeacon:
case eDoubleClick2Beacon:
bcn = new DoubleClickBeacon(beaconTO)
break
case eTTComTracking:
bcn = new TTComBeacon(beaconTO)
break
case "OMNITURE":
bcn = new NewOmnitureBeacon(beaconTO)
break
case "OFFERMATICA":
bcn = new NewOffermaticaBeacon(beaconTO)
break
case "DOUBLE_CLICK":
bcn = new NewDoubleClickBeacon(beaconTO)
break
case "COMMISSION_JUNCTION":
bcn = new NewCommissionJunctionBeacon(beaconTO)
break
case "TT_COM_TRACKING":
bcn = new NewTTComTrackingBeacon(beaconTO)
break
default:
break
}
return bcn
}
function _fireBeaconEvent (authId) {
_fireBeaconEventWithBeaconTO(authId) ;
}
function _fireBeaconEventWithBeaconTO (authId) {
if (_waitingForResponse) return;
if(_beaconDictionary.size() > 0) {
var beaconRequest = new BeaconRequest() ;
beaconRequest.ProcessBeaconRequest = new Array(_beaconDictionary.size()) ;
_beaconDictionary.each( function (key, value) {beaconRequest.ProcessBeaconRequest[key] = generateBeaconProcessRequest(value._genericBeaconData)} )
var url = kBeaconEventsURL + "/" + kPrepareBeaconRequest + "/" + authId ;
_postToApp( url, JSONSerializer.toString(beaconRequest), new BeaconEventHandler(authId));
}
}
function generateBeaconProcessRequest(beaconTO)
{
var pbr = new ProcessBeaconRequest() ;
var brd = new BeaconRequestData() ;
pbr.TransactionID = beaconTO.reqId ;
pbr.BeaconRequestData = brd ;
brd.Screen = beaconTO.currentScreenId ;
brd.EventType = beaconTO.eventType ;
brd.Tab = beaconTO.currentTab ;
brd.SubTab= beaconTO.currentSubItem ;
brd.TopicId= beaconTO.topicId ;
brd.DialogTitle = encodeURIComponent(beaconTO.LCTitle);
brd.ProductId = beaconTO.prodId ;
brd.CustomerType = beaconTO.customerType ;
brd.FederalRefundAmount = beaconTO.fedRefundAmount ;
brd.TaxSessionLocation = beaconTO.taxServer + ":" + beaconTO.taxPort ;
brd.ClientProfileData = beaconTO.profileData ;
brd.Param = beaconTO.params;
return pbr ;
}
function _postToApp( url, postData, responseHandler) {
xhr = new Ajax()
xhr.setAsync(true)
xhr.setURL(url)
xhr.setMethod("POST")
xhr.setPOSTData(postData);
xhr.setReqHeader("If-Modified-Since", "Sat, 1 Jan 2000 00:00:00 GMT")
xhr.setReqHeader('Content-Type', 'application/json');
xhr.setReqHeader("TTO-pageID","FIRE BEACON EVENT");
xhr.setSuccessCallback(_serviceSuccessCB)
xhr.setErrorCallback(_serviceFailureCB)
xhr.setTimeoutCallback(_serviceTimeoutCB)
xhr.send();
_waitingForResponse = true;
function _serviceSuccessCB( rsp) {
if (responseHandler) {
responseHandler.doSuccess(rsp);
_waitingForResponse = false;
}
}
function _serviceFailureCB(rsp) {
if ("undefined" != typeof(TTOEventPubSub)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BeaconEventHandler","Error " +rsp.status + " handling beacon request: " + rsp.statusText, LOG_ERROR))
}
if(rsp.status >= 400){
_beaconDictionary.clear();
}
_waitingForResponse = false;
}
function _serviceTimeoutCB(rsp) {
if ("undefined" != typeof(TTOEventPubSub)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BeaconEventHandler","Timeout handling beacon request: ", LOG_ERROR))
}
_waitingForResponse = false;
}
xhr = null;
}
return _instance;
})();
function BeaconDataTO () {
var t = this
t.pageIsBeaconed = false;
t.type = -1
t.title = ""
t.section = ""
t.customerSource = ""
t.prodId = 0
t.prodAlias = ""
t.currentTab = ""
t.currentSubItem = ""
t.topicId = ""
t.currentScreenId = ""
t.applicationId = "TTO"
t.marketingId = ""
t.priorYrProdId = 0
t.LCTags = ""
t.LCToken = ""
t.LCTitle = ""
t.oldStyleKeys = new Array();
t.profileData = null;
t.reqId = 0;
t.authId = 0;
t.numRetries = 0;
t.params = new Array();
t.customerType = "" ;
t.eventType = "" ;
t.fedRefundAmount = "" ;
t.taxServer = "" ;
t.taxPort = "" ;
}
Beacon = Class.extend({
data : null,
construct : function (reqTO ) {
if (reqTO)
this.data = reqTO
},
doDebugStuff : function(name, details) {
if (typeof DebugTO!="undefined") {
var TO = new DebugTO()
TO.addBeaconInfo(name, details);
var cmd = new DebugCommand(TO)
cmd.execute()
}
},
handleException : function(beacExc ) {
if (typeof(TTOEventPubSub) != 'undefined'){
var msg = "";
if(beacExc){
msg = "Could not set " + beacExc.Type + ' beacon';
if(beacExc.Error)
msg += "; Exception=" + beacExc.Error.name + ":" + beacExc.Error.message;
if(beacExc.AddlMessage)
msg += "; AddlMessage=" + beacExc.AddlMessage;
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BEACON",msg, LOG_WARNING))
}
}
});
kNewOMScript= "NewOMScript"
kNewSiteAdvanceJS= "/scripts/s_code.js"
try {
var head = document.getElementsByTagName('head').item(0)
var scriptTag = document.getElementById(kNewOMScript)
if(!scriptTag)
{
var script = document.createElement('script')
script.src = kNewSiteAdvanceJS
script.type = 'text/javascript'
script.id = kNewOMScript
head.appendChild(script)
}
}
catch(e) {
}
BaseOmnitureBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
clearOMVars : function() {
s.channel = ""
s.pageName = ""
s.events = ""
s.products = ""
s.purchaseID = ""
for(var i=1; i<=75; i++)
{
var eVar = "s.eVar"+i;
eVar += "= \"\"";
try{
eval(eVar);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "BaseOmniture::clearOMVars";
exc.Error = ex;
exc.AddlMessage = eVar + " is invalid.";
t.handleException(exc);
}
}
for(var i=1; i<=75; i++)
{
var prop = "s.prop"+i;
prop += "= \"\"";
try{
eval(prop);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "BaseOmniture::clearOMVars";
exc.Error = ex;
exc.AddlMessage = prop + " is invalid.";
t.handleException(exc);
}
}
}
});
kFlowValue= "flowvalue"
kAuthValue= "authvalue"
kCustSrc= "customerSource"
ksku= "sku"
OmnitureBeacon = BaseOmnitureBeacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var val = ""
var idx = -1
var id = ""
var title = ""
var hashid = getEventDeduperId()
var kttsid = "ttsid"
var ktab = "bctab"
var hasEvent28 = 0
var hasWecome = 0
var sku = t.data.prodId
var t1 = t.data.currentTab
var t2 = t.data.currentSubItem
var st = ""
var flowid = ""
var authoption = ""
var hardcodedTitle = ""
var hardcodedSect = ""
try {
t.clearOMVars()
s.channel = t.data.section
s.eVar4 = t.data.prodAlias
s.prop4 = getHashedAuthId()
s.prop5 = t.data.applicationId
if(t.data.profileData)
s.prop12 = t.data.profileData.requestTime + ":" + t.data.profileData.renderTime
s.prop13 = ""
s.prop14 = t.data.prodAlias
s.prop19 = t.data.currentScreenId
for (var i=0; i<t.data.oldStyleKeys.length; i++){
idx=-1
var itm =t.data.oldStyleKeys[i]
val=unescape(itm.value)
if (typeof val != 'number')
idx=val.indexOf(kttsid)
if(-1!=idx){
var nv = val.replace(/ttsid/g, hashid)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(ksku)
if(-1!=idx){
var nv = val.replace(ksku, sku)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(ktab)
if(-1!=idx){
var tabnames = t1 + ' ' + t2
var nv = val.replace(ktab, tabnames)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kFlowValue)
if(-1!=idx){
var nv = val.replace(kFlowValue, flowid)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kAuthValue)
if(-1!=idx){
var nv = val.replace(kAuthValue, authoption)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kCustSrc)
if(-1!=idx){
var cs = t.data.customerSource
var nv = val.replace(kCustSrc, cs)
val=nv
}
if ("s_pageName"==itm.key){
hardcodedTitle=val
}
else if ("s_channel"==itm.key){
hardcodedSect=val
}
else if ("s_purchaseID"==itm.key)
s.purchaseID=val
else if ("s_events"==itm.key){
s.events=val
idx=-1
if (typeof val != 'number')
idx=val.indexOf("event28")
if(-1!=idx){
hasEvent28=1
}
}
else if ("s_prop1"==itm.key)
s.prop1=val
else if ("s_prop2"==itm.key)
s.prop2=val
else if ("s_prop3"==itm.key)
s.prop3=val
else if ("s_prop6"==itm.key){
s.prop6=val
idx=-1
if (typeof val != 'number')
idx=val.indexOf("Welcome")
if(-1!=idx){
hasWecome=1
}
}
else if ("s_prop7"==itm.key)
s.prop7=val
else if ("s_prop8"==itm.key)
s.prop8=val
else if ("s_prop10"==itm.key)
s.prop10=val
else if ("s_prop13"==itm.key)
s.prop13=val
else if ("s_prop16"==itm.key)
s.prop16=val
else if ("s_prop17"==itm.key)
s.prop17=val
else if ("s_prop19"==itm.key)
s.prop19=val
else if ("s_prop21"==itm.key)
s.prop21=val
else if ("s_prop23"==itm.key)
s.prop23=val
else if ("s_products"==itm.key)
s.products=val
else if ("s_eVar1"==itm.key)
s.eVar1=val
else if ("s_eVar2"==itm.key)
s.eVar2=val
else if ("s_eVar8"==itm.key)
s.eVar8=val
else if ("s_eVar10"==itm.key)
s.eVar10=val
else if ("s_eVar12"==itm.key)
s.eVar12=val
else if ("s_eVar13"==itm.key)
s.eVar13=val
else if ("s_eVar14"==itm.key)
s.eVar14=val
else if ("s_eVar19"==itm.key)
s.eVar19=val
else if ("s_eVar21"==itm.key)
s.eVar21=val
else if ("s_eVar23"==itm.key)
s.eVar23=val
else if ("s_eVar24"==itm.key)
s.eVar24=val
else if ("state"==itm.key)
st=val
}
idx=-1
if (typeof s.events != 'number')
idx=s.events.indexOf("event9")
if(-1!=idx){
if (512==sku){
s.events+=",event12:"
}
else if (4==sku){
s.events+=",event11:"
}
else if (8==sku){
s.events+=",event15:"
}
else if (16==sku){
s.events+=",event14:"
}
else if (32==sku){
s.events+=",event16:"
}
else if (2==sku){
s.events+=",event13:"
}
s.events+=s.purchaseID
if ("1"==st){
if (4==sku)
s.events+=",event18:"
else
s.events+=",event17:"
s.events+=s.purchaseID
}
}
var tempPageName = t.data.currentScreenId
tempPageName+=' - '
tempPageName+= (4==sku)?"FFA":"NONFFA"
tempPageName+=' - '
if(hardcodedTitle!="")
tempPageName+= hardcodedTitle
else
tempPageName+= t.data.LCTitle
s.pageName=tempPageName;
if(hardcodedSect!=""){
s.channel=hardcodedSect;
} else{
var tempChannel = t.data.currentTab
tempChannel += " - "
tempChannel += t.data.currentSubItem
s.channel=decodeURIComponent(tempChannel);
}
var om=s.t();
if(om)
document.write(om)
t.doDebugStuff("OldOmniture", om_requestURL)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "OldOmniture";
exc.Error = ex;
t.handleException(exc);
}
}
});
NewOmnitureBeacon = BaseOmnitureBeacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if(!t.data) return
try {
t.clearOMVars()
var eventDeduperId = getEventDeduperId();
var hashedId = getHashedAuthId();
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(name=="s.prop12" && t.data.profileData != null) {
s.prop12 = t.data.profileData.requestTime + ":" + t.data.profileData.renderTime
} else {
value = value.replace(/eventDeduperId/g, eventDeduperId)
value = value.replace(/hashedId/g, hashedId)
var assignment = name + '= "' + escapeSpecialChars(value) + "\"";
try {
eval(assignment);
} catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOmniture";
exc.Error = ex;
exc.AddlMessage = assignment + " is invalid.";
t.handleException(exc);
}
}
}
var om=s.t();
if(om)
document.write(om)
t.doDebugStuff("NewOmniture", om_requestURL)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOmniture";
exc.Error = ex;
t.handleException(exc);
}
}
});
var kBeaconFrameID = "bea"
var kBeaconFrameID2 = "bea2"
OffermaticaBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $(kBeaconFrameID)
if (!p){
p = appendIFrame(d,document.body,kBeaconFrameID,"Beacon","blank.htm");
p.id = kBeaconFrameID;
}
p = frames[kBeaconFrameID]
var p2 = null
var ofid=""
var ofid2=""
var pl=""
var tmp=""
var val=""
var idx=-1
var flowid = ""
var authoption = ""
var sku=t.data.prodId
var s=""
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if (("ofid"==itm.key) || ("ofid2"==itm.key)|| ("zofid"==itm.key)){
if (ofid.length>0){
pl+="&ofid="
pl+=ofid
pl+=tmp
tmp=""
}
ofid=itm.value
if ("ofid2"==itm.key){
ofid2=itm.value
}
}
else {
val=itm.value
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kFlowValue)
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
else {
var nv = val.replace(kFlowValue, flowid)
val=nv
}
}
else
{
if (typeof val != 'number')
idx=val.indexOf(kAuthValue)
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
else {
var nv = val.replace(kAuthValue, authoption)
val=nv
}
}
else
{
if (typeof itm.key != 'number')
idx=itm.key.indexOf("bv")
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
}
}
}
if (-1==idx){
if (typeof val != 'number')
idx=val.indexOf(ksku)
if(-1!=idx){
var nv = val.replace(ksku, sku)
val=nv
}
}
if (-1==idx){
if (typeof val != 'number')
idx=val.indexOf(kCustSrc)
if(-1!=idx){
var cs = t.data.customerSource
var nv = val.replace(kCustSrc, cs)
val=nv
}
}
if (-1==idx)
{
tmp+="&"
tmp+=itm.key
tmp+="="
tmp+=itm.value
}
else
if (val!="")
{
tmp+="&"
tmp+=itm.key
tmp+="="
tmp+=val
}
}
}
try{
if (ofid!=""){
pl+="&ofid="
pl+=ofid
pl+=tmp
if (ofid2!=""){
p2 = $(kBeaconFrameID2)
if (!p2){
p2 = appendIFrame(d,document.body,kBeaconFrameID2,"Beacon","blank.htm");
p2.id = kBeaconFrameID2;
}
p2 = frames[kBeaconFrameID2]
s="/secure/beacon2.htm"
s+="?"
s+=pl
p2.location.replace(s)
} else {
s="/secure/beacon.htm"
s+="?"
s+=pl
p.location.replace(s)
}
t.doDebugStuff("Offermatica", s)
}
}
catch(ex) {
var exc = new BeaconException();
exc.Type = "Offermatica";
exc.Error = ex;
t.handleException(exc);
$(kBeaconFrameID).src=s
}
}
});
var kBeaconFrameID = "bea"
var kBeaconFrameID2 = "bea2"
NewOffermaticaBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function () {
var t=this
if (!t.data) return
var p = $(kBeaconFrameID)
if (!p){
p = appendIFrame(d,document.body,kBeaconFrameID,"Beacon","blank.htm");
p.id = kBeaconFrameID;
}
p = frames[kBeaconFrameID]
var pl=""
var s=""
try {
for(var i=0; i<t.data.params.length; i++) {
if(pl.length>0)
pl += "&"
pl += t.data.params[i].name + '=' + t.data.params[i].value
}
s="/secure/beacon.htm"
s+="?&"
s+=pl
p.location.replace(s)
t.doDebugStuff("NewOffermatica", s)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOffermatica";
exc.Error = ex;
t.handleException(exc);
$(kBeaconFrameID).src=s
}
}
});
var kDoubleClickURL = "https://fls.doubleclick.net/activityi;src=1984865;"
DoubleClickBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("DblClickFrame")
if (!p){
p = appendIFrame(document,document.body,"DblClickFrame","Beacon","blank.htm");
p.id = "DblClickFrame";
}
p = frames["DblClickFrame"]
var fn=kDoubleClickURL
var pl=""
var plyoy=""
var val=""
var key=""
var idx=-1
var uk=0
var sku="0"
var u8="0"
var u12=""
var u13=""
var ttsid=getHashedAuthId()
var kttsid="ttsid"
var type=""
var cat=""
var ord=""
var num=""
var prodId=t.data.prodId
var skus = new Array()
for (var j=0; j<6; j++){
skus[j]=0;
}
var axel = Math.random()+"";
var ax = axel * 10000000000000;
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if ("sku"==itm.key){
sku=itm.value
}
else
{
if (i>0) pl+=';'
pl+=itm.key
pl+='='
val=itm.value
if (typeof val != 'number'){
idx=val.indexOf("random")
if(-1!=idx){
var nv = val.replace("random", ax)
itm.value=nv
}
}
pl+=itm.value
if ("u8"==itm.key){
u8=itm.value
}
if ( "type" == itm.key ){
type=itm.value
} else if ("cat" == itm.key){
cat=itm.value
} else if ("num" == itm.key){
num=itm.value
} else if ("ord" == itm.key){
ord=itm.value
} else if ("u12" == itm.key){
u12=itm.value
if (typeof u12 != 'number'){
idx=u12.indexOf("u12value")
if(-1!=idx){
var qp = prodId;
qp += ",0,0.0"
u12 = u12.replace("u12value", qp)
pl = pl.replace("u12value", qp)
}
}
} else if ("u13" == itm.key){
u13=itm.value
if (typeof u13 != 'number'){
idx=u13.indexOf("u13value")
if(-1!=idx){
u13 = u13.replace("u13value", ttsid)
pl = pl.replace("u13value", ttsid)
}
}
}
}
}
idx=pl.indexOf("u8")
if(-1!=idx){
if("1"==u8){
if ("512"==sku)
skus[1]=1
else
if ("4"==sku)
skus[0]=1
else
if ("8"==sku)
skus[4]=1
else
if ("16"==sku)
skus[3]=1
else
if ("32"==sku)
skus[5]=1
else
if ("2"==sku)
skus[2]=1
}
for (var j=0; j<6; j++){
pl+=';'
pl+='u'
uk=j+1
pl+=uk
pl+='='
pl+=skus[j]
}
}
if ("ttone268"==cat || "ttoex527"==cat){
plyoy ="type=" + type + ";" + "cat=" + cat + ";" + "u12=" + u12+ ";" + "u13=" + u13 + ";" + "ord=" + ord + ";" + "num=" + num
fn+=plyoy
} else {
fn+=pl
}
fn+="?"
try{
p.location.replace(fn)
}catch (ex) {
var exc = new BeaconException();
exc.Type = "DoubleClick";
exc.Error = ex;
t.handleException(exc);
}
t.doDebugStuff("DoubleClick", fn)
}
});
var kDoubleClickURL = "https://fls.doubleclick.net/activityi;src=1984865;"
NewDoubleClickBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("DblClickFrame")
if (!p){
p = appendIFrame(document,document.body,"DblClickFrame","Beacon","blank.htm");
p.id = "DblClickFrame";
}
p = frames["DblClickFrame"]
var fn=kDoubleClickURL
var hashedId=getHashedAuthId()
var pl=""
try{
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(pl.length>0)
pl += ";"
if(value.indexOf("hashedId") >= 0)
value = value.replace("hashedId", hashedId)
pl += name + '=' + value
}
fn+=pl
fn+="?"
p.location.replace(fn)
t.doDebugStuff("NewDoubleClick", fn)
}catch (ex) {
var exc = new BeaconException();
exc.Type = "NewDoubleClick";
exc.Error = ex;
t.handleException(exc);
}
}
});
var kCJURL = "https://www.emjcd.com/u?"
NewCommissionJunctionBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("BeaconArea")
if (!p){
p = appendLayer(document.body,"BeaconArea")
p.id="BeaconArea"
p.name="BeaconArea"
}
var fn=kCJURL
var hashedId=getHashedAuthId()
var pl=""
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(pl.length>0)
pl += "&"
if(value.indexOf("hashedId") >= 0)
value = value.replace("hashedId", hashedId)
pl += name + '=' + value
}
fn+=pl
TTO.DU.appendImg( p, fn, 20, 1)
t.doDebugStuff("NewCommissionJunction", fn)
}
});
TTComBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
try {
var mktid = ""
var kmktid="mktid"
var list = 0
var tabs = ""
var sku = t.data.prodId
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if( kmktid == itm.key){
mktid = itm.value
var p = mktid.indexOf(",")
if(p != -1){
mktid = mktid.substr(0, p)
}
break
}
}
TrackingService.setTTLocationInfo({
"mktid" : mktid,
"sku" : sku
})
t.doDebugStuff("TTCom Tracking", mktid+" : "+sku)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "TTComTracking";
exc.Error = ex;
t.handleException(exc);
}
}
});
NewTTComTrackingBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
try {
var mktid = ""
var sku = ""
for (var i=0; i<t.data.params.length; i++){
var name = t.data.params[i].name;
var value = t.data.params[i].value;
var assignment = name + '= "' + value + "\"";
try {
eval(assignment);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "NewTTComTracking";
exc.Error = ex;
exc.AddlMessage = assignment + " is invalid.";
t.handleException(exc);
}
}
TrackingService.setTTLocationInfo({
"mktid" : mktid,
"sku" : sku
})
t.doDebugStuff("New TTCom Tracking", mktid+" : "+sku)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewTTComTracking";
exc.Error = ex;
t.handleException(exc);
}
}
});
var hexcase = 0;
var b64pad = "";
var chrsz = 8;
function hex_md5(s){ return binl2hex(core_md5(str2binl(s), s.length * chrsz));}
function b64_md5(s){ return binl2b64(core_md5(str2binl(s), s.length * chrsz));}
function str_md5(s){ return binl2str(core_md5(str2binl(s), s.length * chrsz));}
function hex_hmac_md5(key, data) { return binl2hex(core_hmac_md5(key, data)); }
function b64_hmac_md5(key, data) { return binl2b64(core_hmac_md5(key, data)); }
function str_hmac_md5(key, data) { return binl2str(core_hmac_md5(key, data)); }
function md5_vm_test()
{
return hex_md5("abc") == "900150983cd24fb0d6963f7d28e17f72";
}
function core_md5(x, len)
{
x[len >> 5] |= 0x80 << ((len) % 32);
x[(((len + 64) >>> 9) << 4) + 14] = len;
var a = 1732584193;
var b = -271733879;
var c = -1732584194;
var d = 271733878;
for(var i = 0; i < x.length; i += 16)
{
var olda = a;
var oldb = b;
var oldc = c;
var oldd = d;
a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
c = md5_ff(c, d, a, b, x[i+ 2], 17, 606105819);
b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
d = md5_ff(d, a, b, c, x[i+ 5], 12, 1200080426);
c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
a = md5_ff(a, b, c, d, x[i+ 8], 7 , 1770035416);
d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
a = md5_ff(a, b, c, d, x[i+12], 7 , 1804603682);
d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
b = md5_ff(b, c, d, a, x[i+15], 22, 1236535329);
a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
c = md5_gg(c, d, a, b, x[i+11], 14, 643717713);
b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
d = md5_gg(d, a, b, c, x[i+10], 9 , 38016083);
c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
a = md5_gg(a, b, c, d, x[i+ 9], 5 , 568446438);
d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
b = md5_gg(b, c, d, a, x[i+ 8], 20, 1163531501);
a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
c = md5_gg(c, d, a, b, x[i+ 7], 14, 1735328473);
b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);
a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
c = md5_hh(c, d, a, b, x[i+11], 16, 1839030562);
b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
d = md5_hh(d, a, b, c, x[i+ 4], 11, 1272893353);
c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
a = md5_hh(a, b, c, d, x[i+13], 4 , 681279174);
d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
b = md5_hh(b, c, d, a, x[i+ 6], 23, 76029189);
a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
c = md5_hh(c, d, a, b, x[i+15], 16, 530742520);
b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);
a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
d = md5_ii(d, a, b, c, x[i+ 7], 10, 1126891415);
c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
a = md5_ii(a, b, c, d, x[i+12], 6 , 1700485571);
d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
a = md5_ii(a, b, c, d, x[i+ 8], 6 , 1873313359);
d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
b = md5_ii(b, c, d, a, x[i+13], 21, 1309151649);
a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
c = md5_ii(c, d, a, b, x[i+ 2], 15, 718787259);
b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);
a = safe_add(a, olda);
b = safe_add(b, oldb);
c = safe_add(c, oldc);
d = safe_add(d, oldd);
}
return Array(a, b, c, d);
}
function md5_cmn(q, a, b, x, s, t)
{
return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t)
{
return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t)
{
return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t)
{
return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t)
{
return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}
function core_hmac_md5(key, data)
{
var bkey = str2binl(key);
if(bkey.length > 16) bkey = core_md5(bkey, key.length * chrsz);
var ipad = Array(16), opad = Array(16);
for(var i = 0; i < 16; i++)
{
ipad[i] = bkey[i] ^ 0x36363636;
opad[i] = bkey[i] ^ 0x5C5C5C5C;
}
var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz);
return core_md5(opad.concat(hash), 512 + 128);
}
function safe_add(x, y)
{
var lsw = (x & 0xFFFF) + (y & 0xFFFF);
var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
return (msw << 16) | (lsw & 0xFFFF);
}
function bit_rol(num, cnt)
{
return (num << cnt) | (num >>> (32 - cnt));
}
function str2binl(str)
{
var bin = Array();
var mask = (1 << chrsz) - 1;
for(var i = 0; i < str.length * chrsz; i += chrsz)
bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);
return bin;
}
function binl2str(bin)
{
var str = "";
var mask = (1 << chrsz) - 1;
for(var i = 0; i < bin.length * 32; i += chrsz)
str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & mask);
return str;
}
function binl2hex(binarray)
{
var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
var str = "";
for(var i = 0; i < binarray.length * 4; i++)
{
str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +
hex_tab.charAt((binarray[i>>2] >> ((i%4)*8 )) & 0xF);
}
return str;
}
function binl2b64(binarray)
{
var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
var str = "";
for(var i = 0; i < binarray.length * 4; i += 3)
{
var triplet = (((binarray[i >> 2] >> 8 * ( i %4)) & 0xFF) << 16)
| (((binarray[i+1 >> 2] >> 8 * ((i+1)%4)) & 0xFF) << 8 )
| ((binarray[i+2 >> 2] >> 8 * ((i+2)%4)) & 0xFF);
for(var j = 0; j < 4; j++)
{
if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;
else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);
}
}
return str;
}
function hardExitBeacon()
{
var sprops="TTO>Hard Exit"
var ttsid=getEventDeduperId()
var ev="event29:"
ev+=ttsid
var kKeys = ["s_prop6", "s_prop7", "s_events", "s_prop19"]
var kValues = [sprops, sprops, ev, "Hard Exit"]
zBeacon.addBeacon(eOmnitureBeacon,"","",kKeys,kValues)
}
function getHashedAuthId(){
var hv = ""
var id = ""
var tmp = ""
if (typeof(TTOModel) !="undefined") {
id = unescape(TTOModel.getUserId()).split(':')[0]
}
else {
id = getNameSpaceCookie("AUTH_NS","authid");
if ( "" == id ){
id = getNameSpaceCookie("AUTH_NS","userid");
}
}
if ( id != ""){
tmp = hex_md5(id)
hv = tmp.substr(0,4);
var len = id.length
var hf = Math.round( len / 2 )
var id1 = id.substr( 0, hf )
var id2 = id.substr( hf, id.length - 1)
hv += id2
hv += id1
}
return hv;
}
function getEventDeduperId(){
var hv = getHashedAuthId();
if(hv == "") {
hv = getSessionId();
}
hv += "2011".substr("2011".length-2);
return hv;
}
function escapeSpecialChars(str){
return str.replace(/\\/g, "\\\\").replace(/\"/g, "\\\"");
}
function TTOResponseTO() {
this.httpStatus;
this.httpStatusText;
this.sessionEvent = null;
this.EZStepData = null
this.responseJSON=null
this.responseXML=null
}
TTOServiceHandler = Class.extend({
_onHandleSuccess : null,
_onHandleFailure : null,
_onHandleTimeout : null,
_responseTO : null,
construct : function (){
this.constructor = TTOServiceHandler
this._responseTO = new TTOResponseTO();
},
setSuccessCB : function(CB){this._onHandleSuccess=CB;},
setFailureCB : function(CB){this._onHandleFailure=CB;},
setTimeoutCB : function(CB){this._onHandleTimeout=CB;},
getResponseTO : function () {return this._responseTO;},
doSuccess : function (rsp ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
r.responseText = rsp.responseText;
r.responseXML = rsp.responseXML;
r.responseJSON = JSONSerializer.toJSON(rsp.responseText);
if (this._onHandleSuccess)
this._onHandleSuccess(r)
},
doFailure : function(rsp , url ) {
var r = this._responseTO
try {
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
}
catch(error) {
}
finally {
if (this._onHandleFailure) {
this._onHandleFailure(r, url)
}
}
},
doTimeout : function(rsp , url ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
if (this._onHandleTimeout)
this._onHandleTimeout(r, url)
}
});
BeaconEventHandler = TTOServiceHandler.extend({
construct : function () {
this.superClass.construct.call(this);
},
_onHandleSuccess : function(respTO) {
var json = respTO.responseJSON
var beaconResponse=json.beaconResponse;
if (beaconResponse.length==0){
return;
}
for(var i=0; i<beaconResponse.length; i++){
var beaconList=beaconResponse[i].beacon
var transId=beaconResponse[i].transactionID;
for(var j=0; j<beaconList.length; j++){
var params = beaconList[j].params.param;
var beaconParams = new Array();
for(var k=0; k<params.length; k++){
beaconParams.push(params[k]);
}
var serverBeaconData = new BeaconDataTO();
serverBeaconData.type = beaconList[j].type;
serverBeaconData.params = beaconParams;
TrackingService.queueBeacon(transId, serverBeaconData)
}
transId = decodeURIComponent(transId) ;
TrackingService.fireBeacons(transId);
}
}
});
var JSONSerializer = {
toString: function (obj) {
var t = typeof (obj);
if (t != "object" || obj === null) {
if (t == "string") obj = '"'+obj+'"';
return String(obj);
}
else {
var n, v, json = [], arr = (obj && obj.constructor == Array);
for (n in obj) {
v = obj[n]; t = typeof(v);
if (t == "string") v = '"'+v+'"';
else if (t == "object" && v !== null) v = this.toString(v);
json.push((arr ? "" : '"' + n + '":') + String(v));
}
return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
}
},
toJSON : function (jsonString) {
if (!jsonString) return null
jsonString = jsonString.replace(/\0$/,"")
var json = null;
try {
json = eval('(' + jsonString + ')');
}
catch (ex) {
if ('undefined' != TTOEventPubSub) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("JSONSerializer","Invalid JSON\n\n"+jsonString,LOG_ERROR, ex))
}
return json
}
}
function BeaconException () {
var t = this ;
t.Type = "";
t.Error = "";
t.AddlMessage = "";
}
function addGenericOMBeacon(title, sect)
{
var csrc=requestParam("customerSource");
var prodid=requestParam("productid");
var vals = new Array()
var o = {"key":"s_pageName","value":title}
var o = {"key":"s_channel","value":sect}
vals.push(o)
var TO = new BeaconDataTO()
TO.type = eOmnitureBeacon
TO.title = title
TO.section = sect
if (csrc) TO.customerSource = csrc
TO.prodId = prodid?prodid:0
TO.oldStyleKeys = vals
TrackingService.addBeacon(TO)
}
function addBeacon( type, k, v){
var csrc=requestParam("customerSource");
var prodid=requestParam("productid");
var vals = new Array()
for (var i=0; i<k.length; i++) {
var o = {"key":k[i],"value":v[i]}
vals.push(o)
}
var TO = new BeaconDataTO()
TO.type = type
if (csrc) TO.customerSource = csrc
TO.prodId = prodid?prodid:0
TO.oldStyleKeys = vals
TrackingService.addBeacon(TO)
}
kCurrentYear = "2011"
kLastYear = "2010"
kProdID = "productid";
kImagePath = "/img/"
kTechSupportURL = "https://turbotax.intuit.com/support/in-product/home/?tmSrc=cookie"
kLicenseStatement = "Service and License agreement"
kBullet = " \u2022 "
kSpace = "\u00A0"
kAsterisk = "\u002A"
d = document
gTabIndex=0
gAllowClick=true
gbIE = BrowserSniffer.isIE()
gbSafari = BrowserSniffer.isSafari()
gDebugWindow=null
document.onmouseover=hidestatus
function hidestatus() {window.status=''; return true}
function isLowEndProduct(prodid) {
return (prodid == 4)
}
function __zLoadCSS( f, id, m)
{
if (isUndefined(f))
return;
if (isUndefined(m))
m = 'screen';
var headID = document.getElementsByTagName("head")[0];
var cssNode = document.createElement('link');
cssNode.type = 'text/css';
cssNode.rel = 'stylesheet';
cssNode.href = "/css/"+f;
cssNode.media = m;
if (id) cssNode.id = id
headID.appendChild(cssNode);
}
function $(id){return document.getElementById(id)}
function isUndefined(v){
return(v==undefined||null==v)
}
function isDefined(v){
return(v!=undefined&&v!=null)
}
function doJSONEval(jsonString) {
if (escape(jsonString.charAt(jsonString.length - 1)) == '%00') {
jsonString = jsonString.substring(0,jsonString.length-1)
}
return eval('(' + jsonString + ')');
}
function cancelEvent(evt) {
if (window.showModalDialog)
{
window.event.cancelBubble=true
window.event.returnValue=false
}
else
{
evt.preventDefault()
evt.stopPropagation()
}
}
function setDim(e,w,h){
var s=e.style
if(w){
if(!isNaN(w)){
if(w<0)w=0
w+="px"
}
s.width=w
}
if(h){
if(!isNaN(h)){
if(h<0)h=0
if(h<20)s.fontSize="1px"
h+="px"
}
s.height=h
}
if(w&&h)s.overflow="hidden"
}
function getWindowWidth(){
var w=(BrowserSniffer.isMozilla())?window.innerWidth:document.documentElement.clientWidth
return w
}
function getWindowHeight(){
var h=(BrowserSniffer.isMozilla())?window.innerHeight:document.documentElement.clientHeight
return h
}
function setFocus(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !(e._input || (e.type == "select-one"))) e=e.parentNode
if(!e) return
e.style.borderColor='#333333'
if (typeof Animator!="undefined" && null!=Animator && !(e.type == "select-one" && gbIE))
Animator.run(Animator.fadeColor (e,setBGColor,'#ffffff','#e9ecfd'),8, 30)
else
e.style.backgroundColor='#e9ecfd'
}
function setBlur(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !(e._input || (e.type == "select-one"))) e=e.parentNode
if(!e) return
e.style.borderColor='#666666'
e.style.backgroundColor='#ffffff'
}
function setBGColor(e,clr){
e.style.backgroundColor=clr
}
function openWindow(page, name)
{
if (!name)
name = 'SessWnd';
SessWnd = window.open(page,name,'scrollbars=1,resizable=1,width=750,height=550');
if (SessWnd) {
SessWnd.focus();
}
}
function onCopyright(){
openWindow("http://www.intuit.com/company/")
}
function onPrivacy(){
var prodID = requestParam(kProdID);
if (prodID==4){
openWindow("http://security.intuit.com/privacy")
} else {
openWindow("http://security.intuit.com/privacy")
}
}
function onLegal(){
var prodID = requestParam(kProdID);
if (prodID==4){
openWindow("https://turbotaxweb.qprd.turbotaxonline.intuit.com/open/registration/Legal_FFA.htm"+location.search)
} else {
openWindow("https://turbotaxweb.qprd.turbotaxonline.intuit.com/open/registration/Legal.htm"+location.search)
}
}
function onGoBack(){
if (window.history)
window.history.go(-1)
}
function goToPage(page) {
location.href=page
}
function hide( e){if(e)e.style.visibility="hidden"}
function show( e){if(e)e.style.visibility="inherit"}
function appendLayer(p,css,id){
var e = document.createElement("div")
if (css)e.className=css
if (id) e.id=id
if(p) p.appendChild(e)
return e
}
function createSelectList( n, o, f1, bNoAnimateFocus) {
var e=d.createElement("SELECT")
e.className="edit"
e.tabIndex=++gTabIndex
if(n)e.id=n
if (!bNoAnimateFocus){
if(gbIE) {
e.onfocusin=setFocus
} else
{
e.onfocus=setFocus
}
e.onblur=setBlur
}
if(f1)e.onchange=f1
addOptions(e,o)
return e
}
function addOptions( s, c) {
if(!c || c.length==0) return
for (var i=s.options.length-1;i>0;i--) s.options[i]=null
for (var i=0;i < c.length;i++) {
s.options[i]=new Option()
var text = "";
var value = ""
if (typeof c[i] == "object") {
value = c[i].value
text = c[i].text
}
else {
value = c[i]
text = c[i]
}
s.options[i].value=value
s.options[i].text=text
}
s.options[0].selected=true
}
function createInput( n, w, x, bPW, css, bNoAnimateFocus) {
var e=document.createElement("INPUT");
(bPW)?e.type="password":"text"
if(n)e.id=n
if(w)e.size=w
if(x)e.maxLength=x
if(css)e.className=css
else e.className="edit"
e._input=true
if (!bNoAnimateFocus) {
e.onfocus=setFocus
e.onblur=setBlur
}
e.tabIndex=++gTabIndex
return e
}
function createNamedElement(type, name)
{
var element = null;
try {
element = document.createElement('<'+type+' name="'+name+'">');
}
catch (e)
{
}
if (!element || element.nodeName != type.toUpperCase())
{
element = document.createElement(type);
element.name = name;
}
return element;
}
function createRadioButtons( n, choices, f, x)
{
var cnt = choices.length;
var radio_container_div = document.createElement("div");
var i = 0;
for(i = 0; i < cnt; i++)
{
var lbl = null;
var radio_row_div = document.createElement("div");
radio_row_div.className = "inputBtnRow";
radio_container_div.appendChild(radio_row_div);
var rb_div = document.createElement("div");
rb_div.className = "inputBtn";
radio_row_div.appendChild(rb_div);
var input_tag = createNamedElement("input", "rb_" + n);
input_tag.type = 'radio';
input_tag.className = "rad"
input_tag.id = n + i;
input_tag.tabIndex = ++gTabIndex;
if (f)
input_tag.onclick = f;
if (!x && i==0)
input_tag.defaultChecked = true;
else if (x && x==i)
input_tag.defaultChecked = true;
rb_div.appendChild(input_tag);
var radio_lbl_div = document.createElement("div");
radio_lbl_div.className = "inputBtnLbl";
if (gbIE || gbSafari)
radio_lbl_div.style.paddingTop = "2px";
var label_tag = document.createElement("label");
label_tag.className = "inputBtn";
label_tag.htmlFor = input_tag.id;
label_tag.innerHTML = choices[i];
radio_lbl_div.appendChild(label_tag);
radio_row_div.appendChild(radio_lbl_div);
}
return radio_container_div;
}
function RBTextClickListener(ne){
var evt = new zEvent(ne);
var e=evt.element;
while(e && !e._rb) e=e.parentNode
if(!e) return
e=e._prm
if(!e) return
if (e.disabled==true)
return;
e.checked=true
}
function getRBIndex( n, c) {
for(var i=0; i < c.length; i++){
var rd=document.getElementById(n+i)
if(rd&&rd.checked) return i
}
return -1
}
function enableRBControls( n, c, _enable)
{
if (isUndefined(_enable))
_enable = true;
for(var i=0; i < c.length; i++){
var rd=document.getElementById(n+i)
rd.disabled=!_enable;
}
}
function createCheckBox( id, text, css, bChecked, html) {
var P = d.createElement("DIV")
var oTable = createTable()
var oRow = appendTableRow(oTable)
var oCell1 = appendTableCol(oRow,null,"baseline","1px")
oCell1.style.paddingRight="5px"
var oCell2 = appendTableCol(oRow)
oCell2._cb=true
oCell2.onclick=CBTextClickListener
P.appendChild(oTable)
var e=d.createElement("INPUT")
e.type="checkbox"
e.className="chk"
e.tabIndex=++gTabIndex
if(id)e.id=id
if(bChecked)e.defaultChecked=true
oCell1.appendChild(e)
if (html)
{
oCell2.appendChild(html)
}
else
{
oCell2.appendChild(createText(text,css))
}
oCell2._prm = e
return P
}
function CBTextClickListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._cb) e=e.parentNode
if(!e) return
e=e._prm
if(!e) return
e.checked=!e.checked
}
function createTextArea( n, w, h, x, f) {
var e=d.createElement("TEXTAREA")
if(n)e.id=n
if(w)e.cols=w
if(h)e.rows=h
if(x)e.maxLength=x
if(f)e.onkeyup=f
e.showWarning=false
e.tabIndex=++gTabIndex
return e
}
function createText( t, css, id){
e=document.createElement("SPAN")
if (css) e.className=css
if (id) e.id=id
if (t) e.appendChild(document.createTextNode(t))
return e
}
function createPageLink( t, css, l) {
var e = createLink(t,css,"goToPage('"+kPath+l+location.search+"')")
return e
}
function createLink( t, css, act, icn) {
var e=document.createElement("A")
e._lnk=true;
if (css) e.className=css
if (icn) {
e.appendChild(createImage(icn))
e.appendChild(createImage("clear.gif",5))
}
if (t){
e.appendChild(createText(t))
e.id="link-" + t.replace(/[^A-Za-z0-9_]/g,"_")
}
if (act) e.href="javascript:;"
if (act) e.act=act
e.onclick = linkClickListener
return e
}
function linkClickListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._lnk) e=e.parentNode
if(!e) return
if (!gAllowClick) return
if (e.act && typeof e.act == "function")
eval('e.act()')
else if (e.act)
eval(e.act)
evt.cancel()
}
function createImage( n, w, h, f) {
var i=d.createElement("IMG")
if (n) i.src = kImagePath+n
i.border=0
if (f) {
var cursor="pointer"
if(BrowserSniffer.isIE()) cursor="hand"
i.style.cursor=cursor
i.onclick=f
}
if(w) i.width=w
if(h) i.height=h
i.align="top"
return i
}
function createButton( txt, act, bBack, css) {
var Btn = createLink("",css?css:'ansSess',act)
var spn = document.createElement('span')
Btn.appendChild(spn)
Btn.tabIndex=++gTabIndex
if (bBack){
spn.appendChild(createImage('md_leftarrow_blu.gif'))
}
Btn.txt = document.createTextNode(txt);
spn.appendChild(Btn.txt);
return Btn;
}
function createTRUSTe(bUseTRUSTeLogo, bAddFeedbackLoop, FBLact){
var d=document
var priv=d.createElement("DIV")
if (bUseTRUSTeLogo) {
priv.appendChild(createImage('trustelogo.gif',116, 32, onPrivacy))
priv.appendChild(d.createElement("BR"))
priv.appendChild(createText('\xa9 2011 Intuit Inc. All rights reserved.',"copyright"))
}
else {
priv.appendChild(createLink('License Agreement',"privacy",onLegal))
priv.appendChild(createText(" | ","copyright_sep"))
priv.appendChild(createLink('Privacy Statement',"privacy",onPrivacy))
if (bAddFeedbackLoop){
priv.appendChild(createText(" | ","copyright_sep"))
priv.appendChild(createLink('Send Us Feedback',"privacy",FBLact))
}
priv.appendChild(d.createElement("BR"))
priv.appendChild(createText('\xa9 2011 Intuit Inc. All rights reserved.',"copyright"))
}
return priv
}
function createTable( cp, cs, w, bBrd, css)
{
var e=d.createElement("TABLE")
e.cellPadding=(cp)?cp:0
e.cellSpacing=(cs)?cs:0
e.border=(bBrd)?1:0
if(css)e.className=css
if(w)e.style.width=w
e.body=d.createElement("TBODY")
e.appendChild(e.body)
return e
}
function appendTableRow( t, a, va, w, css)
{
var e=d.createElement("TR")
t.body.appendChild(e)
if(a)e.align=a
if(va)e.vAlign=va
if(w)e.style.width=w
if(css)e.className=css
return e
}
function appendTableCol( tr, a, va, w, spn, css)
{
var e=d.createElement("TD")
tr.appendChild(e)
if(a)e.align=a
if(va)e.vAlign=va
if(w)e.style.width=w
if(spn)e.colSpan=spn
if(css)e.className=css
return e
}
function createIFrame( n, css, src, id)
{
var e
var s = "<IFRAME "
if (n) s = s + "name='" +n+ "' "
if (id) s = s + "id='" + id + "' "
if (css) s = s + "class='" +css+ "' "
if (src) s = s + "src='" +src+ "' "
s = s + "scrolling='no' noresize frameborder='no' allowtransparency='true'></IFRAME>"
p=document.createElement("DIV")
if(p){
p.innerHTML = s
e=p.lastChild
}
return e
}
function appendIFrame(d,p, n, css, src){
var e = createIFrame(n,css,src)
p.appendChild(e)
return e
}
function createForm( n, t, a, m, css)
{
var e = d.createElement("FORM")
if (n) e.name = n
if (css) e.className = css
if (t) e.target = t
if (a) e.action = a
if (m) e.method = m
return e
}
function appendFormElement( f, n, v )
{
EL = createInput(n)
EL.name=n
EL.id = "hidden"
EL.type="hidden"
if(v) EL.value=v
f.appendChild(EL)
}
function requestParam(p)
{
var u = document.location
p = p.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
var regexS = "[\\?&]"+p+"=([^&#]*)";
var regex = new RegExp( regexS );
var results = regex.exec(u);
if( results == null )
return "";
else
return results[1];
}
function createVideoLink(filename, libraryname){
var v = createLink('Watch a video about this topic.',"videoLnk",'gotoVideo("'+filename+'","'+libraryname+'")','videoIcon.gif')
return v
}
function gotoVideo(filename, libraryname){
var dest='http://'+location.hostname+'/open/home/wtt_video.htm'+"?fn="+filename+"&ttl="+libraryname+"&vid=1"
var ops='copyhistory=0,toolbar=0,status=0,location=0,menubar=0,directories=0,resizable=0,scrollbars=0,height='+320 +',width='+360 +',screenX='+150 +',screenY='+100
VideoWnd=window.open(dest,'__videoWindow',ops)
VideoWnd.focus()
}
function appendImg( p, s, w, h){
var e=document.createElement("IMG")
if (s) e.src = s
if(p)p.appendChild(e)
}
function setBkgImg( e, n){
var fn=null
if(n)fn=(n.charAt(0)=='h'&&(n.indexOf("https://")==0||n.indexOf("http://")==0))?n:'/img/'+n
e.style.backgroundImage = "url('"+fn+"')";
}
function hideScrollbars(){
try{
document.documentElement.style.overflow="hidden"
}
catch(e){
try {
document.body.style.overflow="hidden"
}
catch(e2){}
}
}
function showScrollbars(){
if (BrowserSniffer.isSafari()) return
try{
document.documentElement.style.overflow="auto"
}
catch(e){
document.body.style.overflow="auto"
}
}
function getPreloadedImg( fn,id){
var d=document
var Img = d.getElementById(id)
if (!Img) {
Img = d.body.appendChild(createImage(fn,1,1))
Img.id=id
Img.className="preload"
}
return Img
}
function createToggle(toggleID, bShowByDefault)
{
var toggle=document.createElement("A")
toggle.id=toggleID + "Text"
toggle.name=toggleID + "Text"
toggle.className="togglelink"
if(bShowByDefault){
toggle.appendChild(createText("Hide details"))
}else{
toggle.appendChild(createText("Show details"))
}
toggle.href="javascript:toggle(\"" + toggleID + "\")"
return toggle
}
function toggle(val)
{
lyr = document.getElementById(val)
lyrText = document.getElementById(val+ "Text")
if (lyr.style.display == "none"){
lyr.style.display = "";
lyrText.innerHTML = "Hide details";
}
else {
lyr.style.display = "none";
lyrText.innerHTML = "Show details";
}
}
function createHardLink(t, css, href, target){
var link=document.createElement("A")
link.className=css
link.appendChild(createText(t))
if (href) link.href=href
if (target) link.target=target
return link
}
