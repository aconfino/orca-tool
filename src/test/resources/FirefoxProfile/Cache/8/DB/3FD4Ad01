BrowserSniffer = new function()
{
var BrowserSniffer = this;
var agent = navigator.userAgent.toLowerCase();
BrowserSniffer.isIpad = function()
{
return (agent.indexOf("ipad") != -1);
},
BrowserSniffer.isIphone = function()
{
return (agent.indexOf("iphone") != -1);
},
BrowserSniffer.isIOS = function()
{
return (agent.indexOf("ipad") != -1) || (agent.indexOf("iphone") != -1);
},
BrowserSniffer.isAndroid = function()
{
return (agent.indexOf("android") != -1 || agent.indexOf("silk-accelerated=true") != -1);
},
BrowserSniffer.isSafari = function()
{
var _bSafari=false
if(document.childNodes && !document.all && !navigator.taintEnabled) _bSafari = true;
return _bSafari;
},
BrowserSniffer.isIE = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie")!=-1)
},
BrowserSniffer.isIE6 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 6")!=-1)
},
BrowserSniffer.isIE7 = function()
{
var ie8 = (navigator.appVersion.toLowerCase().indexOf("msie 8")!=-1)
var ie7 = (navigator.appVersion.toLowerCase().indexOf("msie 7")!=-1)
return (ie7 || ie8)
},
BrowserSniffer.isIE8 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 8")!=-1)
},
BrowserSniffer.isIE9 = function()
{
return (navigator.appVersion.toLowerCase().indexOf("msie 9")!=-1)
},
BrowserSniffer.isOpera = function()
{
return (agent.indexOf("opera")!=-1)
},
BrowserSniffer.isFirefox = function()
{
return (agent.indexOf("firefox")!=-1)
},
BrowserSniffer.isFirefox4 = function()
{
return (agent.indexOf("firefox/4") > -1)
},
BrowserSniffer.isMozilla = function()
{
return (agent.indexOf("mozilla/5")!=-1)
},
BrowserSniffer.isChrome = function()
{
return (agent.indexOf("chrome") > -1)
},
BrowserSniffer.isWin = function()
{
return ("Win32"==navigator.platform||"Windows"==navigator.platform)
},
BrowserSniffer.isMac = function()
{
return (agent.indexOf("mac")!=-1)
},
BrowserSniffer.isChrome = function()
{
return (agent.indexOf("chrome") > -1)
},
BrowserSniffer.isSamsungDroidCharge = function()
{
return (agent.indexOf("SCH-I510") > -1)
}
}
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();
var ttoSetup = {
initGlobals : function() {
jQuery.noConflict();
gbIE = BrowserSniffer.isIE()
gbMozilla = BrowserSniffer.isMozilla()
gbSafari = BrowserSniffer.isSafari()
gbMac = BrowserSniffer.isMac()
var flashTest = swfobject;
gbFlashInstalled = (flashTest.getFlashPlayerVersion().major >= 9)
RESPONSEFRAMEID= "rsp"
BEACONFRAMEID= "bea"
BEACONFRAMEID2= "bea2"
FLASHAREA = "flashArea"
DISABLEBKG = "disableBkg"
MODALBKG = "modalBkg"
},
initJQueryPlugins : function() {
jQuery.fn.extend({
isChildOf: function( filter_string ) {
var parents = jQuery(this).parents().get();
for ( j = 0; j < parents.length; j++ ) {
if ( jQuery(parents[j]).is(filter_string) ) {
return true;
}
}
return false;
},
capture: function(eventType, cb, bPreventDefault, bStopPropagation) {
this.bind(eventType, function(e) {
cb.call(this, e);
if(bPreventDefault === undefined || bPreventDefault === true)
e.preventDefault();
if(bStopPropagation === undefined || bStopPropagation === true)
e.stopPropagation();
});
},
topWindowOffset: function() {
var offset = this.offset();
if (!this.inIframe()) {
return offset;
}
var pos, wnd = this.parentWindow(), $frame;
while (wnd && wnd.frameElement) {
$frame = jQuery(wnd.frameElement);
pos = $frame.offset();
offset.top += pos.top;
offset.left += pos.left;
wnd = $frame.parentWindow();
}
return offset;
},
inIframe: function() {
return (top.document !== this[0].ownerDocument);
},
parentWindow: function(){
var doc = this[0].ownerDocument;
if (!doc) {
doc = this[0].frameElement.ownerDocument;
if (!doc) {
return undefined;
}
}
return (doc.parentWindow) ? doc.parentWindow : doc.defaultView;
}
});
return this;
},
initPrototypeExtensions : function() {
if(!String.trim) {
String.prototype.trim = function() {
if(this && this.length > 0) {
return this.replace(/^[\s]+/, "").replace(/[\s]+$/, "");
}
return "";
};
}
String.prototype.toNum = function( bEmptyAsValid) {
if(this && this.length > 0) {
var nVal = parseFloat(this.trim());
return isNaN(nVal) ? null : nVal;
}
return bEmptyAsValid ? 0 : null;
};
String.prototype.stripChar = function(c) {
if(this && this.length > 0 && c) {
var re = new RegExp(c, "g");
return this.replace(re, "");
}
return null;
};
String.prototype.normalize = function() {
var newTxt = this;
var i = 0, lastCh = '';
try {
newTxt = decodeURIComponent(this);
}
catch(ex) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TEXT", "Could not URLDecode: " + newTxt, LOG_ERROR, ex))
}
newTxt=newTxt.replace(/~BULLET/g," \u2022 ");
while (newTxt.match(/\s$/)){
lastCh = newTxt.charAt(newTxt.length-1);
newTxt = newTxt.substring(0,newTxt.length-1);
}
if (' '==lastCh)newTxt+=lastCh;
return newTxt
};
Number.prototype.floatToInt = function() {
if(!this) return 0;
var num = this;
var bNeg = false;
if(this < 0) {
bNeg = true;
num = -num;
}
num = Math.floor(num);
if(bNeg) num = -num;
return num;
};
Number.prototype.toFormattedInt = function(bRound) {
if(!this) return "0";
var num = this;
var bNeg = false;
if(this < 0) {
bNeg = true;
num = -num;
}
var rn = (bRound) ? Math.round(num) : num;
var s = new String(rn.floatToInt());
for(var i=0; i < Math.floor((s.length-(1+i))/3); ++i)
{
s = s.substring(0,s.length-(4*i+3)) + ',' + s.substring(s.length-(4*i+3));
}
if(bNeg) s = "-" + s;
return s;
};
Number.prototype.roundToPrecision = function(fractionDigits) {
if(!fractionDigits)
throw new zException("invalid param", "roundToPrecision");
var base = Math.pow(10, fractionDigits);
return Math.round(this * base) / base;
};
return this;
},
loadDeferredScripts : function() {
return this;
},
initTTO : function() {
TTOApp.init();
},
_loadScript : function( sn) {
var s = document.createElement("script");
s.src = "/scripts/" + sn + ".js";
s.async = true;
document.body.appendChild(s);
}
};
ttoSetup.initGlobals();
jQuery(window).unload(function() {
if(undefined != TTOApp)
TTOApp.onunload();
});
jQuery(document).ready(function() {
ttoSetup.loadDeferredScripts().initJQueryPlugins().initPrototypeExtensions().initTTO();
});
var TTOModel = (function(){
var _instance = {
kVideoLimited : "Video_limited",
kVideoFull : "Video_full",
kCIA : "CIA",
kTina : "Tina",
kPersistentUpgrade : "PersistentUpgrade",
getPID : function () { return _userInfo.pid; },
getProductId : function () { return _prodInfo.prodId; },
getCustomerSrc : function () { return _brandingInfo.csrc; },
getReferrer : function () { return _prodInfo.referrer; },
getPartnerName: function () { return _brandingInfo.partnerName; },
getUserId : function () { return _appData.userId; },
getAuthId : function () { return (unescape(_appData.userId).split(':')[0]) },
getTaxServer : function () { return _appData.taxserver; },
getTaxServerPort : function () { return _appData.port; },
getAppData : function () { return _appData; },
getPageLCTagset : function () {return _pageInfo.lcTags; },
getPageLCTitle : function () {return _pageInfo.lcTitle; },
getPriorYrSku : function () {return _PYSku; },
getDialogType : function () {return _currentDialogInfo.type;},
getCustomerType : function () {return _userInfo.customerType;},
getScreenId : function () {return _currentDialogInfo.screenId;},
isPriorYrUser : function () { return kReturningFromPriorYearCustomer == _userInfo.customerType; },
isNewUser : function () { return kNewCustomer == _userInfo.customerType; },
isAccessible : function () { return isDefined(TTOModel.getABTestValue(kAccessible))
&& TTOModel.getABTestValue(kAccessible) != 0; },
isTooltipsVisible : function () { return _tooltips; },
isDelayedAuth : function () { return _delayedAuthUser; },
isTTOBUser : function () { return (kReferrer_TTOB == _prodInfo.referrer || kReferrer_Schwab == _prodInfo.referrer); },
isQA : function () {return _QAbuild; },
isFed : function () { return _currentDialogInfo.curFS.toUpperCase().indexOf("US1040") >=0; },
isEZStepView : function () { return _pageInfo.type == "ezpg"; },
isProgressView : function () { return _pageInfo.type == "progresspg"; },
isFFA : function () { return _prodInfo.prodId == _ffaID; },
isValidProduct : function () { return _prodInfo.prodId != 0; },
isFeatureSupported : function (featureName) {
var f = _prodInfo.features
for (var i=0; i<f.length; i++){
if (featureName == unescape(f[i]))
return true;
}
return false
},
isRightRailSupported : function() {
return !BrowserSniffer.isIpad();
},
isWelcomeMatSupported : function() {
return !BrowserSniffer.isIpad();
},
shouldLoadLowEndStylesheet : function() {
return TTOModel.isFFA() && !BrowserSniffer.isIpad();
},
getABTestValue : function (testName) {
return _abTestInfo[testName];
},
getABTestAsParams : function () {
return _abTestParams;
},
getRightRailVersion : function () {
var rrTest = TTOModel.getABTestValue(kRightRailTest);
if (isDefined(rrTest)) {
if (rrTest.toLowerCase() === "e") {
return "ty10";
}
}
return "";
},
getDialogInfo : function () { return _currentDialogInfo; },
getProductInfo : function () { return _prodInfo; },
getPageInfo : function () { return _pageInfo; },
getBrandingInfo : function () { return _brandingInfo; },
getUserInfo : function () { return _userInfo; },
getABTestInfo : function () { return _abTestInfo; },
setQA : function () {
_QAbuild = true;
},
setUserNonDelayedAuth : function () {
_delayedAuthUser = false;
setCookie('customerType', kUpgradedFromDelayedAuthCustomer);
},
setPriorYrSku : function (sku) {
_PYSku = sku
},
updateCurDialogInfo : function (info ) {
var di = _currentDialogInfo
di.title = decodeURIComponent(info.title)
di.subtitle = decodeURIComponent(info.subtitle)
di.titleGraphic = decodeURIComponent(info.titleGraphic)
di.genericTitle = decodeURIComponent(info.genericTitle)
di.curFS = info.curFS
di.curForm = info.curForm
di.curField = info.curField
di.topicId = info.topicId
di.screenId = info.screenId
di.historyType = info.historyType
di.type = info.type
di.pii = info.pii
},
updateProductInfo : function (info ) {
var pi = _prodInfo
pi.prodName = info.prodName
pi.prodId = info.prodID
pi.prodAlias = info.prodAlias
pi.engVer = info.engVer
pi.fsVer = info.fsVer
pi.referrer = info.referrer
},
setAllowedFeatures : function (features) {
_prodInfo.features = features;
},
updateUserInfo : function (info ) {
var ui = _userInfo
ui.origProdid = info.origProdid
ui.prodid = info.prodid
ui.paid = info.paid
ui.printed = info.printed
ui.efiled = info.efiled
ui.customerType = info.customerType
ui.pid = info.pid
},
updatePageInfo : function (info ) {
var pi = _pageInfo
pi.reqId = info.reqId
pi.type = info.type
pi.CRstate = info.CRstate
pi.pgCnt = info.pgCnt
pi.lcTags = info.lcTags
pi.lcTitle = info.lcTitle
},
setBrandingInfo : function (info ) {
var bi = _brandingInfo
bi.csrc = info.csrc
bi.logoSrcURL = unescape(info.logoSrcURL)
bi.partnerName=unescape(info.partnerName)
bi.iframeContentURL = unescape(info.iframeContentURL)
bi.embeddedContentURL = unescape(info.embeddedContentURL)
bi.embeddedLinkURL = unescape(info.embeddedLinkURL)
bi.showAd = info.showAd
},
initAppData : function (info ) {
var ad = _appData
ad.userId = info.userId
ad.taxserver = info.taxserver
ad.webserver = info.webserver
ad.port = info.port
ad.productData = info.productData
_prodInfo.prodId = info.prodId
_brandingInfo.csrc = info.csrc
_delayedAuthUser = info.delayedAuth
},
setABTestInfo : function (info ) {
_abTestParams = info;
_abTestInfo = null;
_abTestInfo = new Object();
var pairs = info.split('&')
for (var i=0; i<pairs.length; i++) {
val = pairs[i].split('=')
if (val.length == 2)
_abTestInfo[val[0]] = val[1]
}
},
setTooltips : function (bAcc) {
if (typeof(bAcc) == 'string' || bAcc instanceof String) _tooltips = (bAcc.toLowerCase()=="y");
else if (typeof(bAcc) == 'boolean')_tooltips = bAcc;
}
};
var kReferrer_TTOB = "DI"
var kReferrer_LaunchPad = "LP"
var kReferrer_TTCOM = "TT"
var kReferrer_QPO = "QPO"
var kReferrer_IRS = "IRS"
var kReferrer_Schwab = "SC"
var kAccessible = "accessible"
var kRightRailTest = "gsb"
var kDelayedAuthCustomer = 0;
var kUpgradedFromDelayedAuthCustomer = 1;
var kNewCustomer = 2;
var kReturningCurrentYearCustomer = 3;
var kReturningFromPriorYearCustomer = 4;
var _leoID = 512;
var _ffaID = 4;
var _QAbuild = false;
var _delayedAuthUser = false;
var _tooltips = false;
var _PYSku = -1;
var _abTestParams = "";
var _appData = {
userId : "",
taxserver : "",
webserver : "",
port : "",
productData : ""
};
var _prodInfo = {
prodName : "",
prodId : "",
prodAlias : "",
features : "",
engVer : "",
fsVer : "",
priorYrUser : false
};
var _userInfo = {
pid : "",
paid : false,
printed : false,
efiled : false,
priorYrUser : false
};
var _brandingInfo = {
csrc : "",
logoSrcURL : "",
partnerName : "",
iframeContentURL : "",
embeddedContentURL : "",
embeddedLinkURL : "",
showAd : true
};
var _pageInfo = {
reqId : "",
type : "",
CRstate : "",
pgCnt : "",
queryStr : "",
lcTags : "",
lcTitle : ""
};
var _currentDialogInfo = {
title : "",
subtitle : "",
titleGraphic : "",
curFS : "",
curForm : "",
curField : "",
topicId : "",
screenId : "",
historyType : "",
intrvw : false,
pii : false
};
var _abTestInfo = {};
return _instance;
})();
TTOService = (function(){
var _instance = {
kAJAX_SetDataFilePersistent : "setDataFilePersistent",
kAJAX_SetDataFileNonPersistent : "setDataFileNonPersistent",
kAJAX_GetKeywordList : "getKeywordList",
kAJAX_GetShoppingCartData : "getShoppingCartData",
kAJAX_PurchaseModule : "purchaseModule",
kAJAX_GetBizCodeList : "getBizCodeList",
kAJAX_GetTopicList : "getTopicList",
kAJAX_LogEmail : "logEmail",
kAJAX_GetBookmarkURL : "getBookmarkURL",
kAJAX_SetBookmark : "setBookmark",
kAJAX_KeepAlive : "keepAlive",
kAJAX_DoFullSave : "doFullSave",
kAJAX_HandleRIA : "RIA",
kAJAX_GetFASList : "GetFASList",
kAJAX_FormsMode : "formsMode",
kAJAX_EFile : "eFile",
kAJAX_SetEZStepData : "setEZStepData",
kAJAX_GetEZStepData : "getEZStepData",
kAJAX_Upgrade : "upgrade",
kAJAX_GetABTests : "getABtests",
kAJAX_GetBookmarkList : "getBookmarkList",
kAJAX_DeleteBookmark : "deleteBookmark",
kAJAX_UpdateTicket : "updateTicket",
kAJAX_GetFormML : "getFormML",
kAJAX_ABTestData : "ABTestData",
kJSON_EZStepData : "EZStepData",
kJSON_EFSuccess : "EFSuccess",
kJSON_EFErrorMsg : "EFErrorMsg",
kFeedBackCommand : "feedback",
kFileUploadCommand : "uploadprevyrdatafile",
kUploadPDFCommand : "uploadpdf",
create : function (createTO, handler ) {
var url = _getRequestPath(kCreateRequest);
var POSTData = "cr=";
POSTData += "";
POSTData += "&cmd="
POSTData += kCreateRequest
POSTData += "&uid=";
POSTData += createTO.id;
POSTData += "&prodid=";
POSTData += createTO.prodid;
POSTData += "&csrc=";
POSTData += createTO.csrc;
POSTData += "&proddata=";
POSTData += createTO.proddata;
_postToApp(true, url,POSTData, handler, createTO.pageId);
},
allocate : function (pageId, handler ) {
var url = _getRequestPath(kAllocateRequest);
var POSTData = "cr=";
POSTData += "";
POSTData += "&cmd="
POSTData += kAllocateRequest;
POSTData += "&uid="
POSTData += _serviceData.userId;
POSTData += "&prodid=";
POSTData += _serviceData.prodId;
POSTData += "&csrc=";
POSTData += _serviceData.csrc;
POSTData += "&app=";
POSTData += _serviceData.taxserver;
POSTData += "&pt=";
POSTData += _serviceData.port
_postToApp(true, url, POSTData, handler, pageId);
},
submit : function (submitTO, handler ) {
var url = _createPOSTUrl(kSubmitRequest)
var clientReq = {};
clientReq[kControlParam]= submitTO.clientrequest
clientReq[kStateParam]= TTOModel.getPageInfo().CRstate
if (submitTO.hogStatus) {
clientReq[kStatusParam]= true
}
var POSTData = _formatPOSTData(clientReq);
_postToApp(true, url, POSTData, handler, submitTO.pageId);
},
download: function (downloadTO) {
var url = _createGETUrl(kDownloadDatafileRequest, null, downloadTO.filename)
downloadTO.responseFrame.location.replace(url);
},
ajax : function (ajaxTO, handler ) {
var url = _getRequestPath(kAJAXRequest);
url += "/" + ajaxTO.cmd
var POSTData = _formatPOSTData(ajaxTO.data);
_postToApp(true, url,POSTData, handler, ajaxTO.cmd);
},
servlet : function (servletTO, handler ) {
var url = "/services/" + servletTO.servletPath + "/" + servletTO.actionName;
_postToApp(true, url, servletTO.data, handler, servletTO.servletPath);
},
getPDFUrl : function (printTO) {
var printData = "printType=" +printTO.printType;
printData += "&watermark=" + printTO.watermark;
if (printTO.formList.length>0) {
printData += "&formList="
var forms = printTO.formList
for (var i=0; i<forms.length; ++i) {
if(i>0)
printData += ";"
printData += forms[i];
}
}
if(printTO.formsetList.length > 0) {
printData += "&formsetList="
var formsetids = printTO.formsetList;
for( var i=0; i < formsetids.length; ++i){
if(i >0)
printData += ";"
printData += formsetids[i];
}
}
var otherparams = [{name:"save", value:printTO.save}]
return _createGETUrl(kGeneratePDFRequest, printData, printTO.filename, otherparams)
},
executeFormCommand : function (fmTO, handler) {
var url = _getRequestPath(kAJAXRequest);
url += "/" + kAJAX_FormsMode
var util = new FormsModeUtil();
if (null != fmTO.submitData) {
util.addSubmitFormValues(fmTO.submitData);
}
if (null != fmTO.formToAdd) {
util.addAddForm(fmTO.formToAdd);
util.addGetFormImage(fmTO.formToAdd);
}
if (null != fmTO.formToDelete) {
util.addDeleteForm(fmTO.formToDelete);
util.addGetFormsInReturn( fmTO.allowHiddenForms );
}
if (fmTO.getFormsInReturn) {
util.addGetFormsInReturn( fmTO.allowHiddenForms );
}
if (null != fmTO.formFieldToGet) {
util.addGetFormFieldData(fmTO.formFieldToGet);
}
if (null != fmTO.AgencyListToLoad) {
util.addGetAgencyFormList(fmTO.AgencyListToLoad);
}
var formsModeRequest = util.getSubmitVal()
var POSTData = _formatPOSTData(formsModeRequest);
_postToApp(true, url, POSTData, handler, this.kformsModeRequest);
},
upgrade : function (UpgradeTO, handler ) {
var url = _getRequestPath(kAJAXRequest);
url += "/" + this.kAJAX_Upgrade
var POSTData = _formatPOSTData("sku="+UpgradeTO.sku+"&regeneratePage="+UpgradeTO.regeneratePage);
_postToApp(true, url, POSTData, handler, this.kAJAX_Upgrade);
},
getTopicList : function(handler ) {
var url = _getRequestPath(kAJAXRequest);
url += "/" + this.kAJAX_GetTopicList;
var POSTData = _formatPOSTData(null);
_postToApp(true, url, POSTData, handler, this.kAJAX_GetTopicList);
},
clearReturn : function (handler , st) {
var url = _createPOSTUrl(kClearReturnRequest, null, st ? [{name:"skipTransfer", value:st}] : null);
_postToApp(true, url, "", handler, "CLEAR_REQUEST");
},
topicJump : function (TopicJumpTO, handler ) {
var url = _createPOSTUrl(kTopicJumpRequest, null, [{name:"topicPath", value:TopicJumpTO.topicPath}]);
var clientReq = {}
clientReq[kControlParam]= TopicJumpTO.clientrequest
clientReq[kStateParam]= TTOModel.getPageInfo().CRstate
var POSTData = _formatPOSTData(clientReq);
_postToApp(true, url, POSTData, handler, "TOPIC_JUMP");
},
shutdown : function (delay, handler ) {
var url = _createPOSTUrl(kEndSessionRequest, null, [{name:"delay", value:delay}]);
_postToApp(true, url,null, handler, "ENDSESSION");
},
setServiceData : function (serviceDataTO) {
if (!serviceDataTO.taxserver) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService","setServiceData: Invalid or missing taxserver", LOG_ERROR));
if (!serviceDataTO.port) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService","setServiceData: Invalid or missing port", LOG_ERROR));
if (!serviceDataTO.userId) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService","setServiceData: Invalid or missing userid", LOG_ERROR));
_serviceData = serviceDataTO;
_initialized = true;
},
migrate : function (handler ) {
var url = _getRequestPath(kMigrateRequest);
var POSTData = "cr=";
POSTData += "";
POSTData += "&cmd="
POSTData += kMigrateRequest;
POSTData += "&uid="
POSTData += _serviceData.userId;
POSTData += "&prodid=";
POSTData += _serviceData.prodId;
POSTData += "&csrc=";
POSTData += _serviceData.csrc;
POSTData += "&app=";
POSTData += _serviceData.taxserver;
POSTData += "&pt=";
POSTData += _serviceData.port
_postToApp(true, url, POSTData, handler, "MIGRATE_REQUEST");
},
logError : function (error ) {
var POSTData = "component=" + encodeURIComponent(error.component)
POSTData += "&message=" + encodeURIComponent(error.msg)
POSTData += "&userid=" + encodeURIComponent(TTOModel.getUserId())
POSTData += "&browser=" + encodeURIComponent(navigator.userAgent)
POSTData += "&dialogid=" + encodeURIComponent(TTOModel.getDialogInfo().screenId)
POSTData += "&dialogtitle=" + encodeURIComponent(TTOModel.getDialogInfo().title)
var url = kUILogger + "/" + error.logType;
_postToApp(true,url,POSTData)
},
logout : function (authId, handler) {
var url = kAuthURL + "/" + kSignOutRequest;
var postData = "command=";
postData += kSignOutRequest;
postData += "&authid=";
postData += authId;
_postToApp(false, url,postData, handler, "LOGOUT");
},
checkDelayedAuthUser : function(cmd, handler) {
var authId = TTOModel.getAuthId();
var url = kAuthURL + "/" + kCheckDelayedAuthRequest;
var postData = "command=";
postData += kCheckDelayedAuthRequest;
postData += "&authid=";
postData += authId;
_postToApp(true, url, postData, handler, "DELAYED AUTH");
},
getTTOUrl : function( cmd, cr, filename, opt) {
return _createGETUrl(cmd,cr,filename,opt)
},
getContentUrl : function (system, alias, extraParams , isFlow) {
var Url;
var host;
var params = "priorityCode=" + TTOModel.getCustomerSrc()
params += "&productId=" + TTOModel.getProductId()
params += "&productName=" + escape(TTOModel.getProductInfo().prodName)
params += "&returningUser=" + TTOModel.isPriorYrUser()
params += "&accessible=" + TTOModel.isAccessible()
params += "&abtest="+escape(TTOModel.getABTestAsParams())
params += "&referrer=" + TTOModel.getReferrer()
params += "&trial=" + TTOModel.isDelayedAuth()
params += "&taxYear=" + "2011"
params += "&isDebug=" + TTOModel.isQA()
pb = TTOApp.findCtrlByType(26);
if (pb) {
params += "&tab=" + pb.getCurCat();
params += "&subtab=" + pb.getCurSubItem();
}
if (extraParams) {
for (var paramName in extraParams)
{
params += "&" + paramName + "=" + extraParams[paramName]
}
}
switch (system.toLowerCase()) {
case "estore" : host = kEstoreExtContentURI;
break;
case "local" : host = kTTOHostedContentURI;
host += kLocalContentPath;
host += "/" + _serviceData.userId + "/" + _serviceData.taxserver + ":" + _serviceData.port;
break;
case "riadialog" : host = kTTOHostedContentURI;
host += isFlow?kFlowPath:kEasystepPath;
host += "/" + _serviceData.userId + "/" + _serviceData.taxserver + ":" + _serviceData.port;
break;
case "test" :
if (!TTOModel.isQA()) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService", "getContentUrl - NOT a QA Build and Requesting test content Server", LOG_WARNING));
break;
}
host = DebugModel.getTestContentServer();
if (!host)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService", "Test Content Server not defined", LOG_INFO));
if (alias.indexOf('.') < 0) alias += ".htm"
break;
default : TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService", "getContentUrl - Invalid system: "+system, LOG_ERROR));
}
Url = host + "/" + alias + "?" + params;
return Url;
},
getAllowedFeatures: function( handler, productId) {
var authId = TTOModel.getAuthId();
var url = kEntitlementHandler + "/allowedfeatures/" + authId + "/" + productId;
_getFromApp(url, handler);
},
getPDFUploadUrl : function(cmd) {
var url = _getRequestPath(cmd);
var curTaxYear = "2011";
var prvTaxYear = curTaxYear - 1;
var suffix = "?sku=" + encodeURIComponent(TTOModel.getProductInfo().prodAlias) + "&year=" + prvTaxYear;
return url + suffix;
},
getLogInfo: function(logPath, handler) {
var url = kLogRetrievalURI +logPath
_getFromApp(url, handler);
}
};
var kCreateRequest = "create",
kAllocateRequest = "allocate",
kMigrateRequest = "migrate",
kSubmitRequest = "submit",
kAJAXRequest = "ajax",
kEndSessionRequest = "endsession",
kClearReturnRequest = "clear",
kDownloadDatafileRequest= "downloaddatafile",
kGeneratePDFRequest = "generatepdf",
kTopicJumpRequest = "topicjump",
kformsModeRequest = "formsmode",
kSignOutRequest = "SignOut",
kCheckDelayedAuthRequest= "CheckDelayedAuth",
kLoadManager = '/services/sessionmanager',
kTaxAppHandler = '/services/goldmember',
kUILogger = '/services/uilogger',
kTaxAppHandler = '/services/goldmember',
kAuthURL = "/services/tto-auth",
kEntitlementHandler = "/services/entitlement",
kDataExchangeHandler = "/services/dataexchange",
kLogRetrievalURI = "/services/logretrieval",
kTTOHostedContentURI = "/services/content",
kEstoreExtContentURI = "https://turbotax.intuit.com/tto/alias",
kLocalContentPath = "/internalcontent",
kEasystepPath = '/easystep',
kFlowPath = "/flow",
kClientRequest = "clientRequest",
kStateParam = "state",
kControlParam = "ctl",
kStatusParam = "status",
kPageGUID = "reqID",
kProfile = "profile",
_serviceData,
_initialized = false;
function _getRequestPath(cmd) {
if ( (kCreateRequest==cmd) || (kAllocateRequest==cmd) || (kMigrateRequest==cmd) ) {
return kLoadManager + '/' + cmd;
}
else {
return kTaxAppHandler + '/' + _serviceData.userId + "/" + _serviceData.taxserver + ":" + _serviceData.port + "/" + cmd ;
}
}
function _createPOSTUrl (cmd, filename , otherParams ) {
if (!_initialized) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService","_createPOSTUrl - Unitialized Service", LOG_ERROR));
return "NULO"
}
var url = _getRequestPath(cmd);
if(filename)
url+= "/"+filename
url += "?"
if (otherParams) {
for (var i = 0; i < otherParams.length; i++) {
var itm = otherParams[i]
url += "&" + itm.name
url += "=" + itm.value;
}
}
return url;
}
function _createGETUrl (cmd, clientRequest, filename , otherParams ) {
if (!_initialized) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOService","_createGETUrl - Unitialized Service", LOG_ERROR));
return "NULO"
}
var url = _getRequestPath(cmd);
var GETData = "clientRequest=";
if (clientRequest)
GETData += encodeURIComponent(clientRequest);
if (otherParams) {
for (var i=0; i<otherParams.length; i++) {
var itm = otherParams[i]
GETData += "&"+itm.name
GETData += "="+itm.value;
}
}
var uniqueToken = new Date().getTime();
GETData += "&utk=" + uniqueToken;
if(filename)
url+= "/"+filename
url += "?"+GETData;
return url;
}
function _formatPOSTData(inData) {
var POSTData = "";
if (inData && typeof(inData) == "object") {
for (var o in inData) {
POSTData += o
POSTData += "=" + encodeURIComponent(inData[o]);
POSTData += "&"
}
}
else {
POSTData = inData?inData:""
}
return kClientRequest + "=" + encodeURIComponent(POSTData)
}
function _postToApp(async, url, POSTData, responseHandler, pageID ) {
xhr = new Ajax()
xhr.setAsync(async)
xhr.setURL(url)
xhr.setMethod("POST")
xhr.setPOSTData(POSTData);
xhr.setReqHeader("If-Modified-Since", "Sat, 1 Jan 2000 00:00:00 GMT")
xhr.setReqHeader('Content-Type', 'application/x-www-form-urlencoded');
xhr.setReqHeader("TTO-pageID", pageID?pageID:"");
xhr.setSuccessCallback(_serviceSuccessCB)
xhr.setErrorCallback(_serviceFailureCB)
xhr.setTimeoutCallback(_serviceTimeoutCB)
xhr.send();
function _serviceSuccessCB( xhr) {
if (responseHandler) {responseHandler.doSuccess(xhr);}
}
function _serviceFailureCB(xhr ) {
if (responseHandler) {responseHandler.doFailure(xhr, url);}
}
function _serviceTimeoutCB(rsp) {
if (responseHandler) {responseHandler.doTimeout(rsp, url);}
}
xhr = null;
}
function _getFromApp(url, responseHandler) {
jQuery.ajax({
url: url,
data: "",
success: function(json, status, xhr) {
responseHandler.doSuccess(json, status, xhr);
},
error: function(xhr, status, error) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("AJAX","Failed GET Request. URL: "+url+" STATUS CODE: "+xhr.status+" MSG: "+error))
responseHandler.doFailure(xhr, status, error);
},
dataType: "json"
});
}
return _instance;
})();
function Ajax () {
var t=this
t.URL=""
t.method="GET"
t.POSTData=null
t.successCB=null
t.errCB=null
t.headers=new Array()
t.async=true
t.timeoutCB = null;
t.timeout = null;
t.timer = null;
t._xhr=null
}
function _AjaxSend()
{
var t=this
t._xhr=_getXHR()
t._xhr.open(t.method, t.URL, t.async);
for (var i=0; i<t.headers.length; i++){
if(t.headers[i].value && t.headers[i].value.length>0)
t._xhr.setRequestHeader( t.headers[i].name, t.headers[i].value );
}
function abortXhrTimeout() {
if (t && t._xhr) {
t._xhr.abort();
if (t.timeoutCB) {
t.timeoutCB();
}
}
}
t._xhr.send(t.POSTData);
if (t.timeout) {
t.timer = setTimeout(abortXhrTimeout, t.timeout);
}
if (!t.async) {
if (t.timer) clearTimeout(t.timer);
if (t._xhr.status >= 200 && t._xhr.status < 300) if (t.successCB) t.successCB(t._xhr)
else if (t.errCB) t.errCB(t._xhr)
t._xhr=null
return
}
t._xhr.onreadystatechange = function() {
if (t._xhr.readyState >= 2) {
if (t.timer) {
clearTimeout(t.timer);
}
}
if (t._xhr.readyState == 4) {
if (t._xhr.status >= 200 && t._xhr.status < 300) {
if (t.successCB) t.successCB(t._xhr)
}
else {
if (t.errCB) t.errCB(t._xhr)
}
t._xhr=null
}
}
}
function _getXHR(){
try { return new XMLHttpRequest(); } catch(e) {}
try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
alert ("XMLHttpRequest not supported")
return null
}
Ajax.prototype=new Ajax()
p=Ajax.prototype
p.constructor=Ajax
p.setURL=function(url){this.URL=url}
p.setMethod=function(method){this.method=method}
p.setPOSTData=function(data){this.POSTData=data}
p.setSuccessCallback=function(cb){this.successCB=cb}
p.setErrorCallback=function(cb){this.errCB=cb}
p.setReqHeader=function(name,value){var o = new Object(); o.name=name; o.value=value; this.headers.push(o)}
p.setAsync=function(bAsync){this.async=bAsync}
p.setTimeoutCallback=function(cb, timeout){this.timeoutCB=cb; this.timeout=timeout; }
p.send=_AjaxSend
p.getXHRObj=_getXHR
p=null
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
var JSONSerializer = {
toString: function (obj) {
var t = typeof (obj);
if (t != "object" || obj === null) {
if (t == "string") obj = '"'+obj+'"';
return String(obj);
}
else {
var n, v, json = [], arr = (obj && obj.constructor == Array);
for (n in obj) {
v = obj[n]; t = typeof(v);
if (t == "string") v = '"'+v+'"';
else if (t == "object" && v !== null) v = this.toString(v);
json.push((arr ? "" : '"' + n + '":') + String(v));
}
return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
}
},
toJSON : function (jsonString) {
if (!jsonString) return null
jsonString = jsonString.replace(/\0$/,"")
var json = null;
try {
json = eval('(' + jsonString + ')');
}
catch (ex) {
if ('undefined' != TTOEventPubSub) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("JSONSerializer","Invalid JSON\n\n"+jsonString,LOG_ERROR, ex))
}
return json
}
}
TTOServiceHandler = Class.extend({
_onHandleSuccess : null,
_onHandleFailure : null,
_onHandleTimeout : null,
_responseTO : null,
construct : function (){
this.constructor = TTOServiceHandler
this._responseTO = new TTOResponseTO();
},
setSuccessCB : function(CB){this._onHandleSuccess=CB;},
setFailureCB : function(CB){this._onHandleFailure=CB;},
setTimeoutCB : function(CB){this._onHandleTimeout=CB;},
getResponseTO : function () {return this._responseTO;},
doSuccess : function (rsp ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
r.responseText = rsp.responseText;
r.responseXML = rsp.responseXML;
r.responseJSON = JSONSerializer.toJSON(rsp.responseText);
if (this._onHandleSuccess)
this._onHandleSuccess(r)
},
doFailure : function(rsp , url ) {
var r = this._responseTO
try {
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
}
catch(error) {
}
finally {
if (this._onHandleFailure) {
this._onHandleFailure(r, url)
}
}
},
doTimeout : function(rsp , url ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
if (this._onHandleTimeout)
this._onHandleTimeout(r, url)
}
});
function UpgradeHandler (cmd ) {
TTOServiceHandler.call(this)
this._successCB = null
this._cmd = cmd
this._onHandleSuccess = function(respTO) {
var json = respTO.responseJSON
ModalWindow.hide()
if (this._cmd.reqTO.regeneratePage) {
TTOController.regeneratePage(respTO);
}
else if (json && json.sessionEvt && json.sessionEvt.evt == 'updatePage') {
var updateData = json.sessionEvt.data
if (updateData.evtList) {
var evts = updateData.evtList
for (var i=0; i<evts.length; i++) {
var itm = evts[i].pageEvt
TTOController.handlePageEvents(itm.evt,itm.data)
}
}
if (updateData.regions) {
TTOApp.renderRegions(updateData.regions);
}
}
if (this._successCB) this._successCB(respTO)
}
this._onHandleFailure = function(respTO) {
ModalWindow.hide()
}
}
UpgradeHandler.prototype=new TTOServiceHandler()
p=UpgradeHandler.prototype
p.constructor=UpgradeHandler
p.setSuccessCB=function(CB){this._successCB=CB;}
p.setFailureCB=function(CB){}
p=null
AjaxHandler = TTOServiceHandler.extend({
_successCB : null,
_cmd : null,
construct : function (cmd) {
this.superClass.construct.call(this)
this.constructor = AjaxHandler
_cmd = cmd
this._onHandleSuccess = function(respTO){
var json = respTO.responseJSON
if (json && json.sessionEvt) {
TTOController.handleSessionEvent(json.sessionEvt)
}
if (this._successCB) this._successCB(respTO)
}
},
setSuccessCB : function(CB){this._successCB=CB;}
});
function ClearReturnHandler (cmd ) {
TTOServiceHandler.call(this)
this._successCB = null
this._cmd = cmd
this._onHandleSuccess = function(respTO) {
var json = respTO.responseJSON
if (this._cmd.reqTO.regeneratePage) {
TTOController.regeneratePage(respTO);
}
if (this._successCB) this._successCB(respTO)
}
}
ClearReturnHandler.prototype=new TTOServiceHandler()
p=ClearReturnHandler.prototype
p.constructor=ClearReturnHandler
p.setSuccessCB=function(CB){this._successCB=CB;}
p=null
function GetAllowedFeaturesHandler(cmd ){
TTOServiceHandler.call(this)
this._cmd = cmd
}
function _onSuccess(jsonResp){
if (jsonResp) TTOModel.setAllowedFeatures(jsonResp.features)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_FeatureListRetrieved);
}
function _onError(xhr, status, error) {
}
GetAllowedFeaturesHandler.prototype=new TTOServiceHandler()
p=GetAllowedFeaturesHandler.prototype
p.constructor=GetAllowedFeaturesHandler
p.doSuccess=_onSuccess
p.doFailure =_onError;
p=null
function GetLogInfoHandler (cmd , logType, logWin) {
TTOServiceHandler.call(this)
this._cmd = cmd
this._logType = logType
this._logWin = logWin
}
function _gliHandleSuccess(json) {
this.showLog(json, 1)
}
function _gliHandleError(json) {
this.showLog(json, 0)
}
function _gliShowLog(json, success){
var d= this._logWin.document
d.writeln('<HTML>')
d.writeln('<HEAD>')
switch(this._logType){
case GetLogInfoCommand.kPIDEventLog:
d.writeln('<TITLE>PID EVENT LOG INFO</TITLE>')
break;
case GetLogInfoCommand.kPIDEventTDErrors:
d.writeln('<TITLE>TD ERRORS EVENT LOG</TITLE>')
break;
case GetLogInfoCommand.kPIDDumpDataLog:
d.writeln('<TITLE>DATA DUMP LOG</TITLE>')
break;
}
d.writeln('<LINK REL="STYLESHEET" TYPE="text/css" HREF="/css/fonts.css">')
d.writeln('</HEAD>')
d.writeln('<BODY>')
if (success){
if (json){
logs = json.logEntry;
if ( logs.length == 0 ){
d.writeln('No information in the PID event log OR errors are not included in the pidEventErrorList!');
} else {
for (var i=0; i <logs.length; i++ ){
if (GetLogInfoCommand.kPIDDumpDataLog != this._logType) {
d.writeln('<p>' + logs[i].messageType + '&nbsp;&nbsp;&nbsp;' + logs[i].messageDateTime + '</p>')
}
d.writeln('<p>' + logs[i].message)
}
}
} else {
d.writeln('No information in the PID event log!');
}
} else {
if (500 == json.status){
d.writeln('PID event log is not available, please check the PIDEventLogEnabled entry in logOptions.ini!');
} else {
d.writeln(json.responseText);
}
}
d.writeln('</BODY>')
d.writeln('</HTML>')
d.close()
this._logWin.focus()
}
GetLogInfoHandler.prototype=new TTOServiceHandler()
p=GetLogInfoHandler.prototype
p.constructor=GetLogInfoHandler
p.doSuccess = _gliHandleSuccess
p.doFailure = _gliHandleError
p.showLog = _gliShowLog
p=null
GetTopicListHandler = TTOServiceHandler.extend({
_successCB : null,
_cmd : null,
construct : function(cmd) {
this.superClass.construct.call(this);
this.constructor = GetTopicListHandler;
_cmd = cmd;
this._onHandleSuccess = function(respTO) {
var json = respTO.responseJSON;
TTOEventPubSub.publishEvent(zTopicList.kTopicListReturnedEvent, json);
};
}
});
function TTOResponseTO() {
this.httpStatus;
this.httpStatusText;
this.sessionEvent = null;
this.EZStepData = null
this.responseJSON=null
this.responseXML=null
}
TTOCommand = Class.extend({
reqTO : null,
async : true,
handler : null,
construct : function (reqTO ){
this.constuctor = TTOCommand
this.reqTO=reqTO;
this.handler=new TTOServiceHandler();
},
setSuccessCB : function(CB){
this.handler.setSuccessCB(CB);
},
setFailureCB : function(CB){
this.handler.setFailureCB(CB);
},
setTimeoutCB : function(CB){
this.handler.setTimeoutCB(CB);
},
execute : function(){}
});
TTORequestTO = Class.extend({
pageId : "",
construct : function() {}
});
SubmitCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof SubmitTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an SubmitTO"))
return
}
TTOService.submit(this.reqTO, this.handler);
}
});
SubmitTO = TTORequestTO.extend({
pageCount : 0,
clientrequest : "",
hogStatus : false,
construct : function() {}
});
AllocateCommand = SubmitCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof SubmitTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an SubmitTO"))
return
}
TTOService.allocate(this.reqTO.pageId, this.handler);
}
});
CreateCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof CreateTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an CreateTO"))
return
}
TTOService.create(this.reqTO, this.handler);
}
});
CreateTO = TTORequestTO.extend({
id : "",
csrc : "",
prodid : "",
proddata : "",
construct : function() {}
});
AjaxCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
this.handler = new AjaxHandler(this);
},
execute : function () {
if (! (this.reqTO instanceof AjaxTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an AjaxTO"))
return
}
TTOService.ajax(this.reqTO, this.handler);
}
});
AjaxTO = TTORequestTO.extend({
cmd : "",
data : "",
construct : function() {}
});
ShutdownCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof QuitTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an QuitTO"))
return
}
TTOService.shutdown(this.reqTO.delay, this.handler);
}
});
QuitTO = TTORequestTO.extend({
delay : false,
construct : function() {}
});
function UpdateDialogInfoCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != DialogInfoTO) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not a DialogInfoTO"))
return
}
TTOModel.updateCurDialogInfo(this.reqTO)
}
}
UpdateDialogInfoCommand.prototype = new TTOCommand()
UpdateDialogInfoCommand.prototype.constructor=UpdateDialogInfoCommand
function DialogInfoTO () {
this.curFS = ""
this.curForm = ""
this.curField = ""
this.topicId = ""
this.screenId = ""
this.type = 0
this.historyType = ""
this. pii = false
}
function UpdateProductInfoCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.handler = new GetAllowedFeaturesHandler(this);
TTOService.getAllowedFeatures(this.handler, this.reqTO.prodID);
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != ProductInfoTO) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not a ProductInfoTO"))
return
}
TTOModel.updateProductInfo(this.reqTO)
}
}
UpdateProductInfoCommand.prototype = new TTOCommand()
UpdateProductInfoCommand.prototype.constructor=UpdateProductInfoCommand
function ProductInfoTO () {
this.prodName = ""
this.prodID = ""
this.prodAlias = ""
this.engVer = ""
this.referrer = ""
this.fsVer = ""
}
function UpdatePageInfoCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != PageInfoTO){
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not a PageInfoTO"))
return
}
TTOModel.updatePageInfo(this.reqTO)
}
}
UpdatePageInfoCommand.prototype = new TTOCommand()
UpdatePageInfoCommand.prototype.constructor=UpdatePageInfoCommand
function PageInfoTO () {
this.reqId = ""
this.type = ""
this.CRstate = ""
this.pgCnt = ""
this.lcTags = ""
this.lcTitle = ""
}
function UpdateUserInfoCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != UserInfoTO) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not a UserInfoTO"))
return
}
TTOModel.updateUserInfo(this.reqTO)
}
}
UpdateUserInfoCommand.prototype = new TTOCommand()
UpdateUserInfoCommand.prototype.constructor=UpdateUserInfoCommand
function UserInfoTO () {
this.pid = "";
this.prodid = 0;
this.origProdid = 0;
this.paid = false
this.printed = false
this.efiled = false
this.customerType = false
}
function SetBrandingInfoCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != BrandingInfoTO) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not a BrandingTO"))
return
}
TTOModel.setBrandingInfo(this.reqTO)
}
}
SetBrandingInfoCommand.prototype = new TTOCommand()
SetBrandingInfoCommand.prototype.constructor=SetBrandingInfoCommand
function BrandingInfoTO () {
this.csrc = ""
this.logoSrcURL = ""
this.partnerName = ""
this.iframeContentURL = ""
this.embeddedContentURL = ""
this.embeddedLinkURL = ""
this.showAd = true
}
InitAppCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof InitTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an InitTO"))
return
}
if ('undefined' != typeof(TTOModel)) {
TTOModel.initAppData(this.reqTO);
}
TTOService.setServiceData(this.reqTO); }
});
InitTO = TTORequestTO.extend({
userId : "",
csrc : "",
prodId : "",
taxserver : "",
webserver : "",
port : "",
productData : "",
delayedAuth : false,
construct : function() {}
});
MigrateCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
TTOService.migrate(this.handler);
}
});
var kPrintForFiling = 0;
var kPrintForRecords = 1;
var kPrintRecordsWithRecomendedWorksheets = 2;
var kPrintRecordsWithAllWorksheets = 3;
var kPrintForReview = 4;
var kPrintSelected = 5;
var kPrintSelectedWithSupportingDetails = 6;
var kPrintEFPaperwork = 7;
var kPrintActiveForm = 8;
var kPrintEFPostmark = 9;
var kTotalPrintTypes = 10;
PrintCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof PrintTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an PrintTO"))
return
}
if (null == this.reqTO.printType) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND"," PrintTO has no printType"))
return
}
var PDFUrl = TTOService.getPDFUrl(this.reqTO)
if (this.reqTO.save)
showPDFSaveDialog(PDFUrl, true)
else
showPDFViewer(PDFUrl)
},
setSuccessCB : function (CB) { },
setFailureCB : function (CB) { }
});
PrintTO = TTORequestTO.extend({
printType : "",
itemizations : false,
watermark : false,
save : false,
FASfileId : "",
filename : "TaxReturn.pdf",
formList : null,
formsetList : null,
construct : function() {
this.formList = [];
this.formsetList = [];
},
addFormToList : function (formId ) {
this.formList.push(formId)
}
});
DownloadTaxFileCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof DownloadTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an DownloadTO"))
return
}
TTOService.download(this.reqTO, this.handler);
}
});
DownloadTO = TTORequestTO.extend({
filename : "taxReturn.tax",
responseFrame: null,
construct : function() {}
});
UpgradeSkuCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
this.handler = new UpgradeHandler(this);
},
execute : function () {
if (! (this.reqTO instanceof UpgradeTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an UpgradeTO"))
return
}
if (!this.reqTO.sku) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","UpgradeTO has invalid sku:" + reqTO.sku))
return
}
if ( this.reqTO.showWaitMsg) {
ModalWindow.setTitle("Upgrading your product")
ModalWindow.setWaitMsg("Verifying Your Upgrade...")
ModalWindow.show(document.createElement("DIV"),ModalWindow.kModal_HTMLType,null,true)
}
TTOService.upgrade(this.reqTO,this.handler);
},
setFailureCB : function (CB) {}
});
UpgradeTO = TTORequestTO.extend({
sku : 0,
skuName : "",
showWaitMsg : false,
regeneratePage : false,
construct : function() {}
});
ClearReturnCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
this.handler = new ClearReturnHandler(this)
},
execute : function () {
if (! (this.reqTO instanceof ClearReturnTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an ClearReturnTO"))
return
}
TTOService.clearReturn(this.handler, this.reqTO.skipTransfer);
}
});
ClearReturnTO = TTORequestTO.extend({
regeneratePage : false,
skipTransfer : false,
construct : function() {}
});
FormsModeCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof FormsModeRequestTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an FormsModeRequestTO"))
return
}
TTOService.executeFormCommand(this.reqTO, this.handler);
}
});
FormsModeRequestTO = TTORequestTO.extend({
submitData : null,
formFieldToGet : null,
AgencyListToLoad : null,
getFormsInReturn : false,
allowHiddenForms : false,
formToAdd : null,
formToDelete : null,
construct : function() {}
});
ServletCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof ServletTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an ServletTO"))
return
}
TTOService.servlet(this.reqTO, this.handler);
}
});
ServletTO = TTORequestTO.extend({
servletPath : "",
actionName : "",
data : "",
construct : function() {}
});
function SetABTestCommand (reqTO ) {
TTOCommand.call(this,reqTO)
this.execute = function() {
if (null == this.reqTO || this.reqTO.constructor != ABTestTO) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an ABTestTO"))
return
}
TTOModel.setABTestInfo(this.reqTO.abInfo);
}
}
SetABTestCommand.prototype = new TTOCommand()
SetABTestCommand.prototype.constructor=SetABTestCommand
function ABTestTO () {
this.abInfo = ""
}
TopicJumpCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof TopicJumpTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an TopicJumpTO"))
return
}
TTOService.topicJump(this.reqTO, this.handler);
}
});
TopicJumpTO = SubmitTO.extend({
topicPath : "",
construct : function() {
this.superClass.construct.call(this)
}
});
LogoutCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
TTOService.logout(TTOModel.getAuthId(), this.handler);
}
});
CheckDelayedAuthCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
TTOService.checkDelayedAuthUser(TTOModel.getAuthId(), this.handler);
}
});
LogErrorCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this,reqTO)
},
execute : function () {
if (! (this.reqTO instanceof LogErrorTO)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","requestTO is not an LogErrorTO"))
return
}
if (null == this.reqTO.error || this.reqTO.error.constructor != UIError){
alert("LogErrorTO does not contain a UIError Object")
return
}
if (null == this.reqTO.error.component){
return;
}
TTOService.logError(this.reqTO.error); }
});
LogErrorTO = TTORequestTO.extend({
error : null,
construct : function() {}
});
GetLogInfoCommand = TTOCommand.extend({
construct : function (logType, dataDumpType) {
this.superClass.construct.call(this)
this._logType = logType;
this._dataDumpType= dataDumpType
var op='status=0,toolbar=0,menubar=0,location=0,directories=0,resizable=1,scrollbars=1,width=600'
var logInfoWin=window.open("","__loginfo",op);
if(!logInfoWin) return
this.handler = new GetLogInfoHandler(this, logType, logInfoWin);
},
execute : function () {
var path = this._getLogPath(this._logType, this._dataDumpType);
if (null != path){
TTOService.getLogInfo(path,this.handler);
} else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("COMMAND","getLogInfo - couldn't get log path!"))
}
},
_logType : null,
_kPIDEventPath : "/pidevents/",
_kPIDEventTDErrorsPath : "/pidtderrors/",
_kPIDDataDumpPath : "/piddumpdata/",
_getLogPath : function (logType, dataDumpType) {
var path;
var PID = TTOModel.getPID();
if ( null != PID ){
switch(this._logType){
case GetLogInfoCommand.kPIDEventLog:
path =this. _kPIDEventPath + PID;
break;
case GetLogInfoCommand.kPIDEventTDErrors:
path = this._kPIDEventTDErrorsPath + PID;
break;
case GetLogInfoCommand.kPIDDumpDataLog:
path = this._kPIDDataDumpPath + PID + "/" + dataDumpType;
break;
}
}
return path;
}
},
{
kPIDEventLog : 0,
kPIDEventTDErrors : 1 ,
kPIDDumpDataLog : 2
});
GetTopicListCommand = TTOCommand.extend({
construct : function (reqTO ) {
this.superClass.construct.call(this, reqTO);
this.handler = new GetTopicListHandler(this);
},
execute : function() {
TTOService.getTopicList(this.handler);
}
});
kMigrateMsgURL = "/secure/MigrateMsg.htm"
var TTOController = (function(){
var _secureconnectionRetries = 5;
var _instance = {
allocate : function () {
var TO = new SubmitTO()
TO.pageId = "TTO_Allocate"
TO.clientrequest = ""
TO.pageCount = TTOModel.getPageInfo().pgCnt
var cmd= new AllocateCommand(TO)
cmd.setSuccessCB(_handleFirstAppResponse)
cmd.setFailureCB(_handleError)
_fStartTime = new Date()
cmd.execute()
_waitingForResponse=true
},
updateTicket : function () {
this.ajaxToApp("updateTicket", "$cookie.qbn.ticket$");
},
submit : function (nav ) {
if(_waitingForResponse)return false
_waitingForResponse=true
if(!TTOApp.isOKToSubmit()){
_waitingForResponse=false
return false
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_Submit)
var buf= TTOApp.getFormattedSubmitData()
if(nav && nav.topicPath){
_performTopicJump(buf, nav.topicPath)
}
else {
_performSubmit(buf)
}
b=null
return true
},
retrySubmit : function (bClearRetries) {
if (bClearRetries) {
_submitRetryCount = 0;
TTOApp.releaseApp(true);
}
_waitingForResponse = false;
TTOController.submit();
},
regeneratePage : function (respTO) {
_waitingForResponse = true;
_handleAppResponse(respTO)
},
doNav : function (answer, val){
if(!answer) return
var prm = TTOApp.findCtrlByID(answer+"_00")
if (!prm) return
prm.SetVal(val?val:"1")
TTOController.submit()
},
doBackNav : function () {
TTOController.doNav("Back")
},
doTopicJump : function (path){
if(!path) return
var nav = new navObj()
nav.topicPath = path
TTOController.submit(nav)
nav = null;
},
redirect : function ( u, logout){
if(u==null)return
if (logout) {
var cmd = new LogoutCommand();
cmd.execute()
}
TTOApp.fbExpectReload=true
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_AppExit)
location.replace(u)
},
refresh : function () {
TTOApp.fbExpectReload=true
window.location.reload();
},
ajaxToApp : function (cmd,data,callback) {
var TO = new AjaxTO()
TO.cmd = cmd
TO.data = data
var cmd = new AjaxCommand(TO);
cmd.setFailureCB(_handleAjaxError)
cmd.setSuccessCB(callback)
cmd.execute();
function _handleAjaxError(respTO, url){
_handleError(respTO, url, cmd);
}
},
downloadDataFile : function(fn) {
var TO = new DownloadTO()
TO.filename = fn?fn:"taxReturn.tax"+"2011"
TO.responseFrame = frames[RESPONSEFRAMEID]
var cmd = new DownloadTaxFileCommand(TO)
cmd.setSuccessCB(null)
cmd.setFailureCB(null)
cmd.execute()
},
requestHogProgressStatus : function (){
var TO = new SubmitTO()
TO.hogStatus = true
var cmd=new SubmitCommand(TO)
cmd.setSuccessCB(_handleAppResponse)
cmd.setFailureCB(_handleError)
_waitingForResponse = true;
cmd.execute()
},
handlePageEvents : function ( ev,data) {
switch (ev) {
case TTOEventPubSub.kEvt_SetProduct:
if (!data) break;
var TO = new ProductInfoTO()
TO.prodName = unescape(data.prodName)
TO.prodID = unescape(data.prodID)
TO.prodAlias = unescape(data.prodAlias)
TO.referrer = data.referrer
TO.engVer = data.engVer
TO.fsVer = unescape(data.fsVer)
var cmd = new UpdateProductInfoCommand(TO)
cmd.execute();
break;
case TTOEventPubSub.kEvt_SetUserInfo:
if (!data) break;
var TO = new UserInfoTO()
TO.pid = data.pid
TO.prodid = data.prodid
TO.origProdid = data.origProdid
TO.customerType = data.customerType
TO.paid = data.paid
TO.printed = data.printed
TO.efiled = data.efiled
var cmd = new UpdateUserInfoCommand(TO)
cmd.execute();
if (data.priorYrUser )
setReturningUser()
break;
case TTOEventPubSub.kEvt_SetBranding:
if (!data) break;
var TO = new BrandingInfoTO()
TO.csrc = data.csrc
if (data.logoSrcURL) TO.logoSrcURL = unescape(data.logoSrcURL)
if (data.partnerName) TO.partnerName =unescape( data.partnerName)
if (data.iframeContentURL) TO.iframeContentURL = unescape(data.iframeContentURL)
if (data.embeddedContentURL) TO.embeddedContentURL =unescape( data.embeddedContentURL)
if (data.embeddedLinkURL) TO.embeddedLinkURL = unescape(data.embeddedLinkURL)
TO.showAd = data.showAd
var cmd = new SetBrandingInfoCommand(TO)
cmd.execute();
break;
case "setDebugWin":
JSLoader.load(kQAWindowScript)
return;
case TTOEventPubSub.kEvt_HogProgressEvent:
_handleHogProgress(data)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_HogProgressEvent, data)
return;
case "setLCToken":
if (data) TTOModel.setLCToken(unescape(data))
return;
default:
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOController","Unknown page Event: " + ev, LOG_WARNING))
return;
}
TTOEventPubSub.publishEvent(ev);
},
handleSessionEvent : function (sessionEvtObj) {
if (sessionEvtObj.evt == 'redirect'){
var url = unescape(sessionEvtObj.data.url)
var result = url.match(/Error=(\d+)/)
if (result){
url += "&component="+unescape(sessionEvtObj.data.component)
url += "&authid="+TTOModel.getAuthId()
url += "&referrer="+TTOModel.getReferrer()
url += "&partnerName="+TTOModel.getPartnerName()
}
var clearCookies = sessionEvtObj.data.clearCookies
TTOController.redirect(url, clearCookies)
}
else if (sessionEvtObj.evt == 'uploadReady'){
zUploadDataFileReady()
}
else if (sessionEvtObj.evt == 'requestMigrate'){
_requestMigrate()
}
},
getLastResponse : function () {
return _lastResponse;
}
};
var _waitingForResponse = false;
var _submitRetryCount = 0
var _fStartTime;
var _fProfile = "";
var fPgCnt = 0;
var _lastResponse = "";
var _lastRequest = "";
function _prepareForResponse () {
_submitRetryCount = 0;
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_PrepareForPage)
}
function _beginPage() {
fPgCnt++
gLastTabIndex=100
gShowCombo=false
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_BgnPage)
}
function _endPage() {
_waitingForResponse=false;
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_EndPage, [TTOModel.getScreenId()]);
if(TTOModel.isQA())
DebugWindow.update()
}
function _performSubmit(dataBuffer){
var TO = new SubmitTO()
TO.pageId = TTOModel.getDialogInfo().screenId
TO.clientrequest = dataBuffer
TO.pageCount = TTOModel.getPageInfo().pgCnt
var cmd=new SubmitCommand(TO)
cmd.setSuccessCB(_handleAppResponse)
cmd.setFailureCB(_handleError)
_fStartTime = new Date()
cmd.execute()
_waitingForResponse=true
if (TTOModel.isQA()) {
_lastRequest = dataBuffer
DebugWindow.setClientRequest(unescape(dataBuffer))
}
}
function _performTopicJump(dataBuffer, topicPath){
var TO = new TopicJumpTO()
TO.pageId = TTOModel.getDialogInfo().screenId
TO.clientrequest = dataBuffer
TO.pageCount = TTOModel.getPageInfo().pgCnt
TO.topicPath = topicPath
var cmd=new TopicJumpCommand(TO)
cmd.setSuccessCB(_handleAppResponse)
cmd.setFailureCB(_handleError)
cmd.execute()
_waitingForResponse=true
if (TTOModel.isQA()) {
_lastRequest = dataBuffer
DebugWindow.setClientRequest(unescape(dataBuffer))
}
}
function _requestMigrate() {
var cmd=new MigrateCommand(null )
cmd.setSuccessCB(_showMigrateMsg)
cmd.setFailureCB(_handleError)
cmd.execute()
}
function _showMigrateMsg(data) {
var json = data.responseJSON;
var url = "https://" + unescape(json.webserver) + "/secure/ttonline.htm?"
for (var m in json) {
if ("webserver" == m) continue
url += unescape(m) + "=" + unescape(json[m]) + "&"
}
var msgUrl = kMigrateMsgURL + "?url="+escape(url)
Message.show(msgUrl,Message.kMsg_UrlType)
}
function _handleHogProgress (pct) {
signal('TTOController.requestHogProgressStatus()',1000)
}
function _handleFirstAppResponse (respTO) {
jQuery("#startupTxt").fadeOut(300, function() {
jQuery("#startupIcon").attr("src", "/img/green_checkmark.png");
jQuery("#startupTxt").html("Let's work on getting you your maximum refund!").fadeIn(200, function() {
jQuery("#startupMsg").fadeOut(200);
_handleAppResponse(respTO, function() {
if(!TTOModel.isWelcomeMatSupported() || !WelcomeMat.isEnabled())
jQuery("#modalBkg").hide();
});
});
});
}
function _handleAppResponse (respTO, cb) {
if(!_waitingForResponse) return
var rspTime = new Date()
_prepareForResponse();
var json = respTO.responseJSON;
if (null == json) {
_handleInvalidJSON(respTO)
return
}
if (json.sessionEvt) {
TTOController.handleSessionEvent(json.sessionEvt)
return
}
if (json.Page && json.Page.info) {
var pi = json.Page.info
var TO = new PageInfoTO()
TO.reqId = pi.reqId
TO.type = pi.type
TO.CRstate = unescape(pi.CRstate)
TO.pgCnt = pi.pgCnt
TO.lcTags = unescape(pi.lcTags)
TO.lcTitle = unescape(pi.lcTitle)
var cmd = new UpdatePageInfoCommand(TO)
cmd.execute();
}
else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOController","Missing JSON pageInfo object!!", LOG_ERROR))
}
_beginPage();
if(json.Page)
{
if (json.Page.view && json.Page.view.regions) {
regions = json.Page.view.regions
for (var i=0; i< regions.length; i++){
TTOApp.setRegion(regions[i])
}
}
if (json.Page.evtList) {
var evts = json.Page.evtList
for (var i=0; i<evts.length; i++){
var itm = evts[i].pageEvt
TTOController.handlePageEvents(itm.evt,itm.data)
}
}
if (json.Page.data) {
TTOApp.renderRegions(json.Page.data.regions);
}
}
_endPage();
if(cb)
cb();
var endTime = new Date()
var profile = new Profile()
profile.uniqueDialogID = TTOModel.getDialogInfo().screenId;
profile.requestTime = rspTime - _fStartTime;
profile.renderTime = endTime - rspTime;
var isPageBeaconed = false;
if(json.Page.beacon) {
var beac = json.Page.beacon
if(beac.isPageBeaconed=="true")
isPageBeaconed = true;
}
TTOApp.doMetrics({pageIsBeaconed: isPageBeaconed, profileData: profile})
if (TTOModel.isQA()) {
var TO = new DebugTO()
TO.lastRsp = respTO.responseText;
TO.profileData = profile;
var cmd = new DebugCommand(TO)
cmd.execute()
}
respTO = null
}
function _handleInvalidJSON (respTO) {
_lastResponse = respTO.responseText
var screenId = TTOModel.getDialogInfo().screenId;
var params = "?customerSource="+TTOModel.getCustomerSrc()+"&productid="+TTOModel.getProductId()+"&trial=" + TTOModel.isDelayedAuth() + "&close=true&screenId="+screenId+"&msg="+respTO.httpStatusText
var url = kAppRespError+params
TTOApp.hijackApp(url);
respTO = null
}
function _handleError (respTO, url , cmd ) {
var msg = "Error " + respTO.httpStatus + "; URL: " + url + "; Status Text: " + respTO.httpStatusText;
if (TTOModel.isQA())
msg += "; Last Request: " + unescape(_lastRequest);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTOController", msg , LOG_ERROR))
switch (respTO.httpStatus) {
case 0 :
case 12002 :
case 12029 :
case 12030 :
case 12031 :
case 12152 :
case 502 :
case 503 :
case 509 :
case 404 : if (++_submitRetryCount <= kSubmitRetries) {
if (cmd) cmd.execute()
else TTOController.retrySubmit();
}
else {
var params = "?customerSource="+TTOModel.getCustomerSrc()+"&productid="+TTOModel.getProductId()+"&trial=" + TTOModel.isDelayedAuth() + "&close=true&err="+respTO.httpStatus+"&msg="+respTO.httpStatusText
params += cmd?"&showRetry=false":"&showRetry=true"
var url = kSessionConnectionFailurePage+params
TTOApp.hijackApp(url);
}
break;
default : TTOController.redirect("https://turbotax.intuit.com/services/authentication/aliases/continue",true);
}
respTO = null
}
return _instance;
})();
var TTO = {
namespace : function(ns) {
var parts = ns.split(".");
var parent = TTO;
var i;
if(parts.length > 1) {
if(parts[0] === "TTO") {
parts = parts.slice(1);
}
for(i = 0; i < parts.length; i++) {
if(typeof parent[parts[i]] === "undefined") {
parent[parts[i]] = {};
}
parent = parent[parts[i]];
}
}
return parent;
}
};
TTO.namespace("TTO.DU");
TTO.namespace("TTO.H");
(function() {
var t = this;
t.clearKids = function (p) {
jQuery(p).children().remove();
}
t.appendLink = function( p, lbl, act, css, bLock, prm, arg){
var e=document.createElement("A")
if(p)p.appendChild(e)
e._lnk=true
e.clear=_clearLnk
e.bLock=(null==bLock||bLock)?true:false
if(act)e._act=act
if(prm) {
e._prm=prm
e.id=prm.fID
}
if(null!=arg)e._arg=arg
e.onclick=_lnkHndlClick
e.onkeyup=_lnkHndlKeyup
e.onmouseover=zEventClearStatusBar
if(null==css)css=zLnk.kDefLinkStyle
e.className=css
if(lbl)this.appendText( e, lbl)
return e
};
t.appendText = function( p, txt, css, id){
if (!txt) txt="";
if ((typeof txt) !== 'string') txt = new String(txt)
var SP = document.createElement("span")
if(css)SP.className=css
if(id)SP.id=id
p.appendChild(SP)
txt = txt.normalize();
var rns = txt.split('\n')
if (rns.length > 1) {
for (i=0; i<rns.length; i++){
if (i>0) newLine(p)
this.appendText(p,rns[i],css)
}
return
}
jQuery(SP).text(txt)
return SP
};
t.appendTabText = function( p, txt, css)
{
if ((typeof txt) !== 'string') txt = new String(txt)
var rowNum = 0
txt = txt.normalize();
var rows = txt.split('\n')
if (rows.length < 1)
return
var i=0
var newTxt=null
var lastCh=''
for (i=0; i<rows.length; i++)
{
while (rows[i].match(/\s$/)) {
lastCh = rows[i].charAt(rows[i].length-1)
rows[i] = rows[i].substring(0, rows[i].length-1)
}
}
var tbl = new zTable(p, 0, 0, "90%", 0, null, null)
for (i=0; i<rows.length; i++)
{
tbl.appendRow("middle", null, null)
var cells = rows[i].split('\t')
var j=0
for (j=0;j<cells.length;j++)
{
var halign = (j==1) ? "right" : "left";
tbl.appendCol(halign, "middle", null, null, null)
this.appendText(tbl.curCol, cells[j], css)
}
}
};
t.appendLabel = function ( p, id, txt, css, bNoHand) {
var e=document.createElement("label")
if(id)e.htmlFor=id
if(!bNoHand) e.style.cursor="pointer"
if(css)e.className=css
if(txt)TTO.DU.appendText( e,txt)
if(p)p.appendChild(e)
return e
};
t.appendSp = function ( p, w, h, id){
if(null==w||w<1)w=1
if(null==h||h<1)h=kDefaultSpacerHeigtht
var fn = "clear.gif"
if (TTOModel.isQA()) {
if (DebugModel.showSpacers()) fn="clearDbg.gif"
}
var e=t.appendImg( p, fn, w, h, id, "")
e.update = function(w,h) {
if (w) this.width = w;
if (h) this.height = h;
}
return e
}
t.appendImg = function ( p, n, w, h, id, alt) {
var fn=null;
var e=null;
if (n) {
fn= (n.match("/") )? n : getImageURL(n);
}
e = document.createElement('img');
if (fn) {
e.src = fn;
}
e.alt = alt?alt:"";
if (id) {
e.id = id;
}
if (w) {
e.width = w;
}
if (h) {
e.height = h;
}
e.border=0;
if (p) p.appendChild(e)
return e;
};
t.appendImgLnk = function( p, img, w, h, id, alt, act, hvrImg, css, prm, args){
var l=TTO.DU.appendLink( p, null, act, css, false, prm, args);
l.imgLnk=true;
if (act) l.onclick = _imgHndlClick;
var e=t.appendImg(null, img, w, h, id, alt);
l.appendChild(e);
if (hvrImg) {
_gImgPreloadId++;
var hvr = getPreloadedImg( hvrImg, "imgPreload" + _gImgPreloadId);
l._hvrId = hvr.id;
hvr = null;
l._img=e.src;
l.onmouseover=_imgHndlHover;
l.onmouseout=_imgHndlHover;
}
return l;
};
t.appendEdt = function ( p, id, css, sz, max, val, pw){
var e=null;
e=document.createElement("INPUT");
e.id = id;
e.tabIndex=TTOApp.tabIndex++;
if (pw) e.type = "password"
if (css) { e.className = css; }
if (sz > 0) { e.size = sz; }
if (max > 0) { e.maxLength = max;}
if (val) {
jQuery(e).val(val);
}
if (p) p.appendChild(e);
return e;
}
t.appendLst = function( p, id, o, ln, val, w){
var cnt=(o)?o.length:0
if(!val)val=0
if(ln||ln>1){
if(ln>kMaxListboxLines)ln=kMaxListboxLines
}
else ln=1
var e=document.createElement("SELECT")
e.id = id
e.className="lst"
e.size=ln
if(w){
e.setAttribute("style","width:"+ w + "px")
}
e.tabIndex=TTOApp.tabIndex++
if (p) p.appendChild(e)
for(var i=0;i<cnt;i++){
e.options[i]=new Option(decodeURIComponent(o[i]), i, false);
if(i==val) {e.selectedIndex = i}
}
return e
}
var kDefaultSpacerHeigtht = 10
var _lnkHndlKeyup = function(ne){
var evt=new zEvent(ne)
if("13"==evt.which)_lnkHndlClick(ne)
};
var _lnkHndlClick = function(ne){
var evt=new zEvent(ne)
evt.cancel()
var t=evt.element
while(t&&!t._lnk)t=t.parentNode
if(null==t)return
if(t._act||t._prm){
if(t.bLock){
t.onmouseout=null
t.onmouseover=null
}
if (t._act && typeof t._act == "function")
eval('t._act()')
else if (t._act)
eval(t._act)
else if(t._prm){
if(null!=t._arg)t._prm._OnClick(t._arg)
else t._prm._OnClick()
}
}
};
var _clearLnk = function(){
var t=this
t._lnk=null
t.clear=null
if(t._act)t._act=null
if(t._prm)t._prm=null
if(null!=t._arg)t._arg=null
};
var _imgHndlClick = function(ne) {
var evt=new zEvent(ne);
evt.cancel();
var t=evt.element;
while (t && !t.imgLnk) {
t = t.parentNode;
}
if (t) {
if (t._img) {
t.firstChild.src = t._img;
}
if (t._act) {
if (typeof t._act === "function") {
eval('t._act()');
} else {
eval(t._act);
}
}
}
};
var _imgHndlHover = function (ne){
var evt=new zEvent(ne);
var t=evt.element;
while (t && !t.imgLnk) {
t = t.parentNode;
}
if (null == t) {
return;
}
var img=t.firstChild;
if ("mouseover" == evt.type) {
img.src = $(t._hvrId).src;
} else {
img.src = t._img;
}
if (gbIE) {
window.status = "";
evt.eventObj.cancelBubble = true;
evt.eventObj.returnValue = true;
} else {
evt.cancel();
}
};
}).apply(TTO.DU);
(function() {
var t = this;
t.showModalBg = function( bkgID) {
var modalbkg = jQuery("#" + (bkgID || MODALBKG));
var d = jQuery(document);
modalbkg.width(d.width());
modalbkg.height(d.height());
modalbkg.show();
};
t.hideModalBg = function( bkgID) {
var modalbkg = jQuery("#" + (bkgID || MODALBKG));
modalbkg.hide();
};
}).apply(TTO.H);
var CacheManager = (function() {
var _instance = {
initImgs : function () {
_cacheImgs([
{"fn":"clear.gif", "id":'clearImg'},
{"fn":"navBlt.gif", "id":"navBlt"}
]);
},
prefetchTokenizer : function () {
if (!_kTokenizerReady && _kTokenizerUsePrefetch) {
_prefetchTokenizer();
}
},
isTokenizerReady : function () { return _kTokenizerReady; }
};
var _kCacheLayerID = "cacheLayer",
_kTokenizerUsePrefetch = ("1" != "" && "1" != "0")
_kTokenizerReady = false;
_kTokenizerUrl1 = "https://gwsoajsod.intuit.com/sdsa?sysid=tto",
_kTokenizerUrl2 = "https://gwsoajsod2.intuit.com/sdsa?sysid=tto",
_kTokenizerRetryCount = 0;
function _cacheImgs(imgs) {
if(imgs != undefined && imgs.length != undefined) {
var cacheDiv = document.getElementById(_kCacheLayerID);
for(var index = 0; index < imgs.length; index++) {
var idStr = imgs[index].id ? (" id='" + imgs[index].id + "'") : "";
var src = (imgs[index].fn.indexOf("http") == -1 ) ? getImageURL(imgs[index].fn) : imgs[index].fn;
jQuery("<img src='" + src + "' width='1' height='1' class='preload' " + idStr + "></img").appendTo(cacheDiv);
;
}
}
}
function _prefetchTokenizer () {
_cacheImgs([
{"fn":"https://gwsoajsod.intuit.com/sdsa/nothing.gif", "id":"tkn1"},
{"fn":"https://gwsoajsod2.intuit.com/sdsa/nothing.gif", "id":"tkn2"}
]);
}
function _contactTokenizer(url) {
Tokenizer.setScriptSrc(url);
Tokenizer.setSuccessCB(_handleTokenSuccess);
Tokenizer.setErrorCB(_handleTokenError);
Tokenizer.TokenizeCC("4444222233331111", 60000 );
function _handleTokenSuccess(token) {
_kTokenizerReady = true;
;
}
function _handleTokenError (errType, rsp) {
if (Tokenizer.kError_Timeout == errType) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER","Prefetch Failed: "+ url, LOG_ERROR));
_prefetchTokenizer();
}
else {
_kTokenizerReady = true;
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER","Prefetch success: "+ url, LOG_INFO));
}
}
}
return _instance;
})();
kProgHelpURL = "/secure/help/application/prghelp/"
kJumpToRegEx = /interviewtopic=[A-Za-z0-9]*:[A-Za-z]*:[A-Za-z]*/gi
function hyperToUrl(page)
{
if (page==null) return
if ( page.match(kJumpToRegEx) ) {
generateJumpToTopicURL(page.match(kJumpToRegEx).toString().substring(15));
}
else {
gotoURL(page)
}
}
function generateJumpToTopicURL( link) {
var pairs = link.split(':');
var fsID = pairs[0];
var intrvwType = pairs[1];
var topic = pairs[2];
zBookmark._nav_jump_Bookmark_ClickHandler(fsID, intrvwType, topic)
}
function hyperTo(page){
PONWindow.showHypHelp(page)
}
function goPriorReturn()
{
var url = TTOService.getContentUrl("riadialog", "PriorYear", null, true);
var loc=0
if(gbSafari || gbIE) {
loc=1
}
var ops='copyhistory=0,toolbar=1,status=0,location='+loc+',menubar=0,directories=0,resizable=1,scrollbars=1,height=776,width=742,screenX=150,screenY=100'
PYWnd=window.open(url,"__PriorReturnWindow",ops)
PYWnd.focus()
TTOApp.registerWindow(PYWnd);
}
function gotoTechSupport( id , loc , params )
{
var url = TTOModel.isFFA() ? "https://turbotax.intuit.com/support/in-product/freedom/?tmSrc=cookie" : loc === "fta" ? "https://turbotax.intuit.com/support/in-product/343-fta-interview-out/?tmSrc=cookie" : "https://turbotax.intuit.com/support/in-product/home/?tmSrc=cookie";
url += "&lid=";
url += id?id:3000;
url += "&ctype=" + TTOModel.getCustomerType();
url += "&tags=" + TTOModel.getPageLCTagset();
url += "&abtest="+escape(TTOModel.getABTestAsParams());
if (params) {
url += "&" + params;
}
var ops='copyhistory=0,toolbar=0,status=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,height=400,width=800,screenX='+150 +',screenY='+100
var wnd=window.open(url,'__techSupportWindow',ops)
if(wnd) wnd.focus()
}
function gotoSecurity()
{
var url = TTOModel.isFFA() ? "http://security.intuit.com/privacy" : "http://security.intuit.com";
gotoURL(url)
}
function gotoTaxHelp(id,x,y) {
gotoTechSupport()
}
function gotoProgramHelp(id,x,y,z) {
var url = kProgHelpURL + 'prg' +id.toLowerCase()+'.htm'
PONWindow.show(url,kHELP_FileType,z)
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"Help_" + id,'Help')
}
}
function hyperToPrgHelp(id) {
var url = kProgHelpURL + id.toLowerCase() + '.htm';
PONWindow.show(url,kHELP_FileType)
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"Help_" + id,'Help')
}
}
function goFeedback( src, srchstring)
{
var gQuery=srchstring?srchstring:""
var gHelpType = ""
var gHelpContext = ""
var gHistory = ""
var FBLSource = src?src:"APP"
var ws=top.location.protocol+'/'+'/'+top.location.hostname
var params = [{name:"helpType", value:gHelpType},{name:"helpContext", value:gHelpContext},{name:"helpHistory", value:gHistory},{name:"searchString",value:gQuery},{name:"curform", value:TTOModel.getDialogInfo().curForm},{name:"curfield", value:TTOModel.getDialogInfo().curField},{name:"FBLSource", value:FBLSource},{name:"productid", value:TTOModel.getProductId()}]
var loc = TTOService.getTTOUrl( TTOService.kFeedBackCommand, "", null, params)
var ops='copyhistory=0,toolbar=0,status=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,height='+600 +',width='+731 +',screenX=150,screenY=100'
FBLWnd=window.open(loc,"__feedbackLoopWindow",ops)
FBLWnd.focus()
TTOApp.registerWindow(FBLWnd);
}
function goFullSite() {
var url = location.href;
url = url.replace("ttonline_tablet", "ttonline");
url += "&fFullversion=true";
location.replace(url);
}
function goTabletSite() {
var url = location.href;
url = url.replace("ttonline", "ttonline_tablet").replace("&fFullversion=true", "");
location.replace(url);
}
kHELP_FileType = "f"
kHELP_HTMLType = "h"
kHELP_HBlockType = "b"
p=zViewer.prototype
p.constructor=zViewer
p.init=zVwrInit
p.render=zVwrRender
p.setpos=zVwrSetPos
p.close=zVwrClose
p.onEvent=zVwrOnEvent
p._show=_zVwrShow
p._hide=_zVwrHide
p=null;
function zViewer( id)
{
var t=this
t.fID=id
t.el=null
t._fFileName="/secure/blank.htm"
}
function zVwrInit( fn, p) {
var d=document
var t=this
t._fFileName=(fn)?fn:"/secure/blank.htm";
if ($(t.fID)==null){
var e=document.createElement("DIV")
var s="<IFRAME name="+t.fID+" id="+t.fID+" class='viewer' src='/secure/blank.htm' frameborder='0' scrolling='auto' marginheight='0' marginwidth='0'></IFRAME>"
e.innerHTML=s
var fr=e.firstChild
if (p) p.appendChild(fr)
else d.body.appendChild(fr)
t.el=fr
TTOApp.registerViewer(this)
}
t._hide()
t.setpos( 0, 0, null, 10, 10)
try{
frames[t.fID].location.replace("/secure/blank.htm")
}
catch(e) {
$(t.fID).src='/secure/blank.htm'
}
var iframeEl = jQuery("#" + t.fID)[0];
iframeEl.ignoreOffsetPadding = true;
MessageHandler.startListener(iframeEl);
}
function zVwrRender( n, bdr){
var t=this
if (!t.fID) return
if (n) t._fFileName=n
try{
frames[t.fID].location.replace(t._fFileName)
}
catch(e) {
$(t.fID).src=t._fFileName
}
t._show(bdr)
}
function zVwrSetPos(x,y,z,w,h){
var t=this
setPos(t.el,x,y,z)
setDim(t.el,w)
setDim(t.el,null,h)
}
function zVwrClose(){
this.init("/secure/blank.htm")
}
function zVwrOnEvent( ev, arg1,arg2)
{
}
function _zVwrShow(bdr){
var t=this
if(bdr)t.el.style.border=bdr
show(t.el)
}
function _zVwrHide(){
var t=this
hide(t.el)
}
function zRect(x,y,w,h){
var t=this
if(x)t.fX=x
if(y)t.fY=y
if(w)t.fW=w
if(h)t.fH=h
}
function _zRectIsIntersect( r){
if(null==r)return false
var t=this
var tRht=t.fX+t.fW
var tBtm=t.fY+t.fH
var rRht=r.fX+r.fW
var rBtm=r.fY+r.fH
if((t.fX>=r.fX&&t.fX<=rRht)||(tRht>=r.fX&&tRht<=rRht)||(r.fX>=t.fX&&r.fX<=tRht)||(rRht>=t.fX&&rRht<=tRht)){
if((t.fY>=r.fY&&t.fY<=rBtm)||(tBtm>=r.fY&&tBtm<=rBtm)||(r.fY>=t.fY&&r.fY<=tBtm)||(rBtm>=t.fY&&rBtm<=tBtm))return true
}
return false
}
p=zRect.prototype
p.isIntersect=_zRectIsIntersect
p.fX=0
p.fY=0
p.fW=0
p.fH=0
p=null
function zTable( p, cp, cs, w, bBrd, css, cols){
var t=this
var e=document.createElement("TABLE")
if(cols){
e.cols=cols
t.numCols=cols
}
if(p)p.appendChild(e)
e.cellPadding=(cp)?cp:0
e.cellSpacing=(cs)?cs:0
e.border=(bBrd)?1:0
if(css)e.className=css
if(w)setDim(e, w)
t.el=e
t.body=document.createElement("TBODY")
e.appendChild(t.body)
}
function _zTableClear(){
var t=this
t.el=null
t.body=null
t.curRow=null
t.curCol=null
}
function _zTableAppendRow( a, va, w, css){
var e=document.createElement("TR")
this.body.appendChild(e)
if(a)e.align=a
if(va)e.vAlign=va
if(w)setDim(e, w)
if(css)e.className=css
this.curRow=e
this.curCol=null
}
function _zTableAppendCol( a, va, w, spn, css){
var t=this,e=null
if(!t.curRow)return
e=document.createElement("TD")
this.curRow.appendChild(e)
if(a)e.setAttribute('align',a)
if(va)e.setAttribute('vAlign',va);
if (!spn || spn < 2) {
if (w) {
setDim(e, w);
}
}
if(spn)e.setAttribute('colSpan',spn)
if(css)e.className=css
t.curCol=e
}
function _zTableAppend( e){
if(this.curCol)this.curCol.appendChild(e)
}
p=zTable.prototype
p.el=null
p.body=null
p.curRow=null
p.curCol=null
p.numCols=null
p.appendRow=_zTableAppendRow
p.appendCol=_zTableAppendCol
p.append=_zTableAppend
p.clear=_zTableClear
p=null
function $(id){return document.getElementById(id)}
function Submit()
{
return TTOController.submit();
}
function navObj()
{
this.topicPath = null;
}
function getImageURL(name) {
if (name.indexOf('.') < 0) {
name += ".png";
}
var imgPath = '/img/'+name
if (0) {
var host = ''
if (!host) {
host = location.hostname.substr(0, location.hostname.indexOf('.turbotaxonline'))
host = host.replace (/\./g, "-")
}
imgPath = 'https://'+host+'-secure.images.turbotaxonline.intuit.com'+imgPath
}
return imgPath
}
function getSWFUrl(name) {
if (name.indexOf('.') < 0) name += ".swf";
var flashPath = '/flash/'+name
if (0) {
var host = ''
if (!host) {
host = location.hostname.substr(0, location.hostname.indexOf('.turbotaxonline'))
host = host.replace (/\./g, "-")
}
flashPath = 'https://'+host+'-secure.images.turbotaxonline.intuit.com'+flashPath
}
return flashPath
}
function setBkgImg( e, n){
var fn = (n.match("/") )?n:getImageURL(n);
e.style.backgroundImage = "url('"+fn+"')";
}
function changeImage( l, img, alt){
if (img && l) {
l.src = getImageURL(img);
}
if (alt) {
l.alt = alt;
}
}
function exitOnError() {
TTOController.redirect("http://turbotax.intuit.com", false);
}
function isUndefined(v){
return(typeof(v) == 'undefined'||null==v)
}
function isDefined(v){
return(typeof(v) != 'undefined' && v!=null)
}
function getParamValue( u, n)
{
n = n.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
var regexS = "[\\?&]"+n+"=([^&#]*)";
var regex = new RegExp( regexS );
var results = regex.exec(u);
if( results == null )
return "";
else
return results[1];
}
function loadCSS( f, id, m)
{
if (isUndefined(f))
return;
if (isUndefined(m))
m = 'screen';
var d = document;
var headID = d.getElementsByTagName("head")[0];
var cssNode = d.createElement('link');
cssNode.type = 'text/css';
cssNode.rel = 'stylesheet';
cssNode.href = "/css/"+f;
cssNode.media = m;
if (id) cssNode.id = id
headID.appendChild(cssNode);
}
function hideProblemLayers(bHide)
{
if (!gbIE) return
if (BrowserSniffer.isIE6()) {
var boxes = document.getElementsByTagName("SELECT");
for (var i = 0; i < boxes.length; i++) {
if (bHide)
hide(boxes[i]);
else
show(boxes[i]);
}
}
var formLayer = $('formLayer');
if (!formLayer) return
if (bHide)
{
dontdisplay(formLayer);
}
else
{
display(formLayer);
}
}
function setBGColor(e,clr){
e.style.backgroundColor=clr
}
function pause(amt){
var dt = new Date()
while (true){
mill=new Date()
var diff = mill-dt
if( diff > amt ) break;
}
}
function getWindowWidth(){
var w
if (gbMozilla)
w=window.innerWidth-16
else
var w=document.documentElement.clientWidth
if(BrowserSniffer.isMac())w-=15
if(w<=0)w=screen.width
return w
}
function getWindowHeight(){
var h
if (gbMozilla)
h=window.innerHeight
else
h=document.documentElement.clientHeight
if(h<=0)h=screen.height
return h
}
function getExactX(e){
var x=0;
if (e.offsetParent) {
var tmp=e
while (tmp.offsetParent) {
x += tmp.offsetLeft
tmp = tmp.offsetParent;
}
}
return x
}
function getExactY(e){
var y=0;
if (e.offsetParent) {
var tmp=e
while (tmp.offsetParent) {
y += tmp.offsetTop
tmp = tmp.offsetParent;
}
}
return y
}
function gotoURL( url, w, h, n){
url=unescape(url)
if(!w)w=760
if(!h)h=570
if(!n)n='hlperWin'
var ops='copyhistory=0,toolbar=1,status=1,location=1,menubar=1,directories=1,resizable=1,scrollbars=1,height='+h+',width='+w+',screenX=150,screenY=100'
var dest='https://'+location.hostname+'/open/home/'+"external.htm"+"?"+url
JSWnd=window.open(dest,n,ops)
JSWnd.focus()
TTOApp.registerWindow(JSWnd);
}
function getEFPIN(prm) {
if (prm) {
prm.SetVal(1);
TTOController.submit();
}
JSLoader.load("irsPIN.js", function() {
irsPIN.show();
});
}
function popupsBlocked(){
var blocked=true
try{
if(BrowserSniffer.isIOS())
return false;
var testwin = window.open('','','width=1,height=1,left=-10,top=-10,scrollbars=no');
if(testwin) {
blocked=false
testwin.close()
}
else {
blocked=true
}
}
catch(ex){ }
return blocked
}
function getPreloadedImg( fn,id){
var Img = $(id)
if (!Img) {
Img = TTO.DU.appendImg(document.body,fn,1,1,id)
Img.className="preload"
}
return Img
}
function signout(dontShowMsg){
if ( TTOModel.isDelayedAuth() ) {
DelayedAuth.exitSession()
}
else {
var so = TTOApp.findCtrlByType(49)
if (so) so._OnClick(dontShowMsg)
}
}
function hardstop_sign_out(){
signout()
}
function trialForceSave() {
if (TTOModel.isDelayedAuth())
DelayedAuth.forceSave()
}
function exitToUrl(url) {
if (TTOModel.isDelayedAuth() && confirm("Do you want to save your data before exiting?\nYou'll need to create a TurboTax Account.")) {
DelayedAuth.openCreateDlg();
return
}
var TO = new QuitTO();
TO.delay = false
var close = new ShutdownCommand(TO);
close.execute();
TTOController.redirect(url, true)
}
function showItsDeductible(cname, ddate){
if(TTOApp.isErrorTipShowing())
{
TTOApp.showValidationAlert ();
return;
}
var _ctrl = {
name : "Done_00"
}
var _data = {
component : "ItsDeductible",
fileRef : "ItsDeductible.html",
params : "charityname=" + cname + "&donationdate=" + ddate,
css : "IdModalWin",
w : {"type":"x","val":700},
h : {"type":"x","val":520},
modal : true
}
var _idoRIAObj = new zRIA(_ctrl);
_idoRIAObj.Render(_data);
}
function showOptimizerAnimation( prm )
{
TransitionMsg.setMessage("Optimizing Credits and Deductions<br/><span class='waitSubMsg'>Please wait, you will see results shortly.</span>")
prm.SetVal(1)
TTOController.submit()
}
function showRAModalTransition( prm ) {
TransitionMsg.setSpecialMsg("Optimizing your refund" , true, "RATransition")
var h = jQuery('#' + prm.fID).position().top + jQuery('#' + prm.fID).height() + jQuery('#contentLayer').position().top + 20
TransitionMsg.setMsgPosition(0,h)
prm.SetVal(1)
TTOController.submit()
}
function showGetFlashPlayerNotice()
{
showGetFlashPlayerNotice._hide = function()
{
Message.hide();
}
showGetFlashPlayerNotice._install = function()
{
showGetFlashPlayerNotice._hide();
window.open('http://www.adobe.com/go/getflashplayer/');
}
var e = document.createElement("div");
var tl = document.createElement("div");
newLine(tl);
TTO.DU.appendText(tl, "The content you've requested requires the latest version of the ", "getFlashPlayerTitle");
TTO.DU.appendLink(tl, "Adobe Flash Player", showGetFlashPlayerNotice._install, "getFlashPlayerTitle");
newLine(tl);
newLine(tl);
e.appendChild(tl);
var txt = document.createElement("div");
TTO.DU.appendText(txt, "Make sure you've disabled pop-up blockers before clicking the link below:", "getFlashPlayerText");
newLine(txt);
TTO.DU.appendLink(txt, "Install the Adobe Flash Player", showGetFlashPlayerNotice._install, "getFlashPlayerText" );
e.appendChild(txt);
cbtn = document.createElement("DIV");
cbtn.id = "_getFlashPlayerCancelBtn";
cbtn.className = "getFlashPlayerCancelBtn";
zAns.appendDlgAns(cbtn, "Cancel", "flash_cancel", null, zAns.eLargeAnswerType, showGetFlashPlayerNotice._hide);
e.appendChild(cbtn);
Message.show(e, Message.kMsg_HTMLType);
}
function setAMTHeldCookie(bSet)
{
if (bSet)
setPublicCookie("tto_amthold", "true", true, true, kNextYearCookieDate)
else
expireCookie("tto_amthold")
}
function AjaxSequencer()
{
this.requestList = new Array();
this.currentReq = null;
}
AjaxSequencer.prototype = {
addRequest: function(command, data, callback){
if (!command) return
var o = new Object()
o.cmd = command
o.data = data
o.cb = callback
this.requestList.push(o)
},
send : function () {
var mrCnt=0;
var t=this
if (t.requestList.length == 0) return
t.currentReq = t.requestList[mrCnt];
TTOController.ajaxToApp(t.currentReq.cmd, t.currentReq.data, doNext)
function doNext(rspTO) {
if (t.currentReq.cb) t.currentReq.cb(rspTO)
if (t.requestList.length <= ++mrCnt) return;
t.currentReq = t.requestList[mrCnt];
TTOController.ajaxToApp(t.currentReq.cmd,t.currentReq.data,doNext)
}
}
}
function goFBShare(location) {
var redirect = "http://socialmedia.intuit.com/fbtto.php"
var microsite="http://turbotax.intuit.com/internal/facebook1";
var title = "TurboTax Online"
var desc="I'm doing my taxes with TurboTax Online"
var icon= null
switch (location) {
case 'efile' :
microsite="http://turbotax.intuit.com/internal/facebook1";
title = "Great news! I just finished my taxes."
desc = "Are your taxes done? I just finished mine. Thank you TurboTax!"
break;
default :
break;
}
var params = encodeURIComponent("u=" + microsite + "&t=" + title + "&d=" + desc + (icon?("&i="+icon):""))
var url = redirect + "?" + params
window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(url)+'&t='+encodeURIComponent(title),'sharer','toolbar=0,status=0,width=626,height=436');
zBeacon.addBeacon(eOmnitureBeacon,"I like this",location)
}
function getQueryString(location) {
if(location) {
var indexOfQuestionMark = location.indexOf("?");
if(indexOfQuestionMark > 0 && (indexOfQuestionMark + 1) < location.length)
return location.substring(location.indexOf("?")+1, location.length);
else
return "";
}
else
return "";
}
function areCharsValid(str, checkAlpha, checkDigit, checkSpace) {
var temp = str;
if(checkAlpha) {
temp = temp.replace(/[A-Za-z]/gi, "");
}
if(checkDigit) {
temp = temp.replace(/[0-9]/gi, "");
}
if(checkSpace) {
temp = temp.replace(/ /gi, "");
}
return temp.length == 0;
}
function gotoExitSurvey()
{
var bShowSurvey = false;
var args;
var url;
if( ((TTOModel.getAuthId() % 100) <= 3) && !TTOModel.getUserInfo().paid ) {
bShowSurvey = true;
url = "http://webview.isacorp.com/ttoty09do";
}
else if(TTOModel.getUserInfo().paid && (TTOModel.getUserInfo().efiled || TTOModel.getUserInfo().printed)) {
bShowSurvey = false;
}
else if(TTOModel.getUserInfo().paid && (!TTOModel.getUserInfo().efiled || !TTOModel.getUserInfo().printed)) {
bShowSurvey = true;
url = "http://turbotax.intuit.com/microsite/exitpaidnotfiled.jsp";
}
else if( !TTOModel.isNewUser() && !TTOModel.isDelayedAuth() ) {
bShowSurvey = false;
}
else if( TTOModel.isNewUser() || TTOModel.isDelayedAuth()) {
var hardExitTestVal = TTOModel.getABTestValue("FlowHE")
if(hardExitTestVal && hardExitTestVal.toLowerCase() == kHardExitB_ABTestOn) {
bShowSurvey = true;
url = "http://turbotax.intuit.com/microsite/exitsurvey.jsp";
args = 'scrollbars=1,resizable=1,width=900,height=685';
}
}
if( bShowSurvey )
{
var tab1 = -1
var tab2 = -1
if (TTOApp) {
var pb = TTOApp.findCtrlByType(26)
if(pb) {
tab1 = (pb.getCurIndex() == null) ? "-1" : pb.getCurIndex()
tab2 = (pb.getCurSIIndex() == null) ? "-1" : pb.getCurSIIndex()
}
}
url += "?priorityCode=" + TTOModel.getCustomerSrc()
url += "&product=" + TTOModel.getProductId()
url += "&a=" + getCookie('customerType')
url += "&authid=" + TTOModel.getAuthId()
url += "&bsku=" + "&pf=" + "&prs=" + "&pysku="
url += "&origProd=" + TTOModel.getUserInfo().origProdid
url += "&rstate1=" + "&state1=" + "&rt=" + "&ttoar=" + "&ttoarelig=" + "&upg=" + "&w2="
url += "&tab1=" + tab1 + "&tab2=" + tab2
openWindow(url,"",args)
}
}
function showClearReturn( st) {
var CRCtrl = new zRIA()
var data = null;
data = {
component : "ClearReturn",
fileRef : st? "ClearReturnSkipTransfer.htm" : "ClearReturn.htm",
w : {"type":"x","val":450},
h : {"type":"x","val":135},
ch : true,
cv : true,
modal : true
};
CRCtrl.Render(data);
}
function showTour(bShow) {
if(bShow) {
top.TTOApp.doMetrics({LCTitle:"", currentScreenId:"TourDemoClicked", reqId:"TourDemoClicked", eventType:"ButtonContinue", pageIsBeaconed:true});
var width = 640;
var height = 360;
var ctrl = {
name : 'tour',
w : {'type' : 'x', 'val' : width},
h : {'type' : 'x', 'val' : height}
};
var tourCtrl = new zIFr(ctrl);
var tmp = document.createElement('div');
tourCtrl.setLayout(tmp);
var data = {
system : 'local',
fileAlias : 'tour',
isFlow : false,
modal : true,
resizeCB : function() {}
};
var modalParams = {
content : tmp,
w : width,
h : height,
ch : true,
cv : true,
noPadding : true,
closeBtn : true,
dismissable : true,
beforeCloseCB : function() {
jQuery("#demoCallToActionButton").remove();
}
};
RIAModalWindow.show(modalParams);
tourCtrl.Render(data);
jQuery(".RIAModalWin").append("<div id='demoCallToActionButton' onclick='simulateWelcomeStart()' role='button' tabindex='3'></div>");
}
else {
RIAModalWindow.hide(true);
}
}
function openWindow(page, name, args )
{
if (!name)
name = 'SessWnd';
if (!args)
args = 'scrollbars=1,resizable=1,width=750,height=550';
try {
SessWnd = window.open(page,name,args)
SessWnd.focus();
TTOApp.registerWindow(SessWnd);
}
catch(ex) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("Helpers","could not open popup and set focus", LOG_INFO, ex))
}
}
function showVerbatim(){
var _ctrl = {
name: "Verbatim"
}
var _vbtRIAObj = new zRIA(_ctrl)
var data = {
component: "NetPromoter",
fileRef: "Verbatim.htm",
w: {"type": "x","val": 480},
h: {"type": "x","val": 500},
modal : true,
ch: true,
cv:true,
closeBtn:true
}
_vbtRIAObj.Render(data);
}
function showExplainBenefit(type , state , psc ){
var _benefRIAObj = new zRIA()
var stateParam = state?("&state="+state + "&psc=" + psc):""
var paramList = "type=" + type + stateParam;
var height = 424;
if("FED" == type.toUpperCase()) {
height=424;
}
else if("STATE" == type.toUpperCase()) {
height=390;
}
else if("AD" == type.toUpperCase()) {
height=490;
}
else if("RT" == type.toUpperCase()) {
height=298;
}
var data = {
component : "ExplainBenefit",
fileRef : "ExplainBenefit.htm",
params: paramList,
w : {"type":"x","val":669},
h : {"type":"x","val":height},
modal : true,
ch: true,
cv:true,
closeBtn:true
}
_benefRIAObj.Render(data);
}
function getIdFromString(val) {
return val.replace(/[^A-Za-z0-9]/g, "_");
}
function showPDFViewer(pdfURL) {
var dest='https://'+location.hostname+'/secure/'+"PDFViewer.htm"+"?"+pdfURL;
openWindow(dest, "Your_Tax_Documents", "scrollbars=yes, width=950, height=672");
}
function showPDFSaveDialog(pdfURL) {
jQuery("#"+top.RESPONSEFRAMEID, parent.document).attr("src", pdfURL);
}
function simulateWelcomeStart() {
RIAModalWindow.hide(true);
var ifr = jQuery("#contentLayer iframe").get(0);
if(ifr.contentDocument)
jQuery(ifr.contentDocument.getElementById("continueButton")).trigger("click");
else
jQuery(ifr.contentWindow.document.getElementById("continueButton")).trigger("click");
}
function ConvertStringToFormDataVO(formFieldID) {
if ( (null == formFieldID) || (0 == formFieldID.length) ) {
return null;
}
var items = formFieldID.split('.')
if (items.length<2){
return null;
}
var form = parseOutForm(items[1]);
if (3 == items.length) {
var field = parseOutField(items[2]);
form.fields.push(field);
}
form.agencyId=items[0];
return form;
function parseOutForm(form) {
var items = form.split(':');
var frm = new FormDataVO();
frm.id = items[0];
frm.copyNum = (items.length>1)?parseInt(items[1]):0;
return frm;
}
function parseOutField(field) {
var items = field.split(':');
var fld = new FieldDataVO();
fld.id = items[0];
fld.elementNum = (items.length>1)?parseInt(items[1]):0;
return fld;
}
}
function ConvertStringsToFormDataVO(formfieldIDList) {
if (formfieldIDList.length == 0) return null;
var form = ConvertStringToFormDataVO(formfieldIDList[0]);
if (null == form) return null
for (var i=1; i<formfieldIDList.length; i++ ) {
var tempForm = ConvertStringToFormDataVO(formfieldIDList[i]);
if (null != tempForm)
form.fields.push(tempForm.fields[0])
}
return form;
}
function ConvertStringToFieldDataVO(formFieldID) {
var formData = ConvertStringToFormDataVO(formFieldID);
return formData.fields[0];
}
function CreateFormDataVO(form, fields, vals) {
if ( (null == form) || (0 == form.length) ) {
return null;
}
var formdata = ConvertStringToFormDataVO(form);
for (var i=0; i< fields.length; i++) {
var fd = ConvertStringToFieldDataVO(fields[i]);
fd.value = vals[i];
formdata.fields.push(fd);
}
return formdata;
}
function FormDataVO () {
var t=this
t.id;
t.agencyId;
t.copyNum = 0;
t.filecopy = -1;
t.name;
t.visited = false;
t.fileable = false;
t.common = false;
t.removeable = true;
t.fields = new Array();
t.fieldArrays = new Array();
}
function FormIdVO () {
var t=this
t.id;
t.agencyId;
t.name;
t.copyNum;
t.filecopy = -1;
}
function FieldDataVO () {
var t=this
t.id;
t.elementNum = 0;
t.enterable = false;
t.value = "";
}
function FormsModeUtil () {
var _submitData = new Array();
kFormImage = "formImage";
kFormData = "formData";
kFormsInReturn = "formsInReturnList";
kCalcedData = "calcedData";
kFormFieldData = "formFieldData";
kSuccess = "success";
kPORFormsInReturn = "PORformsInReturn";
kAgencyFormList = "agencyFormList";
kAddFormAction = 'AddForm';
kDeleteFormAction = 'DeleteForm';
kOpenFormAction = 'OpenForm';
kGetCalcedFormDataAction = 'GetCalcedData';
kSetFormDataAction = 'SetFormData';
kCloseFormsModeAction = 'CloseFormsMode';
kGetFormDataAction = 'GetFormData';
kGetFormFieldDataAction = 'GetFormFieldData';
kGetFormImageAction = 'GetFormImage';
kGetAgencyFormList = 'GetAgencyList';
kGetFormsInReturnList = 'GetFormInReturnList';
kGetPORFormsInReturn = 'GetFormsInPORList';
kFMRSPActionDelimiter = ';';
kFMRSPItemDelimiter = '~';
kFMRSPColon = ':';
this.addSubmitFormValues = function (data )
{
if (null == data) return;
_addRequest(kSetFormDataAction, _formatFormDataPOSTRequest(data) );
}
this.addGetFormFieldData = function (data )
{
if (null == data) return;
_addRequest(kGetFormFieldDataAction, _formatFormDataPOSTRequest(data) );
}
this.getSubmitVal = function () {
var data = "";
for (var p in _submitData) {
if (data.length > 0) { data += kFMRSPActionDelimiter; }
data += _submitData[p].name;
data += "=";
data += _submitData[p].value;
}
return escape(data);
}
function _addRequest (n, v) {
var req = {name:n, value:v}
_submitData.push(req);
}
function _formatFormDataPOSTRequest (data ) {
if (null == data.formId.agencyId || "" == data.formId.agencyId) {
return "";
}
var agency = data.formId.agencyId;
var formID = data.formId.agencyId
formID += kFMRSPItemDelimiter
formID += data.formId.id
formID += kFMRSPItemDelimiter
formID += data.formId.copyNum
formID += kFMRSPItemDelimiter
formID += data.formId.filecopy
var fields = ""
var fieldList = data.fields.source?data.fields.source:data.fields
for (var i=0; i<fieldList.length; i++){
var itm = fieldList[i]
if (i>0)
fields += kFMRSPItemDelimiter
fields += itm.id;
fields += kFMRSPColon;
fields += itm.elementNum;
fields += kFMRSPColon;
fields += escape(itm.value);
}
var postData = escape(agency);
postData += kFMRSPItemDelimiter
postData += escape(formID);
postData += kFMRSPItemDelimiter
postData += escape(fields);
return postData;
}
}
var TTOEventPubSub = (function(){
var _instance = {
kEvt_WindowBeforeUnload : "beforeUnload",
kEvt_AppExit : "exit",
kEvt_AppHardExit : "hardExit",
kEvt_PrepareForPage : "prepareForPage",
kEvt_BgnPage : "bgnPage",
kEvt_EndPage : "endPage",
kEvt_FinalizePg : "finalizePg",
kEvt_Submit : "submit",
kEvt_SetProduct : "setProduct",
kEvt_SetUserInfo : "setUserInfo",
kEvt_SetFeatures : "setFeatures",
kEvt_SetBranding : "setBranding",
kEvt_InProductOfferOnPage : "IPO",
kEvt_ErrorOnPage : "errorOnPage",
kEvt_RemoveErrorMsg : "hideErrTip",
kEvt_InputDataOnPage : "dataExists",
kEvt_CtrlElementChange : "ctrlElementChange",
kEvt_ClientError : "clientError",
kEvt_FormExists : "formExists",
kEvt_ModalFlowExists : "modalFlowExists",
kEvt_ModalWindowExists : "modalWindowExists",
kEvt_ClearReturn : "clearReturn",
kEvt_RIAEvent : "riaEvent",
kEvt_FeatureListRetrieved : "featuresListRetrieved",
kEvt_HogProgressEvent : "progress",
subscribeForEvent : function (evt, cb , o ) {
if (!_notificationList[evt]) {
_notificationList[evt] = new Array();
}
if (!o) o = window;
var evtObj = new Object()
evtObj.object = o
evtObj.callback = cb
_notificationList[evt].push(evtObj)
o.subscribedForEvent = true;
},
unSubscribe: function ( o ) {
for (n in _notificationList) {
TTOEventPubSub.unSubscribeForEvent(n, o);
}
},
unSubscribeForEvent : function (evt, o ) {
var list = _notificationList[evt]
if (!list) return
for (var i=0; i<list.length; i++) {
var evtObj = list[i].object
if (o == evtObj) {
_notificationList[evt].splice(i,1)
break;
}
}
},
publishEvent : function (evt,args ) {
var list = _notificationList[evt]
if (!list) return
for (var i=0; i<list.length; i++) {
var evtObj = list[i].object
var evtCB = list[i].callback
if (evtCB && evtObj) {
evtCB.call(evtObj,args)
}
}
},
onUnloadPage : function (evt) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_WindowBeforeUnload)
}
};
var _notificationList = new Object();
return _instance;
})();
kTinaURL = "http://turbotax.intuit.com";
kTinaPath = "/support/asa/mainpage.jsp?topic=tto&tmSrc=cookie&yr=09&lid=3053";
kTinaEnabled = "1";
kCIAURL = "https://ttlc.intuit.com";
kCIAPath = "/app/mini_page2";
kCIAEnabled = "1";
kFTAEnabled = "1";
kSICURL = "https://turbotax.intuit.com/support/tto/tthelp.jsp";
kSolveItCenterEnabled = "0";
kSolveItCenterABTestOn = "b";
RightRailHelper = {
isEnabled : function () {
return ("1" == kCIAEnabled && TTOModel.isFeatureSupported(TTOModel.kCIA));
},
isTinaEnabled : function() {
return ("1" == kTinaEnabled && TTOModel.isFeatureSupported(TTOModel.kTina));
},
useSolveItCenter : function () {
var canUseSolveItCenter = "1" == kSolveItCenterEnabled;
if (canUseSolveItCenter == false) {
return false;
}
var solveItCenterTestVal = TTOModel.getABTestValue("solveItCenter")
if (solveItCenterTestVal && solveItCenterTestVal.toLowerCase() == kSolveItCenterABTestOn) {
return true;
}
else {
return false;
}
},
useUnlimitedAskTaxExpert : function () {
var askTextExpertTestVal = TTOModel.getABTestValue("FtrATE")
if (askTextExpertTestVal && askTextExpertTestVal.toLowerCase() == kSolveItCenterABTestOn) {
return true;
}
else {
return false;
}
},
update : function () {
if (!this.isEnabled()) return;
if (this.useSolveItCenter()) {
this._updateSIC()
}
else {
this._updateLC ()
}
},
gotoAnswerCenter : function (loc , params ) {
var di = TTOModel.getDialogInfo()
var sid = ""
if (di) sid=di.screenId?di.screenId:di.topicId;
gotoTechSupport(sid, loc, params);
},
_updateLC : function() {
var widget_id = "&widget_id=v" + (TTOModel.getRightRailVersion() === "" ? "11" : "10");
var u=kCIAURL + kCIAPath + "?" + this._getCIAParams() + widget_id;
var f=frames['CIAFrame'];
f.location.replace(u);
},
_updateSIC : function() {
var ateParam = "";
if (this.useUnlimitedAskTaxExpert()) {
ateParam = "&FtrATE=B";
}
var u=kSICURL + "?" + this._getCIAParams() + ateParam;
var f=frames["solveItCenter"];
f.location.replace(u);
},
_getCIAParams : function () {
var tags=TTOModel.getPageLCTagset();
var di = TTOModel.getDialogInfo()
var sid = ""
if (di) sid=di.screenId?di.screenId:di.topicId;
var ciaParams = "ppid="+TTOModel.getUserId()+"&ctype="+TTOModel.getCustomerType()+"&csrc="+TTOModel.getCustomerSrc()+"&abtest="+escape(TTOModel.getABTestAsParams())+"&tags="+tags+"&sid="+sid+"&w="+screen.width+"&h="+screen.height+"&prodID="+TTOModel.getProductId();
return ciaParams
}
}
kCIAURL = "https://ttlc.intuit.com";
kCIAPonPath = "/app/mini_pon";
PONHelper = {
addPONBeacon : function ( type) {
var tab1 = -1
var tab2 = -1
var pb = TTOApp.findCtrlByType(26)
if(pb) {
tab1 = (pb.getCurIndex() == null) ? "-1" : pb.getCurIndex()
tab2 = (pb.getCurSIIndex() == null) ? "-1" : pb.getCurSIIndex()
}
var data = "TTO_" + tab1 + "_" + tab2 + "_" + PONWindow.getCurrentTopic() + type
var kKeys = ["s_prop10", "s_eVar10", "s_prop19"]
var kValues = [data, data, "Help"]
zBeacon.addBeacon(eOmnitureBeacon,"","",kKeys,kValues)
},
_getPONParams : function () {
var tags=escape("PON~" + PONWindow.getCurrentTopic());
var ptags=TTOModel.getPageLCTagset();
var di = TTOModel.getDialogInfo()
var sid = ""
if (di) sid=di.screenId?di.screenId:di.topicId;
var trialVer=TTOModel.isDelayedAuth()?"true":"false";
var tab1 = -1
var tab2 = -1
var pb = TTOApp.findCtrlByType(26)
if(pb) {
tab1 = (pb.getCurIndex() == null) ? "-1" : pb.getCurIndex()
tab2 = (pb.getCurSIIndex() == null) ? "-1" : pb.getCurSIIndex()
}
var ponParams = "?tmSrc=cookie&ppid="+TTOModel.getUserId()+"&csrc="+TTOModel.getCustomerSrc()+"&tags="+tags+"&sid="+sid+"&parenttags="+ptags+"&w="+screen.width+"&h="+screen.height+"&trial="+trialVer+"&prodID="+TTOModel.getProductId()+"&tab="+tab1+"&subtab="+tab2;
return ponParams
}
}
var LOG_INFO = "info"
var LOG_WARNING = "warning"
var LOG_ERROR = "error"
function UIError (component , msg , type ,ex )
{
this.component = component;
this.msg = msg;
this.logType = type?type:LOG_ERROR;
this.exeptionObj = ex;
}
function Profile ()
{
this.uniqueDialogID = "";
this.requestTime = null;
this.renderTime = null;
this.customerUsageTime = null;
}
var MessageHandler = (function(){
var _instance = {
startListener : function (ifr) {
_createListener(ifr);
},
cancelListener : function (ifr) {
_cancelListener(ifr);
},
receiveMessage : function (msg) {
_parseMessage(msg);
}
};
var _xdMsgCookie='xd_msg',
_iframe = null,
_allowedSources = [],
_heightOffsetPadding = 35,
interval_id,
last_msg,
has_postmessage = window.postMessage
_allowedSources[_getFrameOrigin(location.href)] = true;
if ( window.addEventListener ) {
window.addEventListener( 'message', rm_handler, false )
}
else {
window.attachEvent( 'onmessage', rm_handler )
}
function _createListener (iframe) {
var origin = _getFrameOrigin(iframe.src)
_iframe = iframe
_allowedSources[origin] = true;
if (!has_postmessage) {
interval_id && clearInterval( interval_id );
interval_id = null;
interval_id = setInterval(function(){
var msg = getCookie(_xdMsgCookie),
re = /^\d+&/;
if ( msg !== last_msg ) {
last_msg = msg;
_parseMessage( msg.replace( re, '' ) );
}
}, 100 );
}
_autoResizeIFrame(iframe)
}
function _cancelListener(iframe) {
jQuery(_iframe).unbind();
_iframe = null
if (!has_postmessage) {
expireCookie(_xdMsgCookie)
interval_id && clearInterval( interval_id );
interval_id = null;
}
}
function _autoResizeIFrame (frameToResize) {
jQuery(frameToResize).load(function () {
var _ifr = this;
var delayedResize = function () {
try {
var container = _ifr.contentWindow.document.body;
if (jQuery("#ifrContent", container)[0]) {
container = jQuery("#ifrContent", container)[0];
}
var scrollHeight = container.scrollHeight;
var offsetHeight = container.offsetHeight;
var h = (scrollHeight > offsetHeight) ? scrollHeight : offsetHeight;
_ifr.scrolling = "no";
_setIframeHeight(_ifr,h);
} catch (e) { }
};
setTimeout(delayedResize, 0);
});
if (jQuery.browser.safari || jQuery.browser.opera) {
var source = jQuery(frameToResize).attr('src');
jQuery(frameToResize).attr('src', '');
jQuery(frameToResize).attr('src', source);
}
}
function _setIframeHeight(iframe, h) {
if (isNaN(h) ) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("XDomainMessenger", "Invalid height specifed for url:" +iframe.src , LOG_ERROR));
h=0;
}
if (!iframe.ignoreOffsetPadding) {
h += _heightOffsetPadding;
}
jQuery(iframe).animate(
{'height': h},
0,
'easeInExpo'
)
if (TTOModel.isQA()) {
var TO = new DebugTO()
TO.embeddedHeight = h
var cmd = new DebugCommand(TO)
cmd.execute()
}
}
function _getFrameOrigin (url) {
if (!url.match(/https:/))
return ""
var origin =url.replace( /([^:]+:\/\/[^\/]+).*/, '$1' )
return origin.toLowerCase()
}
function rm_handler (e) {
if (_allowedSources[ e.origin.toLowerCase()]) {
_parseMessage( e.data );
}
else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("XDomainMessager","Message DENIED from: "+ e.origin + " Msg: " + e.data, LOG_INFO) )
return false;
}
}
function _parseMessage (msg) {
msgObj = {}
try {
var msgObj = JSONSerializer.toJSON(msg)
}
catch (ex) {
var msg = "?"+msg
msg.replace(/([^?&=]+)(=([^&]*))?/g, function(str, p1, p2, p3) {
msgObj[unescape(p1)] = unescape(p3);
return str;
});
}
if (!msgObj) return;
if (typeof msgObj.setHeight !== "undefined") {
_setIframeHeight(_iframe, msgObj.setHeight)
var evtObj = new riaEvtObj();
evtObj.type = riaEvtObj.HEIGHT;
evtObj.value = msgObj.setHeight;
TTOEventPubSub.publishEvent (TTOEventPubSub.kEvt_RIAEvent, evtObj)
}
if (typeof msgObj.pubsub !== "undefined") {
TTOEventPubSub.publishEvent(msgObj.pubsub.evtName, msgObj.pubsub.data);
}
if (typeof msgObj.riaPageLoad !== "undefined") {
TransitionMsg.hide()
}
if (typeof msgObj.riaPageSubmit !== "undefined") {
var trMsg = null
window.scrollTo(0,0);
if (msgObj.riaPageSubmit !== null && msgObj.riaPageSubmit !== "" ) trMsg = msgObj.riaPageSubmit
TransitionMsg.show(trMsg)
var TO = new AjaxTO();
TO.cmd = TTOService.kAJAX_KeepAlive;
var req = new AjaxCommand(TO);
req.execute();
}
if (typeof msgObj.keepAlive !== "undefined") {
var TO = new AjaxTO();
TO.cmd = TTOService.kAJAX_KeepAlive;
var req = new AjaxCommand(TO);
req.execute();
}
if (typeof msgObj.doMetrics !== "undefined") {
var data = msgObj.doMetrics;
TTOApp.doMetrics(data)
}
}
return _instance;
})()
function BaseFormatter(fmtStr) {
this.maskChar = numericMaskChar;
this.fmtString = fmtStr;
this.taintable = false;
}
function formatAgainstMask(inVal) {
var stringIndex = 0;
var maskIndex = 0;
var mask = this.fmtString
var outVal = "";
var m;
var c;
while (stringIndex < inVal.length && maskIndex < mask.length ) {
m = mask.charAt(maskIndex);
c = inVal.charAt(stringIndex);
if (this.maskChar == m || this.maskChar == c) {
outVal += c;
stringIndex++;
}
else {
outVal += m;
}
maskIndex++;
}
while (maskIndex < mask.length && this.maskChar != mask.charAt(maskIndex)) {
outVal += mask.charAt(maskIndex);
maskIndex++;
}
return outVal;
}
var p = BaseFormatter.prototype;
p.constructor = BaseFormatter;
p.format = formatAgainstMask;
p = null;
function getFormatter(ft, fst, maxLen, taintable) {
var formatter = null;
switch (ft) {
case 8:
formatter = new SSNFormatter(fst);
break;
case 21:
formatter = new MaskedNumberFormatter(fst);
break;
case 9:
formatter = new EINFormatter(fst);
break;
case 10:
case 12:
case 13:
case 14:
case 15:
case 16:
case 17:
case 18:
case 19:
case 20:
case 11:
formatter = new CurrencyFormatter(ft, fst);
break;
case 5:
case 6:
case 4:
formatter = new DateFormatter(ft, fst);
break;
case 7:
formatter = new AlphaFormatter(fst, maxLen);
break;
case 24:
formatter = new CCFormatter(fst, maxLen);
break;
default:
}
if (formatter) {
formatter.taintable = taintable
}
return formatter;
}
var gkSSNMasks=[
"###-##-####",
"###/##/####",
"#########",
"###-##-####",
"###/##/####",
"#########"];
function SSNFormatter(fst) {
BaseFormatter.call(this, gkSSNMasks[fst]);
this.validTaints = ["applied for", "died","tax exempt","LAFCP","unknown"]
}
function _ssnFormat(strToBeFormatted) {
var result = "";
if(this.taintable) {
var s = strToBeFormatted.toLowerCase()
s = s.replace(/ /g,"")
var valid = false;
for (var i=0; i<this.validTaints.length; i++) {
var taint = this.validTaints[i].toLowerCase()
taint = taint.replace(/ /g,"")
if (taint.indexOf(s) == 0) {
valid = true
break
}
}
if (valid) return strToBeFormatted;
}
if(strToBeFormatted.length >= 3 && strToBeFormatted.charAt(2) == "-") {
return strToBeFormatted;
}
strToBeFormatted = strToBeFormatted.replace(/[^0-9]/gi, "");
result = BaseFormatter.prototype.format.call(this, strToBeFormatted);
return result;
}
SSNFormatter.prototype = new BaseFormatter();
var p = SSNFormatter.prototype;
p.constructor = SSNFormatter;
p.format = _ssnFormat;
p = null;
var numericMaskChar = "#"
var gkMaskedNumMasks=[
"",
"#####-####",
"(###) ###-####",
"YYYY",
"#########",
"(###) #######",
"(###)###-####",
"(###)#######",
"###-###-####",
"###-#######",
"##########",
"### ### ####",
"##### ####",
"YY",
"#####-"];
function MaskedNumberFormatter(fst) {
BaseFormatter.call(this, gkMaskedNumMasks[fst]);
if (3 == fst || 13 == fst) this.maskChar = "Y"
}
function _mnFormat(inVal) {
if(!inVal) return ""
var result = "";
var s = inVal.replace(/[^0-9]/gi, "");
result = BaseFormatter.prototype.format.call(this, s, this.maskChar);
return result;
}
MaskedNumberFormatter.prototype = new BaseFormatter();
var p = MaskedNumberFormatter.prototype;
p.constructor = MaskedNumberFormatter;
p.format = _mnFormat;
p = null;
var gkEINMasks=[
"##-#######",
"##/#######",
"#########",
"##-#######"];
function EINFormatter(fst) {
BaseFormatter.call(this, gkEINMasks[fst]);
this.validTaints = ["appliedfor", "unknown"]
}
function _einFormat(strToBeFormatted) {
var result = "";
if(this.taintable) {
var s = strToBeFormatted.toLowerCase()
s = s.replace(/ /g,"")
var valid = false;
for (var i=0; i<this.validTaints.length; i++) {
var taint = this.validTaints[i].toLowerCase()
taint = taint.replace(/ /g,"")
if (taint.indexOf(s) == 0) {
valid = true
break
}
}
if (valid) return strToBeFormatted;
}
result = MaskedNumberFormatter.prototype.format.call(this, strToBeFormatted)
return result
}
EINFormatter.prototype = new MaskedNumberFormatter();
var p = EINFormatter.prototype;
p.format = _einFormat;
p.constructor = EINFormatter;
p = null;
function CurrencyFormatter(ft, fst) {
this.ft = ft;
this.taintable = false;
BaseFormatter.call(this, "");
}
function _cuFormat(strToBeFormatted) {
var result = "";
result = strToBeFormatted.replace(/[^0-9-.]/gi, "");
if ("-" == result || "." == result || "" == result) return result;
var n = result.toNum();
switch(this.ft)
{
case 10:
case 12: return n.toFormattedInt(true);
default:
var vals = result.split(".");
var bNeg = (0 == result.indexOf("-"))
var i = vals[0].replace(/[^0-9]/gi, "");
result = i.toNum().toFormattedInt();
if (vals.length > 1) {
var p = this._fieldDigitsAfterDecimal(this.ft);
var dec = vals[1].replace(/[^0-9]/gi, "");
dec = dec.substr(0,p)
result = result + "." + dec
}
return bNeg?("-"+result):result;
}
}
function _round(strToBeRounded){
var result = strToBeRounded.replace(/[^0-9-.]/gi, "");
var p = this._fieldDigitsAfterDecimal(this.ft);
var n = result.toNum();
result = n.roundToPrecision(p);
return result;
}
function _fieldDigitsAfterDecimal( ft) {
var n=0
if(10==ft)n=0
else if(11==ft)n=2
else if(12==ft)n=0
else if(13==ft)n=1
else if(14==ft)n=2
else if(15==ft)n=3
else if(16==ft)n=4
else if(17==ft)n=5
else if(18==ft)n=6
else if(19==ft)n=7
else if(20==ft)n=8
return n
}
CurrencyFormatter.prototype = new BaseFormatter();
var p = CurrencyFormatter.prototype;
p.constructor = CurrencyFormatter;
p.format = _cuFormat;
p.round = _round;
p._fieldDigitsAfterDecimal = _fieldDigitsAfterDecimal;
p = null;
var gkDateMasks=[
"MM/DD/YYYY",
"MM/DD/YYYY",
"MMDDYY",
"MM/DD/YY",
"MM-DD-YY",
"DD.MM.YY",
"DD.MM.YYYY",
"DDMMYY",
"MM/DD/YY",
"DD/MM/YY",
"DD-MM-YY",
"DD.MM.YY",
"DD.MM.YYYY",
"MMDDYYYY",
"MM/DD/YYYY",
"MM-DD-YYYY",
"DDMMYYYY",
"DD/MM/YYYY",
"DD-MM-YYYY"];
var gkDayMasks=[
"MM/DD",
"MM/DD",
"MM/DD",
"DD.MM",
"DD.MM",
"MM-DD",
"MM-DD",
"MMDD",
"DD/MM",
"DD-MM",
"DDMM"];
var gkMonthMasks=[
"MM/YYYY",
"MMYY",
"MM/YY",
"MM/YY",
"MM.YY",
"MM.YY",
"MMYYYY",
"MM/YYYY",
"MM/YYYY",
"MM.YYYY",
"MM.YYYY",
"MM-YYYY",
"MM-YYYY",
"MM-YY"];
function DateFormatter(ft, fst) {
this.ft = ft;
this.originalMask = "";
this.day=false;
this.month=false;
this.year=false;
switch(ft) {
case 4:
this.originalMask = gkDateMasks[fst];
this.day=true;
this.month=true;
this.year=true;
break;
case 5:
this.originalMask = gkDayMasks[fst];
this.day=true;
this.month=true;
this.year=false;
break;
case 6:
this.originalMask = gkMonthMasks[fst];
this.day=false;
this.month=true;
this.year=true;
break;
default:
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("DateFormatter","couldn't find the correct mask for this date input, ft = " + ft + ", fst = " + fst, LOG_ERROR))
}
var revisedFormat = this.originalMask.replace(/[A-Za-z]/gi, "#");
BaseFormatter.call(this, revisedFormat);
}
function _dateFormat(inVal) {
var outVal = "";
var DateMask;
if(this.taintable) {
var a = inVal.match(/[A-Za-z]/);
if(null != a && a.length > 0)
return inVal;
}
if (inVal.indexOf("/") > -1) {
var splitVal = inVal.split("/");
var curVal;
for (var i=0; i<splitVal.length-1; i++){
curVal = splitVal[i];
if (curVal.length === 1) {
splitVal[i] = "0" + curVal;
} else if (curVal.length > 2) {
splitVal[i] = curVal.substring(curVal.length-2, curVal.length);
}
}
inVal = splitVal.join("");
}
outVal = inVal.replace(/[^0-9]/gi, "");
var yr = "";
if (this.year && this.originalMask.indexOf("YYYY") > -1) {
if (this.day && this.month && outVal.length > 4) {
yr = outVal.substr(4,outVal.length);
}
else if (!this.day && !this.month && outVal.length > 1) {
yr = outVal;
}
else if (!this.day && this.month && outVal.length > 2){
yr = outVal.substr(2,outVal.length);
}
if (yr.length == 2 && (yr != '19' && yr != '20')) {
var ny = (parseInt(yr) > 12)?'19':'20';
outVal = outVal.substr(0,outVal.length-2) + ny+yr
}
}
outVal= BaseFormatter.prototype.format.call(this, outVal);
return outVal;
}
DateFormatter.prototype = new BaseFormatter();
var p = DateFormatter.prototype;
p.constructor = DateFormatter;
p.format = _dateFormat;
p = null;
function AlphaFormatter(fst, maxLen) {
this.fst = fst;
this.maxLen = maxLen;
this.taintable = true;
BaseFormatter.call(this, "");
}
function _alphaFormat(strToBeFormatted) {
var result = strToBeFormatted;
if(strToBeFormatted == null || strToBeFormatted.length == 0)
return result;
if(this.fst == 2 || this.fst == 3
|| this.fst == 4 || this.fst == 6) {
result = strToBeFormatted.toUpperCase();
}
if(result.length > this.maxLen) {
result = result.substring(0, this.maxLen);
}
return result;
}
AlphaFormatter.prototype = new BaseFormatter();
var p = AlphaFormatter.prototype;
p.constructor = AlphaFormatter;
p.format = _alphaFormat;
p = null;
function CCFormatter(fst, maxLen) {
this.fst = fst;
this.maxLen = maxLen;
this.taintable = true;
BaseFormatter.call(this, "");
}
function _ccFormat(strToBeFormatted) {
var result = strToBeFormatted;
if(strToBeFormatted == null || strToBeFormatted.length == 0) {
return "";
}
if(this.maxLen != null && result.length > this.maxLen) {
result = result.substring(0, this.maxLen);
}
return result;
}
CCFormatter.prototype = new BaseFormatter();
var p = CCFormatter.prototype;
p.constructor = CCFormatter;
p.format = _ccFormat;
p = null;
function BaseValidator(fmtStr, min, max) {
this.fmtString = fmtStr;
this.min = parseFloat(min);
this.max = parseFloat(max);
this.taintable = false;
this.validTaints = [];
this.errorMsg = "Your number must match the format: " + fmtStr;
this.maskChar = numericMaskChar;
}
function _isGreaterThanOrEqualToMin(value) {
if(!isNaN(this.min) && !isNaN(value)) {
this.errorMsg = "Value entered needs to be greater than or equal to " + this.min;
return (parseFloat(value) >= parseFloat(this.min) ? true:false);
}
return true;
}
function _isLessThanOrEqualToMax(value) {
if(!isNaN(this.max) && !isNaN(value)) {
this.errorMsg = "Value entered needs to be less than or equal to " + this.max;
return (parseFloat(value) <= parseFloat(this.max) ? true:false);
}
return true;
}
function _isValid(value) {
return this.isGreaterThanOrEqualToMin(value) && this.isLessThanOrEqualToMax(value);
}
function _validateFormat(strToBeValidated) {
if(strToBeValidated.length != this.fmtString.length) {
return this.errorMsg;
}
for(var index = 0; index < strToBeValidated.length; index++) {
if(this.fmtString.charAt(index) == this.maskChar) {
if(isNaN(strToBeValidated.charAt(index)))
return this.errorMsg;
}
else {
if(strToBeValidated.charAt(index) != this.fmtString.charAt(index))
return this.errorMsg;
}
}
return "";
}
function _isValidTaint(strToBeValidated) {
if(this.taintable && strToBeValidated) {
var s = strToBeValidated.toLowerCase()
s = s.replace(/ /g,"")
for (var i=0; i<this.validTaints.length; i++) {
var taint = this.validTaints[i].toLowerCase()
taint = taint.replace(/ /g,"")
if (taint == s) return true
}
}
return false
}
function _onKeyListener (ne) {
var evt=new zEvent(ne);
var e=evt.element;
while (e && !e.ft) {
e = e.parentNode;
}
if (null==e) {
return;
}
var k=evt.which;
var isSpecialChar = (8==k || 9==k || 16==k || (k>=35 && k<=39) || (k>=91 && k<=93));
var ignoreBack = ((8==k) && e._validator.ignoreBackSpace(e.ft));
if (isSpecialChar && !ignoreBack) {
return;
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_RemoveErrorMsg);
if (e._formatter && e.ft != 7) {
var caretPos = e._validator.getCaret(e);
var currentValue = e.value;
e.value = e._formatter.format(e.value);
if (e.value.length > currentValue.length) {
var lenDif = e.value.length - currentValue.length;
caretPos += lenDif;
}
if (caretPos < e.value.length) {
e._validator.setCaret(e, caretPos);
}
}
}
function _onBlur(ne) {
var evt=new zEvent(ne);
var e=evt.element;
if (!e) {
return;
}
var v = e.value;
if (e.maskedVal && e.maskedVal == v) {
return;
}
if (e.ft == 21 && (e.fst == 1 ) && v.charAt(v.length - 1) == '-') {
v = v.substr(0, v.length - 1);
e.value = v;
}
if (e._validator) {
e.errorMsg = e._validator.validate(e.value);
if (e.errorMsg == "") {
if (e.fReaderHint) {
e.setAttribute('aria-label', decodeURIComponent(e.fReaderHint));
}
else {
e.setAttribute('aria-label', '');
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_RemoveErrorMsg);
if (7 == e.ft) {
e.value = e.value.replace(/^\s+/, "");
e.value = e._formatter.format(e.value);
}
if (!e._fbCalced) {
e._validator.SetVal(e, v);
}
e._fBad = false;
if (e._formatter && 12 == e.ft) {
e.value = e._formatter.format(e.value);
}
} else {
e._fBad = true;
e.setAttribute('aria-label', e.errorMsg);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ErrorOnPage, e);
}
} else if (!e._fbCalced) {
e.validator.SetVal(e, v);
}
e.className = e._fBad ? "editErr" : "edit";
}
function _ignoreBackSpace ( ft) {
if (ft == 11 || ft == 12) {
return true;
}
return false;
}
function _setVal(e, v) {
if ('undefined' == typeof(v)){
return;
}
if (v != e.fVal) {
e.fVal = v;
e._fDirty = true;
}
}
function _getCaret (oField) {
var iCaretPos = 0;
if (document.selection) {
oField.focus();
var oSel = document.selection.createRange();
oSel.moveStart('character', -oField.value.length);
iCaretPos = oSel.text.length;
} else {
if (oField.selectionStart || oField.selectionStart == '0') {
iCaretPos = oField.selectionStart;
}
}
return (iCaretPos);
}
function _setCaret (oField, iCaretPos) {
if (document.selection) {
var range = oField.createTextRange();
range.move('character', iCaretPos);
range.select();
} else {
if (oField.selectionStart || oField.selectionStart == '0') {
oField.selectionStart = iCaretPos;
oField.selectionEnd = iCaretPos;
oField.focus();
}
}
}
var p = BaseValidator.prototype;
p.constructor = BaseValidator;
p.validate = null;
p.isValid = _isValid;
p.validateFormat = _validateFormat;
p.isValidTaint = _isValidTaint;
p.isGreaterThanOrEqualToMin = _isGreaterThanOrEqualToMin;
p.isLessThanOrEqualToMax = _isLessThanOrEqualToMax;
p.onKeyListener = _onKeyListener;
p.onBlur = _onBlur;
p.ignoreBackSpace = _ignoreBackSpace;
p.SetVal = _setVal;
p.setCaret = _setCaret;
p.getCaret = _getCaret;
p.errorMsg;
p = null;
function getValidator(ft, fst, min, max, maxLen, taintable) {
var validator = null;
switch (ft) {
case 8:
validator = new SSNValidator(fst, min, max);
break;
case 21:
validator = new MaskedNumberValidator(fst, min, max);
break;
case 9:
validator = new EINValidator(fst, min, max);
break;
case 10:
case 12:
case 13:
case 14:
case 15:
case 16:
case 17:
case 18:
case 19:
case 20:
case 11:
validator = new CurrencyValidator(ft, fst, min, max);
break;
case 5:
case 6:
case 4:
validator = new DateValidator(ft, fst, min, max);
break;
case 7:
validator = new AlphaValidator(fst, min, max, maxLen);
break;
case 24:
validator = new CCValidator(fst);
break;
default:
}
if (validator) {
validator.taintable = taintable
}
return validator;
}
function SSNValidator(fst, min, max) {
BaseValidator.call(this, gkSSNMasks[fst], min, max);
this.validTaints = ["applied for", "died","tax exempt","LAFCP", "unknown"]
}
function _ssnValidate(strToBeValidated) {
var result = "";
if(strToBeValidated == "")
return "";
if(this.isValidTaint(strToBeValidated)) {
return "";
}
if(!this.isValid(this, strToBeValidated))
return this.errorMsg;
var s = strToBeValidated.replace(/[^0-9]/gi, "");
if(s.length != 9) {
return "This is not a valid social security number";
}
return result;
}
SSNValidator.prototype = new BaseValidator();
var p = SSNValidator.prototype;
p.constructor = SSNValidator;
p.validate = _ssnValidate;
p = null;
function MaskedNumberValidator(fst, min, max) {
this.fst = fst;
this.taintable = false;
BaseValidator.call(this, gkMaskedNumMasks[fst]);
if (3 == fst || 13 == fst) this.maskChar = "Y"
}
function _mnValidate(strToBeValidated) {
if(strToBeValidated.length == 0)
return "";
if(this.fst == 1 || this.fst == 4) {
this.errorMsg = "Your zip code must match the format: " + this.fmtString + " or #####";
if(strToBeValidated.length == 5) {
if(strToBeValidated.replace(/[0-9]/gi, "").length == 0)
return "";
else
return this.errorMsg;
}
else if(strToBeValidated.length == 6) {
var hasToBeNumbers = strToBeValidated.substring(0, 5);
if(hasToBeNumbers.replace(/[0-9]/gi, "").length == 0 &&
(hasToBeNumbers.charAt(5) == "-" || hasToBeNumbers.charAt(5) == " "))
return "";
else
return this.errorMsg;
}
}
var result = this.validateFormat(strToBeValidated);
return result;
}
MaskedNumberValidator.prototype = new BaseValidator();
var p = MaskedNumberValidator.prototype;
p.constructor = MaskedNumberValidator;
p.validate = _mnValidate;
p = null;
function EINValidator(fst, min, max) {
BaseValidator.call(this, gkEINMasks[fst], min, max);
this.validTaints = ["appliedfor", "died", "unknown"]
}
function _einValidate(strToBeValidated) {
var result = "";
if(strToBeValidated.length == 0)
return "";
if(this.isValidTaint(strToBeValidated)) {
return "";
}
result = this.validateFormat(strToBeValidated);
return result;
}
EINValidator.prototype = new BaseValidator();
var p = EINValidator.prototype;
p.constructor = EINValidator;
p.validate = _einValidate;
p = null;
function CurrencyValidator(ft, fst, min, max) {
this.ft = ft;
this.taintable = false;
BaseValidator.call(this, "", min, max);
if (isNaN(this.min) ) this.min = 0 - this.getRange()
if (isNaN(this.max) ) this.max = this.getRange()
}
function _cuValidate(strToBeValidated) {
var result = "";
if(strToBeValidated.length == 0)
return "";
var tmp = strToBeValidated.stripChar(",");
if(isNaN(tmp)) {
return "You must enter a number.";
}
if(!this.isValid(parseFloat(tmp))) {
return this.errorMsg;
}
return "";
}
function _getRange(){
switch(this.ft){
case 10:
case 12:
val=999999999
break
case 11:
case 14:
val=9999999.99
break
case 13:
val=99999999.9
break
case 15:
val=999999.999
break
case 16:
val=99999.9999
break
case 17:
val=9999.99999
break
case 18:
val=999.999999
break
case 19:
val=99.9999999
break
case 20:
val=9.99999999
break
default:
val=999999999
}
return val
}
CurrencyValidator.prototype = new BaseValidator();
var p = CurrencyValidator.prototype;
p.constructor = CurrencyValidator;
p.validate = _cuValidate;
p.getRange = _getRange;
p = null;
function DateValidator(ft, fst, min, max) {
this.ft = ft;
this.fst = fst;
this.originalMask = "";
switch(ft) {
case 4:
this.originalMask = gkDateMasks[fst];
break;
case 5:
this.originalMask = gkDayMasks[fst];
break;
case 6:
this.originalMask = gkMonthMasks[fst];
break;
default:
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("DateValidator","couldn't find the correct mask for this date input, ft = " + ft + ", fst = " + fst, LOG_ERROR));
}
var revisedFormat = this.originalMask.replace(/[A-Za-z]/gi, "#");
BaseValidator.call(this, revisedFormat);
this.validTaints = ["various", "inherit","continue", "continues","none"];
this.min = unescape(min);
this.max = unescape(max);
}
function _dateValidate(strToBeValidated) {
var message = "";
if (this.ft == 4) {
message = "Enter the date as: " + gkDateMasks[this.fst];
} else if (this.ft == 5) {
message = "Enter the day as: " + gkDayMasks[this.fst];
} else if (this.ft == 6) {
message = "Enter the month as: " + gkMonthMasks[this.fst];
}
if(strToBeValidated.length == 0) {
return "";
}
if(this.isValidTaint(strToBeValidated)) {
return "";
}
if (this.min.length > 0) {
if (Date.parse(strToBeValidated) < Date.parse(this.min)) {
return "The date entered cannot be before " + this.min;
}
}
if (this.max.length > 0) {
if (Date.parse(strToBeValidated) > Date.parse(this.max)) {
return "The date entered cannot be after " + this.max;
}
}
var result = this.validateFormat(strToBeValidated);
if(result == "") {
var indexOfMM = this.originalMask.indexOf("MM");
var monthValToBeTested = "";
if(indexOfMM >= 0) {
monthValToBeTested = strToBeValidated.substring(indexOfMM, indexOfMM + 2);
if(isNaN(monthValToBeTested) || !isMonthWithinRange(monthValToBeTested)) {
result = "The month entered is not valid";
return result;
}
}
var indexOfDD = this.originalMask.indexOf("DD");
var year = "";
var indexOfYYYY = this.originalMask.indexOf("YYYY");
if(indexOfYYYY < 0) {
indexOfYYYY = this.originalMask.indexOf("YY");
if(indexOfYYYY >= 0) {
year = strToBeValidated.substring(indexOfYYYY, indexOfYYYY + 2);
var prefix = parseInt(year) > 10 ? "19" : "20";
year = prefix + year;
}
}
else {
year = strToBeValidated.substring(indexOfYYYY, indexOfYYYY + 4);
}
if(indexOfDD >= 0 && year != "") {
var dayValToBeTested = strToBeValidated.substring(indexOfDD, indexOfDD + 2);
if(isNaN(dayValToBeTested) || !isDayWithinRange(year, monthValToBeTested, dayValToBeTested)) {
result = "The day entered does not exist";
return result;
}
}
}
if(result != "") {
result = message;
}
return result;
}
function isMonthWithinRange(val) {
if (parseFloat(val) < 1 || parseFloat(val) > 12) {
return false;
}
return true;
}
function isDayWithinRange(year, month, day) {
var daysInMonth = 32 - new Date(parseFloat(year), parseFloat(month) - 1, 32).getDate();
var dayInt = parseFloat(day);
if (dayInt < 1 || dayInt > daysInMonth) {
return false;
}
return true;
}
DateValidator.prototype = new BaseValidator();
var p = DateValidator.prototype;
p.constructor = DateValidator;
p.validate = _dateValidate;
p = null;
function AlphaValidator(fst, min, max, maxLen) {
this.fst = fst;
this.maxLen = maxLen;
this.taintable = true;
BaseValidator.call(this, "");
}
function _alphaValidate(strToBeValidated) {
if(strToBeValidated == "")
return "";
if(this.fst == 1 || this.fst == 3) {
if(areCharsValid(strToBeValidated, true, false, true))
return "";
else
return "Input must contain only letters and spaces.";
}
else if(this.fst == 4) {
if(areCharsValid(strToBeValidated, true, true, true))
return "";
else
return "Input contains invalid value.";
}
else if(this.fst == 5 || this.fst == 6) {
if(areCharsValid(strToBeValidated, true, false, false))
return "";
else
return "Input must contain only letters.";
}
else if(this.fst == 7) {
if(areCharsValid(strToBeValidated, false, true, false))
return "";
else
return "Input must contain only numbers.";
}
return "";
}
AlphaValidator.prototype = new BaseValidator();
var p = AlphaValidator.prototype;
p.constructor = AlphaValidator;
p.validate = _alphaValidate;
p = null;
function CCValidator(fst) {
this.fst = fst;
this.taintable = true;
BaseValidator.call(this, "");
}
function _ccValidate(strToBeValidated) {
if(strToBeValidated == "")
return "";
if(areCharsValid(strToBeValidated, false, true, false)) {
return "";
}
else {
return "Input must contain only numbers.";
}
return "";
}
CCValidator.prototype = new BaseValidator();
var p = CCValidator.prototype;
p.constructor = CCValidator;
p.validate = _ccValidate;
p = null;
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
zPrm = Class.extend({
fID : null,
fVal : null,
fParent : null,
fDomParent : null,
subscribedForEvent : false,
ctrlList : null,
_fWidth : null,
_fHeight : null,
_fDirty : false,
construct : function (ctrl) {
if (!ctrl) return;
var t=this
t.fID=ctrl.name
t._fCtrlID=ctrl.ctrlID?unescape(ctrl.ctrlID):null;
t.fVal=null
t._fWidth=ctrl.w
t._fHeight=ctrl.h
},
initData : function (data) {
this.fVal = data.val?decodeURIComponent(data.val):data.val
},
Delete : function () {
this.RemoveCtrls()
jQuery($(this.fID)).unbind()
if (this.subscribedForEvent) {
TTOEventPubSub.unSubscribe(this)
}
},
isOKToSubmit : function () {
var t=this
if(!t.ctrlList)return true
var c = t.ctrlList
for (var i in c) {
if (!c[i].prm.isOKToSubmit()) return false
}
return true
},
SetVal : function ( v){
if ('undefined' == typeof(v)) return;
if(v!=this.fVal){
this.fVal=v
this._fDirty=true
TTOApp.registerPrimForSubmit(this);
}
},
GetVal : function () {
return this.fVal
},
ClearVal : function () {
this.SetVal(null)
TTOApp.removePrimFromSubmit(this)
},
setWidth : function (i,type) {
if (typeof i == 'object')
this._fWidth = i
else {
var o = new Object()
o.val = i
o.type = (type) ? type : 'x'
this._fWidth = o
}
},
getWidth : function () {
if ('x' == this._fWidth.type) {
return this.GetPixelWidth() + "px"
}
else if ('p' == this._fWidth.type) {
return this.GetPctWidth() + "%"
}
},
setHeight: function(i, type){
if (typeof i == 'object')
this._fHeight= i
else {
var o = new Object()
o.val=i
o.type = (type)?type:'x'
this._fHeight=o
}
},
GetPixelHeight : function () {
var t=this
if(null==t._fHeight)return 0
else return t._fHeight.val;
},
getRawWidth : function() {
var t=this
if(null==t._fWidth) return 0
if(!t._fWidth.val) return 0
return t._fWidth.val;
},
GetPixelWidth : function () {
var t=this
if(null==t._fWidth)return 0
var typ=t._fWidth.type
if('c'==typ)return 0
var w=t._fWidth.val
if ('x'==typ)return w
var pW
var dlgRegion = TTOApp.findRegionByName("dialog")
if(TTOModel.getDialogType() == 3){
pW = t.GetParentContainerWidth();
}
else{
pW = dlgRegion.ContentWidth;
}
if (pW > 0)
return Math.floor (w*pW/100)
else
return 0
},
GetPctWidth : function () {
var t=this
if(null==t._fWidth)return 0
var typ=t._fWidth.type
if('p'==typ)return t._fWidth.val
return 0;
},
GetCharWidth : function () {
var t=this
if(null==t._fWidth)return 0
var typ=t._fWidth.type
if('c'!=typ)return 0
else return t._fWidth.val
},
GetParentContainerWidth : function () {
var t=this
var prnt=this.fParent
var pW=null
if(prnt && prnt._fWidth){
pW = prnt._fWidth.val
}
if(null==pW)
pW = TTOApp.findRegionByName("dialog").ContentWidth
else
pW = Math.floor((pW*prnt.GetParentContainerWidth())/100)
prnt=null
return pW
},
AddCtrl : function (ctrl) {
var t=this
if(null==ctrl)return
if (!t.ctrlList)
t.ctrlList = new Array();
if (ctrl.fID && !ctrl.name) ctrl.name = ctrl.fID
t.ctrlList[ctrl.name] = t._findOrCreateControl(ctrl)
},
RemoveCtrls : function () {
var t=this
var c = t.ctrlList
if(!c)return
var c = t.ctrlList
for (var i in c) {
c[i].prm.Delete()
c[i].prm.fParent=null
c[i].prm = null
c[i] = null
}
t.ctrlList=null
},
FindCtrl : function (n) {
var t=this
if(!t.ctrlList) return null
return t.ctrlList[n]
},
FindCtrlByType : function (type) {
var t=this
var prm = null
if(!t.ctrlList) return prm
for (var e in t.ctrlList) {
if (t.ctrlList[e].prmType == type)
prm = t.ctrlList[e].prm
else {
prm = t.ctrlList[e].prm.FindCtrlByType(type)
}
if (prm) break;
}
return prm
},
FindCtrlByID : function (ctrlID) {
var t=this
var prm = null
if(!t.ctrlList) return prm
for (var e in t.ctrlList) {
if (t.ctrlList[e].prm.fID == ctrlID)
prm = t.ctrlList[e].prm
else {
prm = t.ctrlList[e].prm.FindCtrlByID(ctrlID)
}
if (prm) break;
}
return prm
},
_findOrCreateControl : function (ctrl) {
var t=this
if (isDefined(t.ctrlList) && isDefined(t.ctrlList[ctrl.name]))
return t.ctrlList[ctrl.name];
else {
var o = new Object
o.prm = createPrimitive(ctrl);
o.prm.fParent=t
o.name = ctrl.name
o.prmType = ctrl.pT
return o
}
},
setLayout : function(p ){
this.fDOMParent=p
},
Render : function(){},
update : function ( n,data){
var t = this
t.fID=n
if (!data) return
if (data.ctrlID) t._fCtrlID=data.ctrlID;
if (data.w) t._fWidth=data.w
if (data.h) t._fHeight=data.h
},
setFocus : function(){}
});
JSLoader = (function(){
var _instance = {
load : function ( n, cb) {
_curScript = n
if (!_initialized) _init();
for (var i = 0; i < _scriptNames.length; i++) {
if (_scriptNames[i] == n) {
if (cb) cb();
return;
}
}
var xhr = new Ajax()
xhr.setURL( "\/scripts\/"+n)
xhr.setMethod("GET")
xhr.setAsync(false)
xhr.setSuccessCallback(
function(rsp) {
_onScriptLoaded(rsp, cb);
}
)
xhr.setErrorCallback(_onScriptLoadFailed)
xhr.send();
}
};
var _scriptNames = new Array();
var _curScript = ""
var _initialized = false;
function _init() {
var scripts = document.getElementsByTagName('script')
for(var i=0;i<scripts.length;i++)
if (scripts[i].src.length > 0) {
var s = scripts[i].src
s = s.substring(s.lastIndexOf('/')+1,s.length)
_scriptNames.push(s)
}
_initialized = true;
}
function _onScriptLoaded(rsp, cb) {
try {
var code = rsp.responseText
if (window.execScript) window.execScript(code, 'javascript');
else window.eval(code);
_scriptNames.push(_curScript)
if(cb)
cb();
}
catch (e) {
_onScriptLoadFailed(rsp)
}
}
function _onScriptLoadFailed (rsp) {
}
return _instance;
})();
kSaveCookieDate= "Sunday, 1-Nov-20 12:00:00 GMT"
kExpCookieDate= "Friday, 12-Dec-00 12:00:00 GMT"
kTTOLocCookieDate= "Thursday, 1-Nov-12 12:00:00 GMT"
kNextYearCookieDate = "Thursday, 1-Nov-12 12:00:00 GMT"
kNameSpaceCookieDelimeter = "%--%"
kNameSpaceCookieSeparator = "-|@|-"
kPublicDomain= ".intuit.com"
kTTODomain= ".turbotaxonline.intuit.com"
function getCookie( n){
var d=document,srch=n+'=',p,e
if(d.cookie.length>0){
p=d.cookie.indexOf(srch)
if(-1!=p){
p+=srch.length
e=d.cookie.indexOf(';',p)
if(-1==e)e=d.cookie.length
return unescape(d.cookie.substring(p,e))
}
}
d=null
return "";
}
function setCookie(str,val,persist,nonsecure,exdate )
{
var c
var saveDate = kSaveCookieDate
if (isDefined(exdate)) saveDate=exdate
val=escape(val)
if(persist) {
c=str+"="+val+";expires="+saveDate+";domain="+kTTODomain+"; path=/;"
}
else {
c=str+"="+val+"; domain="+kTTODomain+"; path=/;"
}
if (!nonsecure)
c+="secure"
document.cookie = c
}
function setPublicCookie(str,val,persist,nonsecure,exdate )
{
val=escape(val)
var c
var saveDate = kSaveCookieDate
if (isDefined(exdate)) saveDate=exdate
if(persist) c=str+"="+val+";expires="+saveDate+";domain="+kPublicDomain+"; path=/;"
else c=str+"="+val+"; domain="+kPublicDomain+"; path=/;"
if (!nonsecure)
c+="secure"
document.cookie = c
}
function setNameSpaceCookie(nspace,str,val,persist,nonsecure,exdate ,p )
{
var cookie
val=escape(val)
var newVal = str+kNameSpaceCookieDelimeter+val
var nsp = getCookie(nspace);
if (!nsp || nsp==""){
setCookie(nspace,newVal,persist,nonsecure,exdate)
}
else{
var newCookieVal=""
var bFound=false
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
if (i>0)
newCookieVal += kNameSpaceCookieSeparator
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (!isDefined(pr)) continue;
if (str==pr[0]) {
newCookieVal += newVal
bFound=true
}
else{
newCookieVal += curVals[i]
}
}
if (!bFound)
newCookieVal = newCookieVal + kNameSpaceCookieSeparator + newVal
if(p) {
setPublicCookie(nspace,newCookieVal,persist,nonsecure,exdate)
} else {
setCookie(nspace,newCookieVal,persist,nonsecure,exdate)
}
}
}
function getNameSpaceCookie(nspace,str){
var nsp = getCookie(nspace);
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr) && str==pr[0]) {
return unescape(pr[1])
}
}
return ""
}
function getNameSpaceCookieObject(nspace){
var nsp = getCookie(nspace);
var curVals = nsp.split(kNameSpaceCookieSeparator)
var prs = new Object;
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr))
prs[pr[0]]= unescape(pr[1])
}
return prs
}
function clearCookieInNameSpace(nspace,str,persist,nonsecure,exdate ) {
var nsp = getCookie(nspace);
expireCookie(nspace)
var curVals = nsp.split(kNameSpaceCookieSeparator)
for (var i=0;i<curVals.length;i++){
var pr = curVals[i].split(kNameSpaceCookieDelimeter)
if (isDefined(pr) && str!=pr[0]) {
setNameSpaceCookie(nspace,pr[0],unescape(pr[1]),persist,nonsecure,exdate)
}
}
}
function expireCookie( Name, path, domain) {
path = path ? path : "/";
domain = (domain || domain === '') ? domain : kPublicDomain;
document.cookie=Name+"=0; expires="+kExpCookieDate+"; domain="+domain+"; path=" + path + "; max-age=0"
document.cookie=Name+"=0; expires="+kExpCookieDate+"; domain="+domain+"; path=" + path + "; max-age=0"
}
function clearAuthCookies(){
expireCookie("email");
expireCookie("AUTH_NS");
}
function clearSessionCookie() {
expireCookie("JSESSIONID", "/services", "");
}
function setCustomerTypeCookie(customerType)
{
setCookie('customerType',customerType)
}
function getCustomerTypeCookie()
{
return getCookie('customerType')
}
function setReturningUser()
{
setCustomerTypeCookie(1)
}
function setTTOLocationCookie(cookieValue)
{
setPublicCookie('tto_location', cookieValue, true, true, kTTOLocCookieDate)
}
function getTTOLocationCookie()
{
return getCookie('tto_location')
}
function updateTTOLocation(mktid,tab1,tab2,sku)
{
var list = 1
var last = 1
var t1 = isDefined(tab1)?tab1:-1
var t2 = isDefined(tab2)?tab2:-1
var ct = getCustomerTypeCookie()?getCustomerTypeCookie():-2
var sku = sku?sku:-1
var priorYrSku = (typeof TTOModel == "undefined")?null:TTOModel.getPriorYrSku()
var tl = getTTOLocationCookie()
if(tl != ""){
var tmp = tl.split("#")
list = tmp[0]
last = tmp[1]
py = tmp[6]
priorYrSku = priorYrSku?priorYrSku:py?py:-1
}
if (-1 != mktid){
last = mktid
list = list|mktid
}
tl = list + '#' + last + '#' + t1 + '#' + t2 + '#a=' + ct + '#' + sku + '#' + priorYrSku
setTTOLocationCookie(tl)
}
function setPriorYearSkuCookie(pysku)
{
var sku = pysku?pysku:-1
if ((typeof TTOModel != "undefined")){
TTOModel.setPriorYrSku(sku)
}
}
function isVisible( e) {return "hidden"!=e.style.visibility}
function hide( e){if(e)e.style.visibility="hidden"}
function show( e){if(e)e.style.visibility="inherit"}
function display( e, style){
if(e)e.style.display=(style)?style:""
}
function dontdisplay( e){if(e)e.style.display="none"}
function appendLayer( p, css, clr, bkg, bV){
var e=document.createElement("DIV")
if(p)p.appendChild(e)
if(css)e.className=css
if(clr)e.style.backgroundColor=clr
if(bkg)e.style.backgroundImage="url("+'/img/'+bkg+")"
if(null!=bV&&!bV)hide(e)
return e
}
function appendIFrame(d,p, n, css, src){
var e;
var s = "<IFRAME ";
if (n) s = s + "name='" +n+ "' ";
if (css) s = s + "class='" +css+ "' ";
if (src) s = s + "src='" +src+ "' ";
s = s + "scrolling='no' noresize frameborder='no'></IFRAME>";
var tmp=document.createElement("DIV")
if(tmp){
tmp.innerHTML = s
e=tmp.lastChild
}
p.appendChild(e)
return e;
}
function setDim(e,w,h){
var s=e.style
if(w){
if(!isNaN(w)){
if(w<0)w=0
w+="px"
}
s.width=w
}
if(h){
if(!isNaN(h)){
if(h<0)h=0
if(h<20)s.fontSize="1px"
h+="px"
}
s.height=h
}
if(w&&h)s.overflow="hidden"
}
function setPos(e,x,y,z,w,h){
var s=e.style
if(null!=x||null!=y){
s.position="absolute"
if(null!=x){
if (gbIE){
if(isNaN(x))s.left=x
else s.pixelLeft=x
}
else {
if(!isNaN(x))x+="px"
s.left=x
}
}
if(null!=y){
if (gbIE){
if(isNaN(y))s.top=y
else s.pixelTop=y
}
else {
if(!isNaN(y))y+="px"
s.top=y
}
}
}
if(null!=z)s.zIndex=z
if(w||h)setDim(e,w,h)
}
function pageX( e){
var x=e.offsetLeft
var p=e.offsetParent
while(null!=p){
if(p.offsetLeft)x+=p.offsetLeft
p=p.offsetParent
}
return x
}
function pageY( e){
var y=e.offsetTop
var p=e.offsetParent
while(null!=p){
if(p.offsetTop)y+=p.offsetTop
p=p.offsetParent
}
return y
}
function clearKids(e){
_clearAttr(e)
e.innerHTML=""
}
function _clearAttr(e){
var c=e.firstChild
while(c){
if(c.hasChildNodes())_clearAttr(c)
else if(c.clear)c.clear()
c=c.nextSibling
}
if(e.clear)e.clear()
}
kMAXSIGS= 25
var gSigs=null
var gSigCnt=0
function signal( s, n){
if(null==gSigs){
gSigCnt=0
gSigs=new Array(kMAXSIGS)
}
gSigs[gSigCnt++]=setTimeout(s,n)
}
function clrSignals(){
if(gSigs){
for(var i=0;i<gSigCnt;i++){
clearTimeout(gSigs[i])
gSigs[i]=null
}
gSigs=null
}
gSigCnt=0
}
function zEventCancelListener(e){
var evt=new zEvent(e)
evt.cancel()
}
function zEventClearStatusBar(e){
window.status="";
return true;
}
function zEventSelectElement(e){
var evt=new zEvent(e)
try{
evt.element.select()
}
catch(e){}
}
function zEventKeyFilter(e)
{
var evt = new zEvent(e);
if (evt.which == 8)
{
if (evt.element.tagName == "INPUT" && (evt.element.type == "file" || evt.element.type == "password" || evt.element.type == "text" || evt.element.type == "tel"))
return;
else if (evt.element.tagName == "TEXTAREA")
return;
;
evt.cancel();
}
}
function zEvent( o){
var t=this
if(o)t.eventObj=o
else {
t.eventObj=window.event
if(!t.eventObj){
var i,cnt=window.frames.length
for(i=0;i<cnt;i++){
try {
t.eventObj = window.frames[i].event
} catch (ex) {}
if(t.eventObj)break
}
}
}
var e=t.eventObj
if(e){
t.type=e.type
if (e.target)t.element=e.target
else if(e.srcElement)t.element=e.srcElement
if(e.which)t.which=e.which
else if(e.keyCode)t.which=e.keyCode
e=null
}
}
function _zEventCancel(){
var e=this.eventObj
if(e){
try {
e.preventDefault()
e.stopPropagation()
e.cancelBubble=true
e.returnValue=false
}
catch (ex){
e.cancelBubble=true
e.returnValue=false
}
}
}
p=zEvent.prototype
p.eventObj=null
p.type=null
p.which=null
p.element=null
p.cancel=_zEventCancel
p=null
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
Dictionary = Class.extend({
_maxSize : 0,
_arr : [],
construct : function(maxSize) {
this._maxSize = maxSize || Infinity;
this._arr = [];
},
getIndexForKey : function(key) {
for(var i = 0, len = this._arr.length; i < len; i++) {
if(this._arr[i].key === key)
return i;
}
return -1;
},
add : function(key, value) {
var foundIndex = this.getIndexForKey(key);
var obj = {};
obj.key = key;
obj.val = value;
if(foundIndex == -1) {
if(this._arr.length < this._maxSize) {
this._arr.push(obj);
}
}
else {
this._arr[foundIndex] = obj;
}
},
remove : function(key) {
var foundIndex = this.getIndexForKey(key);
if(foundIndex > -1) {
this._arr.splice(foundIndex, 1);
}
},
get : function(key) {
var foundIndex = this.getIndexForKey(key);
return this._arr[foundIndex] ? this._arr[foundIndex].val : null;
},
each : function( cb) {
var that = this;
for(var i = 0, len = this._arr.length; i < len; i++) {
cb(that._arr[i].key, that._arr[i].val);
}
},
size : function() {
return this._arr.length;
},
clear : function() {
this._arr = [];
}
});
sdsa_rsp = null
Tokenizer = new function()
{
var Tokenizer = this;
Tokenizer.kCCError = 1;
Tokenizer.kError_Recoverable = 2;
Tokenizer.kError_NonRecoverable = 3;
Tokenizer.kError_Timeout = 4;
Tokenizer.kError_JSONParser = 5;
var kTokenCookieName="sdsa_cc"
var kTokenCookiePath="/sdsa"
if (gbSafari) kTokenCookiePath = '/'
var kTokenScriptID = 'TKN'
var _tokenScriptSrc="https://gwsoajsod.intuit.com/sdsa?sysid=tto"
var _tokenTimer = null;
var _responseWaiter = null;
var _tokenWaitTime = 20000;
var _successCB = null;
var _errorCB = null;
var _cnt = 0;
Tokenizer.TokenizeCC = function(cc, waitTime) {
if (waitTime)
_tokenWaitTime = waitTime
Tokenizer._clearTokenCode()
document.cookie = kTokenCookieName+'='+cc+';path='+kTokenCookiePath+';domain='+kPublicDomain+';secure';
var head = document.getElementsByTagName('head').item(0);
var ts = $(kTokenScriptID);
if (ts) head.removeChild(ts);
var script = document.createElement('script');
script.src = _tokenScriptSrc+'&num='+_cnt++;
script.type = 'text/javascript';
script.id=kTokenScriptID;
head.appendChild(script);
setTimeout('Tokenizer._waitForToken()',0)
_tokenTimer = setTimeout('Tokenizer._abort()',_tokenWaitTime);
},
Tokenizer.setSuccessCB = function(cb) {
_successCB=cb;
},
Tokenizer.setErrorCB = function(cb) {
_errorCB=cb;
},
Tokenizer.Abort = function() {
Tokenizer._clearTokenCode();
},
Tokenizer.setScriptSrc = function(src) {
_tokenScriptSrc = src;
},
Tokenizer._waitForToken = function() {
if (!sdsa_rsp) {
_responseWaiter = setTimeout('Tokenizer._waitForToken()',200);
return;
}
Tokenizer._parseTokenizerResponse();
clearTimeout(_responseWaiter);
clearTimeout(_tokenTimer);
},
Tokenizer._clearTokenCode = function() {
document.cookie=kTokenCookieName+"=0; expires="+kExpCookieDate+"; domain="+kPublicDomain+"; path="+kTokenCookiePath
var head = document.getElementsByTagName('head').item(0)
var ts = $(kTokenScriptID)
if (ts) head.removeChild(ts)
sdsa_rsp = null
clearTimeout(_responseWaiter);
clearTimeout(_tokenTimer);
},
Tokenizer._parseTokenizerResponse = function() {
try{
var rsp = sdsa_rsp
if (rsp.token) {
if (_successCB) _successCB(rsp.token)
}
else if (rsp.error) {
var err = rsp.error.code
if (err < 200) {
if (_errorCB) _errorCB(Tokenizer.kCCError, rsp)
}
else if (err < 500) {
if (_errorCB) _errorCB(Tokenizer.kError_NonRecoverable, rsp)
}
else {
if (_errorCB) _errorCB(Tokenizer.kError_Recoverable, rsp)
}
}
}
catch(e)
{
if (_errorCB) _errorCB(Tokenizer.kError_JSONParser, rsp)
}
},
Tokenizer._abort = function() {
Tokenizer._clearTokenCode()
if (_errorCB) _errorCB(Tokenizer.kError_Timeout, 'Tokenizer Timeout')
}
}
kSubmitRetries = 2;
kExitSurveyViewsRatio = 26;
kSessionConnectionFailurePage = "SessionConnectionFailure.htm"
kWebFlowExceptionPage = "WebFlowException.htm"
kAppRespError="AppRespError.htm"
kAuthedNavigateAwayMsg = "Don't worry- we've saved your data.\nWhen you come back to finish your tax return, you can pick up right where you left off."
kDelayedAuthNavigateAwayMsg = "You haven't saved your data yet!\n\nCreating a user ID and password costs you nothing and will protect you from having to enter your data again.\nBefore you leave, go back and select \"Create User ID\" in the upper-right corner of the screen."
kQAWindowScript = "DebugModel.js"
kDelayedAuthScript = "DelayedAuth.js"
var TTOApp = (function(){
var _instance = {
fbExpectReload : false,
tabIndex : 1,
staticElementTabIndex : 100,
init : function () {
clearSessionCookie();
_setListeners();
_initApp();
setTimeout("TTOController.allocate()",100);
CacheManager.initImgs();
CacheManager.prefetchTokenizer();
},
onSubmit : function () {
window.scrollTo(0,0);
clrSignals()
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_RemoveErrorMsg)
},
prepareForPage : function () {
_registeredSubmitPrimitives = null
TTOApp.tabIndex = 1
},
beginPage : function () {
},
endPage : function () {
signal("TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_FinalizePg)",0)
},
finalizePage : function () {
if(_fFirstRsp){
if ("undefined" != typeof(tts)) {
TTOApp.initTTOIntervention();
}
}
_fFirstRsp=false;
_fbReady=true;
signal("TrackingService.fireTTLocation()",1000);
},
initTTOIntervention : function () {
if ("1" === "1" && TTOModel.getRightRailVersion() !== "ty10" && !TTOModel.isFFA()) {
var ttsConfig = {
abTest: TTOModel.getABTestAsParams(),
priorityCode: TTOModel.getCustomerSrc(),
pageTTOhook: TTOEventPubSub.kEvt_EndPage,
softTTOhook: TTOEventPubSub.kEvt_AppExit,
hardTTOhook: TTOEventPubSub.kEvt_AppHardExit
};
if ("undefined" != typeof(zDebugTrace)) {
ttsConfig.testLog = true;
ttsConfig.loggingMethod = zDebugTrace;
}
if (TTOModel.isFFA() || "0" === "1") {
tts.intervention.suspendInterventionChecks = true;
}
tts.intervention.init(ttsConfig);
}
},
doMetrics : function (extraBeaconDataObj) {
var TO = new BeaconDataTO();
TO.reqId = TTOModel.getPageInfo().reqId;
TO.authId = TTOModel.getAuthId();
TO.title = TTOModel.getDialogInfo().title;
TO.prodId = TTOModel.getProductId();
TO.prodAlias = TTOModel.getProductInfo().prodAlias;
TO.customerSource = TTOModel.getCustomerSrc();
TO.currentScreenId = TTOModel.getDialogInfo().screenId;
TO.topicId = TTOModel.getDialogInfo().topicId;
TO.section = "";
TO.LCTags = TTOModel.getPageLCTagset();
TO.LCTitle = TTOModel.getPageLCTitle();
TO.taxServer = TTOModel.getTaxServer();
TO.taxPort = TTOModel.getTaxServerPort();
TO.customerType = TTOModel.getCustomerType() ;
TO.eventType = "PageEntry" ;
pb = TTOApp.findCtrlByType(26);
if (pb) {
TO.currentTab = pb.getCurCat();
TO.currentSubItem = pb.getCurSubItem();
}
var refundMon = parent.RefundManager;
if (refundMon) {
rfa = refundMon.getInstance();
if (rfa){
TO.fedRefundAmount = rfa.getRfndAmt("S2011US1040PER");
}
}
for (var data in extraBeaconDataObj) {
TO[data] = extraBeaconDataObj[data]
}
if (undefined !== TrackingService) {
TrackingService.sendMetrics(TO.reqId, TO.authId, TO)
}
},
setRegion : function (r) {
if(!r) return
if(null ==_regionList)
_regionList=new Array()
if (isUndefined(_regionList[r.name]))
_regionList[r.name]=createRegion(r.name)
_regionList[r.name].setControls(r.cL)
_regionList[r.name].setLayout()
},
renderRegions : function (data ) {
if (isUndefined(data) || isUndefined(_regionList)) return
for (var i=0; i< data.length; i++){
var region = _regionList[data[i].name];
if (region) {
region.renderControls(data[i].cL);
}
}
},
findRegionByName : function (name) {
var reg = null
for (var r in _regionList) {
reg = _regionList[r]
if (reg.name == name) return reg;
}
return null
},
findCtrlByType : function (type) {
var prm = null
for (var r in _regionList) {
prm = _regionList[r].FindCtrlByType(type)
if (prm) break;
}
return prm
},
findCtrlByID : function (ctrlID) {
var prm = null
for (var r in _regionList) {
prm = _regionList[r].FindCtrlByID(ctrlID)
if (prm) break;
}
return prm
},
findCtrlAndShow : function (type, bShow) {
var ctrl = TTOApp.findCtrlByType(type)
if (ctrl && ctrl.show) ctrl.show(bShow)
return ctrl
},
registerPrimForSubmit : function (prm) {
if (!_registeredSubmitPrimitives) _registeredSubmitPrimitives = new Array();
for (var i=0; i<_registeredSubmitPrimitives.length; i++) {
if (_registeredSubmitPrimitives[i].fID == prm.fID) {
return
}
}
_registeredSubmitPrimitives.push(prm)
},
removePrimFromSubmit : function (prm) {
if (!_registeredSubmitPrimitives) return
for (var i=0; i<_registeredSubmitPrimitives.length; i++) {
if (_registeredSubmitPrimitives[i].fID == prm.fID) {
_registeredSubmitPrimitives.splice(i,1)
break;
}
}
},
isOKToSubmit : function (){
if(!_fbReady || !isDefined(_regionList) )return false
for (r in _regionList) {
if (!_regionList[r].isOKToSubmit()) {
return false
}
}
return true
},
getFormattedSubmitData : function () {
var buf = "";
if (_registeredSubmitPrimitives) {
for (i=0; i<_registeredSubmitPrimitives.length; i++) {
var prm = _registeredSubmitPrimitives[i]
buf += _formatPrimVal(prm.fID,prm.GetVal());
}
}
return buf;
function _formatPrimVal( n, v){
var buf = "";
if(n&&null!=v)
buf += n + '=' + encodeURIComponent(v) + kClientRequestSeperater
return buf;
}
},
registerViewer : function (viewer) {
if (!viewer) return;
var bExists = false;
if(null==_viewerList) viewerList=new Array()
for (var i=0; i<_viewerList.length; i++)
if (_viewerList[i].fID == viewer.fID)
bExists=true;
if (!bExists)
_viewerList[_viewerList.length]=viewer
},
registerWindow : function ( win) {
if (!win) return;
var bExists = false;
if(null==_windowList) _windowList=new Array()
for (var i=0; i<_windowList.length; i++)
if (_windowList == win)
bExists=true;
if (!bExists) {
_windowList[_windowList.length]=win
}
},
closeChildWindows : function () {
if(null==_windowList)return
var i,cnt=_windowList.length
for(i=0;i<cnt;i++) {
if(_windowList[i]) {
try {
_windowList[i].close();
} catch(e)
{
}
}
}
},
showErrorTip : function ( e, msg) {
if(null==e)return
var errMsg = e.errorMsg?e.errorMsg:(msg?msg:"");
var l=$('errorTipLayer')
clearKids(l)
TTO.DU.appendText( l, errMsg)
var x = jQuery(e).topWindowOffset().left + jQuery(e).width() -30;
var y = jQuery(e).topWindowOffset().top - jQuery(l).height() -15;
if (!_errorShowing) {
_errorShowing=true;
jQuery(l).animate({'top':y, 'left':x}, 0, function(){ jQuery(this).show(); });
;
}
else {
jQuery(l).animate({'top':y, 'left':x}, 300);
}
},
hideErrorTip : function (){
if (!_errorShowing) return;
_errorShowing = false;
jQuery('#'+'errorTipLayer').hide();
;
},
isErrorTipShowing : function (){
return _errorShowing;
},
showValidationAlert: function(msg, h){
function _closeMsg()
{
RIAModalWindow.hide();
RIAModalWindow.clear();
_validationAlertShowing = false
}
if (_validationAlertShowing) return
h = h?h:75
_validationAlertShowing = true
var e = document.createElement("div");
e.className = "validationAlertPane";
e.style.height = h+"px";
var t = document.createElement("div");
t.className = "validationAlertText";
t.innerHTML = msg?msg:kValidationAlert;
e.appendChild(t);
e.appendChild(document.createElement("p"));
var btndiv = document.createElement("DIV");
btndiv.className = "validationAlertCloseBtn";
var btn = document.createElement("A")
btn._lnk = true;
btn.className = 'ansLg';
var spn = document.createElement('span');
btn.appendChild(spn);
btn.onclick = _closeMsg;
spn.appendChild(document.createTextNode("OK"));
btndiv.appendChild(btn);
e.appendChild(btndiv);
var modalParam = {
content : e,
w : 300,
h : h,
ch : true,
cv : true,
bkgID : "validationAlertModalBkg"
};
RIAModalWindow.show(modalParam);
},
handleClientError : function (error ) {
if (!error) return;
var TO = new LogErrorTO()
TO.error = error;
var lc = new LogErrorCommand(TO)
lc.execute();
},
checkDelayedAuth : function (bWebFlow ) {
var cmd = new CheckDelayedAuthCommand();
cmd.setSuccessCB(bWebFlow?_handleWebFlowDelayedAuthSuccess:_handleDelayedAuthSuccess);
cmd.setFailureCB(bWebFlow?_handleWebFlowDelayedAuthError:_handleDelayedAuthError);
cmd.execute();
},
verifyUserExit : function () {
if (TTOApp.fbExpectReload) return;
var TO = new QuitTO();
TO.delay = true
var close = new ShutdownCommand(TO);
close.execute();
hardExitBeacon();
if (TTOModel.isDelayedAuth())
return kDelayedAuthNavigateAwayMsg;
else
return kAuthedNavigateAwayMsg;
},
handleRIAEvent : function(evtObj) {
var type = evtObj.type;
var value = evtObj.value;
if(type == riaEvtObj.ERR) {
var flowid = value.flowId
var msg = TTOModel.isQA()?value.msg:""
var nf = value.nfex
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("RIA DIALOG", "flow exception, flowid = " + flowid + ", msg = " + msg, LOG_ERROR))
var params = "?qa="+ (TTOModel.isQA()?"true":"") +"&flowid=" + flowid +"&nf="+nf + "&msg="+msg
var url = kWebFlowExceptionPage+params
TTOApp.hijackApp(url);
}
},
onunload : function () {
clearSessionCookie();
if (!TTOApp.fbExpectReload) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_AppHardExit);
}
TTOApp.closeChildWindows();
if(TTOApp.fbExpectReload) return
gotoExitSurvey()
},
hijackApp : function (url) {
if(!Message.isShowing()) {
Message.show(url,Message.kMsg_UrlType)
_hijacked=true
}
},
releaseApp : function (bDontAnimateMessage) {
if (_hijacked)
Message.hide(bDontAnimateMessage)
_hijacked=false
}
};
var kClientRequestSeperater = ";"
var kValidationAlert = "You must fix errors on this page before continuing."
var _fFirstRsp = false;
var _fbReady = false;
var _hijacked = false;
var _errorShowing = false;
var _validationAlertShowing = false;
var _regionList = new Array();
var _viewerList = new Array();
var _windowList = new Array();
var _registeredSubmitPrimitives = null;
function _setListeners(){
document.onkeydown=zEventKeyFilter;
window.onbeforeunload=TTOApp.verifyUserExit;
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_PrepareForPage, TTOApp.prepareForPage)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, TTOApp.beginPage)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_EndPage, TTOApp.endPage)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, TTOApp.finalizePage)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_ErrorOnPage, TTOApp.showErrorTip)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_RemoveErrorMsg, TTOApp.hideErrorTip)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_ClientError, TTOApp.handleClientError)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_WindowBeforeUnload, TTOApp.verifyUserExit)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_RIAEvent, TTOApp.handleRIAEvent)
}
function _initApp(){
_fFirstRsp = true;
TTOApp.setRegion({"name":"UI"})
if (isDefined(Message))
Message._renderMessageLayer();
var url = document.location
var TO = new InitTO();
TO.userId = getParamValue(url,'uid')
TO.csrc = getParamValue(url,'csrc')
TO.prodId = getParamValue(url,'prodid')
TO.taxserver = getParamValue(url, 'app')
TO.webserver = location.hostname
TO.port = getParamValue(url, 'pt')
TO.productData = getParamValue(url, 'state')
TO.delayedAuth=getCookie('customerType')==-1;
var initApp = new InitAppCommand(TO);
initApp.execute();
var MR = new AjaxSequencer()
MR.addRequest(TTOService.kAJAX_GetABTests,null,setABTestInfo)
if (TTOModel.isDelayedAuth()) {
JSLoader.load(kDelayedAuthScript)
}
else {
var email = getCookie("email")
MR.addRequest(TTOService.kAJAX_LogEmail,email, function(){})
}
MR.send();
function setABTestInfo(respTO) {
var json = respTO.responseJSON
if (json && json.ABTestData) {
var TO = new ABTestTO()
TO.abInfo = decodeURIComponent(json.ABTestData)
var cmd = new SetABTestCommand(TO)
cmd.execute()
}
}
}
function _handleWebFlowDelayedAuthSuccess (respTO) {
_handleDelayedAuthSuccess(respTO, true)
}
function _handleDelayedAuthSuccess (respTO, bWebFlow ){
var json = respTO.responseJSON
var bForceSave = false
if (json.error == 0) {
if (json.provisional == true) bForceSave = true;
}
else if (TTOModel.isDelayedAuth()) {
bForceSave = true;
}
if (bForceSave) {
var fcsUrl = "/open/registration/TrialForceSave.htm" + "?customerSource=" + TTOModel.getCustomerSrc() + "&productid=" + TTOModel.getProductId() + "&trial=true&force=true"
if (bWebFlow) fcsUrl += "&webflow=true"
TTOApp.hijackApp(fcsUrl)
}
}
function _handleWebFlowDelayedAuthError (respTO) {
_handleDelayedAuthError(respTO, true);
}
function _handleDelayedAuthError (respTO, bWebFlow ) {
if (TTOModel.isDelayedAuth()) {
var fcsUrl = "/open/registration/TrialForceSave.htm" + "?customerSource=" + TTOModel.getCustomerSrc() + "&productid=" + TTOModel.getProductId() + "&trial=true&force=true"
if (bWebFlow) fcsUrl += "&webflow=true"
TTOApp.hijackApp(fcsUrl)
}
}
return _instance;
})();
zRegion = zPrm.extend( {
construct : function (n ) {
this.name = n
this.fID=n
},
setLayout : function(){},
setControls : function ( cl ) {
var t=this
if (!cl) return
for (var i=0; i< cl.length; i++) {
t.AddCtrl(cl[i])
}
},
renderControls : function(controlList ) {
var t=this
if (!t.ctrlList || !controlList) return
for (var i=0; i<controlList.length; i++){
var itm = controlList[i]
if (!itm) continue
var data = itm.data
var ctrl = t.FindCtrl(itm.name)
if (!ctrl || !ctrl.prm) continue
ctrl.prm.Render(data)
}
}
});
function createRegion(rn ) {
var region = null;
switch (rn) {
case "dialog" : region = new zDialogRegion(rn); break;
case "static" : region = new zStaticRegion(rn); break;
case "debug" : region = new zDebugRegion(rn); break;
case "hidden" : region = new zHiddenRegion(rn); break;
case "process" : region = new zProcessRegion(rn); break;
case "form" : region = new zFormRegion(rn); break;
case "help" : region = new zHelpRegion(rn); break;
case "UI" : region = new zUIOwnedRegion(rn); break;
default :
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("REGION","Region not in factory: "+rn), LOG_WARNING)
region = new zRegion(rn);
}
return region;
}
zStaticRegion = zRegion.extend( {
construct : function (n ){
var t=this
t.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_SetProduct, this.onSetProduct, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_SetBranding, this.onSetBranding, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_Submit, this.onSubmit, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_InProductOfferOnPage, this.setIPO, this)
t.BannerLayer=$('bannerRegion')
t.LogoLayer=$('ttoLogoLayer')
t.FooterLayer=$('footerLayer')
t.PartnerLogoLayer=appendLayer( gAppRegion)
t.PartnerLogoLayer.id='partnerLogoLayer'
t.PartnerAdLayer=appendLayer(t.FooterLayer)
t.PartnerAdLayer.id='promoLayer'
t.fAdSrc=null
t.fAdImgSrc=null
t.fAdUrl=null
t.fbShowAd=false
t.RefundMntrLayer=appendLayer( gAppRegion, "RefundArea", null, null, false)
t.RefundMntrLayer.id = 'refundLayer'
t.RefundMntrLayer.align="center"
var tb = $('tabRegion')
t.ToolbarLayer= appendLayer(tb)
t.ToolbarLayer.id = 'toolbarLayer'
t.ToolbarLayer.align="right"
t.SignOutLayer=appendLayer( gAppRegion)
t.SignOutLayer.id = 'signoutLayer'
t.PrivacyLayer=appendLayer(t.FooterLayer)
t.Logo = TTO.DU.appendImg(t.LogoLayer)
if (TTOModel.isDelayedAuth()) {
DelayedAuth.initUI()
}
},
setLayout : function () {
var t = this
var e = t.FindCtrlByType(28)
if (e) e.setLayout(t.RefundMntrLayer)
e = t.FindCtrlByType(30)
if (e) e.setLayout(t.ToolbarLayer)
e = t.FindCtrlByType(49)
if (e) e.setLayout(t.SignOutLayer)
},
onSubmit : function () {
var t=this
if(t.RefundMntr)t.RefundMntr.enable(false)
},
onBgnPg : function () {
var t=this
if(!TTOModel.isEZStepView()){
hide(this.ToolbarLayer)
hide(this.PartnerAdLayer)
}
RefundManager.getInstance().clearAll();
t.fHasIPO=false;
},
onFinalizePg : function () {
var t=this
show(t.RefundMntrLayer)
if (TTOModel.isEZStepView()) {
show(t.ToolbarLayer)
}
if (TTOModel.isProgressView() ) {
hide(t.SignOutLayer)
hide(t.TrialSignOutLayer)
hide(t.ToolbarLayer)
}else{
if (TTOModel.isDelayedAuth())
{
DelayedAuth.showDelayedAuthElements(true)
}else{
if (t.SignOutLayer) show(t.SignOutLayer);
}
}
if (!TTOModel.isValidProduct()){
hide(t.RefundMntrLayer)
hide(t.ToolbarLayer)
}
var bShow = true
if(!TTOModel.isValidProduct() ||t.fHasIPO )bShow=false
if ((null==t.fAdImgSrc) || (!t.fbShowAd)) bShow=false
if (bShow) show(t.PartnerAdLayer)
else hide(t.PartnerAdLayer)
t._setPrivacy();
},
onSetBranding : function () {
var t = this;
var a = TTOModel.getBrandingInfo()
t.fbShowAd = a.showAd
t.fAdSrc = a.iframeContentURL
t.fAdImgSrc = a.embeddedContentURL
t.fAdUrl = a.embeddedLinkURL
t._setPartnerLogo(a.logoSrcURL)
t._setAds();
},
onSetProduct : function ()
{
var t=this
var prodID = TTOModel.getProductId()
var rhi = RefundManager.getInstance();
changeImage(t.Logo,'ttlogo'+"_"+prodID+".png", TTOModel.isAccessible()?"TurboTax Logo":null)
t.BannerLayer.style.backgroundImage="url("+getImageURL('hdr'+'_'+prodID+'.gif')+")"
rhi.clearAll();
rhi.setProductId(prodID);
},
_setPartnerLogo : function ( logoSrc) {
var t=this
var l=t.PartnerLogoLayer
if(!l.hasChildNodes()&&logoSrc&&t.fbShowAd){
TTO.DU.appendText( l,'presented by',"presentedBy")
TTO.DU.appendSp( l, 4, 1)
TTO.DU.appendImg( l, logoSrc, 90, 20)
show(l)
}
},
_setAds : function (){
var t=this
var l=t.PartnerAdLayer
var fn = t.fAdImgSrc
if (!fn) return
if(!l.hasChildNodes()&&t.fbShowAd){
var act=(t.fAdUrl)?"gotoURL('"+t.fAdUrl+"')":null
if(act) TTO.DU.appendImgLnk( l, fn, 120, 90, null, "Sponsor", act)
else TTO.DU.appendImg( l, fn, 120, 90)
}
},
_setPrivacy : function () {
var t=this
var pa="gotoURL(\'http://security.intuit.com/privacy\',778)";
var la="gotoURL(\'https://turbotaxweb.qprd.turbotaxonline.intuit.com/open/registration/Legal.htm?productid='+TTOModel.getProductId(),778)";
var l=t.PrivacyLayer,e=null
if (TTOModel.getProductId()==4){
pa="gotoURL(\'http://security.intuit.com/privacy\',778)";
la="gotoURL(\'https://turbotaxweb.qprd.turbotaxonline.intuit.com/open/registration/Legal_FFA.htm?productid='+TTOModel.getProductId(),778)";
}
l.innerHTML = " ";
if (TTOModel.getDialogInfo().pii ){
e=TTO.DU.appendImgLnk( l, 'trustelogo.gif', 116, 31, null, "Truste", pa)
}
else {
e=TTO.DU.appendLink( l, 'License Agreement', la, "privacy", false)
TTO.DU.appendText( l," | ", "copyright")
e=TTO.DU.appendLink( l, 'Privacy', pa, "privacy", false)
TTO.DU.appendText( l," | ", "copyright")
e=TTO.DU.appendLink( l, 'Security', "gotoSecurity()", "privacy", false)
TTO.DU.appendText( l," | ", "copyright")
e=TTO.DU.appendLink( l, 'Support', "gotoTechSupport(3021)", "privacy", false)
TTO.DU.appendText( l," | ", "copyright")
e=TTO.DU.appendLink( l, 'Send Us Feedback', "goFeedback('APP')", "privacy", false)
if(location.href.indexOf("fFullversion=true") > -1) {
TTO.DU.appendText( l," | ", "copyright")
e=TTO.DU.appendLink( l, "View Tablet Version", "goTabletSite()", "privacy", false)
}
}
newLine(l)
e=TTO.DU.appendText( l, '\xa9 2011 Intuit Inc. All rights reserved.', "copyright")
}
});
zProcessRegion = zRegion.extend( {
construct : function (n ){
var t=this
t.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_SetProduct, this.onSetProduct, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_Submit, this.onSubmit, this)
var tb = $('tabRegion')
t.TabBarLayer=appendLayer( tb)
t.TabBarLayer.id = 'tabBarLayer'
var sn = $('subnavRegion')
t.SubNavLayer=appendLayer( sn)
t.SubNavLayer.id = 'subNavLayer'
t.NavBtnLayer= appendLayer(tb)
t.NavBtnLayer.id = 'tabbar_btnLayer'
},
setLayout : function () {
var t = this
var c = this.ctrlList
var e = t.FindCtrlByType(26)
if (e) e.setLayout(t.TabBarLayer,t.SubNavLayer)
if (c && !TTOModel.isEZStepView()) {
for (var i in c) {
c[i].prm.setLayout(t.NavBtnLayer)
}
}
},
onBgnPg : function (){
var t=this
hide(t.NavBtnLayer)
clearKids(t.NavBtnLayer)
if(!TTOModel.isEZStepView()){
hide(t.TabBarLayer)
hide(t.SubNavLayer)
if(!TTOModel.isProgressView()){
t.RemoveCtrls()
}
}
},
onFinalizePg : function () {
var t=this
if(TTOModel.isEZStepView()){
show(t.TabBarLayer)
show(t.SubNavLayer)
hide(t.NavBtnLayer)
t._setPageLocCookie()
}
else {
hide(t.TabBarLayer)
hide(t.SubNavLayer)
show(t.NavBtnLayer)
}
if (!TTOModel.isValidProduct()){
hide(t.TabBarLayer)
hide(t.SubNavLayer)
hide(t.NavBtnLayer)
}
},
onSetProduct : function ( ) {
var t=this
var pb=TTOApp.findCtrlByType(26)
if (!pb) return
},
onSubmit : function () {
hide(this.NavBtnLayer)
},
_setPageLocCookie : function (){
var tab1=-1
var tab2=-1
var sku=0
var pb=TTOApp.findCtrlByType(26)
if (pb){
tab1 = (pb.getCurIndex() == null)? "-1" : pb.getCurIndex()
tab2 = (pb.getCurSIIndex() == null)? "-1" : pb.getCurSIIndex()
}
TrackingService.setTTLocationInfo({
"tab1" : tab1,
"tab2" : tab2,
"sku" : TTOModel.getProductId()
})
}
});
zFormRegion = zRegion.extend( {
construct : function (n ){
var t=this
t.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_Submit, this.onSubmit, this)
t.FormsModeLayer = appendLayer( document.body, "FormsModeArea")
t.FormsModeLayer.id="formsMode"
t.FormsModeLayer.initialized =false
t.FormsModeLayer.showing=false
t.FormLayer=$('formLayer')
},
setLayout : function (){
var c = this.ctrlList
if (c) {
for (var i in c) {
c[i].prm.setLayout(this.FormLayer)
}
}
},
onBgnPg : function (){
this.RemoveCtrls()
clearKids(this.FormLayer)
},
onFinalizePg : function () {
try {
var c = this.ctrlList
if (c) {
for (var i in c) {
c[i].prm.setFocus()
break;
}
}
}
catch(e){}
},
onSubmit : function () {
}
});
zHiddenRegion = zRegion.extend( {
construct : function (n ){
this.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
},
onBgnPg : function _zhrOnBgnPg(){
this.ctrlList = null
}
});
zDialogRegion = zRegion.extend( {
construct : function (n ){
var t=this
t.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_EndPage, this.onEndPg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FormExists, this.setFormExists, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_HogProgressEvent, this.handleHogProgress, this)
t.TitleLayer=$('titleLayer')
t.Title = TTO.DU.appendText( t.TitleLayer,"","title")
t.SubTitleLayer=$('subtitleLayer')
t.SubTitle = TTO.DU.appendText( t.SubTitleLayer,"","subtitle")
t.TitleGraphicLayer=$('titleGraphicLayer')
t.AnalystLayer=$('contentLayer')
t.EngineLayer=$('answerLayer')
t.StaticIcons = new Array()
t.IconLayer=$('iconLayer')
t.ContentWidth = t.AnalystLayer.clientWidth
},
setLayout : function () {
var t=this
var c = this.ctrlList
if (c) {
for (var i in c) {
c[i].prm.setLayout('#contentRegion')
}
}
if (TTOModel.isEZStepView() ) {
for (var i=0; i<t.StaticIcons.length; i++) {
if (i>0) continue
t.StaticIcons[i].setLayout(t.IconLayer);
}
}
},
onBgnPg : function (){
var t=this
t.RemoveCtrls()
clearKids(t.AnalystLayer)
clearKids(t.EngineLayer)
clearKids(t.IconLayer)
clearKids(t.TitleGraphicLayer)
t.AnalystLayer.className = "enforceContentHeight"
},
onEndPg : function () {
this.setTitle();
},
onFinalizePg : function () {
var t=this
if(TTOModel.isProgressView())return
if (t.EngineLayer.childNodes == null || t.EngineLayer.childNodes.length == 0)
hide(t.EngineLayer)
else
{
show(t.EngineLayer);
}
t.setFocus()
},
setTitle : function (){
var t=this;
var cdi = TTOModel.getDialogInfo();
var s = cdi.title;
var st = cdi.subtitle;
var tg = cdi.titleGraphic;
if(TTOModel.isProgressView())return
if (s) {
display($('titleLayer'))
jQuery(t.Title).text(s);
}
else {
dontdisplay($('titleLayer'))
}
if (st) {
display($('subtitleLayer'))
jQuery(t.SubTitle).text(st);
}
else {
dontdisplay($('subtitleLayer'))
}
if (tg != null && tg != "") {
jQuery('#titleGraphicLayer').empty();
TTO.DU.appendImg( t.TitleGraphicLayer, tg);
display($('titleGraphicLayer'));
}
else {
dontdisplay($('titleGraphicLayer'))
}
},
handleHogProgress : function (pct) {
var ttl
if(pct){
ttl="Processing: "
ttl+=pct+"%"
ttl+=" completed"
}
else ttl="Processing completed"
this.Title.firstChild.nodeValue=ttl
},
clearStaticIcons : function () {
var t = this
if (t.StaticIcons){
t.StaticIcons = null
t.StaticIcons = new Array();
}
},
addStaticIconLnk : function (lnk) {
var t = this
for (var i=0; i<t.StaticIcons.length; i++) {
if (lnk.fID == t.StaticIcons[i].fID)
return;
}
t.StaticIcons.push(lnk)
},
setFocus : function (){
if(TTOModel.isProgressView())return
if (false == _zdlgrFindSetFocus(this.AnalystLayer)) {
if ( false == _zdlgrFindSetFocus(this.AnalystLayer,true)) {
_zdlgrFindSetFocus(this.EngineLayer,true)
}
}
window.scrollTo(0,0);
},
setFormExists : function () {
this.AnalystLayer.className = ""
}
});
function _zdlgrDoSetFocus(e, bLnk){
if(!e.tagName)return false
if (true==e.disabled)return false
try {
var bSet=true
if(e.tagName=="INPUT"){
if(e.type=="text"){
e.select()
e.focus()
}
else if(e.type=="radio"){
if(e.checked)e.focus()
else bSet=false
}
else e.focus()
}
else if((e.tagName=="SELECT") || (e.tagname=="TEXTAREA"))e.focus()
else if (bLnk && e.tagName=="A") e.focus()
else bSet=false
}
catch (e) {}
return bSet
}
function _zdlgrFindSetFocus(p, bLnk){
var e=p.firstChild
while(e){
if(_zdlgrDoSetFocus(e,bLnk)||_zdlgrFindSetFocus(e,bLnk))return true
e=e.nextSibling
}
return false
}
zUIOwnedRegion = zRegion.extend( {
construct : function (n){
var t=this
t.superClass.construct.call(this,n)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_Submit, this.onSubmit, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_SetProduct, this.onSetProduct, this)
if (!gbFlashInstalled)
loadCSS("TTW_NoFlash.css");
if(BrowserSniffer.isIOS())
loadCSS("TTW_IOS.css");
gAppRegion = $('app')
var errorTip =appendLayer( document.body, "tip")
errorTip.id = 'errorTipLayer'
var ctrl = new Object
ctrl.name = "My Purchases"
ctrl.pT = 100
t.AddCtrl(ctrl)
ModalWindow.Render()
},
onSubmit : function () {
TTOApp.findCtrlAndShow(32, false)
TTOApp.findCtrlAndShow(25, false)
PONWindow.hide()
},
onFinalizePg : function () {
},
onSetProduct : function () {
var d=document
d.title=""
d.title=TTOModel.getProductInfo().prodName + " " +"2011"
var lowcss = $('lowcss')
if (TTOModel.isFFA()) {
if (lowcss) lowcss.disabled=false
else loadCSS("TTWLow.css",'lowcss');
}
else if (lowcss){
lowcss.disabled=true
}
}
});
kEvt_RightRailDisplayed = "rightRailDisplayed";
gOldNavShowing=false
function zToolShowOldNav() {
var ml = $('menuLayer');
var lc = $('liveCommunityLayer');
if (isDefined(ml)){
gOldNavShowing?hide(ml):show(ml);
}
if (isDefined(lc)){
gOldNavShowing?show(lc):hide(lc);
}
gOldNavShowing = !gOldNavShowing;
}
zHelpRegion = zRegion.extend( {
construct : function (n ){
var t=this;
t.superClass.construct.call(this,n);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_EndPage, this.onEndPg, this);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, this.onFinalizePg, this);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FeatureListRetrieved, this.onFeaturesRetrieved, this);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_SetProduct, this.onSetProduct, this);
var d=document;
var menu = $('rightRailContainer');
t.MenuLayer=appendLayer(menu);
t.MenuLayer.id = 'menuLayer';
var hlp = $('help');
t.tinaLayer = appendLayer(hlp);
t.tinaLayer.id='tina';
var helpBtn = appendLayer(t.tinaLayer, "helpBtn");
t.tinaLayer.onclick = RightRailHelper.gotoAnswerCenter;
jQuery(t.tinaLayer).hide();
appendLayer(hlp,'help_divider');
t.LiveCommunityLayer=appendLayer(hlp);
t.LiveCommunityLayer.id='liveCommunityLayer';
var fr = appendIFrame(d, t.LiveCommunityLayer, 'CIAFrame', 'CIAFrame', "blank.htm");
if (screen.height > 768) {
t.LiveCommunityLayer.className = 'screenLg';
}
t.helpButtonLayer = appendLayer(hlp,"helpButtonLayer");
appendLayer(t.helpButtonLayer,'help_divider');
t.upg = appendLayer(t.helpButtonLayer);
t.upg.id='univUpgBtn';
t.upg.onclick= showUpgrade;
jQuery(t.helpButtonLayer).hide();
if (TTOModel.getRightRailVersion() === "ty10") {
t.tinaLayer.className = "ty10";
t.LiveCommunityLayer.className = 'ty10';
if (screen.height > 768) {
t.LiveCommunityLayer.className = 'screenLg_ty10';
}
t.upg.className = "ty10";
}
t.helpExpanded=false;
},
setLayout : function () {
var t=this;
e = t.FindCtrlByType(40);
if (e) e.setLayout(t.MenuLayer);
},
onBgnPg : function (){
this.ctrlList = null;
this.upg.allowUpgrade=true;
},
onEndPg : function() {
RightRailHelper.update();
},
onFinalizePg : function () {
var t=this;
if ( !t.helpExpanded && TTOModel.isValidProduct() && !TTOModel.isFFA() ) {
t.animateRightRail(true);
}
if(!TTOModel.isFFA()) {
if (TTOModel.isEZStepView() && TTOModel.isFeatureSupported(TTOModel.kPersistentUpgrade)) {
jQuery(t.helpButtonLayer).show();
} else {
jQuery(t.helpButtonLayer).hide();
}
TTOEventPubSub.publishEvent(kEvt_RightRailDisplayed);
} else {
jQuery("#rightRailContainer").show();
}
},
onSetProduct : function (prodId) {
if (TTOModel.isFFA()) {
jQuery("#rightRailContainer").css({
'left' : '',
'top' : ''
});
}
},
onFeaturesRetrieved : function () {
var t=this;
RightRailHelper.update();
if (TTOModel.isFeatureSupported(TTOModel.kPersistentUpgrade)) {
jQuery(t.helpButtonLayer).show();
} else {
jQuery(t.helpButtonLayer).hide();
}
if (RightRailHelper.isTinaEnabled()) {
jQuery(t.tinaLayer).show();
}
else {
jQuery(t.tinaLayer).hide();
}
},
animateRightRail : function (bShow) {
var t=this;
if (!t.helpExpanded && bShow) {
jQuery("#rightRailContainer").show();
}
else if (t.helpExpanded && !bShow) {
jQuery("#rightRailContainer").hide();
}
t.helpExpanded=bShow;
}
});
zDebugRegion = zRegion.extend( {
construct : function (n ){
this.superClass.construct.call(this,n)
this.DebugLayer = appendLayer(document.body, "debugRegion");
this.Layers = null
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this.onBgnPg, this)
},
onBgnPg : function (){
this.ctrlList = null
},
setLayout : function (){
var t=this
this.DebugLayer.innerHTML=''
this.Layers = new Array()
var c = this.ctrlList
if (c) {
for (var i in c) {
var l = appendLayer(this.DebugLayer)
t.Layers.push(l)
c[i].prm.setLayout(l)
}
}
},
renderControls : function (controlList) {
zRegion.prototype.renderControls.call(this,controlList)
if (this.Layers.length) {
var a = this.Layers[1].innerHTML.match(/ASSERT/)
$('contentRegion').style.backgroundImage=(a)?"url("+getImageURL("assert.gif")+")":"none"
}
},
showDegubInfo : function (index) {
if (!this.Layers[index]) {
TTOApp.showValidationAlert ("Debug Information not present")
return
}
var op='status=0,toolbar=0,menubar=0,location=0,directories=0,resizable=1,scrollbars=1,width=600'
var dbgWin=window.open("","debugWindow",op);
if(!dbgWin) return
dbgWin.focus()
var d=dbgWin.document
d.writeln('<HTML>')
d.writeln('<HEAD>')
d.writeln('<TITLE>TTO DEBUG WINDOW</TITLE>')
d.writeln('<LINK REL="STYLESHEET" TYPE="text/css" HREF="/css/fonts.css">')
d.writeln('</HEAD>')
d.writeln('<BODY>')
d.writeln(this.Layers[index].innerHTML)
d.writeln('</BODY>')
d.writeln('</HTML>')
}
});
function createPrimitive(ctrl ) {
switch (ctrl.pT){
case 15: return new zGrid(ctrl);
case 18: return new zDlg(ctrl);
case 26: return new zProcessBar(ctrl);
case 28: return new zRefund(ctrl)
case 48: return new zBookmark(ctrl)
case 30: return new zToolbar(ctrl)
case 40: return new zMenu(ctrl)
case 32: return new zTopicSearch(ctrl);
case 24:
case 25: return new zTopicList(ctrl);
case 29: return new zForm(ctrl)
case 44: return new zFMPrim(ctrl)
case 3: return new zAns(ctrl)
case 45: return new zTogglePanel(ctrl)
case 6: return new zSp(ctrl)
case 0: return new zTxt(ctrl)
case 1: return new zTxtBlk(ctrl)
case 8: return new zChk(ctrl)
case 9: return new zRadio(ctrl)
case 4: return new zImg(ctrl)
case 10: return new zEdt(ctrl)
case 2: return new zLnk(ctrl)
case 46: return new zRIA(ctrl)
case 19: return new zDLT(ctrl)
case 13:
case 14: return new zLst(ctrl)
case 12: return new zTxtArea(ctrl)
case 36: return new zJSInfo(ctrl)
case 42:
case 41: return new zIFr(ctrl)
case 34: return new zAds(ctrl)
case 33: return new zMCpy(ctrl)
case 11: return new zFileUpload(ctrl)
case 100: return new zShoppingCart(ctrl)
case 49: return new zSignOut(ctrl)
case 50: if (gbFlashInstalled) return new zRIASwf(ctrl)
else return new zImg(ctrl)
case 51: return new zChart(ctrl)
case 52: return new zLegendRIA(ctrl)
case 53: return new zSeparator(ctrl)
case 54: return new zHelpSummary(ctrl)
case 20:
case 39:
case 47:
default:
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zPrimitiveFactory","Invalid or unsupported primitive type: "+ctrl.pT), LOG_WARNING)
return new zPrm(ctrl)
}
}
zFrmCtrl = zPrm.extend( {
construct : function zFrmCtrl(ctrl){
this.superClass.construct.call(this,ctrl)
this.context = null;
},
initData : function (data){
this.context = data.ctx
this.superClass.initData.call(this,data)
},
_setHdlrs : function ( e){
var t=this
e._prm=t
e.onblur=zFrmCtrlListener
e.onfocus=zFrmCtrlListener
e.onfocusin=zFrmCtrlListener
if (t instanceof zRadio || t instanceof zChk)
e.onclick=zFrmCtrlListener
if (t instanceof zLst)
e.onchange=zFrmCtrlListener;
if(gbMozilla && gbMac && t instanceof zRadio) {
e.onchange=zFrmCtrlListener;
}
},
_setReaderLabel : function ( e, hint){
var t = this
e.title = ""
if(hint&&e)e.setAttribute('aria-label',decodeURIComponent(hint))
if (TTOModel.isTooltipsVisible()) {
e.title = "Element ID: " +this.fID + '\n';
if (t.context) {
var formset = unescape(t.context.form.AgencyId)
var formid = unescape(t.context.form.Id)
var formCopy = t.context.form.Copy
var fileCopyNum = t.context.form.FCN
var formName =unescape( t.context.form.Name)
var fieldId = unescape (t.context.field.Id)
var fieldElement = t.context.field.EN
e.title += "Formset: " + formset + "\n"
e.title += "Form Name: " + formName + "\n"
e.title += "Form ID: " + formid + ":" + formCopy + "\n"
e.title += "File Copy Number: " + fileCopyNum + "\n"
e.title += "Field Id: " + fieldId + ":" + fieldElement + "\n"
}
}
}
});
function zFrmCtrlListener(ne){
var evt=new zEvent(ne)
var e=evt.element
while(e&&!e._prm)e=e.parentNode
if(null==e){evt.cancel();return}
var t=e._prm
if(null==t){evt.cancel();return}
var et=evt.type
if ((et=="click") && (t instanceof zRadio ||t instanceof zChk)) {
if ((t instanceof zChk) && (t._fCtrlID))
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_CtrlElementChange, [t._fCtrlID, e]);
else if (t instanceof zRadio) {
if (isDefined(t.single) && t.single) {
var elemName = t.GetElementName();
var rbtns = document.getElementsByName(elemName);
for (var j=0; j<rbtns.length; j++){
var elem = rbtns[j];
if (!isUndefined(elem)) {
var radioObj = elem._prm;
if (isDefined(radioObj) && radioObj._fCtrlID)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_CtrlElementChange, [radioObj._fCtrlID, elem]);
}
}
}
else if (t._fCtrlID)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_CtrlElementChange, [t._fCtrlID, e]);
}
}
else if ((et=="change") && (t instanceof zLst) && t._fCtrlID)
{
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_CtrlElementChange, [t._fCtrlID, e]);
}
if("blur"==et || et=="click" || et=="change"){
if(t._OnBlur)t._OnBlur(e)
if(t._fDirty) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_InputDataOnPage)
}
else if("focus"==et) {
if(t._OnFocus)t._OnFocus(e)
}
}
zRIA = zPrm.extend( function () {
var _public = {
modalBkgID : null,
construct : function (ctrl) {
var t = this;
this.superClass.construct.call(this, ctrl);
t._fSubmitCallbackObj = null;
t.URL = null;
t.modal = false;
},
getProductID : function () {
return TTOModel.getProductId();
},
getProductName : function () {
return TTOModel.getProductInfo().prodName;
},
Render : function (data) {
var t=this;
if (!data.fileRef) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zRIA","Invalid RIA specification: Missing fileRef", LOG_ERROR));
return;
}
else if (data.component) {
t.URL = '/secure/ria_components/'+unescape(data.component)+"/"+unescape(data.fileRef)+"?"+unescape(data.params);
if (data.name) {
t.name = unescape(data.name);
} else {
t.name = unescape(data.component);
}
} else if (data.URI) {
t.URL = data.URI+"/"+unescape(data.fileRef)+"?"+unescape(data.params);
t.name = t.fID;
} else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zRIA","Invalid RIA specification: Missing component or URI", LOG_ERROR));
return;
}
t.css=data.css;
if (!t.name) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zRIA","name not specified for RIA component with URL:" + t.URL, LOG_ERROR));
}
t._id=zRIA.generateId(t.name);
t.setWidth(data.w?data.w:645);
t.setHeight(data.h?data.h:450);
TTOApp.registerPrimForSubmit(this);
if (data.modal) {
t.modal = true;
t.show(true, data.removeFromDOM, false, data.ch, data.cv,data.closeBtn,data.onCloseCB);
return;
}
var s = "<IFRAME name='"+t._id+"' id='"+t._id+"' noresize scrolling='no' frameborder='no' src='"+t.URL+"' style='width:"+t.GetPixelWidth()+"px; height:"+t.GetPixelHeight()+"px'></IFRAME>";
var tmp=document.createElement("div");
tmp.innerHTML=s;
var e = tmp.firstChild;
e._prm = t;
if ($(t._id)) {
t.fDOMParent.replaceChild(e, $(t._id));
} else {
t.fDOMParent.appendChild(e);
}
MessageHandler.startListener(e);
},
RenderModal : function () {
var t=this;
var s = "<IFRAME name='"+t._id+"' id='"+t._id+"' onload='RIAModalWindow.setFocus();' noresize scrolling='no' frameborder='no' src='"+t.URL+"' style='width:"+t.GetPixelWidth()+"px; height:"+t.GetPixelHeight()+"px'></IFRAME>";
var tmp=document.createElement("DIV");
tmp.innerHTML=s;
var e = tmp.firstChild;
e._prm = t;
return e;
},
SetFocus : function () {
try {
document.getElementById("_ria_modalInnerLayer").focus();
}
catch (err) {}
},
SetDimensions : function ( w, h) {
setDim($(this._id),w,h);
if (this.modal) {
RIAModalWindow.setDimensions(w,h);
}
},
show : function ( bShow,
bRemoveFromDOM,
cb,
ch,
cv,
bCloseBtn ) {
var t = this;
if (bShow) {
RIAModalWindow.clear();
var e = t.RenderModal();
var modalParam = {
content : e,
cb : cb,
css : t.css,
w : t.GetPixelWidth(),
h : t.GetPixelHeight(),
ch : ch,
cv : cv,
closeBtn:bCloseBtn?true:false
};
RIAModalWindow.show(modalParam);
}
else {
if (t._id) {
RIAModalWindow.hide( bRemoveFromDOM);
if (bRemoveFromDOM) {
t._fSubmitCallbackObj = null;
RIAModalWindow.clear();
}
}
}
},
getRenderData : function ( k) {
var val = getParamValue(this.URL,k);
return (val.length > 0)?val:null;
},
GetVal : function () {
var t = this;
var val = null;
if ((t._fSubmitCallbackObj != undefined) && (t._fSubmitCallbackObj != null) && (t._fSubmitCallbackObj.submitCallback)) {
val = t._fSubmitCallbackObj.submitCallback();
}
return val;
},
openWindow : function (url, name, args ) {
if (popupsBlocked()) {
TTOApp.showValidationAlert("Please disable pop-up blockers for TurboTax.com and try again.");
return;
}
if (name && name.length) {
name = name.replace(/ /, '_');
}
try {
riaPopup = window.open(url, name, args);
riaPopup.focus();
TTOApp.registerWindow(riaPopup);
}
catch (ex) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zRIA", "Could not open window popup and set focus", LOG_INFO, ex));
}
},
SetSubmitCallback : function (o) {
this._fSubmitCallbackObj=o;
}
};
return _public;
}());
zRIA.keyValuePair = function( k, v) {
return {
_key : k,
_value : v
};
};
zRIA.generateId = function(o) {
return "__" + o.toLowerCase() + "__";
};
RIAModalWindow = function() {
var _kRIAModalLayerID='_ria_modalLayer';
var _kRIAModalInnerLayerID = '_ria_modalInnerLayer';
var _modalBkgID = null;
var _modalCloseBtn = 'RIAModalClose';
function _getViewPortDimensions() {
var vp = {};
var w = jQuery(window);
var d = jQuery(document);
vp.w = w.width();
vp.h = w.height();
vp.dw = d.width();
vp.dh = d.height();
vp.vs = d.scrollTop();
vp.hs = d.scrollLeft();
return vp;
}
function _render(p) {
var outerLayer = null;
var innerLayer = null;
var css = p.css;
var w = p.w;
var h = p.h;
var noPadding = p.noPadding;
var addCloseBtn = p.closeBtn;
var outerLayerHTML = "<div id='" + _kRIAModalLayerID + "' ";
outerLayerHTML += "class='" + (css ? css : "RIAModalWin") + "'>";
outerLayerHTML += "</div>";
outerLayer = jQuery(outerLayerHTML);
var innerLayerHTML = "<div id='" + _kRIAModalInnerLayerID + "' class='RIAModalWinInner' style='" + (noPadding ? "padding-top:0" : "") + "'></div>";
innerLayer = jQuery(innerLayerHTML);
if(w)
outerLayer.width(w + (noPadding ? 0 : 20));
if(h) {
outerLayer.height(h + (noPadding ? 0 : 20));
}
outerLayer.append(innerLayer);
if(addCloseBtn) {
var closeBtnLayer = document.createElement("div");
closeBtnLayer.className = _modalCloseBtn;
TTO.DU.appendImgLnk(closeBtnLayer, "pon_btn_close_default.png", 32, 32, _modalCloseBtn, "Close",
function() {
RIAModalWindow.hide(true, p.beforeCloseCB);
}, "pon_btn_close_hover.png");
closeBtnLayer.style.display = "none";
outerLayer.append(closeBtnLayer);
}
return outerLayer;
}
function _openWithAnimation( ml, ch, cv, cb, showCloseBtn) {
var w = ml.width();
var h = ml.height();
var vp = _getViewPortDimensions();
var setTopMargin = h >= vp.h;
var startingLeft = ch ? vp.w / 2 : parseInt(ml.css("left")) + w / 2;
var startingTop = 0;
if(cv) {
startingTop = setTopMargin ? (h / 2 + 100) : (vp.h / 2);
}
else {
startingTop = parseInt(ml.css("top")) + h / 2;
}
var endingLeft = startingLeft - w / 2 - 15;
var endingTop = startingTop - h / 2;
ml.css({
'width' : 0,
'height' : 0,
'left' : startingLeft,
'top' : startingTop
});
ml.show().animate({
width : w,
height : h,
left : endingLeft,
top : endingTop
}, {
duration: 650,
specialEasing: {
width: 'easeInOutExpo',
height: 'easeInOutExpo'
},
complete: function() {
if(showCloseBtn)
jQuery("." + _modalCloseBtn).fadeIn(210);
if(cb)
cb();
}
});
}
function _setFocus( id) {
try {
var mlayer = jQuery("#" + _kRIAModalLayerID);
mlayer.show();
if(isDefined(id))
jQuery("#" + id).get(0).focus();
else
mlayer.get(0).focus();
}
catch(e){}
}
return {
show : function ( p) {
if (isUndefined(p.bkgID)) {
_modalBkgID = MODALBKG;
}
else {
_modalBkgID = p.bkgID;
}
var modalbkg = $(_modalBkgID);
var modalLayer = $(_kRIAModalLayerID);
var layer = null;
if (isUndefined(modalLayer)) {
layer = _render(p);
}
if (isUndefined(layer)) {
return;
}
TTO.H.showModalBg(_modalBkgID);
hideProblemLayers(true);
var ml = jQuery(layer).hide().appendTo("body");
var innerLayer = jQuery("#" + _kRIAModalInnerLayerID);
if (innerLayer.length) {
innerLayer.append(p.content);
}
_openWithAnimation(ml, p.ch, p.cv, p.cb, p.closeBtn);
if(p.dismissable) {
jQuery(document).bind("click", RIAModalWindow.handleDismiss);
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ModalWindowExists, true)
},
handleDismiss : function(e) {
var isChild = jQuery(e.target).isChildOf("div.RIAModalWin");
if(!isChild && !jQuery(e.target).is("div.RIAModalWin"))
RIAModalWindow.hide(true);
},
hide : function( bClear, beforeCloseCB) {
if(beforeCloseCB) {
beforeCloseCB();
}
var modalbkg = jQuery("#" + _modalBkgID);
var modalLayer = jQuery("#" + _kRIAModalLayerID);
if (modalLayer.length == 0) {
return;
}
jQuery(document).unbind("click", RIAModalWindow.handleDismiss);
modalLayer.fadeOut(300, function(){
hideProblemLayers(false);
modalbkg.hide();
if (bClear) {
RIAModalWindow.clear();
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ModalWindowExists, false)
});
},
setDimensions : function(w, h) {
var mlayer = jQuery("#" + _kRIAModalLayerID);
if(w) {
mlayer.width(w + 20);
}
if(h) {
mlayer.height(h + 20);
}
},
center : function( e, w, h, ch, cv) {
if(isUndefined(e))
return;
var vp = _getViewPortDimensions();
if(ch)
jQuery(e).css("left", Math.floor(vp.w / 2 - w / 2) + vp.hs + "px");
if(cv)
jQuery(e).css("top", Math.floor(vp.h / 2 - h / 2) + vp.vs + "px");
},
clear : function() {
jQuery("#" + _kRIAModalLayerID).remove();
},
setFocus : function(id) {
_setFocus(id);
},
getViewPortDimensions : function() {
return _getViewPortDimensions();
}
};
}();
kDefaultFPVersion = "9";
kControlID = "controlID";
kApplicationData = "appData";
kDebug = "debug";
kCurrentYear = "taxYear";
kPriorYearUser = "priorYrUser";
kReferrer = "referrer";
kFlashFallbackText = "There's more content on this page, but we're not hiding it on purpose. You just need to use a browser that supports Flash to see it.";
var _zRIASwfObject = null;
var _zRIASwfContainer = null;
zRIASwf = zRIA.extend( function () {
var _public = {
useWmodeTransparent : true,
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
if (this.fID) {
this._swfID = this.fID;
}
},
GetVal : function () {
var val = null;
var swfObj = $(this._swfID);
if (swfObj && swfObj.getSubmitValue) {
val = swfObj.getSubmitValue();
}
return val;
},
Render : function (data) {
var t = this;
if (data.fileRef) {
t.URL = getSWFUrl(unescape(data.fileRef));
if (data.params) {
t.URL += "?" + unescape(data.params);
}
}
else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zRIASwf", "_zRIASwfRender: no swf file specified", true));
return;
}
t.css = data.css;
t.bgColor = data.bgColor;
if (TTOModel.isAccessible()) {
t.useWmodeTransparent = false;
}
if (!data.doNotRegister) {
TTOApp.registerPrimForSubmit(this);
}
t._id = zRIA.generateId(t.fID);
t._swfID = t.fID;
if (t.flashParams) {
t.flashParams = [];
}
if (t.useWmodeTransparent) {
t.addParam('wmode', 'transparent');
}
t.addParam('allowscriptaccess', 'always');
t.addVariable(kControlID, t._id);
t.addVariable(kCurrentYear, "2011");
t.addVariable(kApplicationData, escape(getFlashAppData()));
t.addVariable(kDebug, (TTOModel.isQA()));
t.addVariable(kPriorYearUser, (TTOModel.isPriorYrUser()));
t.addVariable(kReferrer, (TTOModel.getReferrer()));
t.flashVer = data.fv ? data.fv : kDefaultFPVersion;
if (data.w) {
t.setWidth(data.w);
}
if (data.h) {
t.setHeight(data.h);
}
if (data.modal) {
var h = isDefined(data.ch) ? data.ch : true;
var v = isDefined(data.cv) ? data.cv : true;
var mb = isDefined(data.mb) ? data.mb : true;
t.showModal(true, h, v, mb);
try {
document.getElementById(t._swfID).focus();
}
catch (err) {
;
}
return;
}
if ($(t._id)) {
_zRIASwfContainer = $(t._id);
_zRIASwfContainer.innerHTML = "";
}
else {
_zRIASwfContainer = document.createElement("div");
_zRIASwfContainer.id = t._id;
t.fDOMParent.appendChild(_zRIASwfContainer);
}
var swf = document.createElement("div");
swf.id = t._swfID;
_zRIASwfContainer.appendChild(swf);
if (t.css) {
_zRIASwfContainer.className = t.css;
}
_zRIASwfContainer._prm = t;
this.embedFlash();
},
RenderModal : function () {
var t = this;
_zRIASwfContainer = document.createElement("div");
_zRIASwfContainer.id = t._id;
_zRIASwfContainer._prm = t;
var swf = document.createElement("div");
swf.id = t._swfID;
_zRIASwfContainer.appendChild(swf);
return _zRIASwfContainer;
},
showModal : function ( bShow, ch,
cv, use_mbkg) {
var t=this;
if (bShow) {
var container = this.RenderModal();
if (!container) {
return;
}
RIASwfModalWindow.show(container, t.css, t.GetPixelWidth(), t.GetPixelHeight(), ch, cv, use_mbkg);
this.embedFlash();
}
else {
RIASwfModalWindow.hide();
}
},
checkForFlashPlayer : function ( swfObj, expInst,
fpVer) {
if (!swfObj) {
return false;
}
if (!swfObj.getFlashPlayerVersion) {
return false;
}
;
if (expInst) {
if ((swfObj.getFlashPlayerVersion().major < 6) || (swfObj.getFlashPlayerVersion().major == 6 && swfObj.getFlashPlayerVersion().rev < 65)) {
showGetFlashPlayerNotice();
return false;
}
return true;
}
if (!fpVer) {
fpVer = kDefaultFPVersion;
}
if (swfObj.getFlashPlayerVersion().major < fpVer) {
showGetFlashPlayerNotice();
return false;
}
return true;
},
addParam : function (n,v) {
var t=this;
if (!t.flashParams) {
t.flashParams = [];
}
t.flashParams.push(zRIA.keyValuePair(n,v));
},
addVariable : function (n, v) {
var t=this;
if (!t.flashVars) {
t.flashVars = [];
}
t.flashVars.push(zRIA.keyValuePair(n,v));
},
_addParamsToSWF : function (paramsObject) {
var len = this.flashParams ? this.flashParams.length : 0;
if (len) {
var i;
for (i = 0; i < len; i++) {
var _riaKeyValuePair = this.flashParams[i];
if (_riaKeyValuePair && _riaKeyValuePair._key && _riaKeyValuePair._value) {
paramsObject[_riaKeyValuePair._key] = _riaKeyValuePair._value;
}
}
}
},
_addVariablesToSWF : function (varsObj) {
var len = this.flashVars ? this.flashVars.length : 0;
if (len) {
var i;
for (i = 0; i < len; i++) {
var _riaKeyValuePair = this.flashVars[i];
if (_riaKeyValuePair && _riaKeyValuePair._key && _riaKeyValuePair._value) {
varsObj[_riaKeyValuePair._key] = _riaKeyValuePair._value;
}
}
}
},
addFlashFallbackText : function (flashContainerDiv) {
var fallbackDiv = document.createElement("div");
fallbackDiv.className = "Flashfallback";
var fallbackText = document.createTextNode(kFlashFallbackText);
fallbackDiv.appendChild(fallbackText);
flashContainerDiv.appendChild(fallbackDiv);
},
embedFlash : function () {
var t = this;
var params = {};
var vars = {};
t._addParamsToSWF(params);
t._addVariablesToSWF(vars);
swfobject.embedSWF(t.URL, t._swfID, t.GetPixelWidth(), t.GetPixelHeight(), t.flashVer, '/flash/expressinstall.swf', vars, params);
},
isOKToSubmit : function () {
var swfObj = $(this._swfID);
if (swfObj && swfObj.isOKToSubmit) {
return swfObj.isOKToSubmit();
} else {
return true;
}
}
};
return _public;
}());
RIASwfModalWindow = function() {
var _public = {
modalBkgID : null,
show : function ( content, css_class,
w, h, ch,
cv, use_mbkg) {
_modalHTMLContent = content;
RIASwfModalWindow.modalBkgID = MODALBKG;
var modalbkg = $(RIASwfModalWindow.modalBkgID);
var appendModalLayer = false;
var modalLayer = $(kRIASwfModalLayerID);
if (!modalLayer) {
modalLayer = document.createElement("DIV");
modalLayer.id = kRIASwfModalLayerID;
appendModalLayer = true;
modalLayer.className = css_class ? css_class : 'defaultModalSwf';
}
if (ch) {
RIAModalWindow.center(modalLayer, w, h, true, false);
}
if (cv) {
RIAModalWindow.center(modalLayer, w, h, false, true);
}
if (use_mbkg) {
TTO.H.showModalBg();
}
var mL = $('modalLayer');
if (mL) {
mL.style.display = 'none';
}
hideProblemLayers(true);
if (appendModalLayer) {
document.body.appendChild(modalLayer);
}
modalLayer.appendChild(_modalHTMLContent);
},
hide : function () {
var modalbkg = $(RIASwfModalWindow.modalBkgID);
var modalLayer = $(kRIASwfModalLayerID);
if (isUndefined(modalLayer)) {
return;
}
hide(modalLayer);
jQuery(modalbkg).hide();
RIASwfModalWindow._clear();
var mL = $('modalLayer');
if (mL) {
mL.style.display = 'block';
}
hideProblemLayers(false);
},
_clear : function () {
var modalLayer = $(kRIASwfModalLayerID);
if (isUndefined(modalLayer)) {
return;
}
if (isDefined(_modalHTMLContent)) {
modalLayer.removeChild(modalLayer.lastChild);
_modalHTMLContent = null;
}
document.body.removeChild(modalLayer);
}
};
var kRIASwfModalLayerID='_ria_swfmodalLayer';
var _modalHTMLContent = null;
return _public;
}();
function _ei_handleSessionEvent(sessionEvtObj) {
;
TTOController.handleSessionEvent(sessionEvtObj);
}
function getFlashAppData() {
var postObj = "{";
postObj += '"uid":"'+TTOModel.getUserId()+'",';
postObj += '"prodid":"'+TTOModel.getProductId()+'",';
postObj += '"csrc":"'+TTOModel.getCustomerSrc()+'",';
postObj += '"app":"'+TTOModel.getAppData().taxserver+'",';
postObj += '"ws":"'+TTOModel.getAppData().webserver+'",';
postObj += '"pt":"'+TTOModel.getAppData().port+'"';
postObj += "}";
return postObj;
}
function _ei_doSubmit() {
return Submit();
}
function _ei_getPrimValue(ctrlID, name ) {
;
var e = document.getElementById(ctrlID);
if (e!=undefined && e!=null)
{
if (e._prm!=undefined && e._prm!=null)
{
return e._prm[name];
}
}
}
kBookmarkCSS = "SwfBookmark";
kBookmarkId = "__bkm_00__";
kMaxBookmarksShowing = 3;
kBkmEntryHeight = 44;
var _zBookmarkList = [];
zBookmark = zRIASwf.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this,ctrl);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, function() {zBookmark.hideBookmark();}, this);
},
GetVal : zPrm.prototype.GetVal,
Render : function() {
},
show : function(bShow) {
var t = this;
var bkm = $(kBookmarkId);
var jbkm = !!bkm ? jQuery(bkm) : null;
if(!bShow) {
zBookmark.hideBookmark();
return;
}
jQuery(document).bind("click", zBookmark.hideBookmarkIfDismissed);
if(!jbkm) {
jbkm = jQuery("<div id='" + kBookmarkId + "'></div>").appendTo("#ttoContainer");
jbkm.addClass(kBookmarkCSS);
jbkm.hide();
var bkmBody = "<div id='bkmContainer'>" +
"<div id='bkmTop'>" +
"<div class='bkmLogo'>" +
"Flags" +
"</div>" +
"<div id='bkmAddBtn' class='addBtnInactive'>Add</div>" +
"<div class='clearDiv' />" +
"</div>" +
"<div id='bkmConfirmScreen'>" +
"<div>Delete this flag?</div>" +
"<div style='width:120px;margin:0 auto;'>" +
"<div id='bkmDelConfirmYes' class='btnActive' style='float:left;'>Yes</div><div id='bkmDelConfirmNo' class='btnActive' style='float:right;'>No</div>" +
"<div class='clearDiv' />" +
"</div>" +
"</div>" +
"<div id='bkmMessage'>" +
"Add a flag to come back later." +
"</div>" +
"<div id='bkmContent'></div>" +
"<div id='bkmShowAll'>" +
"<div>Show all flags</div>" +
"</div>" +
"<div id='bkmAddScreen'>" +
"<div id='bkmAddScreenMsg'>" +
"</div>" +
"<div class='addScreenEntry label'>" +
"Title" +
"</div>" +
"<div class='addScreenEntry'>" +
"<input id='bkmName' type='text' width='100%' style='height:12px;' maxlength='32' />" +
"</div>" +
"<div class='addScreenEntry label'>" +
"Notes" +
"</div>" +
"<div class='addScreenEntry'>" +
"<textarea id='bkmDesc' rows='4' /><br />" +
"</div>" +
"<div class='footer'>" +
"<div id='bkm_cancel' class='btnActive' style='float:left;'>" +
"Cancel" +
"</div>" +
"<div id='bkm_save' class='btnActive' style='float:right;'>" +
"Save" +
"</div>" +
"<div class='clearDiv' />" +
"</div>" +
"</div>" +
"</div>";
jbkm.html(bkmBody);
jQuery("#bkm_cancel").click(function() {
jQuery("#bkmAddScreen").fadeOut(200);
jQuery("#bkmContent").fadeIn(200);
if(_zBookmarkList.length > kMaxBookmarksShowing) {
var contentDiv = jQuery("#bkmContent");
contentDiv.css("max-height", kMaxBookmarksShowing * kBkmEntryHeight + "px");
jQuery("#bkmShowAll").show();
}
});
jQuery("#bkm_save").click(function() {
t._zBookmarkOnSave();
});
jQuery("#bkmShowAll").click(function() {
jQuery("#bkmShowAll").hide();
jQuery("#bkmContent").css("max-height", "none");
});
jQuery("#bkmDesc").unbind("keypress").keypress(function(e) {
if(e.which !== 8 && e.which !== 0 && jQuery(this).val().length >= 64) {
e.preventDefault();
}
});
}
else {
if(jbkm.css("display") != "none") {
jbkm.fadeOut(200);
return;
}
}
var MR = new AjaxSequencer();
MR.addRequest(TTOService.kAJAX_GetBookmarkList, null, t._zBookmarkOnGetBookmarkList);
MR.send();
var topSection = jQuery("#bkmTop");
var addScreen = jQuery("#bkmAddScreen");
var contentScreen = jQuery("#bkmContent");
var confirmScreen = jQuery("#bkmConfirmScreen");
topSection.show();
addScreen.hide();
contentScreen.hide();
confirmScreen.hide();
jbkm.fadeIn(250);
},
_zBookmarkOnSave : function() {
var t = this;
var bookmarkName = jQuery.trim(jQuery("#bkmName").val());
var bookmarkDesc = jQuery.trim(jQuery("#bkmDesc").val());
var transferData = bookmarkName + ";" + bookmarkDesc;
if(bookmarkName.length == 0) {
var msgDiv = jQuery("#bkmAddScreenMsg");
msgDiv.html("Title cannot be empty.");
msgDiv.fadeIn(200);
return;
}
for(var i = 0; i < _zBookmarkList.length; i++) {
if(bookmarkName == unescape(_zBookmarkList[i].name)) {
var msgDiv = jQuery("#bkmAddScreenMsg");
msgDiv.html("This title already exists.");
msgDiv.fadeIn(200);
return;
}
}
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"Save bookmark","Bookmark")
}
var MR = new AjaxSequencer();
MR.addRequest(TTOService.kAJAX_SetBookmark, transferData, function(resp) {
var json = resp.responseJSON;
_zBookmarkList = json.bookmarks;
zBookmark.refreshListUI();
});
MR.send();
},
_zBookmarkOnGetBookmarkList : function(resp) {
var json = resp.responseJSON;
_zBookmarkList = json.bookmarks;
var jbkm = jQuery("#__bkm_00__");
var addBtn = jQuery("#bkmAddBtn");
jQuery("#bkmContent").html("");
if(json.disableBookmark) {
addBtn.removeClass().addClass("addBtnInactive");
addBtn.unbind();
addBtn.attr("title", "You cannot add a flag here.");
}
else {
addBtn.removeClass().addClass("addBtnActive");
addBtn.capture("click", function() {
zBookmark.showAddScreen();
});
addBtn.removeAttr("title");
}
zBookmark.refreshListUI();
}
}, {
getBookmarkURL : function() {
TTOController.ajaxToApp(TTOService.kAJAX_GetBookmarkURL,null,zBookmark.handleGetBookmarkURL)
},
handleGetBookmarkURL : function(respTO) {
var kTTOUrl=""
if (TTOModel.isQA())
kTTOUrl="https:\/\/"+location.hostname+"/open/registration/Start.htm?prodData=<BOOKMARK>&productid="+TTOModel.getProductId()
else
kTTOUrl="http://turbotaxweb.turbotaxonline.intuit.com/open/registration/SignIn.htm?prodData=<BOOKMARK>&productid="+TTOModel.getProductId()
data = respTO.responseJSON
if (data && data.error)
TTOApp.showValidationAlert("Flags are not allowed on this page. \n\nerror: "+data.error)
else if (data && data.url) {
prompt ("Bookmark for this page", data.url)
}
},
hideBookmark : function() {
var bookmark = $(kBookmarkId);
var jbkm = !!bookmark ? jQuery(bookmark) : null;
if(jbkm && jbkm.css("display") != "none")
jbkm.fadeOut(200, function() {
jQuery(document).unbind("click", zBookmark.hideBookmarkIfDismissed);
});
},
hideBookmarkIfDismissed : function(e) {
var isChild = jQuery(e.target).isChildOf("div.SwfBookmark");
if(!isChild)
zBookmark.hideBookmark();
},
navigateToBookmark : function( name, fsId, isAct) {
var bkm = TTOApp.findCtrlByType(48)
if (isUndefined(bkm))
return;
if(!isAct){
TTOApp.showValidationAlert("The state has been deleted, so this flag no longer exists.")
}
else if((fsId!=null && fsId.length>0 && fsId.toUpperCase().indexOf("US1040")<0) && (top.TTOModel.isFed() || ( !top.TTOModel.isFed() && fsId!=top.TTOModel.getDialogInfo().curFS))){
TTOApp.showValidationAlert("Please go back to your state return to see this flag.")
}else if (name){
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"Use bookmark","Bookmark")
}
bkm.SetVal(unescape(name));
Submit();
}
bkm.ClearVal()
},
nav_jump_Bookmark_ClickHandler : function( fsId, intrvwType, topic)
{
var bkm = TTOApp.findCtrlByType(48)
var url = "helpJumpToURL:active=true&formsetID="+fsId.toUpperCase()+"&interviewType="+intrvwType.toUpperCase()+"&topic="+topic.toUpperCase()+"&view=kEasyStepManager";
bkm.SetVal(url);
Submit();
bkm.ClearVal()
},
jumpTo_BookmarkURL_ClickHandler : function( bkmURL)
{
var bkm = TTOApp.findCtrlByType(48)
var url = "helpJumpToURL:"+bkmURL;
bkm.SetVal(url);
Submit();
bkm.ClearVal()
},
showAddScreen : function()
{
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"Add bookmark","Bookmark")
}
var addScreen = jQuery("#bkmAddScreen");
var contentScreen = jQuery("#bkmContent");
var msgDiv = jQuery("#bkmAddScreenMsg");
var showAllBookmarksDiv = jQuery("#bkmShowAll");
jQuery("#bkmName").val("");
jQuery("#bkmDesc").val("");
msgDiv.hide();
showAllBookmarksDiv.hide();
contentScreen.hide();
addScreen.fadeIn(300);
},
refreshListUI : function()
{
var addScreen = jQuery("#bkmAddScreen");
var _shorten = function(str, len) {
if(str.length <= len)
return str;
return str.substring(0, len) + "..";
}
if(addScreen.css("display") != "none")
addScreen.hide();
var contentDiv = jQuery("#bkmContent");
contentDiv.css("max-height", kMaxBookmarksShowing * kBkmEntryHeight + "px");
var bkmlistui = "";
var bookmarklistlen = _zBookmarkList.length;
if(bookmarklistlen > 0)
jQuery("#bkmMessage").hide();
else
jQuery("#bkmMessage").show();
for(var i = 0; i < bookmarklistlen; i++) {
var bookmarkName = decodeURIComponent(_zBookmarkList[i].name);
var bookmarkNotes = decodeURIComponent(_zBookmarkList[i].notes);
bkmlistui += "<div class='bkmEntry'>";
bkmlistui += "<div class='left'>";
bkmlistui += "<div class='title' data='" + _zBookmarkList[i].name + "' title='" + bookmarkName + "'>" + _shorten(bookmarkName, 16) + "</div>";
bkmlistui += "<div title='" + bookmarkNotes + "'>" + _shorten(bookmarkNotes, 16) + "</div>";
bkmlistui += "</div>";
bkmlistui += "<div class='right'>";
bkmlistui += "<div class='delImg' />";
bkmlistui += "</div>";
bkmlistui += "<div class='clearDiv' />";
bkmlistui += "</div>";
bkmlistui += "<div class='bkmEntryBottom' />";
}
contentDiv.html(bkmlistui);
jQuery(".bkmEntry .delImg").capture("click", function() {
var delbkmName = unescape(jQuery(this).parent().prev().children(".title").attr("data"));
jQuery("#bkmTop").hide();
jQuery("#bkmDelConfirmYes").capture("click", function() {
var MR = new AjaxSequencer();
MR.addRequest(TTOService.kAJAX_DeleteBookmark, delbkmName, function(resp) {
var json = resp.responseJSON;
if(json && json.error)
alert("Cannot delete flag. Please try again later.");
else {
_zBookmarkList = json.bookmarks;
zBookmark.refreshListUI();
jQuery("#bkmConfirmScreen").hide();
jQuery("#bkmTop").show();
}
});
MR.send();
});
jQuery("#bkmDelConfirmNo").capture("click", function() {
jQuery("#bkmConfirmScreen").hide();
jQuery("#bkmTop").show();
});
jQuery("#bkmConfirmScreen").fadeIn(150);
});
jQuery(".bkmEntry .left .title").capture("click", function() {
var bkmName = unescape(jQuery(this).attr("data"));
for(var i = 0; i < bookmarklistlen; i++) {
if(unescape(_zBookmarkList[i].name) == bkmName) {
zBookmark.navigateToBookmark(bkmName, _zBookmarkList[i].formsetID, _zBookmarkList[i].active);
}
}
});
if(_zBookmarkList.length > kMaxBookmarksShowing) {
jQuery("#bkmShowAll").show();
}
else {
jQuery("#bkmShowAll").hide();
}
contentDiv.fadeIn(250);
}
});
kProcessBarMinTabWidth= 75
kHome='Home'
function zProcessBar(ctrl){
var t=this
zPrm.call(this,ctrl)
t._fCategories = new Array();
t._fSubItems = new Array();
t._fPreSubItems = new Array();
t.TLayer = null;
t.SNLayer = null;
t._fCur=0
t._fCurSI=0
t.fbDirty=true
t.fbRendered=false
}
function _zspbLayout(TabL, SubNL){
this.TLayer = TabL
this.SNLayer = SubNL
}
function _zspbSetItems(items)
{
var t=this
var catNum = -1;
t._fCategories = new Array();
t._fSubItems = new Array();
t._fPreSubItems = new Array();
for (var i=0; i<items.length; i++)
{
var o = new Object();
o.text = items[i].d
o.visited = items[i].v;
o.idx = i;
if (items[i].c){
t._fCategories.push(o);
catNum++;
var s = new Array();
t._fSubItems.push(s);
}
else if (catNum == -1){
t._fPreSubItems.push(o);
}
else {
t._fSubItems[catNum].push(o);
}
}
}
function _zspbRender(data ){
if (isUndefined(data)) return
var t=this
var bReRender=false
if(isDefined(data.ci) && t._fCur!=data.ci){
bReRender=true
t._fCur = (data.ci=="null") ? 0 : data.ci;
}
if (t._fCurSI != data.si && t.fbRendered) {
t._fCurSI = (data.si=="null") ? null : data.si;
t._renderSubItems()
}
if (data.items) {
t._setItems(data.items)
bReRender = true
}
if (bReRender) {
t.fbDirty=true
t._renderItems()
}
}
function _zspbRenderItems(){
var t=this
if(null==t._fCategories)return
if (!t.fbDirty) return
var p = t.TLayer
var d=document
TTO.DU.clearKids(p)
var tb = d.createElement("ul")
p.appendChild(tb);
for(i=0;i<t._fCategories.length;i++){
var itm = d.createElement('li')
var lnk= null
itm.className=(t._fCur==i)?'on':''
tb.appendChild(itm)
if (!TTOModel.isFFA() && kHome ==t._fCategories[i].text) {
var lnk=TTO.DU.appendLink( itm, null, null)
TTO.DU.appendSp(lnk,5)
TTO.DU.appendText(lnk,kHome)
}
else {
lnk = TTO.DU.appendLink(itm,t._fCategories[i].text)
}
lnk._pbar=true;
lnk._prm=t
lnk._index=t._fCategories[i].idx
lnk.id = "cat"+i
lnk.category=true
lnk.onclick=zspbClickListener
}
t._renderSubItems()
t.fbDirty=false
t.fbRendered=true
}
function _zspbRenderSubItems()
{
var t=this
if (null==t._fCur) return
var p = t.SNLayer
var d = document;
TTO.DU.clearKids(p)
var si = t._fSubItems[t._fCur]
var sn = d.createElement("ul")
p.appendChild(sn);
if (isDefined(si)) {
for (var i=0; i<si.length; i++) {
var itm = d.createElement('li')
itm.className=(t._fCurSI==i)?'on':''
sn.appendChild(itm)
var nobr = d.createElement('nobr')
itm.appendChild(nobr)
var lnk = TTO.DU.appendLink(nobr,si[i].text)
lnk.id = "sub"+i
lnk._pbar=true
lnk._prm=t
lnk.onclick=zspbClickListener
lnk._index=si[i].idx
}
}
}
function zspbClickListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._pbar) e=e.parentNode
if(!e) return
evt.cancel()
var t=e._prm
if (TTOApp.isOKToSubmit()) {
if (e.category) {
var newTabId = e.id
t._fCur = parseInt(newTabId.substring(newTabId.indexOf("cat")+3,newTabId.length))
t.fbDirty=true
t._renderItems()
}
t.SetVal(e._index)
TTOApp.registerPrimForSubmit(t);
if (!Submit()) {
t.ClearVal()
}
}
}
function _zspbGetCurCat()
{
if(null==this._fCur) return ""
return this._fCategories[this._fCur].text;
}
function _zspbGetCurSubItem()
{
if((null==this._fCur)||(null==this._fCurSI)) return ""
return this._fSubItems[this._fCur][this._fCurSI].text
}
function _zspbGetCurIndex(){
var t=this
return t._fCur
}
function _zspbGetCurSIIndex(){
var t=this
return t._fCurSI
}
zProcessBar.prototype=new zPrm()
p=zProcessBar.prototype
p.constructor=zProcessBar
p.setLayout=_zspbLayout
p.Render=_zspbRender
p.getCurCat=_zspbGetCurCat
p.getCurSubItem=_zspbGetCurSubItem
p.getCurIndex=_zspbGetCurIndex
p.getCurSIIndex=_zspbGetCurSIIndex
p._setItems=_zspbSetItems
p._renderItems=_zspbRenderItems
p._renderSubItems=_zspbRenderSubItems
p=null
var kFedRBId = "fedRefundBlock";
var kStateRBId = "stateRefundBlock";
var kCombinedRBId = "combinedRefundBlock";
var kStateInnerContainerId = "stateInnerContainer";
var kFedLabelId = "fedLabel";
var kFedAmountId = "fedAmount";
var kStateLabelId = "stateLabel";
var kStateAmountId = "stateAmount";
var kStateRightArrowId = "stateRightArrow";
var kStateLeftArrowId = "stateLeftArrow";
var kCombinedLabelId = "combinedLabel";
var kCombinedAmountId = "combinedAmount";
function RefundManager() {
this.refundPrmList = new Array();
this.history = {};
this.fedPrm = null;
this.isInSpecificState = false;
this.currentStateIndex = 0;
this.currentProductId = -1;
this.oldStateAmt = null;
this.currentFS = "";
this.parseAmt = function(amt) {
if(amt.indexOf("$") >= 0 && amt.length > 1)
return parseInt(amt.substring(1).replace(/,/g, ""));
else
return amt;
};
this.isFed = function(prm) {
if(prm.label.indexOf("Fed")>=0)
return true;
else
return false;
};
this.getRfndAmtTotal = function() {
var amtTotal = 0;
if(this.fedPrm){
if (this.fedPrm.isRefund != 1){
amtTotal -= this.parseAmt(this.fedPrm.amt);
}else{
amtTotal += this.parseAmt(this.fedPrm.amt);
}
}
for(var i=0; i<this.refundPrmList.length; i++) {
if(this.refundPrmList[i].isRefund != 1)
amtTotal -= this.parseAmt(this.refundPrmList[i].amt);
else
amtTotal += this.parseAmt(this.refundPrmList[i].amt);
}
return amtTotal;
};
this.getFedRfndAmt = function() {
var fedAmt = 0;
if(this.fedPrm){
if (this.fedPrm.isRefund != 1){
fedAmt -= this.parseAmt(this.fedPrm.amt);
}else{
fedAmt += this.parseAmt(this.fedPrm.amt);
}
}
return fedAmt;
};
this.getRfndAmt = function(fsid) {
var amt = "0";
var prm = null;
if(fsid.indexOf("US")>=0) {
prm = this.fedPrm;
}
else {
for(var i=0; i<this.refundPrmList.length; i++) {
if(this.refundPrmList[i].fsid == fsid) {
prm = this.refundPrmList[i];
}
}
}
if(prm) {
if(prm.isRefund != 1)
amt = "-" + prm.amt;
else
amt = prm.amt;
}
return amt;
};
this.handleClick = function(blockId) {
var prodId = TTOModel.getProductId();
var prmFound = null;
if (!gbFlashInstalled) return;
if(prodId == 4) {
prmFound = this.refundPrmList[this.currentStateIndex];
}
else {
if(blockId == kFedRBId) {
prmFound = this.fedPrm;
}
else {
prmFound = this.refundPrmList[this.currentStateIndex];
}
}
if(!prmFound)
return;
if(TTOApp.isOKToSubmit() && prmFound._enabled) {
TransitionMsg.setMessage( 'Retrieving your Tax Summary')
prmFound.SetVal(1);
Submit();
prmFound.ClearVal();
}
};
this.showAmt = function(currentLabelDiv, currentAmountDiv, prm, doNotAnimate) {
var prodId = TTOModel.getProductId();
var oldAmtText = currentAmountDiv.innerHTML;
if(prm.isRefund) {
currentAmountDiv.className = "refundAmountPositive";
}
else {
currentAmountDiv.className = "refundAmountNegative";
}
currentLabelDiv.innerHTML = prm.label;
if(TTOModel.getDialogInfo().curFS == prm.fsid && oldAmtText != "" && !doNotAnimate) {
if(this.currentFS != TTOModel.getDialogInfo().curFS) {
this.currentFS = TTOModel.getDialogInfo().curFS;
currentAmountDiv.innerHTML = prm.amt;
this.oldStateAmt == prm.amt
return;
}
if(!this.isFed(prm) && prodId != 4) {
if(!this.oldStateAmt || this.oldStateAmt == prm.amt) {
currentAmountDiv.innerHTML = prm.amt;
this.oldStateAmt = prm.amt;
return;
}
else {
oldAmtText = this.oldStateAmt;
this.oldStateAmt = prm.amt;
}
}
var stepSize = Math.floor(Math.abs(this.parseAmt(oldAmtText) - this.parseAmt(prm.amt)) / 20);
if(stepSize == 0)
stepSize = 1;
this.scrollAmt(currentAmountDiv, this.parseAmt(oldAmtText), this.parseAmt(prm.amt), this.isScrollUp(oldAmtText, prm.amt), stepSize);
}
else {
currentAmountDiv.innerHTML = prm.amt;
}
};
this.updateLeftRightArrow = function(showLeft, showRight) {
if(showLeft) {
$(kStateLeftArrowId).style.display = "inline";
}
else {
$(kStateLeftArrowId).style.display = "none";
}
if(showRight) {
$(kStateRightArrowId).style.display = "inline";
}
else {
$(kStateRightArrowId).style.display = "none";
}
};
this.changeState = function( left) {
var ci = this.currentStateIndex;
var that = this;
var currentLabelDiv = (TTOModel.getProductId() == 4) ? $(kCombinedLabelId) : $(kStateLabelId);
var currentAmountDiv = (TTOModel.getProductId() == 4) ? $(kCombinedAmountId) : $(kStateAmountId);
if(left) {
if(ci > 0) {
var prm = this.refundPrmList[ci-1];
this.showAmt(currentLabelDiv, currentAmountDiv, prm, true);
this.currentStateIndex--;
jQuery.easing.def = "easeInExpo";
jQuery("#" + kStateInnerContainerId).css("opacity", "0");
jQuery("#" + kStateInnerContainerId).css("left", "-110px");
jQuery("#" + kStateInnerContainerId).animate({
opacity: 1,
left: "0"
},350, function() {
that.updateLeftRightArrow((that.currentStateIndex > 0) ? true:false, true);
});
}
}
else {
if(ci < (this.refundPrmList.length - 1)) {
var prm = this.refundPrmList[ci+1];
this.showAmt(currentLabelDiv, currentAmountDiv, prm, true);
this.currentStateIndex++;
jQuery.easing.def = "easeInExpo";
jQuery("#" + kStateInnerContainerId).css("opacity", "0");
jQuery("#" + kStateInnerContainerId).css("left", "110px");
jQuery("#" + kStateInnerContainerId).animate({
opacity: 1,
left: "0"
},350, function() {
that.updateLeftRightArrow(true, (that.currentStateIndex < (that.refundPrmList.length - 1)) ? true:false);
});
}
}
};
this.setProductId = function(prodId) {
if(prodId == this.currentProductId)
return;
this.currentProductId = prodId;
if(prodId == 4) {
if($(kCombinedRBId)) {
return;
}
if($(kFedRBId)) {
var fedDiv = $(kFedRBId);
fedDiv.parentNode.removeChild(fedDiv);
}
if($(kStateRBId)) {
var stateDiv = $(kStateRBId);
stateDiv.id = kCombinedRBId;
stateDiv.className = "refundBlockFree";
stateDiv.style.display = "block";
if($(kStateLabelId))
$(kStateLabelId).id = kCombinedLabelId;
if($(kStateAmountId)) {
$(kStateAmountId).onclick = function() {
RefundManager.getInstance().handleClick(kCombinedRBId);
};
$(kStateAmountId).id = kCombinedAmountId;
}
}
else {
this.createCombinedRMLayout();
}
}
else {
if($(kStateRBId) && $(kFedRBId)) {
return;
}
if($(kCombinedRBId)) {
var combinedDiv = $(kCombinedRBId);
if(this.refundPrmList.length > 0) {
combinedDiv.id = kStateRBId;
combinedDiv.className = "refundBlock";
if($(kCombinedLabelId))
$(kCombinedLabelId).id = kStateLabelId;
if($(kCombinedAmountId)) {
$(kCombinedAmountId).onclick = function() {
RefundManager.getInstance().handleClick(kStateRBId);
};
$(kCombinedAmountId).id = kStateAmountId;
}
this.createFedRMLayout();
}
else {
combinedDiv.parentNode.removeChild(combinedDiv);
this.createFedStateRMLayout();
}
}
else {
this.createFedStateRMLayout();
}
}
this.isInSpecificState = false;
};
this.removeAllRMDOMElements = function() {
if($(kStateRBId)) {
var stateDiv = $(kStateRBId);
stateDiv.parentNode.removeChild(stateDiv);
}
if($(kFedRBId)) {
var fedDiv = $(kFedRBId);
fedDiv.parentNode.removeChild(fedDiv);
}
if($(kCombinedRBId)) {
var combinedDiv = $(kFedRBId);
combinedDiv.parentNode.removeChild(combinedDiv);
}
}
this.createFedRMLayout = function() {
var fedDiv = document.createElement("div");
fedDiv.id = kFedRBId;
fedDiv.className = "refundBlock";
var fedLabelDiv = document.createElement("div");
fedLabelDiv.id = kFedLabelId;
fedDiv.appendChild(fedLabelDiv);
var fedAmountDiv = document.createElement("div");
fedAmountDiv.id = kFedAmountId;
fedAmountDiv.onclick = function() {
RefundManager.getInstance().handleClick(kFedRBId);
};
fedDiv.appendChild(fedAmountDiv);
$('refundLayer').appendChild(fedDiv);
};
this.createFedStateRMLayout = function() {
var that = this;
var stateDiv = document.createElement("div");
stateDiv.id = kStateRBId;
stateDiv.className = "refundBlock";
stateDiv.style.display = "none";
var stateDivInnerContainer = document.createElement("div");
stateDivInnerContainer.className = "refundStateContainer";
stateDivInnerContainer.id = kStateInnerContainerId;
var stateLabelDiv = document.createElement("div");
stateLabelDiv.id = kStateLabelId;
stateDivInnerContainer.appendChild(stateLabelDiv);
var stateAmountDiv = document.createElement("div");
stateAmountDiv.id = kStateAmountId;
stateAmountDiv.onclick = function() {
RefundManager.getInstance().handleClick(kStateRBId);
};
stateDivInnerContainer.appendChild(stateAmountDiv);
var stateRightArrowDiv = document.createElement("div");
stateRightArrowDiv.id = kStateRightArrowId;
stateRightArrowDiv.className = "refundStateRightArrow";
stateRightArrowDiv.onclick = function() {
that.changeState(false);
};
var stateRightArrowTextNode = document.createTextNode(">");
stateRightArrowDiv.appendChild(stateRightArrowTextNode);
var stateLeftArrowDiv = document.createElement("div");
stateLeftArrowDiv.id = kStateLeftArrowId;
stateLeftArrowDiv.className = "refundStateLeftArrow";
stateLeftArrowDiv.onclick = function() {
that.changeState(true);
};
var stateLeftArrowTextNode = document.createTextNode("<");
stateLeftArrowDiv.appendChild(stateLeftArrowTextNode);
stateDiv.appendChild(stateDivInnerContainer);
stateDiv.appendChild(stateLeftArrowDiv);
stateDiv.appendChild(stateRightArrowDiv);
$("refundLayer").appendChild(stateDiv);
this.createFedRMLayout();
};
this.createCombinedRMLayout = function() {
var that = this;
var combinedDiv = document.createElement("div");
combinedDiv.id = kCombinedRBId;
combinedDiv.className = "refundBlockFree";
var stateDivInnerContainer = document.createElement("div");
stateDivInnerContainer.className = "refundStateContainer";
stateDivInnerContainer.id = kStateInnerContainerId;
var combinedLabelDiv = document.createElement("div");
combinedLabelDiv.id = kCombinedLabelId;
stateDivInnerContainer.appendChild(combinedLabelDiv);
var combinedAmountDiv = document.createElement("div");
combinedAmountDiv.id = kCombinedAmountId;
combinedAmountDiv.onclick = function() {
RefundManager.getInstance().handleClick(kCombinedRBId);
};
stateDivInnerContainer.appendChild(combinedAmountDiv);
var stateRightArrowDiv = document.createElement("div");
stateRightArrowDiv.id = kStateRightArrowId;
stateRightArrowDiv.className = "refundStateRightArrow";
stateRightArrowDiv.onclick = function() {
that.changeState(false);
};
var stateRightArrowTextNode = document.createTextNode(">");
stateRightArrowDiv.appendChild(stateRightArrowTextNode);
var stateLeftArrowDiv = document.createElement("div");
stateLeftArrowDiv.id = kStateLeftArrowId;
stateLeftArrowDiv.className = "refundStateLeftArrow";
stateLeftArrowDiv.onclick = function() {
that.changeState(true);
};
var stateLeftArrowTextNode = document.createTextNode("<");
stateLeftArrowDiv.appendChild(stateLeftArrowTextNode);
combinedDiv.appendChild(stateDivInnerContainer);
combinedDiv.appendChild(stateLeftArrowDiv);
combinedDiv.appendChild(stateRightArrowDiv);
$('refundLayer').appendChild(combinedDiv);
};
this.isScrollUp = function(fromAmt, toAmt) {
var parsedFromAmt = this.parseAmt(fromAmt);
var parsedToAmt = this.parseAmt(toAmt);
return (parsedFromAmt <= parsedToAmt) ? true : false;
};
this.scrollAmt = function (amountDiv, currentAmt, newAmt, isScrollUp, stepSize) {
if(currentAmt != newAmt) {
if(Math.abs(newAmt - currentAmt) <stepSize) {
amountDiv.innerHTML = this.formatAmt(newAmt);
return;
}
if(isScrollUp) {
amountDiv.innerHTML = this.formatAmt(currentAmt + stepSize);
setTimeout(function() {
RefundManager._instance.scrollAmt(amountDiv, currentAmt + stepSize, newAmt, isScrollUp, stepSize);
}, 45);
}
else {
amountDiv.innerHTML = this.formatAmt(currentAmt - stepSize);
setTimeout(function() {
RefundManager._instance.scrollAmt(amountDiv, currentAmt - stepSize, newAmt, isScrollUp, stepSize);
}, 45);
}
}
};
this.formatAmt = function(num) {
var amt = num + "";
for (var i = 0; i < Math.floor((amt.length - (1 + i)) / 3); i++) {
amt = amt.substring(0, amt.length - (4 * i + 3)) + "," + amt.substring(amt.length - (4 * i + 3));
}
return ("$" + amt);
};
this.clearAll = function() {
var len = this.refundPrmList.length;
for(var i = 0; i < len; i++) {
this.refundPrmList.pop();
}
for(var p in this.history) {
if(this.history.hasOwnProperty(p))
this.history[p].alive = false;
}
this.isInSpecificState = false;
};
this.getRefundChanges = function() {
var h = this.history;
var arr = [];
for(var p in h) {
if(h.hasOwnProperty(p) && h[p].alive) {
var refundItem = h[p];
var o = {};
o.fsid = p;
if(refundItem.old)
o.delta = refundItem.current - refundItem.old;
else
o.delta = 0;
arr.push(o);
}
}
return arr;
};
}
RefundManager._instance = null;
RefundManager.getInstance = function() {
if(this._instance == null)
this._instance = new RefundManager();
return this._instance;
}
function zRefund(ctrl)
{
;
zPrm.call(this, ctrl);
this.label = "";
this.amt = "";
this.isRefund = "";
this.type = "";
this.fsid = "";
}
function _zRfdRender(data )
{
if (isUndefined(data))
return;
this.label = unescape(data.label);
this.amt = unescape(data.amt);
this.isRefund = data.isRefund;
this.type = data.type;
this.fsid = unescape(data.fsid);
this.addPrim();
}
function _zRfdAdd() {
var rhi = RefundManager.getInstance();
var prm = this;
var prodId = TTOModel.getProductId();
if(!prm)
return;
var h = rhi.history;
var fsid = prm.fsid;
var isRefund = prm.isRefund;
if(h[fsid]) {
h[fsid].old = h[fsid].current;
}
else {
h[fsid] = {};
h[fsid].old = null;
}
h[fsid].current = rhi.parseAmt(prm.amt) * (isRefund == 0 ? -1 : 1);
h[fsid].alive = true;
var prmExists = false;
var prmIndex = -1;
for(var i = 0; i < rhi.refundPrmList.length; i++) {
if(rhi.refundPrmList[i].fID == prm.fID) {
prmExists = true;
prmIndex = i;
break;
}
}
if(!prmExists) {
if(prodId == 4) {
rhi.refundPrmList.push(prm);
prmIndex = rhi.refundPrmList.length-1;
}
else if(!rhi.isFed(this)){
rhi.refundPrmList.push(prm);
prmIndex = rhi.refundPrmList.length-1;
}
}
if(prodId == 4) {
this.updateCombinedDisplay(prm, prmIndex);
}
else {
if(rhi.isFed(this))
rhi.fedPrm = prm;
this.updateDisplay(prm, prmIndex);
}
}
function _zRfdUpdateCombinedDisplay(prm,prmIndex) {
var currentLabelDiv = null;
var currentAmountDiv = null;
var rhi = RefundManager.getInstance();
currentLabelDiv = $(kCombinedLabelId);
currentAmountDiv = $(kCombinedAmountId);
if(TTOModel.getDialogInfo().curFS == prm.fsid) {
rhi.showAmt(currentLabelDiv, currentAmountDiv, prm);
rhi.isInSpecificState = true;
rhi.currentStateIndex = prmIndex;
rhi.updateLeftRightArrow((prmIndex > 0) ? true:false, false);
}
else if(!rhi.isFed(prm)) {
if(rhi.isInSpecificState) {
rhi.updateLeftRightArrow((rhi.currentStateIndex > 0) ? true:false, true);
}
}
}
function _zRfdUpdateDisplay(prm, prmIndex) {
var currentLabelDiv = null;
var currentAmountDiv = null;
var rhi = RefundManager.getInstance();
if(rhi.isFed(prm)) {
currentLabelDiv = $(kFedLabelId);
currentAmountDiv = $(kFedAmountId);
rhi.showAmt(currentLabelDiv, currentAmountDiv, prm);
}
else {
var stateBlock = $(kStateRBId);
if(stateBlock.style.display == "none")
stateBlock.style.display = "";
currentLabelDiv = $(kStateLabelId);
currentAmountDiv = $(kStateAmountId);
if(rhi.isInSpecificState) {
rhi.updateLeftRightArrow((rhi.currentStateIndex > 0) ? true:false, true);
return;
}
else {
if(TTOModel.getDialogInfo().curFS == prm.fsid)
rhi.isInSpecificState = true;
if(rhi.isInSpecificState) {
rhi.currentStateIndex = prmIndex;
rhi.updateLeftRightArrow((prmIndex > 0) ? true:false, (prmIndex < (rhi.refundPrmList.length - 1)) ? true:false);
rhi.showAmt(currentLabelDiv, currentAmountDiv, prm);
}
else if(prmIndex == 0) {
rhi.currentStateIndex = prmIndex;
rhi.updateLeftRightArrow((prmIndex > 0) ? true:false, (prmIndex < (rhi.refundPrmList.length - 1)) ? true:false);
rhi.showAmt(currentLabelDiv, currentAmountDiv, prm);
}
else {
rhi.updateLeftRightArrow(false, true);
}
}
}
}
function _zRfdLayout(p) {
var rhi = RefundManager.getInstance();
var stateBlock = $(kStateRBId);
if(stateBlock)
stateBlock.style.display = "none";
rhi.setProductId(TTOModel.getProductId());
}
function __zRfdEnable(bEnable) { this._enabled = bEnable; }
zRefund.prototype = new zPrm();
var p = zRefund.prototype;
p.constructor = zRefund;
p.setLayout = _zRfdLayout;
p.Render = _zRfdRender;
p.addPrim = _zRfdAdd;
p.updateDisplay = _zRfdUpdateDisplay;
p.updateCombinedDisplay = _zRfdUpdateCombinedDisplay;
p.enable = __zRfdEnable;
p._enabled=true;
p=null;
zToolbar = zPrm.extend({
construct : function(ctrl) {
var t=this
this.superClass.construct.call(t, ctrl);
t._fItems=null
TTOEventPubSub.subscribeForEvent(zToolbar.kSwitchToToolCenterHomeView, zToolbar.switchToHomeView, this);
TTOEventPubSub.subscribeForEvent(zToolbar.kHideToolCenter, zToolbar.hideMenu, this);
TTOEventPubSub.subscribeForEvent(zToolbar.kUpdateToolCenterHeader, this._updateHeader, this);
TTOEventPubSub.subscribeForEvent(zToolbar.kSwitchToToolScreenView, zToolbar.switchToToolScreenView, this);
},
clear : function(){
var t=this
this._fItems=null
},
Render : function(data){
var t=this
var d=document
var startIndex = 0;
var toolBarLayer = t.fDOMParent
var bkm = $("__bkm_00__")
if (!isDefined(toolBarLayer) ||
!data ||
isUndefined(data.items) ||
!TTOModel.isValidProduct()) return
t._addDOM();
t._createItems(data.items);
if (null == t._fItems) return
clearKids(toolBarLayer)
if (!TTOModel.isFFA()){
var btn = appendLayer(toolBarLayer);
btn.id='toolsBtnLayer';
zAns.appendDlgAns(btn, " Flags", "Flags", null, zAns.eBkmBtnType, t._showBkm);
var b = zAns.appendDlgAns(btn," Tools", t.fID+"_TOOLS", null,zAns.eToolbarBtnType,zToolbar.showMenu);
jQuery(b).addClass("btnTools");
TTO.DU.appendImg(toolBarLayer,'nav_divider.gif',null,null, 'nav_divider');
}
var linksDiv = jQuery("#" + zToolbar.kToolCenterID + " .links").empty();
linksDiv.append("<div class='linkHeader'>Other helpful links...</div>");
if(!TTOModel.isFeatureSupported(TTOModel.kPersistentUpgrade))
{
if(RightRailHelper.useSolveItCenter()) {
var upgBtn = $('upg_btn')
if(upgBtn) {
dontdisplay(upgBtn)
}
}
else {
var upg = $('upg')
if(upg) {
dontdisplay(upg)
}
}
}
if (TTOModel.isFFA()){
var p =$('toolbar_menu')
if (p)
clearKids(p)
else {
p = appendLayer(toolBarLayer)
p.id='toolbar_menu'
}
var tl = d.createElement('ul')
p.appendChild(tl);
for (var i=startIndex; i<t._fItems.length; i++){
var o = t._fItems[i]
var itm = d.createElement('li')
tl.appendChild(itm)
var l= TTO.DU.appendLink(itm)
l.idx = o.idx
l._tool=true
l._prm=t
l.onclick=zToolbar.toolClickHandler
if (o.icon)
TTO.DU.appendImg(l,o.icon,null,null,'toolbar_icon')
TTO.DU.appendText(l,o.name)
}
}
else {
var contentDiv = jQuery(".homeScreen .content");
for (var i=startIndex; i<t._fItems.length; i++){
var o = t._fItems[i]
var b = null;
switch (o.name) {
case zToolbar.kTopicsSearchName:
b = jQuery('<div id="topics_search" class="btn"><div class="toolcenterBtnInner"><div class="toolIcon">s</div><div id="topic_search_text" class="btnLabel">Topic Search</div></div></div>').appendTo(contentDiv).get(0);
break;
case zToolbar.kTopicListName:
b = jQuery('<div id="topic_list" class="btn"><div class="toolcenterBtnInner"><div class="toolIcon">l</div><div id="topic_list_text" class="btnLabel">Topic List</div></div></div>').appendTo(contentDiv).get(0);
break;
case zToolbar.kMyTurboTaxFeesName:
b = jQuery('<div id="my_fees" class="btn"><div class="toolcenterBtnInner"><div class="toolIcon">$</div><div id="my_fees_text" class="btnLabel">My Fees</div></div></div>').appendTo(contentDiv).get(0);
break;
default:
var link = {};
link.id = zToolbar.shortenToolName(o.name);
link.name = o.name;
b = t._addLink(linksDiv, link).get(0);
break;
}
if(b) {
b.idx = o.idx;
b._tool = true;
b._prm = t;
b.onclick = zToolbar.toolClickHandler;
}
}
jQuery('<div class="clearDiv"></div>').appendTo(contentDiv);
}
},
_addLink : function(linksDiv, lnkObj) {
var div = document.createElement("div");
div.className = "linkDiv";
linksDiv.append(div);
var bulletSpan = document.createElement("span");
bulletSpan.innerHTML = "&#x2022;&nbsp;";
div.appendChild(bulletSpan);
var lnk = jQuery("<span class='toolcenterLink' id='" + lnkObj.id + "'>" + lnkObj.name + "</span>").appendTo(div);
return lnk;
},
_addDOM : function() {
jQuery("#toolsCenter").empty().append('<div class="innerBox">'+
'<div class="scrollOuterContainer">'+
'<div class="scrollBox">'+
'<div class="homeScreen">'+
'<div class="header">'+
'<div class="title">Tools Center</div>'+
'<div class="closeBtn" id="tools_home_close">D</div>'+
'</div>'+
'<div class="content">'+
'</div>'+
'<div class="links">'+
'</div>'+
'<div class="spacer"></div>'+
'</div>'+
'<div class="toolScreen">'+
'<div class="header">'+
'<div class="title"></div>'+
'<div class="closeBtn" id="tools_secondary_close">D</div>'+
'<div class="back">[</div>'+
'</div>'+
'<div class="content">'+
'</div>'+
'<div class="spacer"></div>'+
'</div>'+
'<div class="clearDiv"></div>'+
'</div>'+
'</div>'+
'</div>');
},
_createItems : function(toolItems){
this.clear();
this._fItems=new Array()
for (var i=0; i<toolItems.length; i++){
var itm = toolItems[i]
var o = new Object()
o.idx = i
o.cr = unescape(itm.v)
o.name = unescape(itm.l)
o.context = unescape(itm.c)
o.icon = unescape(itm.icn)
this._fItems.push(o)
}
if (BrowserSniffer.isIOS()) {
this._fItems = jQuery.grep(this._fItems, function(n) {
return n.name != zToolbar.kIOSRemoveToolItems;
});
}
if (!TTOModel.isFFA() && TTOModel.isQA()){
jQuery("<div class='debugButton'>debug</div>").click(function() {
zToolShowOldNav();
}).appendTo(jQuery("#toolsCenter .homeScreen .header"));
var debugDiv = document.createElement("div");
}
jQuery("#" + zToolbar.kToolCenterID + " .back").unbind("click").capture("click", function() {
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolCenterHomeView);
});
jQuery("#" + zToolbar.kToolCenterID + " .closeBtn").unbind("click").capture("click", function() {
zToolbar.hideMenu();
});
},
_showBkm : function(){
TTOApp.findCtrlAndShow(48,true)
},
_updateHeader : function( ht) {
if(ht)
jQuery("#" + zToolbar.kToolCenterID + " ." + zToolbar.kToolScreenClass + " .header .title").html(ht);
if(TTOModel.isFFA())
jQuery("#" + zToolbar.kToolCenterID + " .back").hide();
else
jQuery("#" + zToolbar.kToolCenterID + " .back").show();
}
}, {
kSwitchToToolScreenViewComplete : "Switch_To_Tool_Screen_View_Complete",
kSwitchToToolScreenView : "Switch_To_Tool_Screen_View",
kSwitchToToolCenterHomeView : "Switch_To_Tool_Center_Home_View",
kHideToolCenter : "Hide_Tool_Center",
kUpdateToolCenterHeader : "Update_Tool_Screen_Header",
kPrintSaveReturnsName : "Print/Save Returns",
kTopicsSearchName : "Topics & Forms",
kTopicListName : "Topic List",
kViewTaxSummaryName : "View Tax Summary",
kViewPastReturnsName : "View Past Returns",
kMyTurboTaxFeesName : "My TurboTax Fees",
kSearchTopicsOrFormsName : "Search Topics or Forms",
kIOSRemoveToolItems : "View Tax Summary",
kToolScreenClass : "toolScreen",
kToolCenterID : "toolsCenter",
kScrollBy : 404,
kToolScreenWidth : 404,
kToolScreenHeight : 293,
hideMenu : function(bForceHide) {
jQuery("#" + zToolbar.kToolCenterID).fadeOut(350, function() {
var modalbkg = $(MODALBKG)
jQuery(modalbkg).hide();
hideProblemLayers(false);
});
},
showMenu : function( noAnimation) {
var modalbkg = $(MODALBKG);
var tc = jQuery("#" + zToolbar.kToolCenterID);
TTO.H.showModalBg();
hideProblemLayers(true);
RIAModalWindow.center($(zToolbar.kToolCenterID), 400, null, true, false);
zToolbar.switchToHomeView(noAnimation);
if(!noAnimation) {
jQuery.easing.def = "easeInExpo";
tc.animate({
opacity: 'toggle'
}, 500);
}
else {
tc.show();
}
},
switchToHomeView : function( noAnimation) {
var scrollInnerContainer = jQuery(".scrollBox");
var scrollBoxLeftPosition = scrollInnerContainer.css("left");
scrollBoxLeftPosition = isUndefined(scrollBoxLeftPosition) ? 0 : parseInt(scrollBoxLeftPosition);
if(noAnimation) {
if(scrollBoxLeftPosition < 0)
jQuery(".scrollBox").css("left", 0);
jQuery("#" + zToolbar.kToolCenterID).css("height", 280);
}
else {
if(scrollBoxLeftPosition < 0)
jQuery(".scrollBox").animate({
left : 0
}, 300);
jQuery("#" + zToolbar.kToolCenterID).animate({
height : 280
}, 300);
}
},
switchToToolScreenView : function() {
if (TTOModel.isFFA()){
zToolbar.showMenu( true);
jQuery(".scrollBox").css("left", zToolbar.kScrollBy * -1);
jQuery("#" + zToolbar.kToolCenterID).css("height", 370);
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolScreenViewComplete);
}
else {
jQuery(".scrollBox").animate({
left : "-" + zToolbar.kScrollBy
}, 300, function() {
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolScreenViewComplete);
});
jQuery("#" + zToolbar.kToolCenterID).animate({
height: 370
}, 300);
}
},
shortenToolName : function(name) {
return name.replace(/[ &/]/g, "_");
},
toolClickHandler : function(ne){
var evt = new zEvent(ne)
evt.cancel()
var e = evt.element
while(e && !e._tool) e=e.parentNode
if (!e) return
var i = e.idx
e=e._prm
var itm=e._fItems[i]
if (itm.cr==kJavascriptAction)
eval(itm.context)
else if (kTopicJumpAction == itm.cr) {
TTOController.doTopicJump(itm.context)
zToolbar.hideMenu(true)
}
else {
e.SetVal(itm.idx)
if (!Submit()) {
}
e.ClearVal()
zToolbar.hideMenu(true)
}
}
});
kSubMenuOffsetY= 10
kSubMenuOffsetX= 2
kJavascriptAction= "1"
kTopicJumpAction= "6"
kPrintAction= "7"
kHelpSearchFlag= "***HS***"
kIOSRemoveItems = ["View Tax Summary", "Download My Tax File"];
kSubMenuCSS = (gbIE)?"subMenuIE":"subMenuNN"
function zMenu(ctrl){
var t=this
zPrm.call(t,ctrl)
t._fCurIndex = 0
t._fHelpSearchLayer=null
t._fHelpSearchSubmenu=null
t._fHelpSearchTable=null
t._fToolMenu=null
}
function _zMenuCreate( toolItem)
{
var t=this
if (null == t._fItems) return
var node = new Array()
node.idx = t._fCurIndex-1
node.cr = unescape(toolItem.cr)
node.name = unescape(toolItem.txt)
node.context = unescape(toolItem.ctx)
node.level = unescape(toolItem.lvl)
while (t._fItems[t._fCurIndex] && toolItem.lvl < t._fItems[t._fCurIndex].lvl)
{
node.push(t._createMenu(t._fItems[t._fCurIndex++]))
}
return node
}
function _zMenuLayout(){
var t=this
t.fDOMParent = $('menuLayer')
}
function _zMenuRender (data) {
var t=this
if (!t.fDOMParent) t.fDOMParent = $('menuLayer')
var navLayer = t.fDOMParent
if (isUndefined(data.items)) return
t._fItems=data.items
t._fCurIndex = 0
if (isUndefined(t._fItems)) t._fItems=new Array()
var TOP = t._itemCreator (-1,"","",-1)
t._fToolMenu = this._createMenu(TOP)
if (!navLayer) return
clearKids(navLayer)
for (var i=0; i<t._fToolMenu.length; i++){
var l = appendLayer(navLayer,"NavBkg")
t._renderMenuSection(t._fToolMenu[i],l)
TTO.DU.appendSp(navLayer,1,10)
}
t._createHelpSearch()
}
function zMenuClear(){
var t=this
this._fItems=null
if (null!=t._fToolMenu)
delete t._fToolMenu
t._fToolMenu=null
}
function appendNavHdr(d,p, s) {
var H=appendLayer(p,"NavHeader")
TTO.DU.appendText(H,s)
return H
}
function appendNavItem(p, s, act, sm) {
var navImage = $("navBlt")
var L
if (act) {
L = TTO.DU.appendLink(p,null,null,"nav")
}
else L= appendLayer(p)
L.activeCell = null
L.table=null
var e = appendLayer(L)
e.className="NavItem"
e.id="menu-" + s.replace(/ /g,"_")
e.sm=sm
e._menu=true;
e.act=act
e.onmouseover=zmenuMouseListener
e.onmouseout=zmenuMouseListener
e.onmousedown=zmenuMouseListener
e.onmouseup=zmenuMouseListener
if (act && p.className==kSubMenuCSS)
e.onclick=zmenuMouseListener
if (sm)
{
document.body.appendChild(sm)
sm._submenu=true
sm._owner=e
sm.onmouseover=zsubmenuMouseListener
sm.onmouseout=zsubmenuMouseListener
}
var tbl=new zTable( e, gbIE?2:1, 0, "100%", 0, "navlink", 2)
L.table=tbl.el
tbl.appendRow( null, null)
tbl.appendCol( null, null, null)
tbl.curCol.style.paddingLeft="5px"
tbl.curCol.style.paddingRight="5px"
if (s){
TTO.DU.appendText(tbl.curCol,s)
}
L.activeCell = tbl.curCol
if (sm)
{
tbl.appendCol( null, "baseline", 5)
TTO.DU.appendImg(tbl.curCol,navImage.src,9,7)
if (gbMozilla)
tbl.curCol.style.paddingTop="6px"
}
return L
}
function _zMenuRenderSection( itm, p){
var t=this, act, i
var d=document
var s = itm.name
if (BrowserSniffer.isIOS()) {
if (kIOSRemoveItems && jQuery.inArray(s, kIOSRemoveItems) !== -1) return;
}
if (itm.cr==kJavascriptAction)
act = itm.context
else {
act="TTOApp.findCtrlByType("+40 +")._OnClick("+itm.idx+",'"+itm.cr+"','"+itm.context+"')"
}
if (itm.level == 0) {
appendNavHdr(d,p,s)
var toolsect = appendLayer(p,"NavSection")
for (i=0; i<itm.length; i++) {
t._renderMenuSection(itm[i],toolsect)
}
}
else {
if (itm.length > 0) {
var l = d.createElement("DIV"); l.className=kSubMenuCSS
appendNavItem(p,itm.name,null,l)
for (i=0; i<itm.length; i++) {
t._renderMenuSection(itm[i],l)
}
}
else {
var el = appendNavItem(p,itm.name,act)
if (kHelpSearchFlag == itm.name) {
t._fHelpSearchSubmenu = p
t._fHelpSearchTable = el.table
t._fHelpSearchLayer = el.activeCell
}
}
}
}
function _zMenuCreateHS(){
var t=this
if (isUndefined(t._fHelpSearchLayer)) return
t._fHelpSearchLayer.innerHTML=""
var HLP = new zHelpSearch()
var I = HLP.Render(t._fHelpSearchLayer)
t._fHelpSearchSubmenu.style.width=I.offsetWidth+50+"px"
I.onmouseout=HLP._fEdit.blur
}
function _zMenuOnClick( i, req, ctx){
if (req == kPrintAction) {
var type = ctx.split(';')
var TO = new PrintTO()
TO.filename = "taxReturn.pdf"
TO.printType = type[0]
if (type[1])
TO.formList = eval('(' + unescape(type[1]) + ')');
var cmd = new PrintCommand(TO)
cmd.execute()
}
else if (req==kJavascriptAction) {
eval(ctx)
}
else if (kTopicJumpAction == req) {
TTOController.doTopicJump(ctx)
}
else {
this.SetVal(i)
Submit()
}
this.ClearVal()
}
function zmenuMouseListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._menu) e=e.parentNode
if(!e) return
if (evt.type=='mousedown'){
evt.cancel();
if (e.act) eval(e.act);
e.className="NavItem";
if(e.sm) {
hide(e.sm);
hideProblemLayers(false);
}
}
else if (evt.type=="mouseover"){
e.className="NavItemOver";
if(e.sm){
e.sm.style.top=getExactY(e)-kSubMenuOffsetY+"px"
e.sm.style.left=getExactX(e)+e.offsetWidth-kSubMenuOffsetX+"px"
if (e.sm.offsetTop + e.sm.offsetHeight > getWindowHeight())
e.sm.style.top = (e.sm.offsetTop - e.sm.offsetHeight + 4*kSubMenuOffsetY)+"px"
hideProblemLayers(true)
show(e.sm)
}
}
else if (evt.type=="mouseout"){
e.className="NavItem";
if(e.sm) {
hide(e.sm);
hideProblemLayers(false);
}
}
else if (evt.type=="mousedown" && e.act){
e.className="NavItemDown"
}
else if (evt.type=="mouseup" && e.act) {
e.className="NavItemOver"
}
}
function zsubmenuMouseListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._submenu) e=e.parentNode
if(!e) return
if (evt.type=="mouseover"){
hideProblemLayers(true);
show(e);
e._owner.className="NavItemDim"
}
else if (evt.type=="mouseout"){
hide(e);
e._owner.className="NavItem";
hideProblemLayers(false);
}
}
function _zMenuCreateItem(cr,txt,ctx,lvl) {
var o = new Object();
o.cr = cr
o.txt = txt
o.ctx = ctx
o.lvl = lvl
return o
}
zMenu.prototype=new zPrm()
p=zMenu.prototype
p.constructor=zMenu
p.Render=_zMenuRender
p.setLayout=_zMenuLayout
p.clear=zMenuClear
p._OnClick=_zMenuOnClick
p._renderMenuSection=_zMenuRenderSection
p._createMenu=_zMenuCreate
p._createHelpSearch=_zMenuCreateHS
p._itemCreator=_zMenuCreateItem
p=null
FormsMode = function () {
var _public = {
init : function (prim) {
_fFormPrim = prim;
},
close : function () {
Submit();
_fFormPrim.show(false);
return true;
}
};
var _fFormPrim = null;
return _public;
}();
FormsMode.kFormsModeSwf = "FormsMode.swf";
FormsMode.kFormSwf = "Form.swf";
FormsMode.kFormWholeDisplayH = 768;
FormsMode.kFormRegionDisplayH = 250;
FormsMode.kFormLargeRegionDisplayH = 500;
FormsMode.kEditable = "editable";
FormsMode.kAllowFormLink = "allowLinks";
FormsMode.kFormId = "formId";
FormsMode.kFormImage = "formImage";
FormsMode.kFormData = "formData";
FormsMode.kFormDesc = "formDesc";
FormsMode.kFocusField = "focusField";
FormsMode.kFocusFieldIdx = "focusFieldIdx";
FormsMode.kFieldInError = "fieldInError";
zForm = zRIASwf.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
window.scroll(0,0);
var t=this;
t.useWmodeTransparent = !gbIE;
var swfData = {};
swfData.fileRef = FormsMode.kFormSwf;
this.setWidth(640);
if (data.dispWhole) {
if (data.useFullFormSpace) {
this.setHeight(FormsMode.kFormWholeDisplayH);
} else {
this.setHeight(FormsMode.kFormLargeRegionDisplayH);
}
} else {
this.setHeight(FormsMode.kFormRegionDisplayH);
}
t.addVariable(FormsMode.kEditable, data.editable?"true":"false");
t.addVariable(FormsMode.kAllowFormLink, "false");
t.addVariable(FormsMode.kFormId, escape(data.formId));
t.addVariable(FormsMode.kFormDesc, data.desc);
t.addVariable(FormsMode.kFocusField, escape(data.focusFld.Id));
t.addVariable(FormsMode.kFocusFieldIdx, escape(data.focusFld.EN));
t.addVariable(FormsMode.kFieldInError, escape(data.focusFldErr));
data = null;
zRIASwf.prototype.Render.call(this,swfData);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_FormExists, t._swfID);
},
setFocus: function () {
var _swf = $(this._swfID);
if (!_swf) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zFormsMode", "_zFormSetFocus - No Form SWF found: " + this.fID), LOG_ERROR);
return;
}
_swf.focus();
},
GetVal : function () {
var val = null;
var _swf = $(this._swfID);
if (!_swf) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zFormsMode", "_zFormGetValue - No Form SWF found: " + this.fID), LOG_ERROR);
return val;
}
if (!_swf.getChangedData) {
return val;
}
var data = _swf.getChangedData();
if (data) {
var fmu = new FormsModeUtil();
fmu.addSubmitFormValues(data);
val = fmu.getSubmitVal();
data = null;
fmu = null;
}
return val;
},
isOKToSubmit : function() {
var _swf = $(this._swfID);
if (!_swf) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zFormsMode", "_zFormOKToSubmit - No Form SWF found: " + this.fID), LOG_ERROR);
return true;
}
if (_swf.itsOKToSubmit) {
return _swf.itsOKToSubmit();
} else {
return true;
}
}
});
zFMPrim = zRIASwf.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
FormsMode.init(this);
},
Render : function (data) {
var t = this;
t.fDOMParent = $('formsMode');
window.scroll(0, 0);
var swfData = {};
swfData.fileRef = FormsMode.kFormsModeSwf;
this.setWidth(1150);
this.setHeight(768);
t.addVariable(FormsMode.kEditable, data.editable);
t.addVariable(FormsMode.kAllowFormLink, "true");
t.addVariable(FormsMode.kFormDesc, escape("Forms Mode"));
t.addVariable(FormsMode.kFormId, escape(data.formId));
this.superClass.Render.call(this, swfData);
t.show(true);
data = null;
},
show : function (bShow) {
var formLayer = this.fDOMParent;
if (isUndefined(formLayer)) {
return;
}
if (bShow) {
jQuery('#formsMode').show(1000);
TTO.H.showModalBg();
} else {
jQuery('#formsMode').hide(1000);
jQuery("#" + MODALBKG).hide();
}
},
GetVal : function () {
var _swf = $(this._swfID);
if (!_swf) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zFormsMode", "_zFMGetValue - No Form SWF found: " + this.fID), LOG_ERROR);
return "";
}
var val = null;
var data = _swf.getChangedData();
if (data) {
var fmu = new FormsModeUtil();
fmu.addSubmitFormValues(data);
val = fmu.getSubmitVal();
data = null;
fmu = null;
}
return val;
}
});
function DltFieldId( name, record, column ){return name+"@"+record+":"+column}
kDLTBorderW= 2
kDLTCellPad= 2
zDLT = zFrmCtrl.extend( {
construct : function (ctrl) {
var t=this
this.superClass.construct.call(this,ctrl)
t.fVal=""
},
Render : function (data){
var t=this,i
var recs = data.recs
var nRows = data.visR
var tbl=new zTable( t.fDOMParent, kDLTCellPad, 0, t.GetPixelWidth(), 0, "DLT", data.recs.length)
t._fTbl=tbl
tbl.appendRow( "center", "middle", null, "DLTHdr")
tbl.proto = new Array()
tbl.vals = new Array()
for(i=0;i<recs.length;i++){
tbl.appendCol( null, null, null, null, "DLTHdr")
TTO.DU.appendText( tbl.curCol, recs[i].head)
tbl.proto[i] = recs[i].proto
tbl.vals[i] = recs[i].vals
if(recs[i].vals.length>nRows)nRows=recs[i].vals.length
}
if(data.df){
tbl.appendCol()
TTO.DU.appendSp( tbl.curCol, 1, 1)
tbl.del=true
}
for(i=0;i<nRows;i++) {
if (i>data.maxR) break;
t._appendRec()
}
},
_appendRec : function (){
var t=this
var r=0
var lst=t._fTbl.body.lastChild
if(lst&&lst.lastRow){
lst.lastRow=false
r=lst.recNum
r++
}
t._fTbl.appendRow( "center", "middle")
for (var c=0; c<t._fTbl.numCols; c++) {
t._fTbl.appendCol( null, null, null, null, "DLTRec")
t._fTbl.curRow.lastRow=true
t._fTbl.curRow.recNum=r
var proto = t._fTbl.proto[c].type
proto.name = DltFieldId(t.fID,r,c)
t.AddCtrl(proto)
var prm = t.ctrlList[proto.name].prm
prm.fParent=this
prm.fDOMParent = t._fTbl.curCol
prm._dltRec=r
prm._dltCol=c
prm._OnBlurBase=prm._OnBlur
prm._OnBlur=_zDltOnBlurCtrl
prm.SetVal=_zDltCapturePrimVal
var data = t._fTbl.proto[c].data.data
data.val = t._fTbl.vals[c][r]
prm.Render(data)
}
if(t._fTbl.del){
t._fTbl.appendCol( null, null, null, null, "DLTDel")
td=t._fTbl.curCol
var l=TTO.DU.appendLink( td, "Delete", null, "mcDelete", true, t)
l.onclick=zDltDelListener
}
},
isOKToSubmit : function (){
var t=this
for (var e in t.ctrlList) {
var p = t.ctrlList[e].prm
if(p&&!p.isOKToSubmit())return false
}
return true
}
});
function _zDltCapturePrimVal(val) {
if(val==this.fVal) return
this.fVal=val
val=val+""
var n = this.fID.split('@')
n = n[1].split(":")
var r = n[0]
var c = n[1]
var dlt = this.fParent
var dltVal = dlt.fVal+r+','+c+','+val.length+':'+val
dlt.SetVal(dltVal)
}
function _zDltOnBlurCtrl( e){
if (null == e) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zDlt","_zDltOnChange:HTML Input control not specified"), LOG_WARNING)
return
}
var t=this
t._OnBlurBase(e)
var r=e.parentNode.parentNode
while(r&&r.tagName!="TR")r=r.parentNode
if(!r)return
if(r.nextSibling)r=r.nextSibling
if(r.lastRow&&t.fVal&&t.fVal.length>0){
t.fParent._appendRec( r.parentNode)
}
}
function zDltDelListener(ne){
var evt=new zEvent(ne)
evt.cancel()
var t=evt.element
while(t&&!t._prm)t=t.parentNode
if(null==t)return
var tr=t.parentNode.parentNode
while(tr&&tr.tagName!="TR")tr=tr.parentNode
if(!tr)return
if(tr.lastRow)return
var tbl=tr.parentNode
var r=tr.recNum
t._prm.fVal+=r+';'
var lst=t._prm._fPrms
var i,cnt=lst.length
for(i=0;i<cnt;i++){
if(lst[i]._dltRec==r)lst[i]._dltDeleted=true
}
_clearAttr(tr)
tbl.removeChild(tr)
tr=null
}
zBeacon = zPrm.extend( function () {
var _public = {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t = this;
var TO = new BeaconDataTO();
TO.type = data.type;
TO.title = TTOModel.getDialogInfo().title;
TO.prodId = TTOModel.getProductId();
TO.prodAlias = TTOModel.getProductInfo().prodAlias;
TO.customerSource = TTOModel.getCustomerSrc();
TO.currentScreenId = TTOModel.getDialogInfo().screenId;
TO.section = "";
TO.LCTags = TTOModel.getPageLCTagset();
TO.LCTitle = TTOModel.getPageLCTitle();
pb = TTOApp.findCtrlByType(26);
if (pb) {
TO.currentTab = pb.getCurCat();
TO.currentSubItem = pb.getCurSubItem();
}
for (var i = 0; i < data.keylist.length; i++) {
data.keylist[i].key = unescape(data.keylist[i].key);
data.keylist[i].value = unescape(data.keylist[i].value);
}
TO.oldStyleKeys = data.keylist;
if (undefined != TrackingService)
TrackingService.queueBeacon(TTOModel.getPageInfo().reqId, TO);
}
};
return _public;
}());
zBeacon.addBeacon = function(type, title, sect, keys, values) {
var vals = [];
var o = {"key":"s_pageName","value":title};
vals.push(o);
if(sect != "") {
o = {"key":"s_channel","value":sect};
vals.push(o);
}
if (keys != undefined && values != undefined && keys.length == values.length) {
for(var index = 0; index < keys.length; index++) {
o = {"key": keys[index], "value":values[index]};
vals.push(o);
}
}
else {
;
}
var TO = new BeaconDataTO();
TO.type = type;
TO.prodId = TTOModel.getProductId();
TO.prodAlias = TTOModel.getProductInfo().prodAlias;
TO.customerSource = TTOModel.getCustomerSrc();
TO.currentScreenId = TTOModel.getDialogInfo().screenId;
TO.title = title;
TO.section = sect;
TO.oldStyleKeys = vals;
pb=TTOApp.findCtrlByType(26);
if (pb) {
TO.currentTab = pb.getCurCat();
TO.currentSubItem = pb.getCurSubItem();
}
TrackingService.addBeacon(TO);
};
zBeacon.isBeaconSample = function() {
var bIs=false;
var id = unescape(TTOModel.getUserId()).split(':')[0];
if (id > 0) {
var re=id % 100;
if (re < 10){
bIs=true;
}
}
return bIs;
};
zGrid = zPrm.extend( {
construct : function (ctrl){
this.superClass.construct.call(this,ctrl)
var t=this
t._fRows=ctrl.layout.rows
t._fNumCols=ctrl.layout.numCols
t.htmlElement = null
t.style = ctrl.style?decodeURIComponent(ctrl.style):null;
var nRows=t._fRows.length
var j,r,c,cells,list
for(r=0;r<nRows;r++){
cells=t._fRows[r].cells
if (!cells) continue;
for(c=0;c<cells.length;c++){
list=cells[c].cL
if (!list) continue;
for(j=0;j<list.length;j++) {
if(list[j]) {
t.AddCtrl(list[j])
}
}
}
}
},
Render : function (data ) {
var t=this
var bHide = false;
if (data && data.feature && !TTOModel.isFeatureSupported(unescape(data.feature))) {
bHide = true
}
if (data && data.skuList) {
bHide = true;
var lst = (unescape(data.skuList)).split(",")
var sku = TTOModel.getProductId();
for (var i=0; i<lst.length; i++) {
if (lst[i] == sku) {
bHide = false;
break;
}
}
}
if (bHide) {
jQuery (t.htmlElement).hide()
}
else {
t.renderControlList(data.layout)
}
},
setLayout : function ( domParent){
var p = document.createDocumentFragment();
var t=this
var nRows=t._fRows.length
var r,c,cntCells,cells,cspn,w
var tblColCnt=t._fNumCols
var bBorders=false
var tblW=t.GetPixelWidth()
var bkg = p
if (TTOModel.isQA()) {
bBorders=DebugModel.showGridBorders()
}
var totalCols = 0;
for(r=0;r<nRows;r++){
cells=t._fRows[r].cells
totalCols = (totalCols > cells.length)?totalCols:cells.length
}
if (this.style) {
bkg = appendLayer(p,this.style.toLowerCase())
}
var gridCSS = "grid"
if (TTOModel.getDialogType() == 3) {
gridCSS = "gridV2";
tblW = 0
}
var tbl=new zTable( bkg, 0, 0, tblW, bBorders, gridCSS, tblColCnt)
this.htmlElement = tbl.el
for(r=0;r<nRows;r++){
var colCnt = 0;
cells=t._fRows[r].cells
if(null!=cells){
tbl.appendRow()
var cntCells=cells.length
for(c=0;c<cntCells;c++){
var curCell = cells[c]
var colLayout = "colPad"
if (0==c) colLayout = "colFirst"
else if (cntCells-1 == c) colLayout = "colLast"
if (r==0) colLayout += " colNoVerticalPad"
t._renderCol( tbl,curCell, colLayout)
colCnt += curCell.span?curCell.span:1
}
}
if(colCnt<totalCols) {
for(c=colCnt;c<totalCols;c++)
tbl.appendCol()
}
}
tbl.clear()
domParent.appendChild(p)
},
renderControlList : function (ctrlList ) {
if (!ctrlList) return
for (var i=0; i<ctrlList.length; i++) {
var itm = ctrlList[i]
if (!itm) continue
var ctrl = this.FindCtrl(itm.name)
if (ctrl && ctrl.prm)
ctrl.prm.Render(itm.data)
}
},
_renderCol : function ( tbl, curCell, colLayout){
var t=this
var wObj = {cellW:0, rawVal:0};
t._cellWidth(curCell.cL, wObj)
tbl.appendCol( t._toAlign(curCell.hA), t._toVAlign(curCell.vA), wObj.cellW, curCell.span, colLayout)
if (wObj.cellW && TTOModel.getDialogType() == 3) tbl.curCol.style.width = wObj.cellW + "%";
var ctrls = curCell.cL
if(ctrls && ctrls.length > 0){
var cnt = ctrls.length
for(var j=0;j<cnt;j++){
var ctrl = this.FindCtrl(ctrls[j].name)
if (ctrl)
ctrl.prm.setLayout(tbl.curCol)
}
if(ctrls[0].pT==6) tbl.curCol.className += " colNoVerticalPad"
}
if (TTOModel.isQA() && DebugModel.showGridBorders()) {
if (wObj.cellW)
tbl.curCol.title = "TD Width: " + wObj.rawVal + " - UI Width: " + wObj.cellW + (TTOModel.getDialogType() == 3?"%":"px")
else
tbl.curCol.title = "Width not specified"
tbl.curCol.className += " colDbg"
}
},
_cellWidth : function (cell, wObj){
wObj.rawVal=0;
wObj.cellW=0
var prmW = 0
if (!cell) return
for(i=0;i<cell.length;i++){
var ctrl = this.FindCtrl(cell[i].name)
prmW = (TTOModel.getDialogType() == 3)?ctrl.prm.GetPctWidth():ctrl.prm.GetPixelWidth()
wObj.rawVal += ctrl.prm.getRawWidth();
wObj.cellW+=prmW
}
},
_toAlign : function ( a){
var ha = "left"
if (0==a) ha='left'
else if (1==a) ha='left'
else if (2==a) ha='center'
else if (3==a) ha='right'
return ha
},
_toVAlign : function ( a){
var va="baseline"
if (0==a) va=''
else if (1==a) va='top'
else if (2==a) va='center'
else if (3==a) va='bottom'
else if (4==a) va='top'
return va
}
});
riaEvtObj = function () {
this.type = null;
this.value = null;
this.submitdata = null
}
riaEvtObj.ERR = "ERROR";
riaEvtObj.NAV = "NAV";
riaEvtObj.JUMP = "JUMP";
riaEvtObj.SUBMIT = "SUBMIT";
riaEvtObj.HEIGHT = "HEIGHT";
zDlg = zGrid.extend( {
construct : function (ctrl) {
var t=this
this.superClass.construct.call(this,ctrl)
t.setWidth(100,'p')
t.type = ctrl.type
t.RIA = null
t.isUpgrade = false
t.modalFlowCoExists =false
var TO = new DialogInfoTO()
TO.title = ctrl.title
TO.subtitle = ctrl.subtitle
TO.titleGraphic = ctrl.titleGraphic
TO.genericTitle = ctrl.genericTitle
TO.curFS = ctrl.curFS
TO.curForm = ctrl.curForm
TO.curField = ctrl.curFld
TO.topicId = ctrl.topicId
TO.screenId = ctrl.tag
TO.type = ctrl.type
TO.pii = ctrl.pii
var cmd = new UpdateDialogInfoCommand(TO)
cmd.execute();
if (TTOModel.isQA()) {
var dTO = new DebugTO()
dTO.historyType= ctrl.historyType
var dCmd = new DebugCommand(dTO)
dCmd.execute()
}
var i,cnt
t.fLEng=ctrl.engL
if(t.fLEng){
for(i=0;i<t.fLEng.length;i++){
t.AddCtrl(t.fLEng[i])
}
}
t.fREng=ctrl.engR
if(t.fREng){
for(i=0;i<t.fREng.length;i++){
t.AddCtrl(t.fREng[i])
}
}
},
setLayout : function (p) {
this.superClass.setLayout.call(this,$('contentLayer'))
this._layoutEngCtrls($('answerLayer'))
},
Render : function (data ) {
var t=this,i,prm
if (!data) return
switch (t.type) {
case 0 :
case 2:
case 3:
t.renderControlList(data.layout)
t.renderControlList(data.engR)
t.renderControlList(data.engL)
break;
case 1:
t._renderRIA(data.riaInfo)
t.renderControlList(data.engR)
t.renderControlList(data.engL)
break;
default:
break;
}
},
_layoutEngCtrls : function (p){
var t=this,l=t.fLEng,r=t.fREng
var i,cnt=0,ctrl,prm
if(l && l.length > 0){
var lt = appendLayer(p, "ansL")
cnt=l.length
for(i=0;i<cnt;i++){
ctrl=t.FindCtrl(l[i].name)
if (ctrl) prm=ctrl.prm
if(prm) prm.setLayout(lt)
}
}
if(r && r.length > 0){
var rt = appendLayer(p, "ansR")
cnt=r.length
for(i=0;i<cnt;i++){
ctrl=t.FindCtrl(r[i].name)
if (ctrl) prm=ctrl.prm
if(prm)prm.setLayout(rt)
}
}
},
_renderRIA : function (info) {
if (this.RIA) return;
var _ctrl = {name : this.fID}
this.RIA = new zIFr(_ctrl)
this.RIA.setLayout($('contentLayer'))
var params = info.params
if (!info.params) {
params = new Array()
}
params["component"] = info.component
var data = {}
data.system = "riadialog"
data.fileAlias = decodeURIComponent(info.fileRef)
data.isFlow = info.isFlow
data.params = params
this.RIA.Render(data)
this.isUpgrade = (info.component.toLowerCase() == "upsell")
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_RIAEvent, this._riaFlowListener, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_ModalFlowExists, this._modalFlowListener, this)
},
_modalFlowListener : function (modalFlowRunning) {
this.modalFlowCoExists = modalFlowRunning
},
_riaFlowListener : function (evtObj) {
if (this.modalFlowCoExists) return;
var type = evtObj.type
var value = evtObj.value
var submitdata = evtObj.submitdata
if (submitdata && "null" != submitdata && "" != submitdata)
this.SetVal(submitdata)
if (type === riaEvtObj.SUBMIT) {
TTOController.submit();
}
else if (type === riaEvtObj.NAV) {
TTOController.doNav("riaAnswer", value);
}
else if (type === riaEvtObj.JUMP) {
TTOController.doTopicJump(value);
}
}
});
zAns = zPrm.extend( function () {
var _public = {
construct : function (ctrl) {
var t=this;
this.superClass.construct.call(this,ctrl);
t.Btn = null;
t.act = null;
t.prtopt = null;
t.label = null;
},
Render : function (data) {
var t=this;
t.act=(data.act)?data.act:null;
t.prtopt = (data.prtopt)?data.prtopt:null;
t.label = data.label;
t.Btn = $(t.fID);
if (t.Btn) {
t.Btn.update(data.type, t.label, null, data.back);
} else {
t.Btn = zAns.appendDlgAns(t.fDOMParent, t.label, t.fID, t.GetPixelWidth(), data.type, null, t, null, data.back);
}
},
_OnClick : function (val) {
var t=this;
if (t.act) {
var act = unescape(t.act)
if (act.indexOf('(') > 0) eval(act)
else eval(act)(this);
}
else if (t.prtopt) {
t.TO = new PrintTO();
var po = t.prtopt;
t.TO.printType=po.prtTyp;
t.TO.filename = po.fn;
t.TO.watermark = po.wm;
var i,
tmp,
len;
if (po.ptfsids && po.ptfsids.length >0) {
len = po.ptfsids.length;
for (i=0; i<len; i++) {
tmp = po.ptfsids[i];
t.TO.formsetList.push(tmp.fsid);
}
}
if (po.ptforms && po.ptforms.length >0) {
t.TO.printType=kPrintSelected;
len = po.ptforms.length;
for (i=0; i<len; i++) {
tmp = po.ptforms[i];
t.TO.addFormToList(tmp);
}
}
var cmd = new PrintCommand(t.TO);
cmd.execute();
}
else{
t.SetVal(val?val:1);
if (!Submit()) {
t.ClearVal();
}
}
}
};
return _public;
}());
zAns.eForwardAnswerType = 0;
zAns.eDoneAnswerType = 1;
zAns.eLargeAnswerType = 2;
zAns.eSmallAnswerType = 3;
zAns.eGuideMeAnswerType = 4;
zAns.eAnalyzerAnswerType = 5;
zAns.eExpertAnswerType = 6;
zAns.ePrintAnswerType = 7;
zAns.eLPageAnswerStartType = 8;
zAns.eLPageAnswerUpdateType = 9;
zAns.eMCUIAnswerType = 10;
zAns.eGreenAnswerType = 11;
zAns.eProcessBarAnswerType = 12;
zAns.eToolbarBtnType = 13;
zAns.eLargeLinkType = 14;
zAns.eLargeBoldLinkType = 15;
zAns.eSmallLinkType = 16;
zAns.eSmallBoldLinkType = 17;
zAns.eAquaType = 18;
zAns.eGuideMeLarge = 19;
zAns.eGuideMeSmall = 20;
zAns.eBkmBtnType = 100;
zAns.eTinaBtnType = 101;
zAns.eMenubarBtnType = 102;
zAns.appendDlgAns = function( p, label, id, btnW, type, act, prm, arg, bBackBtn) {
var Btn = TTO.DU.appendLink( p, null, act, null, null, prm, arg);
Btn.id = id;
var SP = document.createElement('span');
Btn.appendChild(SP);
if (btnW) {
SP.style.width = btnW + "px";
}
var C = document.createElement('nobr');
SP.appendChild(C);
Btn.iconL = TTO.DU.appendImg( C);
Btn.iconL.align = "top";
dontdisplay(Btn.iconL);
Btn.txt = document.createTextNode(".");
C.appendChild(Btn.txt);
Btn.iconR = TTO.DU.appendImg( C);
Btn.iconR.align = "top";
dontdisplay(Btn.iconR);
Btn.update = function(type, label, act, bBackBtn){
var rd = zAns.getAnswerRenderData(type, bBackBtn);
this.txt.nodeValue = unescape(label);
this._act = act;
if (btnW) {
rd.cls += " ansNoPadding";
}
this.className = rd.cls;
if (rd.iL) {
display(Btn.iconL);
changeImage(Btn.iconL, rd.iL);
} else {
dontdisplay(Btn.iconL);
}
if (rd.iR) {
display(Btn.iconR);
changeImage(Btn.iconR, rd.iR);
} else {
dontdisplay(Btn.iconR);
}
Btn.tabIndex=(rd.tabIndex == null)?TTOApp.tabIndex++:rd.tabIndex;
rd = null;
};
if (null != type) {
Btn.update(type, label, act, bBackBtn);
}
Btn.setAttribute('aria-label',decodeURIComponent(label))
Btn.setAttribute('role', 'button')
return Btn;
}
zAns.getAnswerRenderData = function(type,bBackBtn) {
var o = new Object();
var AnsIconL, AnsIconR
var cls = "ansAqua"
switch (type) {
case zAns.eGreenAnswerType:
cls = "ansGrn"
break
case zAns.eLPageAnswerStartType:
cls = "ansLP"
break;
case zAns.eLPageAnswerUpdateType:
cls = "ansRoyal"
break
case zAns.eSmallAnswerType:
cls = "ansSm"
break
case zAns.ePrintAnswerType:
AnsIconL = 'printBtn.gif';
case zAns.eDoneAnswerType:
case zAns.eForwardAnswerType:
case zAns.eLargeAnswerType:
cls = "ansLg"
if (bBackBtn){
AnsIconL = 'md_leftarrow_blu.gif'
}
break
case zAns.eMCUIAnswerType:
cls = "ansMCUI"
break
case zAns.eProcessBarAnswerType:
cls = "ansTabbar"
break
case zAns.eToolbarBtnType:
cls = "toolbarBtn"
AnsIconL = "icon_tools.png"
o.tabIndex=TTOApp.staticElementTabIndex++
break
case zAns.eMenubarBtnType:
cls = "menubarBtn"
o.tabIndex=TTOApp.staticElementTabIndex++
break
case zAns.eLargeLinkType:
cls="ansLLnk"
break;
case zAns.eLargeBoldLinkType:
cls="ansLBLnk"
break;
case zAns.eSmallLinkType:
cls="ansSLnk"
break;
case zAns.eSmallBoldLinkType:
cls="ansSBLnk"
break;
case zAns.eBkmBtnType:
cls = "toolbarBtn"
AnsIconL = "icon_flag.png"
o.tabIndex=TTOApp.staticElementTabIndex++
break
case zAns.eTinaBtnType:
cls = "ansLg"
AnsIconR = 'md_rightarrow_blu.gif'
break;
case zAns.eGuideMeLarge:
cls = "guideMeLg"
AnsIconR = "intgfx_chevron_guideme_btn_large.png"
break
case zAns.eGuideMeSmall:
cls = "guideMeSm"
AnsIconR = "intgfx_chevron_guideme_btn_small.png"
break
case zAns.eAquaType:
case zAns.eGuideMeAnswerType:
case zAns.eAnalyzerAnswerType:
case zAns.eExpertAnswerType:
default:
break
}
o.cls = cls
o.iR = AnsIconR
o.iL = AnsIconL
return o
}
zTogglePanel = zGrid.extend( {
construct: function(ctrl){
this.superClass.construct.call(this, ctrl);
var t = this;
t._fCondition = ctrl.cond;
t._fEval = ctrl.eval;
t._fDisabled = ctrl.disabled;
t._fCoverDiv = null;
t._panel = null;
if (t._fCtrlID) {
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_CtrlElementChange, this._show_hide, this);
}
},
setLayout: function( p){
var t = this;
t._panel = document.createElement("div");
t._panel._prm = t;
t._panel.id = t.fID;
if (!t._fDisabled) {
jQuery(t._panel).hide();
}
if (p) {
p.appendChild(t._panel);
if (t._fDisabled) {
t._fCoverDiv = appendLayer(p);
t._fCoverDiv.sized = false;
hide(t._fCoverDiv);
}
}
this.superClass.setLayout.call(this, t._panel);
},
Render: function(data){
this.superClass.Render.call(this, data);
var t = this;
var tagNames = ["select", "input"];
var i;
for (i = 0; i < tagNames.length; i++) {
var elems = document.getElementsByTagName(tagNames[i]);
var j;
for (j = 0; j < elems.length; j++) {
var e = elems[j];
if (!isUndefined(e._prm) && (e._prm._fCtrlID == t._fCtrlID)) {
if ((zRadio == e._prm.constructor) && (e._prm.single == false)) {
if (e.checked) {
t._show_hide([t._fCtrlID, e]);
}
} else {
t._show_hide([t._fCtrlID, e]);
}
}
}
}
},
_show_hide: function(args ){
var t = this;
var isSingleRB = false;
var isRBGroup = false;
var panelAction = "none";
var ctrl = args[0];
var e = args[1];
if (isUndefined(e) || ctrl != t._fCtrlID) {
return panelAction;
}
if (e.tagName.toLowerCase() == 'input')
{
var elem_type = e.type.toLowerCase();
if (elem_type == "radio") {
if (isUndefined(e._prm)) {
return panelAction;
}
var radioObj = e._prm;
isSingleRB = radioObj.single ? true : false;
isRBGroup = !isSingleRB;
}
if (isSingleRB || elem_type == "checkbox") {
if (e.checked == 1) {
if (((t._fCondition == 1) && (t._fEval == 0)) || ((t._fCondition == 0) && (t._fEval == 1))) {
panelAction = "open";
} else {
panelAction = "close";
}
} else {
if (((t._fCondition == 0) && (t._fEval == 0)) || ((t._fCondition == 1) && (t._fEval == 1))) {
panelAction = "open";
} else {
panelAction = "close";
}
}
}
}
if (isRBGroup || e.tagName.toLowerCase() == 'select')
{
if (t._fEval == 0) {
panelAction = (e.value == t._fCondition) ? "open" : "close";
} else if (t._fEval == 1) {
panelAction = (e.value != t._fCondition) ? "open" : "close";
}
}
if (isUndefined(t._panel)) {
return panelAction;
}
if (panelAction == "open") {
if (t._fDisabled && t._fCoverDiv) {
jQuery(t._fCoverDiv).slideUp(0);
} else {
jQuery(t._panel).slideDown(500);
}
} else if (panelAction == "close" && (t._panel.style.display != 'none')) {
if (t._fDisabled && t._fCoverDiv) {
jQuery(t._fCoverDiv).slideDown(0);
if (!t._fCoverDiv.sized) {
t._fCoverDiv.className = "TogglePanelDisable";
t._fCoverDiv.style.marginTop = "-" + t._panel.offsetHeight + 'px';
t._fCoverDiv.style.width = t._panel.offsetWidth + 'px';
t._fCoverDiv.style.height = t._panel.offsetHeight + 'px';
t._fCoverDiv.sized = true;
}
} else {
jQuery(t._panel).slideUp(0);
}
}
return panelAction;
}
});
zSp = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
this.SP = null
},
Render : function (data) {
var t=this
if (data.w)t.setWidth(data.w)
if (data.h)t.setHeight(data.h)
t.SP = $(t.fID)
if (t.SP) {
t.SP.update(t.GetPixelWidth(), t.GetPixelHeight())
}
else {
t.SP = TTO.DU.appendSp( t.fDOMParent, t.GetPixelWidth(), t.GetPixelHeight(), t.fID)
}
}
});
function newLine( p){p.appendChild(document.createElement("BR"))}
zTxtBlk = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data ) {
var t=this,i,bFrst=true
var SP = $(t.fID)
if (SP) clearKids(SP)
else {
SP = document.createElement("span")
SP.id = t.fID;
t.fDOMParent.appendChild(SP);
}
for (i=0; i<data.length; i++) {
t._renderRn(SP,data[i],bFrst)
bFrst=false;
}
},
renderAsLabel : function (id) {
this._lblId = id;
},
_lblId : null,
_renderRn : function (p, rn, bFirst) {
var t=this
var txt = rn.txt
var css = rn.css
var code = rn.code
var link = rn.lnk
var tab = rn.tab
var rns = rn.rns
var bLink=(code & zTxtBlk.kHelpLinkStyleRun || code & zTxtBlk.kURLStyleRun || code & zTxtBlk.kProgHelpLinkStyleRun)
var bAnchor=(code & zTxtBlk.kAnchorStyleRun)
var bBR=(!bFirst && (code & zTxtBlk.kBgnParagraphStyleRun))
if(bBR)newLine(p)
var e
if(!bFirst&&bAnchor){
e=document.createElement("SPAN")
e.id="runanchr"
p.appendChild(e)
}
if(bLink) {
css = css?css:"textLnk"
e=TTO.DU.appendLink( p, txt, null,css)
e._rn=true;
e.code = code
e.link=link
e.onclick=t._handleClick
}
else if (tab)
e = appendTabText( p, txt, css)
else if (t._lblId)
TTO.DU.appendLabel( p, t._lblId, txt, css)
else
e=TTO.DU.appendText( p, txt, css)
for (var i=0; i<rns.length; i++){
t._renderRn(p,rns[i],false)
}
},
_handleClick : function (ne){
var evt = new zEvent(ne)
evt.cancel()
var e = evt.element
while(e && !e._rn) e=e.parentNode
if (!e) return
if(e.code & zTxtBlk.kHelpLinkStyleRun){
PONWindow.showHypHelp('hyp'+e.link,kHELP_FileType)
}
else if( e.code & zTxtBlk.kProgHelpLinkStyleRun){
gotoProgramHelp(e.link,evt.eventObj.clientX,evt.eventObj.clientY)
}
else if (e.link.length<6){
gotoTaxHelp(e.link,evt.eventObj.clientX,evt.eventObj.clientY)
}
else gotoURL(e.link)
}
},
{
kBgnParagraphStyleRun : 0x01,
kEndParagraphStyleRun : 0x02,
kHelpLinkStyleRun : 0x04,
kAnchorStyleRun : 0x08,
kURLStyleRun : 0x10,
kProgHelpLinkStyleRun : 0x20
}
);
zTxt = zPrm.extend({
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data ) {
TTO.DU.appendText(this.fDOMParent,data.txt, data.css)
}
});
function appendChk( p, id, val){
var e=document.createElement("INPUT")
e.type="checkbox"
e.className="chk";
e.onkeydown=zChkSpaceListener
e._chk=true;
if(id)e.id=id
e.tabIndex=TTOApp.tabIndex++
if(1==val)e.defaultChecked=true
if(p)p.appendChild(e)
return e
}
zChk = zFrmCtrl.extend( {
construct : function (ctrl){
var t=this
this.superClass.construct.call(this,ctrl)
if (ctrl.lbl) {
t.lbl = ctrl.lbl
t.AddCtrl(t.lbl)
}
},
setLayout : function (p) {
var t=this,d=document
var cb_container_div = d.createElement("div");
var cb_row_div = d.createElement("div");
cb_row_div.className = "inputBtnRow"
cb_container_div.appendChild(cb_row_div);
t.fDOMParent = d.createElement("div");
t.fDOMParent.className = "inputBtn";
cb_row_div.appendChild(t.fDOMParent);
var cb_lbl_div = d.createElement("div");
cb_lbl_div.className = "inputBtnLbl";
if (gbMozilla && !gbMac)
cb_lbl_div.style.paddingTop = "1px";
cb_row_div.appendChild(cb_lbl_div);
if (t.lbl) {
var ctrl=t.FindCtrl(t.lbl.name)
ctrl.prm.setLayout(cb_lbl_div);
}
p.appendChild(cb_container_div);
},
Render : function (data) {
var t=this
t.initData(data)
var val = data.val
var lbl = data.lbl
var e = $(t.fID)
if (!e) {
e = appendChk( t.fDOMParent, t.fID,val);
e.id = t.fID
t._setHdlrs(e)
}
else {
if(1==val)e.defaultChecked=true
}
t._setReaderLabel(e, data.hint)
if (t.lbl) {
var ctrl=t.FindCtrl(t.lbl.name)
ctrl.prm.renderAsLabel(t.fID)
ctrl.prm.Render(lbl.data)
}
},
_OnBlur : function ( e){
if(e)this.SetVal((e.checked)?1:0)
},
_OnClick : function ( e) {
this._OnBlur(e)
}
});
function zChkSpaceListener(ne){
var evt=new zEvent(ne)
if (evt.which!=32) return
var e=evt.element
while(e&&!e._chk)e=e.parentNode
if(null==e)return
e.defaultChecked = !e.defaultChecked
}
function appendRadio(p,id,grpID,val,bSelected,prm) {
var P = document.createElement('div')
var s="<input name="+grpID+" type='radio'>"
P.innerHTML=s
var e = P.firstChild
e.className="rad"
e.id=id
e.value=val
e._rad=true
e._prm=prm;
if (bSelected) {
e.defaultChecked=true
e.checked=true
}
e.onkeydown=zRadSpaceListener
e.tabIndex=TTOApp.tabIndex++
p.appendChild(e);
return e
}
function zRadio(ctrl)
{
var t=this
zFrmCtrl.call(t,ctrl)
t.vert=(1==ctrl.v)
t.grpID=ctrl.grp;
t.RadioBtns = new Array();
if (ctrl.lbls) {
t.lbls = ctrl.lbls
for (var i=0; i< ctrl.lbls.length; i++) {
t.AddCtrl(ctrl.lbls[i])
}
}
t.single = !(isUndefined(t.grpID) || t.grpID == "");
}
function _zRadioLayout(p) {
var t=this;
var cnt=t.lbls.length;
var vrt=t.vert;
var radio_container_div = document.createElement("div");
var e=null;
var radio_row_div = null;
for(i=0; i<cnt; i++)
{
var lbl = null;
if(vrt || 0==i)
{
radio_row_div = document.createElement("div");
radio_row_div.className = "inputBtnRow";
radio_container_div.appendChild(radio_row_div);
}
t.RadioBtns[i] = document.createElement("div");
t.RadioBtns[i].className = vrt ? "inputBtn" : "inputBtnHorz";
radio_row_div.appendChild(t.RadioBtns[i]);
var radio_lbl_div = document.createElement("div");
radio_lbl_div.className = vrt ? "inputBtnLbl" : "inputBtnLblHorz";
if (gbMozilla && !gbMac)
radio_lbl_div.style.paddingTop = "1px";
if (t.lbls[i]) {
var ctrl=t.FindCtrl(t.lbls[i].name)
ctrl.prm.setLayout(radio_lbl_div)
}
radio_row_div.appendChild(radio_lbl_div);
}
p.appendChild(radio_container_div);
}
function _zRadioRender(data)
{
var t=this
if(null==this.lbls) return;
var val = data.val
var lbls = data.lbls
t.initData(data)
t.SetVal(val?val:0)
TTOApp.registerPrimForSubmit(this)
for (var i=0; i<lbls.length; i++) {
var id = t.fID+":"+i
var bSelected=false
if (!t.single) {
if(i==t.fVal)
bSelected=true
}
else if (t.fVal)
bSelected=true;
var e = appendRadio( t.RadioBtns[i], id, t.GetElementName(),i,bSelected,t);
t._setHdlrs(e)
t._setReaderLabel(e, data.hint)
if (t.lbls[i]) {
var ctrl=t.FindCtrl(t.lbls[i].name)
ctrl.prm.renderAsLabel(id)
ctrl.prm.Render(lbls[i].data)
}
}
}
function _zRadioOnBlur( e)
{
var t=this
if(gbSafari && !t.single)
{
var rbtns = document.getElementsByName(t.GetElementName());
for(i=0; i < rbtns.length; i++)
{
var rd=$(t.fID+":"+i)
if(e&&e.checked&&e==rd) {
t.SetVal(i);
}
}
}
else
{
if (e && t.single)
{
var rbtns = document.getElementsByName(t.GetElementName());
for (var j=0; j<rbtns.length; j++)
{
var elem = rbtns[j];
if (!isUndefined(elem))
{
var radioObj = elem._prm;
if (!isUndefined(radioObj))
radioObj.SetVal(elem.checked?1:0);
}
}
}
else if(e&&e.checked)
{
t.SetVal(e.value)
}
}
}
function zRadSpaceListener(ne)
{
var evt=new zEvent(ne)
if (evt.which!=32)
return
var e=evt.element
while(e&&!e._rad)e=e.parentNode
if(null==e)
return
e.defaultChecked = !e.defaultChecked
}
function _zRadioGetElementName()
{
var t=this;
var the_name="";
if (isDefined(t))
{
if (t.grpID)
the_name = 'r'+t.grpID;
else
the_name = 'r'+t.fID;
}
return the_name;
}
zRadio.prototype=new zFrmCtrl()
p=zRadio.prototype
p.constructor=zRadio
p.GetElementName=_zRadioGetElementName;
p.Render=_zRadioRender
p.setLayout=_zRadioLayout
p._OnBlur=_zRadioOnBlur
p=null
var _gImgPreloadId=0;
zImg = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t=this;
if (data.w) {
t.setWidth(data.w);
}
if (data.h) {
t.setHeight(data.h);
}
var src = data.src?unescape(data.src):unescape(data.fileRef);
var alt = data.alt?unescape(data.alt):"";
var img = $(t.fID);
if (img) {
var i = TTO.DU.appendImg( null, src, t.GetPixelWidth(), t.GetPixelHeight(), t.fID, alt)
jQuery(img).replaceWith(i)
}
else {
TTO.DU.appendImg( t.fDOMParent, src, t.GetPixelWidth(), t.GetPixelHeight(), t.fID, alt);
}
}
});
zEdt = zFrmCtrl.extend( function () {
var _public = {
_fBad : false,
_fErrorMessage : false,
_fTokenizing: false,
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t=this;
t.initData(data);
t.CC = data.CC;
t.maskedVal = null;
t.tokenized = false;
var editVal = t.fVal;
if (t.CC && t.fVal) {
if (t.fVal.length > 0 && t.fVal.charAt(0) == "9") {
t.tokenized = true;
}
var mask = "";
for (var i=0; i<t.fVal.length-4; i++) {
mask += "*";
}
editVal = mask + editVal.substr(editVal.length-4);
t.maskedVal = editVal;
}
var pw = (7==data.va.ft && 99==data.va.fst)
var e = $(t.fID)
if (!e) {
e = TTO.DU.appendEdt( t.fDOMParent, t.fID, "edit", t.getRawWidth(), data.va.mx, editVal, pw);
}
else {
}
e.setAttribute('autocomplete','off');
e.ft=data.va.ft;
e.fst=data.va.fst;
e.taint = data.va.tnt;
e.mx=data.va.mx;
e.mnv = data.va.mnv;
e.mxv = data.va.mxv;
e.ctx = data.ctx;
if (data.ro) {
e.disabled = data.ro;
e.className="readonly";
}
e._formatter = getFormatter(e.ft, e.fst, e.mx, e.taint);
e._validator = getValidator(e.ft, e.fst, e.mnv, e.mxv, e.mx, e.taint);
t._setHdlrs(e);
t._setReaderLabel(e,data.hint);
if (12 != e.ft)
e.onkeyup=this._OnKeyListener;
try {
if(e.ft == 21 || e.ft == 4 || e.ft == 6 || e.ft == 5) {
e.type = "tel";
}
}
catch(e){ }
},
_OnKeyListener : function (ne) {
var evt=new zEvent(ne);
var e=evt.element;
while (e && !e.ft) {
e = e.parentNode;
}
if (null==e) {
return;
}
var k=evt.which;
var isSpecialChar = (8==k || 9==k || 16==k || (k>=35 && k<=39) || (k>=91 && k<=93));
var ignoreBack = ((8==k) && e._validator.ignoreBackSpace(e.ft));
if (isSpecialChar && !ignoreBack) {
return;
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_RemoveErrorMsg);
if (isDefined(e._prm) && e._prm.CC) {
e._prm.tokenized = false;
}
if (e._formatter && e.ft != 7) {
var caretPos = e._validator.getCaret(e);
var currentValue = e.value;
if (!BrowserSniffer.isAndroid()) {
e.value = e._formatter.format(e.value);
}
if (e.value.length > currentValue.length) {
var lenDif = e.value.length - currentValue.length;
caretPos += lenDif;
}
if (caretPos < e.value.length) {
e._validator.setCaret(e, caretPos);
}
}
},
_OnFocus : function ( e) {
if (!e) {
return;
}
var t=this;
e.className=t._fBad?"editErr":"edit";
if (t._fBad) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ErrorOnPage, e);
}
},
_OnBlur : function( e) {
if (!e) {
return;
}
var t = this, v = e.value;
if (t.maskedVal && t.maskedVal == v) {
return;
}
if (e.ft == 21 && (e.fst == 1 ) && v.charAt(v.length - 1) == '-') {
v = v.substr(0, v.length - 1);
e.value = v;
}
if (e._validator) {
e.errorMsg = e._validator.validate(e.value);
if (e.errorMsg == "") {
if (t.fReaderHint) {
e.setAttribute('aria-label', decodeURIComponent(t.fReaderHint));
}
else {
e.setAttribute('aria-label', '');
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_RemoveErrorMsg);
if (7 == e.ft) {
e.value = e.value.replace(/^\s+/, "");
e.value = e._formatter.format(e.value);
}
if (!t._fbCalced) {
t.SetVal(e.value);
}
t._fBad = false;
if (e._formatter && 12 == e.ft) {
e.value = e._formatter.format(e.value);
}
if (!t._fBad && t.CC && t.fVal && !t.tokenized ) {
t._fTokenizing = true;
gCCEditPrimitive = t;
gCCEditPrimitive.el = e;
gTokenTryCount = 0;
var bEnabled = TokenizeCC(t.fVal);
if (!bEnabled) {
clearTokenCode();
}
}
} else {
t._fBad = true;
e.setAttribute('aria-label', e.errorMsg);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ErrorOnPage, e);
}
} else if (!t._fbCalced) {
t.SetVal(v);
}
e.className = this._fBad ? "editErr" : "edit";
},
isOKToSubmit : function () {
if (this._fTokenizing) {
TransitionMsg.show(kTokenizingMsg);
setTimeout (_waitToSubmit, 100);
return false;
}
if (this._fBad)
TTOApp.showValidationAlert ("You must fix errors on this page before continuing.");
return (!this._fBad);
}
};
function _waitToSubmit () {
if (this._fTokenizing) {
setTimeout (_waitToSubmit, 100);
}
else if (gCCEditPrimitive._fBad) {
TransitionMsg.hide();
_setCCEditBad ()
}
else {
Submit();
}
}
return _public;
}());
kTokenizingMsg = "For your security...<br/>We are encrypting your credit card information.";
kTokenizingErrMsg = "Error encrypting your credit card."
kCCErrMsg = "Invalid credit card."
gCCEditPrimitive = null;
kDefaultTokenScriptSrc="https://gwsoajsod.intuit.com/sdsa";
kRetryTokenScriptSrc="https://gwsoajsod2.intuit.com/sdsa";
kTokenizerRetryAmounts=[20,40,60,20]
function TokenizeCC(cc) {
if ( TTOModel.isQA() && !DebugModel.useTokenizer()) return false;
if (gCCEditPrimitive.CC.UseTokenizer) {
var _url = (0 == gTokenTryCount % 2) ? kDefaultTokenScriptSrc : kRetryTokenScriptSrc;
_url += "?sysid=tto";
Tokenizer.setScriptSrc(_url);
Tokenizer.setSuccessCB(HandleTokenSuccess);
Tokenizer.setErrorCB(HandleTokenError);
Tokenizer.TokenizeCC(cc, kTokenizerRetryAmounts[gTokenTryCount] * 1000 );
;
;
;
;
return true;
} else {
;
return false;
}
}
function HandleTokenSuccess(token) {
;
var t=gCCEditPrimitive;
if (!t) {
return;
}
t.SetVal(token);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER","Tokenizer Success", LOG_INFO));
clearTokenCode();
}
function HandleTokenError(errType, rsp) {
var t=gCCEditPrimitive;
var cc = (t)?t.fVal.substring(t.fVal.length - 4):"xxxx";
var scrpt = (0 == gTokenTryCount % 2) ? kDefaultTokenScriptSrc : kRetryTokenScriptSrc;
var msg = "Tokenizer Message: Try #" + (gTokenTryCount+1) + "; CC=" +cc + "; URL= " + scrpt + "; MSG= ";
if (Tokenizer.kCCError == errType) {
_setCCEditBad( true)
}
else if (Tokenizer.kError_NonRecoverable == errType) {
_setCCEditBad( )
msg += rsp.error.code+" - Non Recoverable...ABORTING";
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER",msg, LOG_ERROR));
}
else if (Tokenizer.kError_JSONParser == errType) {
_setCCEditBad()
msg += "JSON Parse Error - Non Recoverable...ABORTING";
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER",msg, LOG_ERROR));
}
else if (Tokenizer.kError_Recoverable == errType) {
msg += rsp.error.code+" - Recoverable...Retrying";
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER",msg, LOG_INFO));
_retryTokenizer();
return;
}
else if (Tokenizer.kError_Timeout == errType) {
msg += Math.floor(kTokenizerRetryAmounts[gTokenTryCount])+" seconds Timed out: - ...Retrying";
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER", msg, LOG_INFO));
_retryTokenizer();
return;
}
clearTokenCode();
}
function _retryTokenizer() {
if (++gTokenTryCount >= kTokenizerRetryAmounts.length) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TOKENIZER", "Tokenizer Error: Timout...ABORTING", LOG_ERROR));
_setCCEditBad( )
clearTokenCode();
}
else if (gCCEditPrimitive) {
TokenizeCC(gCCEditPrimitive.fVal);
}
}
function clearTokenCode() {
var t=gCCEditPrimitive;
t._fTokenizing=false;
Tokenizer.Abort();
}
function _setCCEditBad (ccError) {
if (!gCCEditPrimitive.CC.AllowCCInApp || ccError) {
gCCEditPrimitive._fBad=true;
gCCEditPrimitive.el.errorMsg = ccError?kCCErrMsg:kTokenizingErrMsg;
gCCEditPrimitive.el.className="editErr";
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ErrorOnPage, gCCEditPrimitive.el);
}
}
zLnk = zPrm.extend( {
construct : function (ctrl) {
var t=this
this.superClass.construct.call(this, ctrl);
},
Render : function(data){
var t=this
t.href = data.href?unescape(data.href):null
t.act = data.act?unescape(data.act):null
var Icn = null
var p = t.fDOMParent
var e=TTO.DU.appendLink( p, null, null, data.css, null, t)
if (data.icon) {
if (!data.css) e.className="iconLnk"
var hi = TTO.DU.appendImg(e,decodeURIComponent(data.icon))
TTO.DU.appendSp(e,5)
}
TTO.DU.appendText(e,data.label)
},
_OnClick : function(){
var t=this
if(t.href)gotoURL(t.href)
else if(t.act)eval(t.act)
else{
t.SetVal(1)
if (!Submit()) {
t.ClearVal()
}
}
}
});
zLnk.kDefLinkStyle= "lnk";
kMaxListboxLines= 25
KSelectCommandText= "Select an item below."
zLst = zFrmCtrl.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t = this
t.choices=data.choices
t.visibleLines=data.vis
t.initData(data)
TTOApp.registerPrimForSubmit(this)
var lst = $(t.fID);
if(data.searchable && !lst){
lst = t._appendSrchLst( t, t.fID, data.choices, data.vis, data.val)
}
else if (!lst){
lst = TTO.DU.appendLst( t.fDOMParent, t.fID, data.choices, data.vis, data.val)
}
else {
}
t.el = lst
var w=t.GetPixelWidth()
if(w>0&&w>t.fMaxLen*7)setDim(lst, lst.style.width)
t._setReaderLabel(lst, data.hint)
t._setHdlrs(lst)
},
_OnBlur : function( e) {
if (!e) return
this.SetVal(e.selectedIndex)
},
setList : function (items,sel, appendTitle) {
var t=this
t.choices=items
delete items
items=null
var lst = $(t.fID)
lst.innerHTML=""
var cnt=(t.choices)?t.choices.length:0
var i, val
var frag = document.createDocumentFragment();
for(i=0;i<cnt;i++){
val = decodeURIComponent(t.choices[i]);
t.choices[i] = val;
var option = document.createElement("option");
option.selected = false;
option.value = i;
option.appendChild(document.createTextNode(val));
if(appendTitle) {
option.title = val;
}
frag.appendChild(option);
}
lst.appendChild(frag);
lst.selectedIndex = sel?sel:0
},
setListInBatches : function(items, sel, appendTitle, cb, si, bCleared) {
var t=this
t.choices=items
var stepSize = 200;
if(!si)
si = 0;
var lst = $(t.fID)
if(!bCleared)
lst.innerHTML=""
var cnt=(items)?items.length:0
var i, val;
var frag = document.createDocumentFragment();
for(i=si; i < cnt && i < si + stepSize; i++){
val = decodeURIComponent(items[i]);
t.choices[i] = val;
var option = document.createElement("option");
option.selected = false;
option.value = i;
option.appendChild(document.createTextNode(val));
if(appendTitle) {
option.title = val;
}
frag.appendChild(option);
}
lst.appendChild(frag);
if(i == cnt) {
lst.selectedIndex = sel?sel:0;
if(cb) cb();
}
else {
setTimeout(function() {
t.setListInBatches(items, sel, appendTitle, cb, i, true);
}, 25);
}
},
setFilter : function (pattern, bApplyPatternAnywhere, bCaseSensitive)
{
var i=0, index=0, regexp, e;
var t=this
var lst = $(t.fID)
if (!lst || !t.choices) return;
try {
pattern=pattern.replace(/([\\\(\)\[\]\{\}\*\.\+\$\?\^|])/g,"\\$1")
var caseflag = bCaseSensitive?'':'i'
if (bApplyPatternAnywhere)
regexp = new RegExp(pattern, caseflag);
else
regexp = new RegExp('^'+pattern, caseflag);
} catch(ex) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zLst","_zSetFilter: error in regex", LOG_INFO, ex))
}
for (i=0; i < this.choices.length; i++) {
if (regexp.test(this.choices[i])) {
lst.selectedIndex = i
break;
}
}
},
_appendSrchLst : function ( t, id, o, ln, val) {
var t = this
var p = t.fDOMParent
clearKids(p)
var l = appendLayer( p, 'srchLstContainer');
t.inpt = TTO.DU.appendEdt( l, "srchListEdt", "srchEdit", 60, 65, val)
var e = t.inpt
e._prm=t
e._fiSrch=true
e.onkeyup=zSrchLstKeyListener
e.setAttribute("hint", "Enter bank or brokerage name here")
if (!val) {
jQuery(e).addClass('defaultText');
jQuery(e).val(e.getAttribute('hint'))
jQuery(e).blur(function() {
var t = jQuery(this)
if (t.val() == ""){
t.addClass('defaultText')
t.val(t.attr('hint'))
}
});
jQuery(e).focus(function () {
var t = jQuery(this)
if (t.val() == t.attr('hint')) {
t.removeClass("defaultText");
t.val("")
}
});
}
l.appendChild(document.createElement("p"))
TTO.DU.appendText( l, KSelectCommandText,"srchCommandTxt")
newLine(l)
var lst = TTO.DU.appendLst( l, id, o, ln, val, 400)
lst.onclick=function() {
jQuery(e).val(lst.options[lst.selectedIndex].text);
jQuery(e).removeClass("defaultText");
}
return lst
},
Delete : function () {
var t=this
t.superClass.Delete.call(this);
jQuery(t.inpt).unbind()
t.inpt = null
}
});
function zSrchLstKeyListener(ne){
var evt=new zEvent(ne);
var e=evt.element
while(e && !e._fiSrch) e=e.parentNode
if (!e) return
var t = e._prm
if (!t) return
t.setFilter(e.value, false)
t.SetVal(t.el.selectedIndex)
}
function zTxtArea(ctrl){
var t=this
zFrmCtrl.call(t,ctrl)
}
function _zTxtAreaRender(data){
var t=this
var e=null
t.initData(data)
if (data.w) t.setWidth(data.w)
if (data.h) t.setHeight(data.h)
e=document.createElement("TEXTAREA")
t.fDOMParent.appendChild(e)
e.id=t.fID;
if (data.w)e.cols=t.GetCharWidth();
if (data.h)e.rows=data.h.val;
if (data.mx)e.maxLength=data.mx;
e.showWarning=true;
if(data.val)e.value=unescape(data.val);
e.tabIndex=TTOApp.tabIndex++
t._setHdlrs(e);
e.onkeyup=zTxtAreaKeyListener
return e
}
function _zTxtAreaOnBlur( e){
if(!e)return
var t=this;
val=e.value;
t.SetVal(val);
}
function zTxtAreaKeyListener(ne){
var evt=new zEvent(ne)
var e=evt.element
if(null==e)return
var val=e.value;
if (val.length>e.maxLength) {
if (e.showWarning) {
TTOApp.showValidationAlert ("The maximum number of characters allowed ("+e.maxLength+") has been reached.");
}
e.value=val.substring(0,e.maxLength);
e.showWarning=false;
}
}
zTxtArea.prototype=new zFrmCtrl()
p=zTxtArea.prototype
p.constructor=zTxtArea
p.Render=_zTxtAreaRender
p._OnBlur=_zTxtAreaOnBlur
p=null
function zJSInfo(ctrl){
zPrm.call(this,ctrl)
}
function _zJSInfoRender(data){
if (data.js)
this.SetVal(eval(unescape(data.js)));
}
zJSInfo.prototype=new zPrm()
p=zJSInfo.prototype
p.constructor=zJSInfo
p.Render=_zJSInfoRender
p=null
zIFr = zPrm.extend( {
construct : function (ctrl){
this.superClass.construct.call(this,ctrl)
if (!this._fWidth) {
this.setWidth(100, 'p')
}
if (!this._fHeight) {
this.setHeight(435,'x')
}
this.url = null
},
Render : function (data){
var t = this
var url;
if (data.system) {
t.url = TTOService.getContentUrl(decodeURIComponent(data.system), decodeURIComponent(data.fileAlias), data.params, data.isFlow)
}
else if (data.url) {
t.url = unescape(data.url)
}
else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("IFRAME","No URL defined", LOG_ERROR))
return;
}
if ($(t.fID) && !data.isFlow) {
$(t.fID).src = t.url
}
else {
jQuery("<iframe noresize scrolling='no' frameborder='no' allowtransparency='true' ></iframe>").attr({
name: t.fID,
id: t.fID,
width: t.getWidth(),
height: t.GetPixelHeight(),
src: t.url
}).appendTo(t.fDOMParent)
MessageHandler.startListener($(t.fID));
}
if (TTOModel.isQA()) {
var page = data.system + (data.isFlow?" (flow)": "")
if (!data.system && t.url.match("https"))
page = t.url.substring(t.url.indexOf('https://') + 8, t.url.indexOf('.com') + 4)
var tmp = t.url.substring(t.url.indexOf("?") + 1)
tmp = tmp.split("&");
var ecParams = "";
for (var i = 0; i < tmp.length; i++) {
ecParams += tmp[i] + '\n'
}
var TO = new DebugTO()
TO.embeddedContentUrl = page
TO.embeddedContentAlias = data.fileAlias
TO.embeddedContentParams = ecParams
TO.embeddedContentRef = t.fID
var cmd = new DebugCommand(TO)
cmd.execute()
}
},
Delete : function () {
this.superClass.Delete.call(this);
MessageHandler.cancelListener($(this.fID));
jQuery($(this.fID)).remove();
}
});
zAds = zPrm.extend( function () {
var _public = {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_InProductOfferOnPage);
_adFrame.init();
},
Delete : function () {
_adFrame.close();
},
Render : function (data) {
var t = this;
TopSrc = unescape(data.iframe[0]);
TopImgSrc = unescape(data.embedURL[0]);
TopClickUrl = unescape(data.embedLink[0]);
BtmSrc = unescape(data.iframe[1]);
BtmImgSrc = unescape(data.embedURL[1]);
BtmClickUrl = unescape(data.embedLink[0]);
var l = appendLayer( t.fDOMParent);
setDim(l, 120, 308);
l.id = kIPOId;
if (!TopSrc || !BtmSrc) {
var act = (TopClickUrl) ? "gotoURL('" + TopClickUrl + "')" : null;
TTO.DU.appendImgLnk( l, TopImgSrc, null, null, null, "", act);
newLine(l);
TTO.DU.appendSp( l, 1, 18, true);
newLine(l);
act = (BtmClickUrl) ? "gotoURL('" + BtmClickUrl + "')" : null;
TTO.DU.appendImgLnk( l, BtmImgSrc, null, null, null, "", act);
}
else {
var q = "topIPO=" + TopSrc + "&btmIPO=" + BtmSrc;
_adFrame.render(kIPOPage + q);
}
}
};
var kIPOId = "_zAdsIPO";
var kIPOPage = "ipoPage.htm?";
var _adFrame = new zViewer("advwr");
return _public;
}());
kNoEntryText= "You haven't entered anything."
kMCUIAddBtn_DefaultLabel= 'Add'
kMaxMCUIWidth = 645
function zMCpy(ctrl) {
var t=this
zPrm.call(t,ctrl)
}
function _zMCpyOnClick( c){
this.SetVal(c)
if (!Submit()) {
t.ClearVal()
}
}
function _zMCpyRender(data){
var t=this,d=document,i
if ($(t.fID)) return
var bDel = data.delActive
var hdrs = data.head
var cols=data.cols
var nC=cols.length
var nR=data.numR
var totalCols = nC
if(bDel)totalCols++
totalCols = (totalCols*2)-1
var colAlign=new Array()
var tbl=new zTable( t.fDOMParent, 0, 0, "100%", 0, 'mcTable', totalCols)
tbl.el.id = t.fID;
tbl.appendRow()
for(i=0;i<hdrs.length;i++){
cType=cols[i].ft
colAlign[i] = (cType>10&&cType<21)?'right':'left'
tbl.appendCol( null, null, (i==0)?15:25, null, "mcHeading")
TTO.DU.appendSp( tbl.curCol, 1, 1)
tbl.appendCol( colAlign[i], null, null, null, "mcHeading")
var nobr = d.createElement("NOBR");
tbl.curCol.appendChild(nobr);
TTO.DU.appendText( nobr, hdrs[i])
}
tbl.appendCol( "right", null, 25, null, "mcHeading")
TTO.DU.appendSp( tbl.curCol, 15, 10)
tbl.appendCol( "center", null, null, null, "mcHeading")
tbl.curCol.width=(bDel)?"110px":"50px"
var iR,iC,cType,s,e,rw,val,valLen,align
if (0 == nR){
tbl.appendRow( null, "top", null, "mcRow")
tbl.appendCol( "center", null, null, null, "mcCol")
tbl.appendCol( "left", null, null, totalCols-2, "mcCol")
TTO.DU.appendText(tbl.curCol,kNoEntryText,"bold");
}
for(iR=0;iR<nR;iR++){
tbl.appendRow( null, "top", null, "mcRow")
for(iC=0;iC<nC;iC++){
tbl.appendCol( "right", "top", (iC==1)?15:25, null, "mcCol")
TTO.DU.appendSp( tbl.curCol, 1, 1)
cType=cols[iC].ft
val=cols[iC].vals[iR]
s=" "
valLen=val.length
if(valLen>0){
if(cType==11||cType==12)s='$'
if(cType==12&&val.charAt(valLen-1)=='.')s+=val.substr(0,valLen-1)
else s+=val
}
tbl.appendCol( colAlign[iC], null, null, null, "mcCol")
if(s.length>0)TTO.DU.appendText( tbl.curCol, s)
else TTO.DU.appendSp( tbl.curCol, 10, 1)
}
tbl.appendCol( "right", null, 25, null, "mcCol")
TTO.DU.appendSp( tbl.curCol, 10, 10)
tbl.appendCol( "center", "top", null, null, "mcDeleteCol")
var nobr = d.createElement("DIV");
tbl.curCol.appendChild(nobr);
zAns.appendDlgAns(nobr,"Edit",t.fID+"_edt"+i,null,zAns.eLPageAnswerStartType,null, t, "E"+iR)
if(bDel){
TTO.DU.appendSp(nobr,5)
zAns.appendDlgAns(nobr,"Delete",t.fID+"_del"+i,null,zAns.eLPageAnswerStartType,null, t, "D"+iR)
}
else tbl.curCol.width="45px";
}
if (nR > 0){
tbl.appendRow( null, "bottom", null, "mcRow")
for (iC=0; iC<nC; iC++) {
tbl.appendCol( "right", "top", null, null, "mcTotalCol")
TTO.DU.appendSp( tbl.curCol, 1, 10)
tbl.appendCol( colAlign[iC], "top", null, null, "mcTotalCol")
cType=cols[iC].ft
val=cols[iC].vals[iR]
s=" "
valLen=val?val.length:0
if(valLen>0 && (cType==11||cType==12)){
s='$'
if(cType==12&&val.charAt(valLen-1)=='.')s+=val.substr(0,valLen-1)
else s+=val
}
else if(valLen>0 && (cType==7)){
s+=val;
}
TTO.DU.appendText( tbl.curCol, s, "mcTotal")
}
tbl.appendCol( "right", null, null, null, "mcTotalCol");
TTO.DU.appendSp( tbl.curCol, 25, 10);
tbl.appendCol( "center", null, null, null, "mcTotalCol");
TTO.DU.appendSp( tbl.curCol, 25, 10);
}
if (data.add && data.addActive)
{
var lbl = data.addLbl?unescape(data.addLbl):kMCUIAddBtn_DefaultLabel
tbl.appendRow( null, "bottom", null, null)
tbl.appendCol( "right", null, null, null, (nR > 0)?"mcAnsCol1":"mcAnsCol")
TTO.DU.appendSp( tbl.curCol, 1, 10)
tbl.appendCol( "left", null, null, totalCols-2, (nR > 0)?"mcAnsCol1":"mcAnsCol")
var btn = zAns.appendDlgAns( tbl.curCol, lbl, t.fID+"_ADD", null, zAns.eLPageAnswerUpdateType, null, t, "A")
}
if (gbIE && tbl.el.clientWidth > kMaxMCUIWidth) {
tbl.el.style.tableLayout = "fixed"
}
tbl.clear()
tbl=null
t.fDOMParent.appendChild(document.createElement("P"));
}
zMCpy.prototype=new zPrm()
p=zMCpy.prototype
p.constructor=zMCpy
p.Render=_zMCpyRender
p._OnClick=_zMCpyOnClick
p=null
kWDIETitle= "Search Topics or Forms"
kSearchTitle= "I'm looking for:"
kExampleText= '(for example "wages", or "W-2")'
kGoBtn= "btn_go.gif"
kWaitText= "Please wait while we initialize the keyword list."
kWaitText2= "(This only needs to be done once)"
kCommandText= "Choose an item below, then select GO."
kViewableRows= 10
kWDIEModalIcon = 'icon_searchform.gif'
kMessageText= 'This search feature isn\'t available for state returns. If you continue, we\'ll take you back to your federal return.'
kMessageConfirm= 'Do you want to Continue?'
gbLoadingKeywordList=false
function showTS() {
var ts=TTOApp.findCtrlByType(32)
if (isUndefined(ts)) return
dontdisplay(ts._fMsgLayer)
if ( !TTOModel.isFed() ){
ts.showWarning()
}
else if (null == TTOApp.fKeywordList){
jQuery(".topicSearchBody").hide();
jQuery(".topicSearchWaiting").show();
setTimeout("requestKeywordList()", 300);
}
else {
try{ts._fSrchInput.focus()}
catch(e){}
}
}
function requestKeywordList(){
if (gbLoadingKeywordList) return
gbLoadingKeywordList=true
TTOController.ajaxToApp(TTOService.kAJAX_GetKeywordList,null, handleKeywordRequest)
}
function handleKeywordRequest(respTO){
data =respTO.responseJSON
TTOApp.fKeywordList = data.keywordList
var ts=TTOApp.findCtrlByType(32)
if (isUndefined(ts)) return
ts._fSrchList.setListInBatches(TTOApp.fKeywordList, null, true, function() {
ModalWindow.hideWaitMsg();
try{ts._fSrchInput.focus()}
catch(e){}
gbLoadingKeywordList=false
jQuery(".topicSearchWaiting").hide();
jQuery(".topicSearchBody").fadeIn(200);
});
}
function zTopicSearch(ctrl){
var t=this
zPrm.call(t,ctrl)
t._fBody=null
t._fMsgLayer=null
t._fSrchInput=null
t._fSrchBtn=null
t._fSrchList=null
t._fSelectedIndex=-1
t._fWDIELayer=document.createElement("DIV")
t._fWDIELayer.className='topicSearch'
t.fbRendered = false;
}
function _zTpSrchCreate(){
var t= this
clearKids(t._fWDIELayer)
t._fSelectedIndex=-1
t._fBody=appendLayer(t._fWDIELayer, "topicSearchBody")
var waitingLayer = appendLayer(t._fWDIELayer, "topicSearchWaiting")
var spinner = TTO.DU.appendImg(waitingLayer, "/img/loading_spinner.gif");
spinner.style.verticalAlign = "middle";
spinner.style.marginRight = "3px";
TTO.DU.appendText(waitingLayer, "Getting topics..");
TTO.DU.appendText( t._fBody, kSearchTitle,"srchTitle")
TTO.DU.appendSp( t._fBody,20)
TTO.DU.appendText(t._fBody,kExampleText,"srchExample")
newLine(t._fBody)
var inBoxDiv = document.createElement('div');
t._fBody.appendChild(inBoxDiv);
t._fSrchInput = TTO.DU.appendEdt( inBoxDiv, "tpsrch", "searchBar", 45, 50)
t._fSrchInput._prm=t
t._fSrchInput._tpSrch=true
t._fSrchInput.onkeyup=zTPKeyListener
t._fSrchInput.onkeydown=zTPKeyListener
TTO.DU.appendSp(t._fBody,1,12)
t._fListLayer = appendLayer( t._fBody)
TTO.DU.appendText( t._fListLayer, kCommandText,"srchCommandTxt")
newLine(t._fListLayer)
var ctrl = new Object
ctrl.name="WDIE"
t._fSrchList = new zLst(ctrl)
t._fSrchList.fDOMParent=t._fListLayer
var data = new Object
data.vis=kViewableRows
t._fSrchList.Render(data)
var el = t._fSrchList.el
el._tpSrch=true
el._prm=t
el.style.width="100%";
el.style.height="160px";
el.style.padding="3px";
el.style.border="3px solid #999";
el.style.color="#333";
el.style.boxShadow="0 1px 3px #ccc";
el.ondblclick=zTPClickListener
el.onkeydown=zTPKeyListener
var goLayer = appendLayer( t._fListLayer,'topicSearchGo');
t._fSrchBtn = TTO.DU.appendImgLnk(goLayer,kGoBtn,null,null,'topicSearchGo');
t._fSrchBtn._tpSrch=true
t._fSrchBtn._prm=t
t._fSrchBtn.onclick=zTPClickListener
jQuery(t._fListLayer).append("<div class='feedbackDiv'><span>Didn't find it?</span> <span class='feedbackLink'>Send Us Feedback</span></div>");
jQuery(".feedbackLink").live('click', function() {
var searchTerm = jQuery(".searchBar").val();
goFeedback('WDIE', searchTerm);
});
t._fMsgLayer = appendLayer( t._fWDIELayer,"topicSearchMsg")
dontdisplay(t._fMsgLayer)
t.fbRendered = true
}
function _zTpSrchCreateFBL(){
var t=this
var l = document.createElement("DIV")
var l = TTO.DU.appendText(l,"Didn't find it? ","srchFBLTxt")
var lnk = TTO.DU.appendLink(l,'Send Us Feedback',null,"srchFBLLink")
lnk._fbl = true
lnk._prm=t
lnk.onclick=zTPFBLListener
return l
}
function zTPKeyListener(ne){
var evt=new zEvent(ne);
var e=evt.element
if (13==evt.which) {
zTPClickListener(ne)
}
else {
while(e && !e._tpSrch) e=e.parentNode
if (!e) return
var t = e._prm
if (!t) return
t._fSrchList.setFilter(e.value)
}
}
function zTPClickListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._tpSrch) e=e.parentNode
if(!e) return
e = e._prm
evt.cancel()
if(TTOApp)TTOApp.fWaitMsg="Accessing Your Topic"
var sel = e._fSrchList.el.selectedIndex
if (sel>=0 && e._fSrchList.el[sel].value >= 0) {
var keys = new Array();
keys.push("s_prop2");
var vals = new Array();
vals.push(e._fSrchList.choices[sel]);
zBeacon.addBeacon(eOmnitureBeacon,"Search Topics or Forms", "Search Topics", keys, vals);
e._fSelectedIndex=e._fSrchList.el[sel].value
e.onClose()
e.submit()
TTOEventPubSub.publishEvent(zToolbar.kHideToolCenter);
}
}
function zTPFBLListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._fbl) e=e.parentNode
if (!e) return
e = e._prm
evt.cancel()
goFeedback('WDIE',e._fSrchInput.value);
}
function zTPCancelListener(ne){
var evt = new zEvent(ne)
var t=evt.element._prm
evt.cancel()
t.onClose();
TTOEventPubSub.publishEvent(zToolbar.kHideToolCenter);
}
function _zTPSrchOnClose() {
var t=this
t.show(false)
if (t._fSrchInput){
t._fSrchInput.blur()
t._fSrchInput.value=""
t._fSrchList.setFilter("")
}
}
function _zTPSubmit(){
var t=this
if (t._fSelectedIndex < 0) return
t.ClearVal();
t.SetVal(t._fSelectedIndex)
if(!Submit()) {
t.ClearVal();
}
}
function _zTPShow(bShow) {
var t=this
if (bShow){
if (!t.fbRendered)
t.create()
var tsLayer = jQuery(t._fWDIELayer);
var tcContentLayer = jQuery("." + zToolbar.kToolScreenClass + " .content");
TTOEventPubSub.publishEvent(zToolbar.kUpdateToolCenterHeader, "Topic Search");
if(jQuery(".topicSearch").length == 0)
tcContentLayer.empty("").append(tsLayer);
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolScreenView);
setTimeout(showTS, 300);
}
}
function _TPShowWarning(){
var t=this
var d=document
clearKids(t._fMsgLayer)
hide(t._fBody)
display(t._fMsgLayer)
TTO.DU.appendText( t._fMsgLayer, kMessageText,"main")
t._fMsgLayer.appendChild(d.createElement('P'))
TTO.DU.appendText( t._fMsgLayer, kMessageConfirm,"mainbold")
TTO.DU.appendSp(t._fMsgLayer,7);
var ok = d.createElement("INPUT")
ok.type="button"
ok.value='Yes'
ok.className="srchBtnHi"
ok._warn=true
ok._prm=t
ok.onclick=zWarningOKListener
t._fMsgLayer.appendChild(ok)
TTO.DU.appendSp(t._fMsgLayer,7);
var cancel = d.createElement("INPUT")
cancel.type="button"
cancel.value='No'
cancel.className="srchBtnHi"
cancel._prm=t
cancel.onclick=zTPCancelListener
t._fMsgLayer.appendChild(cancel)
t._fMsgLayer.style.position="absolute"
t._fMsgLayer.style.top=t._fBody.offsetTop+"px"
t._fMsgLayer.style.left="0px";
t._fMsgLayer.style.width="100%";
}
function zWarningOKListener(ne){
var evt = new zEvent(ne)
var e=evt.element
while(e && !e._warn) e=e.parentNode
if(!e) return
var t=e._prm
if(!t) return
dontdisplay(t._fMsgLayer)
show(t._fBody);
if (null == TTOApp.fKeywordList){
ModalWindow.showWaitMsg()
requestKeywordList()
}
}
function _zTPResetKeywordList(){
if (isDefined(TTOApp.fKeywordList)){
TTOApp.fKeywordList = null
}
}
zTopicSearch.prototype=new zPrm()
p=zTopicSearch.prototype
p.constructor=zTopicSearch
p.show=_zTPShow
p.create=_zTpSrchCreate
p.CreateFBL=_zTpSrchCreateFBL
p.onClose=_zTPSrchOnClose
p.showWarning=_TPShowWarning
p.submit=_zTPSubmit
p.resetKeywordList=_zTPResetKeywordList
zTopicList = zRIASwf.extend( {
construct : function(ctrl) {
this.superClass.construct.call(this, ctrl);
TTOEventPubSub.subscribeForEvent(zTopicList.kTopicListReturnedEvent, this._onTopicListReturned, this);
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_BgnPage, this._clearTreeData, this);
TTOEventPubSub.subscribeForEvent(zToolbar.kSwitchToToolScreenViewComplete, this._inView, this);
},
show : function(bShow) {
var that = this;
if(!bShow) return;
var tlContainer = jQuery("<div id='" + this._kTLContainerID + "' class='" + this._topicListCSS + "'></div>");
jQuery("." + zToolbar.kToolScreenClass + " .content").empty("").append(tlContainer);
tlContainer.width(zToolbar.kToolScreenWidth - 28);
tlContainer.height(zToolbar.kToolScreenHeight - 40);
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolScreenView);
TTOEventPubSub.publishEvent(zToolbar.kUpdateToolCenterHeader, "Topic List");
},
Render : function() {
},
GetVal : function() {
return this._fSelectedIndex;
},
_clearInternalState : function() {
jQuery("#expandAllTL").unbind("click");
jQuery("#collapseAllTL").unbind("click");
this._currentIndex = 0;
this._nodeJumpOn = false;
},
_inView : function() {
if(jQuery("#" + this._kTLContainerID).length == 0)
return;
var that = this;
if(!zTopicList.cssLoaded) {
loadCSS("topiclist.css");
zTopicList.cssLoaded = true;
}
if(!zTopicList.jsLoaded) {
JSLoader.load("jquery.jstree.js", function() {
zTopicList.jsLoaded = true;
that._getTopicList();
});
}
else
this._getTopicList();
},
_clearTreeData : function() {
this._treeCollection = new Array();
},
_showSpinner : function(bShow) {
if(bShow) {
var tlContainer = jQuery("#" + this._kTLContainerID);
jQuery("<div id='TopicListSpinnerContainer' class='TopicListSpinnerContainer'><div class='TopicListSpinnerInner'><img src='/img/loading_spinner.gif' style='vertical-align:middle;' />&nbsp;&nbsp;Loading...</div></div>").appendTo(tlContainer);
}
else
jQuery("#TopicListSpinnerContainer").remove();
},
_getTopicList : function() {
this._clearInternalState();
this._showSpinner(true);
if(this._treeCollection.length === 0) {
var getTopicListCommand = new GetTopicListCommand();
getTopicListCommand.setFailureCB(function() {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zTopicList", "Could not retrieve data from server", LOG_ERROR));
});
getTopicListCommand.execute();
}
else {
this._renderTree();
}
},
_onTopicListReturned : function(json) {
if(json) {
this._topics = json.data.topics;
if(json.data.focusIdx != null && json.data.focusIdx != undefined) {
this._initialSelect = ["topic_" + json.data.focusIdx];
}
else {
this._initialSelect = [];
}
this._createTreeCollection();
this._renderTree();
}
else {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("zTopicList", "No JSON returned for topic list", LOG_ERROR));
}
},
_bindEventsToTree : function(tree) {
var that = this;
tree.bind("loaded.jstree", function(event, data) {
that._showSpinner(false);
jQuery("#" + that._kTLContainerID + " li[isChecked=true]").each(function() {
jQuery.jstree._reference('#' + that._kTLContainerID).check_node(this);
});
var footerLinks = jQuery("<div class='TopicListFooter'></div>");
var expandAllBtn = jQuery("<div id='expandAllTL' class='TopicListFooterButton'><div class='TopicListFooterLIcon'>+</div>&nbsp;&nbsp;Expand All</div>");
var collapseAllBtn = jQuery("<div id='collapseAllTL' class='TopicListFooterButton'><div class='TopicListFooterLIcon'>-</div>&nbsp;&nbsp;Collapse All</div>");
footerLinks.append(expandAllBtn).append(collapseAllBtn).appendTo("." + zToolbar.kToolScreenClass + " .content");
jQuery("#expandAllTL").capture("click", function() {
jQuery("#" + that._kTLContainerID).jstree("open_all");
});
jQuery("#collapseAllTL").capture("click", function() {
jQuery.jstree._reference('#' + that._kTLContainerID).deselect_all(tree);
jQuery("#" + that._kTLContainerID).jstree("close_all");
});
});
tree.bind("select_node.jstree", function(event, data) {
if(that._initialSelect.length !== 0) {
if(!that._nodeJumpOn) {
that._nodeJumpOn = true;
return;
}
}
var nodeId = data.rslt.obj.attr('id');
var idx = nodeId.substring(6);
var tl = TTOApp.findCtrlByType(25)
if (isUndefined(tl))
return;
TTOApp.registerPrimForSubmit(tl);
if (idx != null)
{
tl._fSelectedIndex = idx;
if (!Submit()) {
TTOApp.removePrimFromSubmit(tl)
}
TTOEventPubSub.publishEvent(zToolbar.kHideToolCenter);
}
});
},
_renderTree : function() {
var tree = jQuery("#" + this._kTLContainerID);
var that = this;
this._bindEventsToTree(tree);
tree.jstree({
"core" : {
},
"ui" : {
"initially_select" : this._initialSelect
},
"themes" : {
"url" : "/img",
"icons" : false
},
"json_data" : {
"data" : this._treeCollection[0].children
},
"checkbox" : {
"checked_parent_open" : false
},
"plugins" : [ "themes", "json_data", "ui", "checkbox" ]
});
},
_createTreeCollection : function() {
var _tl = new Object();
_tl.txt = "My Tax Return";
_tl.lvl = -1;
_tl.idx = null;
this._treeCollection.push(this._createChildren(_tl));
},
_createChildren : function(topicItem) {
var node = new Object();
node.data = unescape(topicItem.txt);
var attr = {};
attr.id = "topic_" + topicItem.idx;
attr.isChecked = (topicItem.v == 0 || topicItem.v == undefined) ? "false" : "true";
node.attr = attr;
node.children = [];
var tempString = node.data;
var childNode = [];
while (this._topics[this._currentIndex] && topicItem.lvl < this._topics[this._currentIndex].lvl){
childNode.push(this._createChildren(this._topics[this._currentIndex++]));
}
if (childNode.length){
node.children = childNode;
}
return node;
},
_treeCollection : [],
_currentIndex : null,
_topics : null,
_initialSelect : null,
_nodeJumpOn : false,
_topicListCSS : "TopicList",
_kTLContainerID : "__tplst_00__"
}, {kTopicListReturnedEvent : "topicListReturned"});
kBrowserID= "bwsrid"
kFileName= "file"
kBrowserForm= "brwsfrm"
kSafariBrwsForm = 'safbrwsfrm'
kUploadFailMsg = "Uh oh. The file you uploaded is too big.<p/>Make sure you selected the right file. Don't worry, if it's still too big, we'll help you enter your info manually so you can keep working on your taxes"
var g_actCtrl = null
var g_FormUpload = null
function brwsSubmit(t)
{
g_actCtrl = t;
var d = document
var f = g_FormUpload
var _inputHasValue = false;
var _e = document.getElementById(kBrowserID);
if (_e && (_e.value.length > 0))
_inputHasValue = true;
if (f && _inputHasValue)
f.submit()
else
{
TTOApp.showValidationAlert("Please supply a valid file to upload.");
return;
}
TransitionMsg.show("Uploading your TurboTax Desktop file")
}
function zUploadDataFileReady()
{
var t = g_actCtrl
if( null != t )
{
t.SetVal(1)
if (!Submit()) {
t.ClearVal()
}
}
}
function uploadFailure(msg)
{
TTOApp.showValidationAlert(kUploadFailMsg, 150 );
TransitionMsg.hide()
}
function zFileUpload(ctrl){
var t=this
zFrmCtrl.call(t,ctrl)
}
function _zFURender(data){
var t=this
var d=document
if (data.w) t.setWidth(data.w)
if (gbSafari){
var e=document.createElement("DIV")
var s = '<form id="'+kSafariBrwsForm+'" name="brwsfrm" style="Z-INDEX:999;" target="rsp" method="post" enctype="multipart/form-data" action="'+TTOService.getTTOUrl(TTOService.kFileUploadCommand)+'"><input id="'+kBrowserID+'" name="file" type="file" /></form>'
e.innerHTML=s
g_FormUpload=e.firstChild
t.fDOMParent.appendChild(g_FormUpload)
return
}
g_FormUpload=d.createElement("FORM")
g_FormUpload.setAttribute('id',kBrowserForm)
g_FormUpload.setAttribute('name',kBrowserForm)
g_FormUpload.setAttribute('action',TTOService.getTTOUrl(TTOService.kFileUploadCommand))
g_FormUpload.setAttribute('method',"post")
g_FormUpload.target="rsp"
g_FormUpload.encoding = "multipart/form-data"
var e=d.createElement("INPUT")
e.type="file"
e.setAttribute("id",kBrowserID)
e.setAttribute("name",kFileName)
e.setAttribute("autocomplete","off")
e.className="edit"
e.size=t.GetCharWidth()
if (gbMac && gbMozilla && (e.size >= 80))
e.size=60
e.tabIndex=TTOApp.tabIndex++
g_FormUpload.appendChild(e)
t.fDOMParent.appendChild(g_FormUpload)
}
zFileUpload.prototype=new zFrmCtrl()
p=zFileUpload.prototype
p.constructor=zFileUpload
p.Render=_zFURender
p=null
kSignOutMsg = "Signing Out"
kSignOutMsgURL = "/secure/SignOut.htm"
function zSignOut(ctrl) {
var t=this
zPrm.call(t,ctrl)
}
function _zSORender(data){
var t=this
if ($(t.fID)) return
var p = t.fDOMParent
var e=TTO.DU.appendLink( p, data.label, null, "signout", null, t)
e.id = t.fID
e.title+=unescape(data.label)
}
function _zSOOnClick(dontShowMsg){
var t=this
TransitionMsg.setMessage(kSignOutMsg)
t.SetVal(1)
if (Submit()) {
if (!dontShowMsg) {
Message.show(kSignOutMsgURL,Message.kMsg_UrlType)
setTimeout("exitOnError()", 7000);
}
}
else {
t.ClearVal()
}
}
zSignOut.prototype=new zPrm()
var p=zSignOut.prototype
p.constructor=zSignOut
p.Render=_zSORender
p._OnClick=_zSOOnClick
p=null
zChart = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t = this;
if(!zChart.jsLoaded) {
JSLoader.load("highcharts.js", function() {
zChart.jsLoaded = true;
t._render(data);
});
}
else
t._render(data);
},
_render : function(data) {
var t = this;
if (data.w) {
t.setWidth(data.w.val, data.w.type);
var currentHeight = t.GetPixelWidth();
if (data.aspect) {
currentHeight = currentHeight * data.aspect / 100;
}
t.setHeight(currentHeight);
}
switch(data.style.toLowerCase()) {
case "rainbow":
t._colorScheme = zChart.kRainbowColors;
break;
case "green":
t._colorScheme = zChart.kGreenColors;
break;
case "red":
t._colorScheme = zChart.kRedColors;
break;
case "blue":
t._colorScheme = zChart.kBlueColors;
break;
default:
break;
}
t._chartData = t._parseChartData(data.series);
t._containerID = zRIA.generateId(t.fID);
t._setupChartContainer();
if(data.type == zChart.kColumnChart) {
t._chartType = "column";
t._renderBarColumnChart();
}
else if(data.type == zChart.kBarChart) {
t._chartType = "bar";
t._renderBarColumnChart();
}
else if(data.type == zChart.kPieChart) {
return;
}
},
_parseChartData : function( series) {
var t = this;
var categories = [];
var numOfCategories = series.length;
for(var i = 0; i < numOfCategories; i++) {
categories.push(decodeURIComponent(series[i].desc));
}
t._categories = categories;
var keys = [];
if(numOfCategories) {
for(var key in series[0]) {
if(key.indexOf(zChart._kGroupKeyLabelPrefix) >= 0) {
keys.push(key);
}
}
}
var tmpSeries = [];
for(var i = 0; i < keys.length; i++) {
var group = {
data : []
};
for(var j = 0; j < numOfCategories; j++) {
group.data.push(decodeURIComponent(series[j][keys[i]]).toNum(true));
}
tmpSeries.push(group);
}
t._series = tmpSeries;
},
_setupChartContainer : function() {
var t = this;
if ($(t._containerID)) {
t._container = jQuery(t._containerID);
t._container.html("");
}
else {
t._container = jQuery("<div id='" + t._containerID + "'></div>");
t._container.appendTo(t.fDOMParent);
}
t._container.width(t.GetPixelWidth());
t._container.height(t.GetPixelHeight());
},
_renderBarColumnChart : function() {
var t = this;
new Highcharts.Chart({
chart : {
backgroundColor : '',
renderTo : t._containerID,
type : t._chartType,
spacingTop : 30,
spacingBottom : 30
},
title : {
text : ''
},
legend : {
enabled : false
},
color : t._colorScheme,
xAxis : {
categories : t._categories
},
yAxis : {
title : {
text : ''
}
},
series : t._series,
tooltip : {
enabled : false
},
plotOptions : {
column : {
dataLabels : {
color: "#333",
style: {
textShadow: "0 0 1px #c5c5c5",
fontWeight: "bold"
},
enabled : true,
y : -10,
formatter : function() {
var digits = ("" + this.y).split("");
var output = "";
var count = 0;
for(var i = digits.length - 1; i >= 0; i--) {
if(count != 3) {
output = digits[i] + output;
count++;
}
else {
output = digits[i] + "," + output;
count = 1;
}
}
return "$" + output;
}
},
borderColor : "#555",
borderWidth : 2,
minPointLength : 2
}
}
});
},
isOKToSubmit: function(){
return true;
},
_style : "",
_chartType : "",
_chartData : null,
_container : null,
_containerID : null,
_categories : null,
_series : null,
_colorScheme : null
}, {
kColumnChart : "ColumnChart",
kBarChart : "BarChart",
kPieChart : "PieChart",
jsLoaded : false,
_kGroupKeyLabelPrefix : "label",
kRainbowColors : ["#07a634", "#ad2934", "#285f9f", "#a6662f", "#4b289f",
"#81a130", "#07a38f", "#9b219f", "#7e7e7e", "#83d299", "#d69499", "#93afcf", "#d2b297", "#a593cf",
"#c0d097", "#83d1c7", "#cd90cf", "#bebebe"],
kGreenColors : ["#07a634", "#39b85d", "#6aca85", "#9cdbae", "#cdedd6", "#e7f6eb"],
kRedColors : ["#ad2934", "#bd545d", "#ce7f85", "#dea9ae", "#efd4d6", "#f7eaeb"],
kBlueColors : ["#285f9f", "#537fb2", "#7e9fc5", "#a9bfd9", "#d4dfec", "#eaeff6"]
});
zLegendRIA = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
},
Render : function (data) {
var t = this;
if(data.w) {
this.setWidth(data.w.val, data.w.type);
if(data.categories && !isUndefined(data.categories.length)) {
var height = 10 + data.categories.length * 23;
this.setHeight(height);
}
else {
;
this.setHeight(50);
}
}
switch(data.style.toLowerCase()) {
case "rainbow":
t._colorScheme = zChart.kRainbowColors;
break;
case "green":
t._colorScheme = zChart.kGreenColors;
break;
case "red":
t._colorScheme = zChart.kRedColors;
break;
case "blue":
t._colorScheme = zChart.kBlueColors;
break;
default:
break;
}
t._containerID = zRIA.generateId(t.fID);
t._setupLegendContainer();
t._insertContent(data.categories);
},
isOKToSubmit : function() {
return true;
},
_setupLegendContainer : function() {
var t = this;
if($(t._containerID)) {
t._container = jQuery(t._containerID);
t._container.empty();
}
else {
t._container = jQuery("<div id='" + t._containerID + "'></div>");
t._container.appendTo(t.fDOMParent);
}
t._container.width(t.GetPixelWidth());
t._container.height(t.GetPixelHeight());
},
_insertContent : function( categories) {
var t = this;
var c = t._container;
for(var i = 0, length = categories.length; i < length; i++) {
var color = t._colorScheme[i % t._colorScheme.length];
var html = "<div class='legendRow'>" +
"<div class='legendBullet' style='background-color:" + color + "'></div>" +
"<div class='legendText'>" + decodeURIComponent(categories[i]) + "</div>" +
"<div class='clearDiv'></div>" +
"</div>";
c.append(html);
}
},
_containerID : null,
_container : null,
_colorScheme : null
});
function zSeparator(ctrl) {
var t=this
zPrm.call(this,ctrl)
}
function _zSeparatorRender(data ){
var t = this;
var p = t.fDOMParent;
var sepStyle;
if( data.style ) sepStyle = decodeURIComponent(data.style);
else sepStyle = "sep_solid";
if( data.vertical && data.vertical == 1) sepStyle += "_vert";
var d = appendLayer(p, sepStyle);
if( data.w ) d.style.width = data.w.val + "px";
}
zSeparator.prototype=new zPrm()
p=zSeparator.prototype
p.constructor=zSeparator
p.superclass=zPrm.prototype
p.Render=_zSeparatorRender
p=null;
zHelpSummary = zPrm.extend( {
construct : function (ctrl) {
this.superClass.construct.call(this, ctrl);
this.helpContent = null;
},
Render : function (data) {
var t=this;
var lnkText = data.helpTitle;
if(lnkText) {
t.helpContent = data.helpText.data;
var e = TTO.DU.appendLink( t.fDOMParent, lnkText, null, data.style?data.style:"lpNumLink", null, t);
if(data.w) {
t.setWidth(data.w);
}
e.id = t.fID;
e.title = unescape(lnkText);
}
},
_OnClick : function (val) {
var t = this;
var hc = t.helpContent;
if(hc) {
PONWindow.show(hc, kHELP_HBlockType);
}
}
});
TransitionMsg = (function(){
var _instance = {
show : function (msg) {
if (msg) _msg = msg
else if (null == _msg) {
_msg = "Processing..."
if (!TTOModel.isDelayedAuth() && _dataExistsOnPage)
_msg = 'Saving your information...'
}
_show();
},
hide : function () {
_hide()
},
setMessage : function (msg) {
_msg = msg;
},
setSpecialMsg : function (msg, modal, css) {
_msg = msg;
_modal = modal;
_css = css;
},
setMsgPosition : function (x,y) {
if (y) jQuery(_defaultMsgLayer).css("margin-top",y);
if (x) jQuery(_defaultMsgLayer).css("margin-left",x);
},
suspendTransitions : function (bSuspend) {
_suspend = bSuspend
},
setDataExistsMsg : function () {
_dataExistsOnPage = true;
}
};
var _initialized = false;
var _contentArea = null;
var _defaultMsgLayer = null;
var _txtLayer = null;
var _msg = null
var _modal = false;
var _css = "waitMsgBkg"
var _suspend = false;
var _dataExistsOnPage = false;
function _init() {
_contentArea = $('contentRegion');
_createDefaultTransition()
_initialized = true;
}
function _createDefaultTransition() {
_defaultMsgLayer = appendLayer($('waitRegion'), "waitMsgBkg")
var spinner = TTO.DU.appendImg(_defaultMsgLayer,"loading_spinner.gif")
spinner.align="top"
_txtLayer = appendLayer(_defaultMsgLayer, "waitMsgLayer")
}
function _show (bModal) {
if (_suspend) return;
_renderMessage()
_defaultMsgLayer.className = _css;
if (_modal) {
jQuery(_contentArea).fadeTo(0, .25)
}
else {
jQuery(_contentArea).hide()
}
jQuery('#waitRegion').show()
}
function _hide() {
jQuery('#waitRegion').hide()
jQuery(_contentArea).show()
if (_modal) jQuery(_contentArea).fadeTo(0, 1)
_dataExistsOnPage = false;
_msg = null
_modal = false
_css = "waitMsgBkg"
jQuery(_defaultMsgLayer).css("margin-top",0);
jQuery(_defaultMsgLayer).css("margin-left",0);
}
function _renderMessage () {
if (!_initialized) _init()
jQuery(_txtLayer).empty()
jQuery(_txtLayer).html(_msg)
}
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_Submit, _instance.show)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_FinalizePg, _instance.hide)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_ModalFlowExists, _instance.suspendTransitions)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_InputDataOnPage, _instance.setDataExistsMsg)
return _instance;
})();
gbLoadPaymentUpdate=true
gbPaidStatusString="Paid"
gbPurchaseViewTitleString="My TurboTax Fees"
kTTFeesModalIcon = "icon_ttfees.gif"
kTotalDueHeader="Total Due:"
kTotalPurchaseHeader="Total Fees:"
kTotalPaidHeader="Amount Paid:"
kTotalBalanceDueHeader="Balance Due:"
kErrorMessage="You haven't entered enough information for us to display your TurboTax fees."
kUpdateText="Waiting for update..."
kIncludedText="Included"
kPurchaseViewHelpLink="Help with My TurboTax Fees"
kPurchaseViewTaxLine="plus applicable sales tax"
priceColumnWidth = 35
nameColumnWidth = 230
lastColumnWidth = 35
function requestShoppingCartData(){
TTOController.ajaxToApp(TTOService.kAJAX_GetShoppingCartData, null, receiveShoppingCartData)
}
function receiveShoppingCartData(respTO) {
var ShoppingCart = TTOApp.findCtrlByType(100);
if (!ShoppingCart) return;
var data = ""
var json = respTO.responseJSON;
data = json.items;
ShoppingCartData = data[0]
includedFeatures = data[1]
ShoppingCart._totalPaid = 0
ShoppingCart._totalDue = 0
var itemList = new Array()
var item = null;
for (var i = 0; i < ShoppingCartData.length; i+=1) {
item = new zShoppingCartItem(ShoppingCartData[i])
itemList.push(item)
if (item._fTFItemPaid) {
ShoppingCart._totalPaid += (item._fTFItemPrice - 0) * 100 / 100;
} else {
ShoppingCart._totalDue += (item._fTFItemPrice - 0) * 100 / 100;
}
}
if (itemList.length == 0 && data.length > 2) {
ShoppingCart._fShoppingCartError = true
display(ShoppingCart._fErrorLayer,"block")
dontdisplay(ShoppingCart._fTableLayer,"block")
dontdisplay(ShoppingCart._fTotalLayer,"block")
} else {
ShoppingCart._fShoppingCartError = false
dontdisplay(ShoppingCart._fErrorLayer)
display(ShoppingCart._fTableLayer,"block")
display(ShoppingCart._fTotalLayer,"block")
ShoppingCart._itemList = itemList
ShoppingCart._fIncludedFeatures=includedFeatures
ShoppingCart.ClearTable()
ShoppingCart.RenderItemTable()
ShoppingCart.RenderTotal()
}
ModalWindow.hideWaitMsg();
}
function zShoppingCart(ctrl){
var t=this
zPrm.call(t,ctrl)
t._totalTable=null
t._totalPaid=0
t._totalDue=0
t._itemList=null
t._paidItemList=null
t._unpaidItemList=null
t._fTableLayer=null
t._fTotalLayer=null
t._fShoppingCartBase=null
t._fErrorLayer=null
t._fShoppingCartWindow=null
t._fShoppingCartHeaders=null
t._fShoppingCartItems=null
t._fShoppingCartError=false
t._fIncludedFeatures=null
t._fVisible=false
t.Render()
}
function _zShoppingCartRender(){
var t=this
var d=document
t._fShoppingCartBase = d.createElement("DIV")
t._fShoppingCartBase.className = 'PurchaseViewBase'
t._fTableLayer = d.createElement("DIV")
t._fTableLayer.className = 'PurchaseTable'
t._fTotalLayer = d.createElement("DIV")
t._fTotalLayer.className = 'PurchaseTotal'
t._fErrorLayer = d.createElement("DIV")
t._fErrorLayer.className = 'PurchaseViewError'
dontdisplay(t._fErrorLayer)
t._fHelpLayer = d.createElement("DIV");
t._fHelpLayer.className = "PurchaseFooter";
TTO.DU.appendLink( t._fHelpLayer, kPurchaseViewHelpLink, 'gotoProgramHelp("scr50034",100,100,900)', "HelpLinkText", null);
t._fShoppingCartBase.appendChild(t._fTableLayer)
t._fShoppingCartBase.appendChild(t._fTotalLayer)
t._fShoppingCartBase.appendChild(t._fErrorLayer)
t._fShoppingCartBase.appendChild(t._fHelpLayer)
t.RenderErrorMessage( t._fErrorLayer)
}
function _zShoppingCartRenderItemTable() {
var t = this
if (t._itemList.length > 0) {
t._fShoppingCartItems = new zTable( t._fTableLayer, 0, 0, null, null, "PurchaseTableRow", 3)
t.RenderItem( t._fShoppingCartItems, t._itemList)
}
}
function _zShoppingCartClearTable() {
var t = this
var c = t._fTableLayer.firstChild;
while (c) {
t._fTableLayer.removeChild(c)
c = t._fTableLayer.firstChild;
}
if (t._fShoppingCartItems != null) {
t._fShoppingCartItems.clear()
t._fShoppingCartItems = null
}
}
function _zShoppingCartRenderItem( tbl, itemList) {
var t = this
for (var i in itemList) {
tbl.appendRow( null, "top", null, null)
var backgroundColor = "#FFFFFF";
if (i%2 == 0)
backgroundColor = "#e5e5e5";
tbl.curRow.style.backgroundColor = backgroundColor;
tbl.appendCol( "left", "top", nameColumnWidth, null, "SelectedItemTitle")
TTO.DU.appendText( tbl.curCol, itemList[i]._fTFItemName, null, getIdFromString(itemList[i]._fTFItemName))
if (itemList[i]._fTFDisplayIncluded)
t.RenderIncluded(tbl.curCol, t._fIncludedFeatures)
tbl.appendCol( "right", "top", priceColumnWidth, null, "SelectedItemPrice")
var priceText = t.FormatDollarAmount(itemList[i]._fTFItemPrice)
TTO.DU.appendText( tbl.curCol, priceText, null, getIdFromString(itemList[i]._fTFItemName + "_price"))
if (priceText == "Included")
tbl.curCol.style.fontSize="11px"
if (t._totalPaid > 0 && !itemList[i]._fTFItemPaid)
tbl.curCol.style.color="#cc3300"
tbl.appendCol( "right", "top", priceColumnWidth, null, "PaidText")
TTO.DU.appendText( tbl.curCol, (itemList[i]._fTFItemPaid)?"(Paid)":" ", null)
tbl.appendCol( "right", "top", lastColumnWidth, null, "PaidText")
}
}
function _zShoppingCartRenderIncluded( p, featureList) {
if (featureList && featureList.length > 0) {
newLine( p)
var includedHeader = TTO.DU.appendText( p, "Included: ", "IncludedFeaturesHeader")
newLine( p)
includedHeader.style.textWeight = "bold"
for (var i = 0; i < featureList.length; i++) {
TTO.DU.appendText( p, "- " + featureList[i], "IncludedFeaturesText")
newLine( p)
}
}
}
function _zShoppingCartTotalLines( totalTable, header, amount, color, bold, asteric) {
totalTable.appendCol( "left", "top", nameColumnWidth, null, "TotalsHeaderText")
TTO.DU.appendText( totalTable.curCol, header, null, getIdFromString("ttfees_" + header))
if (bold != null)
totalTable.curCol.style.fontWeight = "bold"
if (amount == "Included")
amount = "$0.00"
var columnWidth =
totalTable.appendCol( "right", "top", priceColumnWidth, null, "TotalsAmountText")
TTO.DU.appendText( totalTable.curCol, amount, null, getIdFromString("ttfees_" + header + "_price"))
if (bold != null) {
totalTable.curCol.style.fontWeight = "bold"
}
if (color != null) {
totalTable.curCol.style.color = color;
totalTable.curCol.style.fontWeight = "bold"
}
if (asteric != null)
TTO.DU.appendText( totalTable.curCol, "*", "SalesTaxAsteric")
totalTable.appendCol( "left", "top", priceColumnWidth, null, "TotalsAmountText")
}
function _zShoppingCartRenderTotal() {
var t = this
if (t._totalTable != null) {
t._totalTable.clear()
clearKids(t._fTotalLayer)
t._totalTable = null
}
TTO.DU.appendSp( t._fTotalLayer, 1, 5, null)
t._totalTable = new zTable( t._fTotalLayer, 0, 0, "100%", null, null, 3)
if (t._totalPaid == 0) {
t._totalTable.appendRow()
t.TotalLines( t._totalTable, kTotalDueHeader, t.FormatDollarAmount(t._totalDue), null, true, true)
} else {
t._totalTable.appendRow()
t.TotalLines( t._totalTable, kTotalPurchaseHeader, t.FormatDollarAmount(t._totalDue + t._totalPaid), null, true)
t._totalTable.appendRow()
t.TotalLines( t._totalTable, kTotalPaidHeader, t.FormatDollarAmount(t._totalPaid) + "*", null, null)
if (t._totalDue > 0) {
t._totalTable.appendRow()
t.TotalLines( t._totalTable, kTotalBalanceDueHeader, t.FormatDollarAmount(t._totalDue), "#CC3300", null, true)
}
}
TTO.DU.appendSp( t._fTotalLayer, 1, 3, null)
TTO.DU.appendText( t._fTotalLayer, " * ", "SalesTaxAstericSmall")
TTO.DU.appendText( t._fTotalLayer, kPurchaseViewTaxLine, "SalesTaxFooter")
}
function _zShoppingCartFormatDollarAmount( amount) {
var value = Math.round(amount * 100) / 100;
var textAmount = value.toString()
var decimalIndex = textAmount.indexOf(".")
if (decimalIndex < 0)
textAmount = textAmount + ".00"
while (decimalIndex > 0 && textAmount.length - decimalIndex < 3) {
textAmount = textAmount + "0"
}
return "$" + textAmount
}
function _zShoppingCartRenderErrorMessage( p)
{
TTO.DU.appendText( p, kErrorMessage, null)
}
function _zShoppingCartShow( showTF){
var t=this
if (showTF){
TTOEventPubSub.publishEvent(zToolbar.kSwitchToToolScreenView);
var shoppingCartDiv = jQuery(t._fShoppingCartBase);
jQuery("." + zToolbar.kToolScreenClass + " .content").empty("").append(shoppingCartDiv);
requestShoppingCartData();
TTOEventPubSub.publishEvent(zToolbar.kUpdateToolCenterHeader, "My TurboTax Fees");
if (zBeacon.isBeaconSample()){
zBeacon.addBeacon(eOmnitureBeacon,"My TurboTax Fees","Fees")
}
} else {
var c = t._fShoppingCartBase.firstChild;
while (c) {
dontdisplay(c)
c = t._fShoppingCartBase.firstChild;
}
ModalWindow.hide()
}
}
zShoppingCart.prototype=new zPrm()
p=zShoppingCart.prototype
p.constructor=zShoppingCart
p.Render=_zShoppingCartRender
p.RenderItemTable=_zShoppingCartRenderItemTable
p.RenderItem=_zShoppingCartRenderItem
p.RenderIncluded=_zShoppingCartRenderIncluded
p.ClearTable=_zShoppingCartClearTable
p.RenderTotal=_zShoppingCartRenderTotal
p.TotalLines=_zShoppingCartTotalLines
p.FormatDollarAmount=_zShoppingCartFormatDollarAmount
p.show=_zShoppingCartShow
p.RenderErrorMessage=_zShoppingCartRenderErrorMessage
function zShoppingCartItem( data) {
var t = this
if (data[0] == "true") {
t._fTFDisplayIncluded = true
} else {
t._fTFDisplayIncluded = false
}
t._fTFItemName = data[1]
t._fTFItemCode = data[2]
t._fTFItemConfirmation = data[3]
t._fTFItemCurrency = data[4]
t._fTFItemPrice = data[5]
if (data[6] == "true") {
t._fTFItemPaid = true
} else {
t._fTFItemPaid = false
}
}
function zShoppingCartItemToString() {
var t = "name : " + this._fTFItemName
t += "; code : " + this._fTFItemCode
t += "; confirmation : " + this._fTFItemConfirmation
t += "; currency : " + this._fTFItemCurrency
t += "; price : " + this._fTFItemPrice
t += "; paid : " + this._fTFItemPaid
t += "; removable : " + this._fTFItemRemovable
return t
}
zShoppingCartItem.prototype=new zPrm()
i = zShoppingCartItem.prototype
i.fID=i._fTFItemCode
i.fVal=i._fTFItemName
i.fParent=null
i.toString=zShoppingCartItemToString
i.constructor = zShoppingCartItem
kBCLTitle= "Business Code Lookup"
kBCLSearchTitle= "Enter keyword(s) that describe your business:"
kBCLExampleText= 'Example: retail grocery store, financial, construction, plumbing'
kBCLSearchBtn= "btn_go.gif"
kBCLOkBtn= "btn_ok.gif"
kBCLCancelBtn= "btn_cancel.gif"
kBCLCommandText= "Choose an item below, then select OK."
kBCLViewableRows= 10
kBCLModalIcon = 'icon_mag-glass.gif'
kBCLSearchTextID = "BCLSearchID"
function showBizCode(){
var bizCode = new zBizCode();
if( bizCode ) {
bizCode.Render();
bizCode.Show(true);
}
}
function zBizCode(){
var t=this
t._fWaitLayer=null
t._fMsgLayer=null
t._fSrchList=null
t.fProgressBar=null
t._fSelectedIndex=-1
t._fBizCodeLayer=document.createElement("DIV")
t._fBizCodeLayer.className='topicSearch'
}
function _zBizCodeRender(){
var t=this
clearKids(t._fBizCodeLayer)
var body = appendLayer(t._fBizCodeLayer,"topicSearchBody")
var txtLayer = appendLayer(body)
TTO.DU.appendText(txtLayer,kBCLSearchTitle,"srchTitle")
newLine(txtLayer)
TTO.DU.appendSp(txtLayer,0,25)
var inpt = TTO.DU.appendEdt(txtLayer,kBCLSearchTextID,"edit",35,50)
inpt.onfocus=zEventSelectElement
inpt.onkeydown=zBCKeyListener
TTO.DU.appendSp(txtLayer,10,1)
zAns.appendDlgAns(txtLayer,"GO","bzGO",null,zAns.eSmallAnswerType, null ,this, "GO")
newLine(txtLayer)
TTO.DU.appendSp(txtLayer,0,15)
TTO.DU.appendText(txtLayer,kBCLExampleText,"srchExample")
newLine(txtLayer)
TTO.DU.appendSp(txtLayer,1,12)
t._fListLayer = appendLayer(body)
TTO.DU.appendText(t._fListLayer,kBCLCommandText,"srchExample")
newLine(t._fListLayer)
t._fSrchList = appendLayer(t._fListLayer,"bizcode")
t._fSrchList.id="bizcodeSearch"
t._fSrchList.style.marginBottom = "20px"
TTO.DU.appendSp(t._fListLayer,1,12)
TTO.DU.appendSp(t._fListLayer,130,12)
zAns.appendDlgAns(t._fListLayer,"Cancel","bzX",null,zAns.eLPageAnswerStartType, null ,this, "X")
TTO.DU.appendSp(t._fListLayer,4,12)
zAns.appendDlgAns(t._fListLayer,"OK","bzOK",null,zAns.eLPageAnswerUpdateType, null ,this, "OK")
return t._fBizCodeLayer
}
function zBCKeyListener(ne){
var evt=new zEvent(ne);
var e=evt.element
if (13==evt.which) {
requestBizCodeList($(kBCLSearchTextID).value)
}
}
function _BizCodeOnClick(arg)
{
switch (arg) {
case "GO" : requestBizCodeList($(kBCLSearchTextID).value); break;
case "OK" : zBizCodeOnOk(); break;
case "X" : ModalWindow.hide(); break;
}
}
function requestBizCodeList(srchStr){
if(srchStr) srchStr = srchStr.replace(/^\s+|\s+$/g, "");
TTOController.ajaxToApp(TTOService.kAJAX_GetBizCodeList,srchStr,handleBizCodeRequest)
}
function handleBizCodeRequest(respTO){
var bizcode = document.getElementById("bizcodeSearch");
if( bizcode ) clearKids(bizcode)
var json = respTO.responseJSON
dispTable(unescape(json.biz))
}
function zBizCodeOnOk(){
var radioControl = document.getElementsByName("radiobutton")
var value;
sel = 0;
if( radioControl == null ) return
for (i=radioControl.length-1; i > -1; i--) {
if (radioControl[i].checked)
value = radioControl[i].value
}
var editControl = document.getElementById("edt_00")
if( editControl && value ){
editControl.value = value
editControl.focus()
}
ModalWindow.hide()
}
function _zBizCodeOnClose(){
}
function _zBizCodeShow(bShow){
var t=this
ModalWindow.setTitle(kBCLTitle,kBCLModalIcon)
ModalWindow.setCloseCallback(_zBizCodeOnClose)
if (bShow){
ModalWindow.show(t._fBizCodeLayer,ModalWindow.kModal_HTMLType,function(){
try{$(kBCLSearchTextID).focus()}
catch(e){}
})
}
else {
if (t._fBizCodeLayer)
ModalWindow.hide();
t.submit()
}
}
function myobject(){
this.label = ""
this.desc = ""
this.code = ""
}
function dispTable(text){
var tr, td, txt;
var currentPos = 0;
var desc;
var bizcode = document.getElementById("bizcodeSearch");
var table = document.createElement("table");
var tbody = document.createElement("tbody");
var obj = new myobject()
if( text.length < 2 ){
var editControl = document.getElementById(kBCLSearchTextID);
var editValue = ""
if( editControl ) editValue = editControl.value
tr = document.createElement("tr");
td = document.createElement("td");
var P=document.createElement("DIV")
var s='We <strong>did not find </strong>a code for <strong>' + editValue + '</strong><BR>'
s += "Here's how to <strong>refine</strong> your search:<BR>";
s += "- Be sure to check your spelling.<BR>";
s += "- Try entering a different description or keyword (instead of \"freelance copywriter\", enter \"writer\").<BR>";
s += "- Keep your description short (instead of \"long-distance transport carrier\", enter \"truck driver\").<BR>";
s += "No luck? <strong>Enter 999999</strong> (Miscellaneous) if you can't find a more specific code. It will not affect your tax return.";
P.innerHTML=s
td.appendChild(P);
tr.appendChild(td);
tbody.appendChild(tr);
}
else{
while ( currentPos != -1 ){
currentPos = getNextLabel(currentPos, text, obj);
if ( currentPos != -1 ){
tr = document.createElement("tr");
td = document.createElement("td");
var P=document.createElement("DIV")
var s='<div class="bizcodeLabel"><input name="radiobutton" type="radio" id="radiobtn" value="'+obj.code+'" '
s+='>'
s+=obj.label+'<strong>('+obj.code+')</strong></input></div>'
s+='<div class="bizcodeResults">'
s+=obj.desc
s+='</div>'
P.innerHTML=s
td.appendChild(P);
tr.appendChild(td);
tbody.appendChild(tr);
}
}
}
table.appendChild(tbody);
bizcode.appendChild(table);
}
function getNextLabel(pos,text,myobj){
var found = false;
var labelTag = "<label>"
var endlabelTag = "</label>"
var start = text.indexOf(labelTag,pos);
var end = text.indexOf(endlabelTag,pos);
if( start == -1 ) return -1
myobj.label = text.substring(start+labelTag.length,end);
var codeTag = "<code>"
var endcodeTag = "</code>"
start = text.indexOf(codeTag,pos);
end = text.indexOf(endcodeTag,pos);
if( start == -1 ) return -1
myobj.code = text.substring(start+codeTag.length,end);
var descTag = "<desc>"
var enddescTag = "</desc>"
start = text.indexOf(descTag,pos);
end = text.indexOf(enddescTag,pos);
myobj.desc = text.substring(start+descTag.length,end);
return end+enddescTag.length;
}
zBizCode.prototype=new zPrm()
p=zBizCode.prototype
p.constructor=zBizCode
p.Render=_zBizCodeRender
p._OnClick=_BizCodeOnClick
p.Show=_zBizCodeShow
p.onClose=_zBizCodeOnClose
Message = new function()
{
var Message = this;
var kMessageLayerID='messageLayer'
var kMessageTitle ='TurboTax Online Message!'
var iframe = new zViewer("msgvwr")
var viewer=null
var hlpContent=null
var isCurrentlyShowing=false;
Message.kMsg_UrlType = "f"
Message.kMsg_HTMLType = "h"
Message.kMsg_HBlockType = "b"
Message._renderMessageLayer = function () {
var d=document
var l = d.createElement("DIV")
l.className="MsgPopup"
l.id=kMessageLayerID
TTO.DU.appendImg(l,'exituserID_bg-box.gif',450,295)
viewer = appendLayer(l,"MsgBody")
hlpContent=appendLayer(viewer,"MsgPopupContent")
dontdisplay(hlpContent)
d.body.appendChild(l)
iframe.init(null,viewer)
iframe.el.scrolling="no"
return l
},
Message.show = function ( content, type)
{
isCurrentlyShowing = true;
var msgLayer = $(kMessageLayerID)
if (isUndefined(msgLayer))
msgLayer = Message._renderMessageLayer()
var x = 200;
var y = 100;
var viewPort = RIAModalWindow.getViewPortDimensions();
if (y < viewPort.vs)
y = y + viewPort.vs;
if (x < viewPort.hs)
x = x + viewPort.hs;
TTO.H.showModalBg();
hideProblemLayers(true);
var animateEl = jQuery(msgLayer);
animateEl.css("left", "200px");
animateEl.css("top", "-400px");
animateEl.animate({
left: x,
top: y
}, 500);
Message._clearMessage()
animateEl.show();
if (type == Message.kMsg_UrlType) {
iframe.render(content)
iframe.setpos(0,0,null,'100%','100%')
}
else if (type == Message.kMsg_HBlockType){
display(hlpContent)
content.Render(hlpContent)
}
else if (type == Message.kMsg_HTMLType){
display(hlpContent)
hlpContent.appendChild(content)
}
},
Message.hide = function(bDontAnimate)
{
isCurrentlyShowing = false;
var msgLayer = $(kMessageLayerID)
if (isUndefined(kMessageLayerID)) return
if (bDontAnimate) {
_hideMessage()
}
else {
var animateEl = jQuery(msgLayer);
animateEl.css("left", "200px");
animateEl.css("top", "100px");
animateEl.animate({
left: "200",
top: "-400"
}, 300, _hideMessage);
}
function _hideMessage(){
jQuery(msgLayer).hide();
hideProblemLayers(false);
Message._clearMessage();
TTO.H.hideModalBg();
}
},
Message._clearMessage = function()
{
var msgLayer = $(kMessageLayerID)
if (isUndefined(msgLayer)) return
if (isDefined(iframe)) {
iframe.close()
}
hlpContent.innerHTML=""
dontdisplay(hlpContent)
},
Message.isShowing = function() {
return isCurrentlyShowing;
}
}
ModalWindow = new function()
{
var ModalWindow = this;
var kModalLayerID='modalLayer'
var kModalTitle ='TurboTax Online Message!'
var title=""
var titleLayer=null
var icon=null
var lnks = new Array()
var linkLayer=null
var viewer=null
var modalHTMLContent=null
var waitLayer=null
var waitMsg=""
var waitMsgLayer=null
var bShowing=false
ModalWindow.kModal_UrlType = "f"
ModalWindow.kModal_HTMLType = "h"
ModalWindow.kModal_HBlockType = "b"
ModalWindow.closeCB = null
ModalWindow.Render = function () {
var d=document
var l = d.createElement("DIV")
l.className="ModalWin"
l.id=kModalLayerID
TTO.DU.appendImg(l,'mp_background.png',415,452)
titleLayer = appendLayer(l,"ModalTitle")
viewer = appendLayer(l,"ModalBody")
waitLayer = appendLayer(l,"ModalWait")
var wi = appendLayer(waitLayer,"ModalWaitImg")
waitMsgLayer = appendLayer(waitLayer,"ModalWaitMsg")
var linkArea = appendLayer(l,"ModalLinks")
var lnkTbl = new zTable(linkArea,0,0, "100%")
lnkTbl.appendRow()
lnkTbl.appendCol( "left", "middle")
linkLayer = lnkTbl.curCol
lnkTbl.appendCol( "right", "middle")
var close = TTO.DU.appendImgLnk(lnkTbl.curCol,"modal_close.gif",51,13,"modalClose","close","ModalWindow.hide()","modal_close_over.gif")
jQuery(l).hide();
d.body.appendChild(l)
},
ModalWindow._setTitle= function ()
{
clearKids(titleLayer)
if (isDefined(icon)) {
TTO.DU.appendImg(titleLayer,icon)
TTO.DU.appendSp(titleLayer,10)
}
if (isDefined(title))
TTO.DU.appendText(titleLayer,title,"ModalTitle")
},
ModalWindow.setCloseCallback = function (cb)
{
ModalWindow.closeCB = cb
},
ModalWindow._setLinks = function ()
{
for (var i=0; i<lnks.length; i++)
{
linkLayer.appendChild(lnks[i])
TTO.DU.appendSp(linkLayer,10)
}
},
ModalWindow.showWaitMsg= function ()
{
if (!waitMsgLayer) return
var d=document
clearKids(waitMsgLayer)
if (isDefined(waitMsg)) {
TTO.DU.appendText(waitMsgLayer,waitMsg)
display(waitLayer)
dontdisplay(viewer)
}
},
ModalWindow.hideWaitMsg=function() {
if (!waitMsgLayer) return
clearKids(waitMsgLayer)
dontdisplay(waitLayer)
display(viewer)
},
ModalWindow.setTitle = function ( ttl, icn)
{
title = ttl
icon = icn
},
ModalWindow.setWaitMsg = function (msg)
{
waitMsg=msg
},
ModalWindow.addLink = function ( e)
{
lnks.push(e)
}
ModalWindow.show = function ( content, type, cb, bShowWait)
{
modalHTMLContent = content
modalHTMLContent.id = "modelContent"
var modalbkg = $(MODALBKG)
var modalLayer = $(kModalLayerID)
if (isUndefined(modalLayer))
modalLayer = ModalWindow.Render()
ModalWindow._setTitle()
ModalWindow._setLinks()
var viewPort = RIAModalWindow.getViewPortDimensions();
TTO.H.showModalBg();
hideProblemLayers(true);
RIAModalWindow.center(modalLayer, 415, null, true, false);
jQuery(modalLayer).fadeIn(100, cb);
if (type == ModalWindow.kModal_HTMLType){
viewer.appendChild(modalHTMLContent)
}
if (bShowWait) ModalWindow.showWaitMsg()
else ModalWindow.hideWaitMsg()
bShowing = true
show($(kModalLayerID));
},
ModalWindow.hide = function()
{
var modalbkg = $(MODALBKG)
var modalLayer = $(kModalLayerID)
if (isUndefined(modalLayer) || !bShowing) return
if( ModalWindow.closeCB ) ModalWindow.closeCB()
jQuery(modalLayer).fadeOut(100, function(){hide(modalLayer);
hideProblemLayers(false);
ModalWindow._clear();
jQuery(modalbkg).hide();
});
bShowing=false;
},
ModalWindow._clear = function()
{
try{
var modalLayer = $(kModalLayerID)
if (isUndefined(modalLayer)) return
if (isDefined(modalHTMLContent))
viewer.removeChild(modalHTMLContent)
linkLayer.innerHTML=""
closeCB=null
delete lnks; lnks = null
lnks = new Array
waitMsg=""
}
catch(ex){
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("ModalWindow","ModalWindow._clear",LOG_ERROR, ex))
}
}
}
PONWindow = new function()
{
var PONWindow = this;
var el = null
var viewer = null
var bVisible=false
var back=null
var filenames=new Array()
var filetypes=new Array()
var previousMoreFilename=null
var iframe = new zViewer("HELPPOPUP")
var msgLayer=null
var hlpContent=null
var bkg=null
var moreBtn=null
var msg=null
var bkgImg=null
var elMore = null
var viewerMore = null
var bVisibleMore = null
var backMore=null
var iframeMore = new zViewer("HELPMOREPOPUP")
var msgLayerMore=null
var hlpContentMore=null
var topics=new Array()
PONWindow.Render = function () {
var d=document
var l = d.createElement("DIV")
l.id="HelpPopupID"
l.className="HelpPopup"
bkg = TTO.DU.appendImg(l,'pon_bg_opened.png',460,463)
var buttonLayer = appendLayer(l, "HelpViewerLinks");
buttonLayer.id="HelpViewerLinksID";
var b = appendLayer(buttonLayer, "HelpBack");
back = TTO.DU.appendImgLnk(b,"btn_back_hyphelp.gif",57,22,"PONBack","Back",PONWindow.backListener,"btn_back_hyphelp_over.gif")
back._prm=PONWindow
back._bk=true
var cls = appendLayer(buttonLayer, "HelpClose");
cls.id="HelpCloseID"
var close = TTO.DU.appendImgLnk(cls,"pon_btn_close_default.png",32,32,"PONClose","Close",PONWindow.closeListener,"pon_btn_close_hover.png")
close._cls=true
close._prm=PONWindow
msgLayer = appendLayer(l,"HelpMsg")
viewer=appendLayer(l,'HelpViewer')
viewer.id="HelpViewerID"
var footerLayer = appendLayer(l, "HelpFooterLinks");
var prt = appendLayer(footerLayer, "HelpPrint");
prt.onclick = PONWindow.printListener;
prt.innerHTML = '<img src="/img/' + 'pon_btn_print.png' + '" align="top" />&nbsp;&nbsp;';
prt.appendChild(d.createTextNode("Print This Help"));
var more = appendLayer(footerLayer, "HelpMore");
moreBtn = d.createElement("A")
moreBtn._lnk=true;
moreBtn.className = 'ansLg';
var spn = d.createElement('span');
moreBtn.appendChild(spn);
moreBtn.onclick = PONWindow.moreHelpListener;
spn.appendChild(d.createTextNode("See More Help"));
var img=d.createElement("img")
img.border=0
img.align="top"
img.src = "/img/" + 'md_rightarrow_blu.gif'
spn.appendChild(img)
more.appendChild(moreBtn);
var backBtn = appendLayer(footerLayer, "HelpBackMore");
backMore = d.createElement("A")
backMore._lnk=true;
backMore.className = 'ansLg';
var bakspn = d.createElement('span');
backMore.appendChild(bakspn);
var bakimg=d.createElement("img")
bakimg.border=0
bakimg.align="top"
bakimg.src = "/img/" + 'md_leftarrow_blu.gif'
bakimg.style.marginTop = "4px";
bakspn.appendChild(bakimg)
backMore.onclick = PONWindow.moreBackListener;
backBtn.appendChild(backMore);
dontdisplay(backMore)
viewer.onmousedown=zEventCancelListener
hlpContent=appendLayer(viewer,"HelpPopupContent")
dontdisplay(hlpContent)
el = l
d.body.appendChild(l)
iframe.init(null,viewer)
jQuery(l).draggable().touch({
animate: false,
sticky: false,
dragx: true,
dragy: true,
rotate: false,
resort: true,
scale: false
});
PONWindow.RenderMoreHelp()
},
PONWindow.RenderMoreHelp = function () {
var d=document
var l = d.createElement("DIV")
l.id="HelpMorePopupID"
l.className="HelpMorePopup"
msgLayerMore = appendLayer(l,"HelpMoreMsg")
viewerMore=appendLayer(l,'HelpMoreViewer')
viewerMore.id="HelpMoreViewerID"
viewerMore.onmousedown=zEventCancelListener
hlpContentMore=appendLayer(viewerMore,"HelpMorePopupContent")
dontdisplay(hlpContentMore)
elMore = l
var hlpWndw = document.getElementById("HelpPopupID");
hlpWndw.appendChild(l);
if (!isDefined(iframeMore)) {
iframeMore = new zViewer("HELPMOREPOPUP")
}
iframeMore.init(null,viewerMore)
iframeMore.el.scrolling="no"
},
PONWindow.showHypHelp = function (topic) {
;
var d = document
var cnt = null
topic = topic.toLowerCase()
var fs = TTOModel.getDialogInfo().curFS.toLowerCase()
var curFS = fs.substring(fs.length-3,fs.length)
if (curFS == 'per') {
curFS = 'fdi'
}
var url = '/secure/help/'+curFS+'/hyper/'+topic+'.htm'
PONWindow.show(url,kHELP_FileType)
},
PONWindow.show = function ( fn, type, z) {
jQuery("#ttoContainer").bind("click", PONWindow.closeListener);
jQuery("#HelpPopupID").click(function(event){
event.stopPropagation();
});
var padding=20
if (kHELP_HBlockType != type && fn.match(kTopicRegEx) )
{
var topicID = fn.match(kTopicRegEx).toString().split('.')[0];
topics.push(topicID);
}
else
{
;
topics.push(fn);
}
previousMoreFilename=null
if (!bVisible || filenames[filenames.length-1] != fn) {
if (!isDefined(el)) {
PONWindow.Render()
}
hideProblemLayers(true);
if (!bVisible) {
RIAModalWindow.center(el,450,450,true, true)
jQuery(el).fadeIn(100);
}
if (0==filenames.length || filenames[filenames.length-1] != fn) {
if (bVisible) {
jQuery(el).fadeOut(100, function() {
bVisible=false;
hide();
PONWindow.hideMoreHelp();
PONWindow.clearMore();
PONWindow.show(fn,type);
});
return
}
PONWindow.clear()
if (type == kHELP_FileType) {
iframe.render(fn)
iframe.setpos(0,0,null, jQuery("#HelpViewerID").width()-2, jQuery("#HelpViewerID").height()-2)
}
else if (type == kHELP_HBlockType) {
display(hlpContent)
var prm = new zTxtBlk()
prm.fDOMParent=hlpContent
prm.Render(fn)
}
else if (type == kHELP_HTMLType) {
display(hlpContent)
hlpContent.innerHTML=fn
}
filenames.push(fn)
filetypes.push(type)
PONWindow.RenderUIElements()
}
var hlpVw = document.getElementById("HelpViewerID");
var hlpCnt = document.getElementById("HELPPOPUP");
if(filenames.length > 1) {
show(back)
hlpVw.style.top = "59px";
hlpVw.style.height = "338px";
hlpCnt.style.height = "338px";
}
else {
hide(back)
hlpVw.style.top = "27px";
hlpVw.style.height = "370px";
hlpCnt.style.height = "370px";
}
bVisible=true
el.style.zIndex=z?z:300
if (zBeacon.isBeaconSample()){
PONHelper.addPONBeacon("")
}
}
else {
PONWindow.hideMoreHelp()
PONWindow.hide()
}
},
PONWindow.hide = function () {
PONWindow.hideMoreHelp();
if (!bVisible) return;
jQuery(el).fadeOut(100);
hideProblemLayers(false);
PONWindow.clear()
PONWindow.clearMore()
filenames=new Array()
filetypes=new Array()
previousMoreFilename=null
topics=new Array()
bVisible=false
el.style.zIndex=0
},
PONWindow.showMoreHelp = function ( fn) {
if (!isDefined(elMore)) {
PONWindow.RenderMoreHelp()
}
frames['HELPMOREPOPUP'].focus();
if (!bVisibleMore) {
RIAModalWindow.center(elMore,450,450,true, true)
if ( previousMoreFilename != fn ) {
PONWindow.clearMore()
iframeMore.render(fn)
previousMoreFilename=fn
}
iframeMore.setpos(0,0,null,viewerMore.offsetWidth-2,viewerMore.offsetHeight-2)
var hlpCls = document.getElementById("HelpCloseID");
var x = hlpCls.offsetLeft
jQuery.easing.def = "easeInOutExpo";
jQuery(bkg).animate({
width: "737px",
height: "463px"
}, 100);
elMore.style.top = "0px";
elMore.style.left = x+25 + 'px';
elMore.style.zIndex = 301;
elMore.style.visibility = "visible"
hlpCls.style.left = "684px";
dontdisplay(moreBtn)
display(backMore)
}
bVisibleMore=true
if (zBeacon.isBeaconSample()) {
PONHelper.addPONBeacon("_More")
}
},
PONWindow.hideMoreHelp = function () {
if (!bVisibleMore) return;
frames['HELPPOPUP'].focus();
jQuery.easing.def = "easeInOutExpo";
jQuery(bkg).animate({
width: "460px",
height: "463px"
}, 100);
dontdisplay(backMore)
display(moreBtn)
var hlpWndwLinks = document.getElementById("HelpViewerLinksID");
var hlpCls = document.getElementById("HelpCloseID");
hlpWndwLinks.appendChild(hlpCls);
hlpCls.style.left = "420px";
hlpCls.style.top = "-10px";
elMore.style.zIndex = -1;
elMore.style.visibility = "hidden"
bVisibleMore=false
},
PONWindow.backListener = function (ne) {
var evt = new zEvent(ne)
evt.cancel()
PONWindow.clearMore()
previousMoreFilename=null
if (topics.length > 1) {
topics.pop()
}
if (filenames.length > 1) {
filenames.pop()
filetypes.pop()
fn = filenames.pop()
type = filetypes.pop()
PONWindow.show(fn,type)
}
},
PONWindow.moreBackListener = function (ne) {
var evt = new zEvent(ne);
evt.cancel()
PONWindow.hideMoreHelp()
},
PONWindow.closeListener = function (ne) {
jQuery("#ttoContainer").unbind('click', PONWindow.closeListener);
var evt = new zEvent(ne)
evt.cancel()
PONWindow.hideMoreHelp()
PONWindow.hide()
},
PONWindow.printListener = function (ne) {
var evt = new zEvent(ne);
evt.cancel()
try {
frames['HELPPOPUP'].focus();
frames['HELPPOPUP'].print();
}
catch(ex) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("PONWindow","PONWindow.printListener",LOG_ERROR, ex))
}
return false;
},
PONWindow.getCurrentTopic = function () {
if ( topics && (topics.length > 0) ) {
return topics[topics.length-1]
} else {
return null
}
},
PONWindow.moreHelpListener = function (ne) {
var evt = new zEvent(ne);
evt.cancel()
var url = kCIAURL + kCIAPonPath + PONHelper._getPONParams();
if(!BrowserSniffer.isIE6() && !TTOModel.isFFA()) {
PONWindow.showMoreHelp(url)
}
else {
gotoTechSupport(PONHelper._getPONParams());
}
},
PONWindow.RenderUIElements = function() {
if (msg) msgLayer.appendChild(msg)
if (bkgImg) {
fn = '/img/'+bkgImg
bkg.src=fn
}
msg=null
bkgImg=null
},
PONWindow.clear = function() {
if (isDefined(iframe)) {
iframe.close()
}
if(hlpContent) {
hlpContent.innerHTML=""
}
if(msgLayer) {
msgLayer.innerHTML=""
}
dontdisplay(hlpContent)
},
PONWindow.clearMore = function() {
if (isDefined(iframeMore)) {
iframeMore.close()
}
hlpContentMore.innerHTML=""
msgLayerMore.innerHTML=""
dontdisplay(hlpContentMore)
}
};
var kTopicRegEx = /[A-Za-z0-9]*.htm/gi
function showUpgrade () {
var upg = new ModalUpgrade()
upg.show();
upg = null;
}
ModalUpgrade = zIFr.extend( {
show : function () {
if (TTOApp.findCtrlByType(18).isUpgrade) {
TTOApp.showValidationAlert("If you would like to upgrade your product, \n please refer to the upgrade on the screen.");
return
}
var params = new Array();
params["regeneratePage"] = true;
var _ctrl = {
name : 'upg_flow',
w : {"type":"x","val":600},
h : {"type":"x","val":700}
}
var data = {
system : "riadialog",
fileAlias : "universal_upsell",
isFlow : true,
params : params,
modal : true
}
var tmp = document.createElement('div')
this.construct(_ctrl)
this.setLayout(tmp)
var modalParams = {
content : tmp,
w : 600,
h : 700,
ch : true,
cv : true,
closeBtn : true,
beforeCloseCB : function () { jQuery('#upg_flow').remove()}
};
RIAModalWindow.show(modalParams);
this.Render(data);
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ModalFlowExists, true)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_RIAEvent, this._riaListener, this)
TTOEventPubSub.subscribeForEvent(TTOEventPubSub.kEvt_ModalWindowExists, this._modalWinListener, this)
},
_onHide : function () {
TTOEventPubSub.unSubscribe(this)
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ModalFlowExists, false)
},
_modalWinListener : function (showing) {
if (showing) return
else {
this._onHide()
}
},
_riaListener : function (evtObj) {
if (riaEvtObj.HEIGHT == evtObj.type) {
RIAModalWindow.setDimensions(null, evtObj.value)
}
else {
jQuery('#upg_flow').remove()
RIAModalWindow.hide(true)
}
}
});
var WelcomeMat = (function() {
var kWMPlaceHolderID = "wmPlaceHolder";
var kWMContainerID = "wmContainer";
var kRRContainerID = "rightRailContainer";
var kGetHelpButtonID = "getHelpButton";
var kRedArrowID = "redArrow";
var kWMOKBtnID = "wmOKBtn";
var kWMCloseBtnID = "wmCloseBtn";
var _unhighlightHelpButton = function( bDestroy) {
var arrow = jQuery("#" + kRedArrowID);
var button = jQuery("#" + kGetHelpButtonID);
arrow.hide();
button.hide();
if(bDestroy) {
arrow.remove();
button.remove();
}
};
var _highlightHelpButton = function( bAutoDismiss) {
var arrow = jQuery("#" + kRedArrowID);
var button = jQuery("#" + kGetHelpButtonID);
arrow.show();
button.show();
if(bAutoDismiss) {
setTimeout(function() {
arrow.hide();
button.hide();
}, 3500);
}
};
return {
preCache : function() {
var cacheList = ["welcomemat_ok.png", "welcomemat_ok_on.png", "welcomemat_redarrow.png", "welcomemat_gethelp.png"];
for(var i = 0, l = cacheList.length; i < l; i++) {
var image = new Image();
image.src = getImageURL(cacheList[i]);
}
return this;
},
createDOMForNewUser : function() {
var wmGlobalLocation = jQuery("#" + kWMPlaceHolderID).offset();
var wmTop = wmGlobalLocation.top;
var wmLeft = wmGlobalLocation.left;
var wmOKBtnLeftOffset = 290;
var easyquestionsImg = getImageURL("welcomemat_easyquestions.gif");
var mathImg = getImageURL("welcomemat_math.gif");
var ftaImg = getImageURL("welcomemat_fta_small.gif");
var wmDivHTML = "<div id='" + kWMContainerID + "' style='top:" + wmTop + "px;left:" + wmLeft + "px;'><div id='wm' style='height:307px;'><div class='section'><div class='sectionTitle'>We ask easy questions</div><div><img src='" + easyquestionsImg + "' alt='We ask easy questions' /></div><div class='sectionFooter'>You don't have to know taxes. We guide you step by step and fill out tax forms for you.</div></div><div class='section'><div class='sectionTitle'>We do all the math</div><div><img src='" + mathImg + "' alt='We do all the math' /></div><div class='sectionFooter'>TurboTax double-checks your return as you go to help make sure your taxes are done right.</div></div><div class='rightSection'><div class='sectionTitle'>Free Tax Advice</div><div><img src='" + ftaImg + "' alt='Free Tax Advice' /></div><div class='sectionFooter' style='width:190px;'>Now get Free personalized tax advice from an experienced tax professional live, by phone or chat.</div></div><div class='cleardiv'></div><div id='" + kWMOKBtnID + "' style='left:" + wmOKBtnLeftOffset + "px;' alt='dismiss' role='button' tabindex='" + top.TTOApp.tabIndex++ + "'></div><div id='" + kWMCloseBtnID + "' alt='dismiss' role='button' tabindex='" + top.TTOApp.tabIndex++ + "'>CLOSE&nbsp;<b>X</b></div></div><div id='wmTitleNew'>Here's How TurboTax Works</div></div>";
jQuery(wmDivHTML).appendTo("body");
},
createDOMForReturningUser : function() {
var wmGlobalLocation = jQuery("#" + kWMPlaceHolderID).offset();
var wmTop = wmGlobalLocation.top;
var wmLeft = wmGlobalLocation.left;
var wmOKBtnLeftOffset = 400;
var personImg = getImageURL("welcomemat_returning_person.gif");
var bgImg = getImageURL("welcomemat_returning_bg.gif");
var wmDivHTML = "<div id='" + kWMContainerID + "' style='top:" + wmTop + "px;left:" + wmLeft + "px;'><div id='wm' style='height:307px;background-color:#f6f6f6'><img id='returningPersonImg' src='" + personImg + "' alt='Tax Expert' /><div id='wmReturningTxtContainer'><div class='returningTitle'>Free One-on-One Expert Tax Advice</div><div class='returningDetail'>Now get answers to your questions from an experienced tax professional Free by phone or live chat - so you can feel even more confident your taxes are done right.</div></div><div id='" + kWMOKBtnID + "' style='left:" + wmOKBtnLeftOffset + "px;' alt='dismiss' role='button' tabindex='" + top.TTOApp.tabIndex++ + "'></div><div id='" + kWMCloseBtnID + "' alt='dismiss' role='button' tabindex='" + top.TTOApp.tabIndex++ + "'>CLOSE&nbsp;<b>X</b></div><div id='wmTitleReturning'>Here's What's New This Year</div></div></div>";
jQuery(wmDivHTML).appendTo("body");
},
render : function() {
var customerType = TTOModel.getCustomerType();
if(!WelcomeMat.isEnabled()) {
return;
}
top.TTOApp.doMetrics({LCTitle:"", currentScreenId:"WelcomeMat", reqId:"WelcomeMat", eventType:"PageEntry", pageIsBeaconed:true});
TTOEventPubSub.unSubscribe(WelcomeMat);
var modalbkg = jQuery("#modalBkg");
var d = jQuery(document);
modalbkg.height(d.height() + 327);
modalbkg.show();
var dialogRegionObj = jQuery("#dialogRegion");
var rrContainerObj = jQuery("#" + kRRContainerID);
var wmPlaceHolder = "<div id='" + kWMPlaceHolderID + "'></div>";
dialogRegionObj.before(wmPlaceHolder);
if(customerType == 4)
this.createDOMForReturningUser();
else {
this.createDOMForNewUser();
var rightSection = jQuery(".rightSection");
rightSection.hover(function() {_highlightHelpButton(false);},
function() {_unhighlightHelpButton(false);});
}
jQuery("#" + kWMOKBtnID).capture("click", function() {
WelcomeMat.dismiss();
});
jQuery("#" + kWMCloseBtnID).capture("click", function() {
WelcomeMat.dismiss();
});
jQuery(document).bind("click", WelcomeMat.shouldDismiss);
var dialogRegionGlobalLocation = dialogRegionObj.position();
var dRTop = dialogRegionGlobalLocation.top;
rrContainerObj.css("top", dRTop);
var rrGlobalLocation = rrContainerObj.offset();
var rrTop = rrGlobalLocation.top;
var rrLeft = rrGlobalLocation.left;
var redArrowImg = getImageURL("welcomemat_redarrow.png");
var getHelpImg = getImageURL("welcomemat_gethelp.png");
setTimeout(function() {
jQuery("<img id='" + kRedArrowID + "' src='" + redArrowImg + "' style='top:" + (rrTop - 50) + "px;left:" + (rrLeft + 150) + "px;' />").appendTo("body").hide();
jQuery("<img id='" + kGetHelpButtonID + "' src='" + getHelpImg + "' style='top:" + (rrTop + 47) + "px;left:" + (rrLeft + 26) + "px;' title='Get ExpertHelp' />").appendTo("body");
_highlightHelpButton(true);
}, 500);
jQuery("#" + kWMContainerID).focus();
},
dismiss : function() {
_unhighlightHelpButton(true);
this._clearAllListeners();
jQuery("#" + kWMContainerID).fadeOut(150, function() {
jQuery(this).remove();
var dialogRegionObj = jQuery("#dialogRegion");
var rrContainerObj = jQuery("#" + kRRContainerID);
dialogRegionObj.css("opacity", .2);
rrContainerObj.css("opacity", .2);
jQuery("#modalBkg").hide();
jQuery("#" + kWMPlaceHolderID).animate({
height: '-=327'
}, 280, function() {
jQuery(this).remove();
});
rrContainerObj.animate({
top: '-=327'
}, 280);
dialogRegionObj.animate({opacity: 1}, 280);
rrContainerObj.animate({opacity: 1}, 280);
setTimeout(function() {
WelcomeMat = null;
}, 300);
});
},
shouldDismiss : function(e) {
var target = jQuery(e.target);
var isChildOfWM = target.isChildOf("#" + kWMContainerID);
var isGetHelpBtn = target.id === kGetHelpButtonID;
if(!isChildOfWM && !isGetHelpBtn)
WelcomeMat.dismiss();
},
isEnabled : function() {
var kDialogWelcomeScrnId = "DialogWelcome";
var customerType = TTOModel.getCustomerType();
var prodId = TTOModel.getProductId();
var screenId = TTOModel.getDialogInfo().screenId;
function stopListening() {
TTOEventPubSub.unSubscribe(WelcomeMat);
};
if(!1) {
stopListening();
return false;
}
if(customerType == 1 || customerType == 3 || prodId == 4) {
stopListening();
return false;
}
if(getParamValue(location.href, "bookmark") != "") {
stopListening();
return false;
}
if(screenId != kDialogWelcomeScrnId)
return false;
var gsb = TTOModel.getABTestValue("gsb");
if(gsb && (gsb.match(/[cde]/i) != null) ) {
stopListening();
return false;
}
if(BrowserSniffer.isSamsungDroidCharge()) {
stopListening();
return false;
}
return true;
},
_clearAllListeners : function() {
var rightSection = jQuery(".rightSection");
if(rightSection.length > 0)
rightSection.unbind("mouseenter").unbind("mouseleave");
jQuery("#" + kWMOKBtnID).unbind("click");
jQuery("#" + kWMCloseBtnID).unbind("click");
jQuery(document).unbind("click", WelcomeMat.shouldDismiss);
}
};
})().preCache();
TTOEventPubSub.subscribeForEvent(kEvt_RightRailDisplayed, WelcomeMat.render, WelcomeMat);
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
function Class() { }
Class.prototype.construct = function() {};
Class.__asMethod__ = function(func, baseClass) {
return function() {
var currentSuperClass = this.superClass;
this.superClass = baseClass;
var ret = func.apply(this, arguments);
this.superClass = currentSuperClass;
return ret;
};
};
Class.extend = function(def, static) {
var classDef = function() {
if (arguments[0] !== Class) {
this.construct.apply(this, arguments);
}
};
var proto = new this(Class);
var baseClass = this.prototype;
for (var n in def) {
var item = def[n];
if (item instanceof Function) {
item = Class.__asMethod__(item, baseClass);
}
proto[n] = item;
}
if (static) {
for (var n in static) {
classDef[n] = static[n];
}
}
proto.superClass = baseClass;
classDef.prototype = proto;
classDef.extend = this.extend;
return classDef;
};
Dictionary = Class.extend({
_maxSize : 0,
_arr : [],
construct : function(maxSize) {
this._maxSize = maxSize || Infinity;
this._arr = [];
},
getIndexForKey : function(key) {
for(var i = 0, len = this._arr.length; i < len; i++) {
if(this._arr[i].key === key)
return i;
}
return -1;
},
add : function(key, value) {
var foundIndex = this.getIndexForKey(key);
var obj = {};
obj.key = key;
obj.val = value;
if(foundIndex == -1) {
if(this._arr.length < this._maxSize) {
this._arr.push(obj);
}
}
else {
this._arr[foundIndex] = obj;
}
},
remove : function(key) {
var foundIndex = this.getIndexForKey(key);
if(foundIndex > -1) {
this._arr.splice(foundIndex, 1);
}
},
get : function(key) {
var foundIndex = this.getIndexForKey(key);
return this._arr[foundIndex] ? this._arr[foundIndex].val : null;
},
each : function( cb) {
var that = this;
for(var i = 0, len = this._arr.length; i < len; i++) {
cb(that._arr[i].key, that._arr[i].val);
}
},
size : function() {
return this._arr.length;
},
clear : function() {
this._arr = [];
}
});
function BeaconRequest () {
var t = this ;
t.ProcessBeaconRequest = new Array() ;
}
function ProcessBeaconRequest () {
var t = this ;
t.TransactionID = "" ;
t.BeaconRequestData = null ;
}
function BeaconRequestData () {
var t = this ;
t.Screen = "" ;
t.EventType = "" ;
t.Tab = "" ;
t.SubTab= "" ;
t.TopicId= "" ;
t.DialogTitle = "";
t.FederalRefundAmount = "" ;
t.ProductId = "" ;
t.CustomerType = "" ;
t.TaxSessionLocation = "" ;
t.ClientProfileData = null ;
t.Param = new Array() ;
}
var eOmnitureBeacon = 0
var eOffermaticaBeacon= 1
var eDoubleClickBeacon= 2
var eDoubleClick2Beacon= 3
var eDigitalGrit= 4
var eCommissionJunction= 5
var eTTComTracking= 6
var eOmnitureOtherBeacon= 7
var eOffermatica2Beacon= 8
var beaconQueueSize = 5
var maxClientRetry = 5
var head = document.getElementsByTagName('head').item(0)
var scriptTagSID = document.getElementById("SIDScript")
if(!scriptTagSID)
{
var script = document.createElement('script')
script.src = "/scripts/sessionId.js"
script.type = 'text/javascript'
script.id = "SIDScript"
head.appendChild(script)
}
TrackingService = (function(){
var _instance = {
queueBeacon : function (transId, beaconData ) {
transId = decodeURIComponent(transId)
var dictObj = _beaconDictionary.get(transId);
if (! dictObj) {
var dictObj = new BeaconDictionaryObj();
_beaconDictionary.add(transId, dictObj);
}
dictObj.addBeacon(beaconData)
},
addBeacon : function (beaconData ) {
var bea = _createBeacon(beaconData)
if (bea)
bea.render()
},
setTTLocationInfo : function (info ) {
for (var n in info) {
_ttcomLocation[n] = info[n];
}
},
fireTTLocation : function () {
updateTTOLocation(
_ttcomLocation.mktid,
_ttcomLocation.tab1,
_ttcomLocation.tab2,
_ttcomLocation.sku
)
},
sendMetrics : function (transId, authId, genericBeaconDataTO ) {
transId = decodeURIComponent(transId)
if (genericBeaconDataTO) {
_setGenericBeaconData(transId, genericBeaconDataTO)
if( genericBeaconDataTO.pageIsBeaconed){
_fireBeaconEvent(authId)
} else{
this.fireBeacons(transId)
}
}
else {
this.fireBeacons(transId)
}
},
fireBeacons : function(transId) {
var dictObj = _beaconDictionary.get(transId);
if(dictObj == null)
return;
for (var i=0; i<dictObj._beaconList.length; i++){
var b = dictObj._beaconList[i]
var g = dictObj._genericBeaconData
for (var o in g) {
if ( (null == b[o] || "" === b[o]) && (null != g[o] && "" !== g[o]))
b[o] = g[o];
}
var bcn = _createBeacon(b);
if (bcn) bcn.render();
}
_beaconDictionary.remove(transId)
}
};
var kBeaconEventsURL = "/services/beacon-events",
kBeaconFireEventRequest = "fireEvent" ,
kPrepareBeaconRequest = "prepareBeacons",
_waitingForResponse = false,
_beaconDictionary = new Dictionary(beaconQueueSize),
_beaconQueue = new Array(),
_ttcomLocation = {};
BeaconDictionaryObj = Class.extend({
construct: function () {
this._genericBeaconData = null,
this._beaconList = new Array()
},
addBeacon : function (data) {
this._beaconList.push(data)
}
});
function _setGenericBeaconData(transId, data) {
var dictObj = _beaconDictionary.get(transId);
if (! dictObj) {
var dictObj = new BeaconDictionaryObj();
_beaconDictionary.add(decodeURIComponent(transId), dictObj);
}
dictObj._genericBeaconData = data
}
function _renderQueuedBeacons (beaconDataTO) {
var profileData = "";
if (beaconDataTO && beaconDataTO.profileData)
profileData = beaconDataTO.profileData;
for (var i=0; i<_beaconQueue.length; i++) {
var beac = _beaconQueue[i];
beac.data.profileData = profileData;
beac.render();
}
delete _beaconQueue;
_beaconQueue = new Array();
}
function _createBeacon(beaconTO) {
var bcn = null;
switch(beaconTO.type){
case eOmnitureBeacon:
case eOmnitureOtherBeacon:
bcn = new OmnitureBeacon(beaconTO)
break
case eOffermaticaBeacon:
case eOffermatica2Beacon:
bcn = new OffermaticaBeacon(beaconTO)
break
case eDoubleClickBeacon:
case eDoubleClick2Beacon:
bcn = new DoubleClickBeacon(beaconTO)
break
case eTTComTracking:
bcn = new TTComBeacon(beaconTO)
break
case "OMNITURE":
bcn = new NewOmnitureBeacon(beaconTO)
break
case "OFFERMATICA":
bcn = new NewOffermaticaBeacon(beaconTO)
break
case "DOUBLE_CLICK":
bcn = new NewDoubleClickBeacon(beaconTO)
break
case "COMMISSION_JUNCTION":
bcn = new NewCommissionJunctionBeacon(beaconTO)
break
case "TT_COM_TRACKING":
bcn = new NewTTComTrackingBeacon(beaconTO)
break
default:
break
}
return bcn
}
function _fireBeaconEvent (authId) {
_fireBeaconEventWithBeaconTO(authId) ;
}
function _fireBeaconEventWithBeaconTO (authId) {
if (_waitingForResponse) return;
if(_beaconDictionary.size() > 0) {
var beaconRequest = new BeaconRequest() ;
beaconRequest.ProcessBeaconRequest = new Array(_beaconDictionary.size()) ;
_beaconDictionary.each( function (key, value) {beaconRequest.ProcessBeaconRequest[key] = generateBeaconProcessRequest(value._genericBeaconData)} )
var url = kBeaconEventsURL + "/" + kPrepareBeaconRequest + "/" + authId ;
_postToApp( url, JSONSerializer.toString(beaconRequest), new BeaconEventHandler(authId));
}
}
function generateBeaconProcessRequest(beaconTO)
{
var pbr = new ProcessBeaconRequest() ;
var brd = new BeaconRequestData() ;
pbr.TransactionID = beaconTO.reqId ;
pbr.BeaconRequestData = brd ;
brd.Screen = beaconTO.currentScreenId ;
brd.EventType = beaconTO.eventType ;
brd.Tab = beaconTO.currentTab ;
brd.SubTab= beaconTO.currentSubItem ;
brd.TopicId= beaconTO.topicId ;
brd.DialogTitle = encodeURIComponent(beaconTO.LCTitle);
brd.ProductId = beaconTO.prodId ;
brd.CustomerType = beaconTO.customerType ;
brd.FederalRefundAmount = beaconTO.fedRefundAmount ;
brd.TaxSessionLocation = beaconTO.taxServer + ":" + beaconTO.taxPort ;
brd.ClientProfileData = beaconTO.profileData ;
brd.Param = beaconTO.params;
return pbr ;
}
function _postToApp( url, postData, responseHandler) {
xhr = new Ajax()
xhr.setAsync(true)
xhr.setURL(url)
xhr.setMethod("POST")
xhr.setPOSTData(postData);
xhr.setReqHeader("If-Modified-Since", "Sat, 1 Jan 2000 00:00:00 GMT")
xhr.setReqHeader('Content-Type', 'application/json');
xhr.setReqHeader("TTO-pageID","FIRE BEACON EVENT");
xhr.setSuccessCallback(_serviceSuccessCB)
xhr.setErrorCallback(_serviceFailureCB)
xhr.setTimeoutCallback(_serviceTimeoutCB)
xhr.send();
_waitingForResponse = true;
function _serviceSuccessCB( rsp) {
if (responseHandler) {
responseHandler.doSuccess(rsp);
_waitingForResponse = false;
}
}
function _serviceFailureCB(rsp) {
if ("undefined" != typeof(TTOEventPubSub)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BeaconEventHandler","Error " +rsp.status + " handling beacon request: " + rsp.statusText, LOG_ERROR))
}
if(rsp.status >= 400){
_beaconDictionary.clear();
}
_waitingForResponse = false;
}
function _serviceTimeoutCB(rsp) {
if ("undefined" != typeof(TTOEventPubSub)) {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BeaconEventHandler","Timeout handling beacon request: ", LOG_ERROR))
}
_waitingForResponse = false;
}
xhr = null;
}
return _instance;
})();
function BeaconDataTO () {
var t = this
t.pageIsBeaconed = false;
t.type = -1
t.title = ""
t.section = ""
t.customerSource = ""
t.prodId = 0
t.prodAlias = ""
t.currentTab = ""
t.currentSubItem = ""
t.topicId = ""
t.currentScreenId = ""
t.applicationId = "TTO"
t.marketingId = ""
t.priorYrProdId = 0
t.LCTags = ""
t.LCToken = ""
t.LCTitle = ""
t.oldStyleKeys = new Array();
t.profileData = null;
t.reqId = 0;
t.authId = 0;
t.numRetries = 0;
t.params = new Array();
t.customerType = "" ;
t.eventType = "" ;
t.fedRefundAmount = "" ;
t.taxServer = "" ;
t.taxPort = "" ;
}
Beacon = Class.extend({
data : null,
construct : function (reqTO ) {
if (reqTO)
this.data = reqTO
},
doDebugStuff : function(name, details) {
if (typeof DebugTO!="undefined") {
var TO = new DebugTO()
TO.addBeaconInfo(name, details);
var cmd = new DebugCommand(TO)
cmd.execute()
}
},
handleException : function(beacExc ) {
if (typeof(TTOEventPubSub) != 'undefined'){
var msg = "";
if(beacExc){
msg = "Could not set " + beacExc.Type + ' beacon';
if(beacExc.Error)
msg += "; Exception=" + beacExc.Error.name + ":" + beacExc.Error.message;
if(beacExc.AddlMessage)
msg += "; AddlMessage=" + beacExc.AddlMessage;
}
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("BEACON",msg, LOG_WARNING))
}
}
});
kNewOMScript= "NewOMScript"
kNewSiteAdvanceJS= "/scripts/s_code.js"
try {
var head = document.getElementsByTagName('head').item(0)
var scriptTag = document.getElementById(kNewOMScript)
if(!scriptTag)
{
var script = document.createElement('script')
script.src = kNewSiteAdvanceJS
script.type = 'text/javascript'
script.id = kNewOMScript
head.appendChild(script)
}
}
catch(e) {
}
BaseOmnitureBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
clearOMVars : function() {
s.channel = ""
s.pageName = ""
s.events = ""
s.products = ""
s.purchaseID = ""
for(var i=1; i<=75; i++)
{
var eVar = "s.eVar"+i;
eVar += "= \"\"";
try{
eval(eVar);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "BaseOmniture::clearOMVars";
exc.Error = ex;
exc.AddlMessage = eVar + " is invalid.";
t.handleException(exc);
}
}
for(var i=1; i<=75; i++)
{
var prop = "s.prop"+i;
prop += "= \"\"";
try{
eval(prop);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "BaseOmniture::clearOMVars";
exc.Error = ex;
exc.AddlMessage = prop + " is invalid.";
t.handleException(exc);
}
}
}
});
kFlowValue= "flowvalue"
kAuthValue= "authvalue"
kCustSrc= "customerSource"
ksku= "sku"
OmnitureBeacon = BaseOmnitureBeacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var val = ""
var idx = -1
var id = ""
var title = ""
var hashid = getEventDeduperId()
var kttsid = "ttsid"
var ktab = "bctab"
var hasEvent28 = 0
var hasWecome = 0
var sku = t.data.prodId
var t1 = t.data.currentTab
var t2 = t.data.currentSubItem
var st = ""
var flowid = ""
var authoption = ""
var hardcodedTitle = ""
var hardcodedSect = ""
try {
t.clearOMVars()
s.channel = t.data.section
s.eVar4 = t.data.prodAlias
s.prop4 = getHashedAuthId()
s.prop5 = t.data.applicationId
if(t.data.profileData)
s.prop12 = t.data.profileData.requestTime + ":" + t.data.profileData.renderTime
s.prop13 = ""
s.prop14 = t.data.prodAlias
s.prop19 = t.data.currentScreenId
for (var i=0; i<t.data.oldStyleKeys.length; i++){
idx=-1
var itm =t.data.oldStyleKeys[i]
val=unescape(itm.value)
if (typeof val != 'number')
idx=val.indexOf(kttsid)
if(-1!=idx){
var nv = val.replace(/ttsid/g, hashid)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(ksku)
if(-1!=idx){
var nv = val.replace(ksku, sku)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(ktab)
if(-1!=idx){
var tabnames = t1 + ' ' + t2
var nv = val.replace(ktab, tabnames)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kFlowValue)
if(-1!=idx){
var nv = val.replace(kFlowValue, flowid)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kAuthValue)
if(-1!=idx){
var nv = val.replace(kAuthValue, authoption)
val=nv
}
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kCustSrc)
if(-1!=idx){
var cs = t.data.customerSource
var nv = val.replace(kCustSrc, cs)
val=nv
}
if ("s_pageName"==itm.key){
hardcodedTitle=val
}
else if ("s_channel"==itm.key){
hardcodedSect=val
}
else if ("s_purchaseID"==itm.key)
s.purchaseID=val
else if ("s_events"==itm.key){
s.events=val
idx=-1
if (typeof val != 'number')
idx=val.indexOf("event28")
if(-1!=idx){
hasEvent28=1
}
}
else if ("s_prop1"==itm.key)
s.prop1=val
else if ("s_prop2"==itm.key)
s.prop2=val
else if ("s_prop3"==itm.key)
s.prop3=val
else if ("s_prop6"==itm.key){
s.prop6=val
idx=-1
if (typeof val != 'number')
idx=val.indexOf("Welcome")
if(-1!=idx){
hasWecome=1
}
}
else if ("s_prop7"==itm.key)
s.prop7=val
else if ("s_prop8"==itm.key)
s.prop8=val
else if ("s_prop10"==itm.key)
s.prop10=val
else if ("s_prop13"==itm.key)
s.prop13=val
else if ("s_prop16"==itm.key)
s.prop16=val
else if ("s_prop17"==itm.key)
s.prop17=val
else if ("s_prop19"==itm.key)
s.prop19=val
else if ("s_prop21"==itm.key)
s.prop21=val
else if ("s_prop23"==itm.key)
s.prop23=val
else if ("s_products"==itm.key)
s.products=val
else if ("s_eVar1"==itm.key)
s.eVar1=val
else if ("s_eVar2"==itm.key)
s.eVar2=val
else if ("s_eVar8"==itm.key)
s.eVar8=val
else if ("s_eVar10"==itm.key)
s.eVar10=val
else if ("s_eVar12"==itm.key)
s.eVar12=val
else if ("s_eVar13"==itm.key)
s.eVar13=val
else if ("s_eVar14"==itm.key)
s.eVar14=val
else if ("s_eVar19"==itm.key)
s.eVar19=val
else if ("s_eVar21"==itm.key)
s.eVar21=val
else if ("s_eVar23"==itm.key)
s.eVar23=val
else if ("s_eVar24"==itm.key)
s.eVar24=val
else if ("state"==itm.key)
st=val
}
idx=-1
if (typeof s.events != 'number')
idx=s.events.indexOf("event9")
if(-1!=idx){
if (512==sku){
s.events+=",event12:"
}
else if (4==sku){
s.events+=",event11:"
}
else if (8==sku){
s.events+=",event15:"
}
else if (16==sku){
s.events+=",event14:"
}
else if (32==sku){
s.events+=",event16:"
}
else if (2==sku){
s.events+=",event13:"
}
s.events+=s.purchaseID
if ("1"==st){
if (4==sku)
s.events+=",event18:"
else
s.events+=",event17:"
s.events+=s.purchaseID
}
}
var tempPageName = t.data.currentScreenId
tempPageName+=' - '
tempPageName+= (4==sku)?"FFA":"NONFFA"
tempPageName+=' - '
if(hardcodedTitle!="")
tempPageName+= hardcodedTitle
else
tempPageName+= t.data.LCTitle
s.pageName=tempPageName;
if(hardcodedSect!=""){
s.channel=hardcodedSect;
} else{
var tempChannel = t.data.currentTab
tempChannel += " - "
tempChannel += t.data.currentSubItem
s.channel=decodeURIComponent(tempChannel);
}
var om=s.t();
if(om)
document.write(om)
t.doDebugStuff("OldOmniture", om_requestURL)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "OldOmniture";
exc.Error = ex;
t.handleException(exc);
}
}
});
NewOmnitureBeacon = BaseOmnitureBeacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if(!t.data) return
try {
t.clearOMVars()
var eventDeduperId = getEventDeduperId();
var hashedId = getHashedAuthId();
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(name=="s.prop12" && t.data.profileData != null) {
s.prop12 = t.data.profileData.requestTime + ":" + t.data.profileData.renderTime
} else {
value = value.replace(/eventDeduperId/g, eventDeduperId)
value = value.replace(/hashedId/g, hashedId)
var assignment = name + '= "' + escapeSpecialChars(value) + "\"";
try {
eval(assignment);
} catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOmniture";
exc.Error = ex;
exc.AddlMessage = assignment + " is invalid.";
t.handleException(exc);
}
}
}
var om=s.t();
if(om)
document.write(om)
t.doDebugStuff("NewOmniture", om_requestURL)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOmniture";
exc.Error = ex;
t.handleException(exc);
}
}
});
var kBeaconFrameID = "bea"
var kBeaconFrameID2 = "bea2"
OffermaticaBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $(kBeaconFrameID)
if (!p){
p = appendIFrame(d,document.body,kBeaconFrameID,"Beacon","blank.htm");
p.id = kBeaconFrameID;
}
p = frames[kBeaconFrameID]
var p2 = null
var ofid=""
var ofid2=""
var pl=""
var tmp=""
var val=""
var idx=-1
var flowid = ""
var authoption = ""
var sku=t.data.prodId
var s=""
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if (("ofid"==itm.key) || ("ofid2"==itm.key)|| ("zofid"==itm.key)){
if (ofid.length>0){
pl+="&ofid="
pl+=ofid
pl+=tmp
tmp=""
}
ofid=itm.value
if ("ofid2"==itm.key){
ofid2=itm.value
}
}
else {
val=itm.value
idx=-1
if (typeof val != 'number')
idx=val.indexOf(kFlowValue)
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
else {
var nv = val.replace(kFlowValue, flowid)
val=nv
}
}
else
{
if (typeof val != 'number')
idx=val.indexOf(kAuthValue)
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
else {
var nv = val.replace(kAuthValue, authoption)
val=nv
}
}
else
{
if (typeof itm.key != 'number')
idx=itm.key.indexOf("bv")
if(-1!=idx){
if (( authoption == "0" ) || (authoption == "")){
val = ""
}
}
}
}
if (-1==idx){
if (typeof val != 'number')
idx=val.indexOf(ksku)
if(-1!=idx){
var nv = val.replace(ksku, sku)
val=nv
}
}
if (-1==idx){
if (typeof val != 'number')
idx=val.indexOf(kCustSrc)
if(-1!=idx){
var cs = t.data.customerSource
var nv = val.replace(kCustSrc, cs)
val=nv
}
}
if (-1==idx)
{
tmp+="&"
tmp+=itm.key
tmp+="="
tmp+=itm.value
}
else
if (val!="")
{
tmp+="&"
tmp+=itm.key
tmp+="="
tmp+=val
}
}
}
try{
if (ofid!=""){
pl+="&ofid="
pl+=ofid
pl+=tmp
if (ofid2!=""){
p2 = $(kBeaconFrameID2)
if (!p2){
p2 = appendIFrame(d,document.body,kBeaconFrameID2,"Beacon","blank.htm");
p2.id = kBeaconFrameID2;
}
p2 = frames[kBeaconFrameID2]
s="/secure/beacon2.htm"
s+="?"
s+=pl
p2.location.replace(s)
} else {
s="/secure/beacon.htm"
s+="?"
s+=pl
p.location.replace(s)
}
t.doDebugStuff("Offermatica", s)
}
}
catch(ex) {
var exc = new BeaconException();
exc.Type = "Offermatica";
exc.Error = ex;
t.handleException(exc);
$(kBeaconFrameID).src=s
}
}
});
var kBeaconFrameID = "bea"
var kBeaconFrameID2 = "bea2"
NewOffermaticaBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function () {
var t=this
if (!t.data) return
var p = $(kBeaconFrameID)
if (!p){
p = appendIFrame(d,document.body,kBeaconFrameID,"Beacon","blank.htm");
p.id = kBeaconFrameID;
}
p = frames[kBeaconFrameID]
var pl=""
var s=""
try {
for(var i=0; i<t.data.params.length; i++) {
if(pl.length>0)
pl += "&"
pl += t.data.params[i].name + '=' + t.data.params[i].value
}
s="/secure/beacon.htm"
s+="?&"
s+=pl
p.location.replace(s)
t.doDebugStuff("NewOffermatica", s)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewOffermatica";
exc.Error = ex;
t.handleException(exc);
$(kBeaconFrameID).src=s
}
}
});
var kDoubleClickURL = "https://fls.doubleclick.net/activityi;src=1984865;"
DoubleClickBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("DblClickFrame")
if (!p){
p = appendIFrame(document,document.body,"DblClickFrame","Beacon","blank.htm");
p.id = "DblClickFrame";
}
p = frames["DblClickFrame"]
var fn=kDoubleClickURL
var pl=""
var plyoy=""
var val=""
var key=""
var idx=-1
var uk=0
var sku="0"
var u8="0"
var u12=""
var u13=""
var ttsid=getHashedAuthId()
var kttsid="ttsid"
var type=""
var cat=""
var ord=""
var num=""
var prodId=t.data.prodId
var skus = new Array()
for (var j=0; j<6; j++){
skus[j]=0;
}
var axel = Math.random()+"";
var ax = axel * 10000000000000;
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if ("sku"==itm.key){
sku=itm.value
}
else
{
if (i>0) pl+=';'
pl+=itm.key
pl+='='
val=itm.value
if (typeof val != 'number'){
idx=val.indexOf("random")
if(-1!=idx){
var nv = val.replace("random", ax)
itm.value=nv
}
}
pl+=itm.value
if ("u8"==itm.key){
u8=itm.value
}
if ( "type" == itm.key ){
type=itm.value
} else if ("cat" == itm.key){
cat=itm.value
} else if ("num" == itm.key){
num=itm.value
} else if ("ord" == itm.key){
ord=itm.value
} else if ("u12" == itm.key){
u12=itm.value
if (typeof u12 != 'number'){
idx=u12.indexOf("u12value")
if(-1!=idx){
var qp = prodId;
qp += ",0,0.0"
u12 = u12.replace("u12value", qp)
pl = pl.replace("u12value", qp)
}
}
} else if ("u13" == itm.key){
u13=itm.value
if (typeof u13 != 'number'){
idx=u13.indexOf("u13value")
if(-1!=idx){
u13 = u13.replace("u13value", ttsid)
pl = pl.replace("u13value", ttsid)
}
}
}
}
}
idx=pl.indexOf("u8")
if(-1!=idx){
if("1"==u8){
if ("512"==sku)
skus[1]=1
else
if ("4"==sku)
skus[0]=1
else
if ("8"==sku)
skus[4]=1
else
if ("16"==sku)
skus[3]=1
else
if ("32"==sku)
skus[5]=1
else
if ("2"==sku)
skus[2]=1
}
for (var j=0; j<6; j++){
pl+=';'
pl+='u'
uk=j+1
pl+=uk
pl+='='
pl+=skus[j]
}
}
if ("ttone268"==cat || "ttoex527"==cat){
plyoy ="type=" + type + ";" + "cat=" + cat + ";" + "u12=" + u12+ ";" + "u13=" + u13 + ";" + "ord=" + ord + ";" + "num=" + num
fn+=plyoy
} else {
fn+=pl
}
fn+="?"
try{
p.location.replace(fn)
}catch (ex) {
var exc = new BeaconException();
exc.Type = "DoubleClick";
exc.Error = ex;
t.handleException(exc);
}
t.doDebugStuff("DoubleClick", fn)
}
});
var kDoubleClickURL = "https://fls.doubleclick.net/activityi;src=1984865;"
NewDoubleClickBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("DblClickFrame")
if (!p){
p = appendIFrame(document,document.body,"DblClickFrame","Beacon","blank.htm");
p.id = "DblClickFrame";
}
p = frames["DblClickFrame"]
var fn=kDoubleClickURL
var hashedId=getHashedAuthId()
var pl=""
try{
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(pl.length>0)
pl += ";"
if(value.indexOf("hashedId") >= 0)
value = value.replace("hashedId", hashedId)
pl += name + '=' + value
}
fn+=pl
fn+="?"
p.location.replace(fn)
t.doDebugStuff("NewDoubleClick", fn)
}catch (ex) {
var exc = new BeaconException();
exc.Type = "NewDoubleClick";
exc.Error = ex;
t.handleException(exc);
}
}
});
var kCJURL = "https://www.emjcd.com/u?"
NewCommissionJunctionBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
var p = $("BeaconArea")
if (!p){
p = appendLayer(document.body,"BeaconArea")
p.id="BeaconArea"
p.name="BeaconArea"
}
var fn=kCJURL
var hashedId=getHashedAuthId()
var pl=""
for(var i=0; i<t.data.params.length; i++) {
var name = t.data.params[i].name
var value = t.data.params[i].value
if(pl.length>0)
pl += "&"
if(value.indexOf("hashedId") >= 0)
value = value.replace("hashedId", hashedId)
pl += name + '=' + value
}
fn+=pl
TTO.DU.appendImg( p, fn, 20, 1)
t.doDebugStuff("NewCommissionJunction", fn)
}
});
TTComBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
try {
var mktid = ""
var kmktid="mktid"
var list = 0
var tabs = ""
var sku = t.data.prodId
for (var i=0; i<t.data.oldStyleKeys.length; i++){
var itm = t.data.oldStyleKeys[i]
if( kmktid == itm.key){
mktid = itm.value
var p = mktid.indexOf(",")
if(p != -1){
mktid = mktid.substr(0, p)
}
break
}
}
TrackingService.setTTLocationInfo({
"mktid" : mktid,
"sku" : sku
})
t.doDebugStuff("TTCom Tracking", mktid+" : "+sku)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "TTComTracking";
exc.Error = ex;
t.handleException(exc);
}
}
});
NewTTComTrackingBeacon = Beacon.extend( {
construct : function (reqTO ) {
var t=this;
this.superClass.construct.call(this,reqTO);
},
render : function() {
var t=this
if (!t.data) return
try {
var mktid = ""
var sku = ""
for (var i=0; i<t.data.params.length; i++){
var name = t.data.params[i].name;
var value = t.data.params[i].value;
var assignment = name + '= "' + value + "\"";
try {
eval(assignment);
} catch(ex) {
var exc = new BeaconException();
exc.Type = "NewTTComTracking";
exc.Error = ex;
exc.AddlMessage = assignment + " is invalid.";
t.handleException(exc);
}
}
TrackingService.setTTLocationInfo({
"mktid" : mktid,
"sku" : sku
})
t.doDebugStuff("New TTCom Tracking", mktid+" : "+sku)
}
catch (ex) {
var exc = new BeaconException();
exc.Type = "NewTTComTracking";
exc.Error = ex;
t.handleException(exc);
}
}
});
var hexcase = 0;
var b64pad = "";
var chrsz = 8;
function hex_md5(s){ return binl2hex(core_md5(str2binl(s), s.length * chrsz));}
function b64_md5(s){ return binl2b64(core_md5(str2binl(s), s.length * chrsz));}
function str_md5(s){ return binl2str(core_md5(str2binl(s), s.length * chrsz));}
function hex_hmac_md5(key, data) { return binl2hex(core_hmac_md5(key, data)); }
function b64_hmac_md5(key, data) { return binl2b64(core_hmac_md5(key, data)); }
function str_hmac_md5(key, data) { return binl2str(core_hmac_md5(key, data)); }
function md5_vm_test()
{
return hex_md5("abc") == "900150983cd24fb0d6963f7d28e17f72";
}
function core_md5(x, len)
{
x[len >> 5] |= 0x80 << ((len) % 32);
x[(((len + 64) >>> 9) << 4) + 14] = len;
var a = 1732584193;
var b = -271733879;
var c = -1732584194;
var d = 271733878;
for(var i = 0; i < x.length; i += 16)
{
var olda = a;
var oldb = b;
var oldc = c;
var oldd = d;
a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
c = md5_ff(c, d, a, b, x[i+ 2], 17, 606105819);
b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
d = md5_ff(d, a, b, c, x[i+ 5], 12, 1200080426);
c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
a = md5_ff(a, b, c, d, x[i+ 8], 7 , 1770035416);
d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
a = md5_ff(a, b, c, d, x[i+12], 7 , 1804603682);
d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
b = md5_ff(b, c, d, a, x[i+15], 22, 1236535329);
a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
c = md5_gg(c, d, a, b, x[i+11], 14, 643717713);
b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
d = md5_gg(d, a, b, c, x[i+10], 9 , 38016083);
c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
a = md5_gg(a, b, c, d, x[i+ 9], 5 , 568446438);
d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
b = md5_gg(b, c, d, a, x[i+ 8], 20, 1163531501);
a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
c = md5_gg(c, d, a, b, x[i+ 7], 14, 1735328473);
b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);
a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
c = md5_hh(c, d, a, b, x[i+11], 16, 1839030562);
b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
d = md5_hh(d, a, b, c, x[i+ 4], 11, 1272893353);
c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
a = md5_hh(a, b, c, d, x[i+13], 4 , 681279174);
d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
b = md5_hh(b, c, d, a, x[i+ 6], 23, 76029189);
a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
c = md5_hh(c, d, a, b, x[i+15], 16, 530742520);
b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);
a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
d = md5_ii(d, a, b, c, x[i+ 7], 10, 1126891415);
c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
a = md5_ii(a, b, c, d, x[i+12], 6 , 1700485571);
d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
a = md5_ii(a, b, c, d, x[i+ 8], 6 , 1873313359);
d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
b = md5_ii(b, c, d, a, x[i+13], 21, 1309151649);
a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
c = md5_ii(c, d, a, b, x[i+ 2], 15, 718787259);
b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);
a = safe_add(a, olda);
b = safe_add(b, oldb);
c = safe_add(c, oldc);
d = safe_add(d, oldd);
}
return Array(a, b, c, d);
}
function md5_cmn(q, a, b, x, s, t)
{
return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t)
{
return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t)
{
return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t)
{
return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t)
{
return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}
function core_hmac_md5(key, data)
{
var bkey = str2binl(key);
if(bkey.length > 16) bkey = core_md5(bkey, key.length * chrsz);
var ipad = Array(16), opad = Array(16);
for(var i = 0; i < 16; i++)
{
ipad[i] = bkey[i] ^ 0x36363636;
opad[i] = bkey[i] ^ 0x5C5C5C5C;
}
var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz);
return core_md5(opad.concat(hash), 512 + 128);
}
function safe_add(x, y)
{
var lsw = (x & 0xFFFF) + (y & 0xFFFF);
var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
return (msw << 16) | (lsw & 0xFFFF);
}
function bit_rol(num, cnt)
{
return (num << cnt) | (num >>> (32 - cnt));
}
function str2binl(str)
{
var bin = Array();
var mask = (1 << chrsz) - 1;
for(var i = 0; i < str.length * chrsz; i += chrsz)
bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);
return bin;
}
function binl2str(bin)
{
var str = "";
var mask = (1 << chrsz) - 1;
for(var i = 0; i < bin.length * 32; i += chrsz)
str += String.fromCharCode((bin[i>>5] >>> (i % 32)) & mask);
return str;
}
function binl2hex(binarray)
{
var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
var str = "";
for(var i = 0; i < binarray.length * 4; i++)
{
str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) +
hex_tab.charAt((binarray[i>>2] >> ((i%4)*8 )) & 0xF);
}
return str;
}
function binl2b64(binarray)
{
var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
var str = "";
for(var i = 0; i < binarray.length * 4; i += 3)
{
var triplet = (((binarray[i >> 2] >> 8 * ( i %4)) & 0xFF) << 16)
| (((binarray[i+1 >> 2] >> 8 * ((i+1)%4)) & 0xFF) << 8 )
| ((binarray[i+2 >> 2] >> 8 * ((i+2)%4)) & 0xFF);
for(var j = 0; j < 4; j++)
{
if(i * 8 + j * 6 > binarray.length * 32) str += b64pad;
else str += tab.charAt((triplet >> 6*(3-j)) & 0x3F);
}
}
return str;
}
function hardExitBeacon()
{
var sprops="TTO>Hard Exit"
var ttsid=getEventDeduperId()
var ev="event29:"
ev+=ttsid
var kKeys = ["s_prop6", "s_prop7", "s_events", "s_prop19"]
var kValues = [sprops, sprops, ev, "Hard Exit"]
zBeacon.addBeacon(eOmnitureBeacon,"","",kKeys,kValues)
}
function getHashedAuthId(){
var hv = ""
var id = ""
var tmp = ""
if (typeof(TTOModel) !="undefined") {
id = unescape(TTOModel.getUserId()).split(':')[0]
}
else {
id = getNameSpaceCookie("AUTH_NS","authid");
if ( "" == id ){
id = getNameSpaceCookie("AUTH_NS","userid");
}
}
if ( id != ""){
tmp = hex_md5(id)
hv = tmp.substr(0,4);
var len = id.length
var hf = Math.round( len / 2 )
var id1 = id.substr( 0, hf )
var id2 = id.substr( hf, id.length - 1)
hv += id2
hv += id1
}
return hv;
}
function getEventDeduperId(){
var hv = getHashedAuthId();
if(hv == "") {
hv = getSessionId();
}
hv += "2011".substr("2011".length-2);
return hv;
}
function escapeSpecialChars(str){
return str.replace(/\\/g, "\\\\").replace(/\"/g, "\\\"");
}
function TTOResponseTO() {
this.httpStatus;
this.httpStatusText;
this.sessionEvent = null;
this.EZStepData = null
this.responseJSON=null
this.responseXML=null
}
TTOServiceHandler = Class.extend({
_onHandleSuccess : null,
_onHandleFailure : null,
_onHandleTimeout : null,
_responseTO : null,
construct : function (){
this.constructor = TTOServiceHandler
this._responseTO = new TTOResponseTO();
},
setSuccessCB : function(CB){this._onHandleSuccess=CB;},
setFailureCB : function(CB){this._onHandleFailure=CB;},
setTimeoutCB : function(CB){this._onHandleTimeout=CB;},
getResponseTO : function () {return this._responseTO;},
doSuccess : function (rsp ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
r.responseText = rsp.responseText;
r.responseXML = rsp.responseXML;
r.responseJSON = JSONSerializer.toJSON(rsp.responseText);
if (this._onHandleSuccess)
this._onHandleSuccess(r)
},
doFailure : function(rsp , url ) {
var r = this._responseTO
try {
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
}
catch(error) {
}
finally {
if (this._onHandleFailure) {
this._onHandleFailure(r, url)
}
}
},
doTimeout : function(rsp , url ) {
var r = this._responseTO
r.httpStatus = rsp.status;
r.httpStatusText = rsp.statusText;
if (this._onHandleTimeout)
this._onHandleTimeout(r, url)
}
});
BeaconEventHandler = TTOServiceHandler.extend({
construct : function () {
this.superClass.construct.call(this);
},
_onHandleSuccess : function(respTO) {
var json = respTO.responseJSON
var beaconResponse=json.beaconResponse;
if (beaconResponse.length==0){
return;
}
for(var i=0; i<beaconResponse.length; i++){
var beaconList=beaconResponse[i].beacon
var transId=beaconResponse[i].transactionID;
for(var j=0; j<beaconList.length; j++){
var params = beaconList[j].params.param;
var beaconParams = new Array();
for(var k=0; k<params.length; k++){
beaconParams.push(params[k]);
}
var serverBeaconData = new BeaconDataTO();
serverBeaconData.type = beaconList[j].type;
serverBeaconData.params = beaconParams;
TrackingService.queueBeacon(transId, serverBeaconData)
}
transId = decodeURIComponent(transId) ;
TrackingService.fireBeacons(transId);
}
}
});
var JSONSerializer = {
toString: function (obj) {
var t = typeof (obj);
if (t != "object" || obj === null) {
if (t == "string") obj = '"'+obj+'"';
return String(obj);
}
else {
var n, v, json = [], arr = (obj && obj.constructor == Array);
for (n in obj) {
v = obj[n]; t = typeof(v);
if (t == "string") v = '"'+v+'"';
else if (t == "object" && v !== null) v = this.toString(v);
json.push((arr ? "" : '"' + n + '":') + String(v));
}
return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
}
},
toJSON : function (jsonString) {
if (!jsonString) return null
jsonString = jsonString.replace(/\0$/,"")
var json = null;
try {
json = eval('(' + jsonString + ')');
}
catch (ex) {
if ('undefined' != TTOEventPubSub) TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("JSONSerializer","Invalid JSON\n\n"+jsonString,LOG_ERROR, ex))
}
return json
}
}
function BeaconException () {
var t = this ;
t.Type = "";
t.Error = "";
t.AddlMessage = "";
}
var TurboTaxSupport = (TurboTaxSupport || {});
try {
TurboTaxSupport.Intervention = (function(){
var version = "2.0";
var ttSupportDomain = "https://turbotax.intuit.com";
var ttsAssetsLocation = "https://images.turbotax.intuit.com/support/testing/ty11/interventions/images/akamai/";
var privates = {
config: {
testLog: false,
abTest: "",
priorityCode: "3468337910",
loggingMethod: function(){},
reportMethod: function(){},
bpsApiUrl1: "https://prediction.platform.intuit.com/api/v1/predictions",
bpsApiUrl2: "https://prediction.platform.intuit.com/api/v1/activities",
bpsApiUrl3: "/events",
checkIntervals: [],
checkPageIds: [],
blacklistIds: [],
supportProduct: "117",
supportBucket: "214",
supportMethod: "Chat",
intContent: {},
interventionType: "0",
pageTTOhook: "",
softTTOhook: "",
hardTTOhook: "",
showInterventions: "true",
interventionClass: ""
},
intervalsRemaining: null,
currentTimeout: null,
animationTimeout: null,
checkPageIdDelay: 1,
supportApiUrl: ttSupportDomain+"/support/contact/services/channel-available.jsp",
ttsConfigUrl: ttSupportDomain+"/support/testing/ty11/interventions/config.jsp",
ajaxTimeoutDelay: 6000,
predictionId: 123
};
return function(){
var obj = this;
this.suspendInterventionChecks = false;
this.suspendAllActivity = false;
this.getVersion = function(){
return version;
}
this.init = function(configOverrideObj){
var images = new Array();
images[0] = new Image(); images[0].src = ttsAssetsLocation+'help_center_pop_bg.png?v=1';
images[1] = new Image(); images[1].src = ttsAssetsLocation+'help_center_pop_bottom.png?v=1';
images[2] = new Image(); images[2].src = ttsAssetsLocation+'help_center_pop_top.png?v=1';
images[3] = new Image(); images[3].src = ttsAssetsLocation+'button_help_center.gif?v=1';
images[4] = new Image(); images[4].src = ttsAssetsLocation+'help_center_v2prompt.png?v=1';
obj.processConfigChanges(configOverrideObj);
if(typeof(TTOEventPubSub) != 'undefined') {
if(privates.config.pageTTOhook != "") {
TTOEventPubSub.subscribeForEvent(privates.config.pageTTOhook, tts.intervention.startChecks);
}
if(privates.config.hardTTOhook != "") {
TTOEventPubSub.subscribeForEvent(privates.config.hardTTOhook, tts.intervention.reportHardExit);
}
if(privates.config.softTTOhook != "") {
TTOEventPubSub.subscribeForEvent(privates.config.softTTOhook, tts.intervention.reportSoftExit);
}
}
if(privates.config.priorityCode == "4740900000" || privates.config.priorityCode == "4741100000" || privates.config.priorityCode == "4739900000" || privates.config.priorityCode == "4743000000" || privates.config.priorityCode == "4741700000") {
obj.callConfigService();
}
}
this.processConfigChanges = function (configOverrideObj){
if (arguments.length > 0 && configOverrideObj.constructor == Object) {
for (var configProperty in privates.config) {
if (typeof(configOverrideObj[configProperty]) != 'undefined' && configOverrideObj[configProperty].constructor == privates.config[configProperty].constructor) {
privates.config[configProperty] = configOverrideObj[configProperty];
obj.log('config: setting '+configProperty+' ('+configOverrideObj[configProperty]+')');
}
}
}
}
this.callConfigService = function () {
obj.log('func: callConfigService '+(!obj.suspendInterventionChecks));
if(obj.suspendInterventionChecks == false) {
jQuery.ajax({
dataType: "jsonp",
url: privates.ttsConfigUrl,
data: { abTest: privates.config.abTest, priorityCode: privates.config.priorityCode },
timeout: privates.ajaxTimeoutDelay,
beforeSend: function () {
if (obj.callConfigServiceTimeout != null) {
clearTimeout(obj.callConfigServiceTimeout);
}
obj.callConfigServiceTimeout = setTimeout(function () {
obj.log('SERVICE FAILURE: callConfigService ajax timeout');
obj.suspendInterventionChecks = true;
},
privates.ajaxTimeoutDelay-500);
},
complete: function () {
if (obj.callConfigServiceTimeout != null) {
clearTimeout(obj.callConfigServiceTimeout);
}
},
success: function(returnData){
obj.handleConfigService(returnData);
},
error: function () {}
});
}
}
this.callConfigServiceTimeout = null;
this.handleConfigService = function (returnData){
obj.log('func: handleConfigService');
obj.processConfigChanges(returnData);
obj.checkBps(true);
}
this.getConfig = function(){ return privates.config; }
this.getIntervalsRemaining = function(){ return privates.intervalsRemaining; }
this.startChecks = function (currentPgId) {
obj.log('func: startChecks');
if(typeof(currentPgId) != 'undefined') {
if(currentPgId.constructor == Array) {
currentPgId = currentPgId[0];
}
} else {
currentPgId = 'none';
}
if (privates.currentTimeout != null) {
clearTimeout(privates.currentTimeout);
}
privates.intervalsRemaining = new Array();
if (privates.config.checkPageIds.length == 0) {
for (var i=0; i<privates.config.checkIntervals.length; i++) {
privates.intervalsRemaining.push(privates.config.checkIntervals[i]);
}
} else {
privates.intervalsRemaining.push(privates.checkPageIdDelay);
}
obj.checkIfInterventionRequired(currentPgId);
}
this.checkIfInterventionRequired = function (currentPgId) {
obj.log('func: checkIfInterventionRequired'+(arguments.length>0?' > '+currentPgId:''));
if (!obj.suspendInterventionChecks && privates.intervalsRemaining.length > 0) {
var eligiblePage = false;
if (privates.config.checkPageIds.length == 0) {
eligiblePage = true;
} else if(arguments.length > 0) {
for (var i=0; i<privates.config.checkPageIds.length; i++) {
var checkPageId = privates.config.checkPageIds[i];
if (checkPageId == currentPgId) {
eligiblePage = true;
obj.log('func: checkIfInterventionRequired - page match '+currentPgId);
}
}
}
if(arguments.length > 0) {
for (var j=0; j<privates.config.blacklistIds.length; j++) {
var checkBlacklistId = privates.config.blacklistIds[j];
if (checkBlacklistId == currentPgId) {
obj.log('func: checkIfInterventionRequired - blacklist match '+currentPgId);
eligiblePage = false;
}
}
}
if (eligiblePage) {
var delay = privates.intervalsRemaining[0]*1000;
obj.log('wait: '+delay);
if (privates.currentTimeout != null) {
clearTimeout(privates.currentTimeout);
}
privates.currentTimeout = setTimeout(function(){
var temp = privates.intervalsRemaining.shift();
obj.checkBps(false);
}, delay);
}
}
}
this.checkBps = function (firstCheck) {
obj.log('func: checkBps - is first check: '+firstCheck);
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1,
data: { account: 'ttoty11', target: 'TTS', format: 'json' },
timeout: privates.ajaxTimeoutDelay,
beforeSend: function () {
if (obj.checkBpsTimeout != null) {
clearTimeout(obj.checkBpsTimeout);
}
obj.checkBpsTimeout = setTimeout(function () {
obj.suspendInterventionChecks = true;
obj.log('SERVICE FAILURE: ajax checkBps timeout');
},
privates.ajaxTimeoutDelay-500);
},
complete: function () {
if (obj.checkBpsTimeout != null) {
clearTimeout(obj.checkBpsTimeout);
}
},
success: function(returnData){
obj.handleBpsReturn(returnData, firstCheck);
},
error: function () {}
});
}
this.checkBpsTimeout = null;
this.handleBpsReturn = function (returnData, isFirstCheck) {
obj.log('func: handleBpsReturn - is first check: '+isFirstCheck);
if (returnData.stop_requesting == "true" || returnData.stop_requesting == true) {
obj.suspendInterventionChecks = true;
obj.suspendAllActivity = true;
}
if(isFirstCheck) {
obj.log("handleBpsReturn: stop service = "+returnData.stop_requesting+" ("+returnData.stop_reason+")");
privates.config.reportMethod(returnData.stopChecking);
} else {
var predictions = "Z";
var score = "0.00";
if(typeof(returnData.predictions) != 'undefined') {
if(typeof(returnData.predictions[0]) != 'undefined') {
if(typeof(returnData.predictions[0].id) != 'undefined'){
privates.predictionId = returnData.predictions[0].id;
}
if(typeof(returnData.predictions[0].probability) != 'undefined'){
predictions = returnData.predictions[0].probability;
}
if(typeof(returnData.predictions[0].score) != 'undefined') {
score = returnData.predictions[0].score;
if(typeof(s) != 'undefined' && typeof(s.t) != 'undefined' ) {
s.eVar6 = score+'|'+predictions;
s.eVar7 = privates.config.priorityCode+privates.config.abTest+'|'+privates.config.supportMethod;
s.t();
}
}
}
}
if(privates.interventionClass == 'trainer') {
obj.log("handleBpsReturn: intervene prediction = "+predictions+", score: "+score+", FORCE SHOW");
if (predictions != "Z") {
var rand = Math.floor(Math.random()*10)+1;
if(rand <= 2) {
obj.checkSupportAvailability(score);
}
} else {
obj.checkIfInterventionRequired();
}
} else {
obj.log("handleBpsReturn: intervene prediction = "+predictions+", score: "+score);
if (predictions != "Z") {
obj.checkSupportAvailability(score);
} else {
obj.checkIfInterventionRequired();
}
}
}
}
this.checkSupportAvailability = function (bpsScore) {
obj.log('func: checkSupportAvailability');
jQuery.ajax({
dataType: "jsonp",
url: privates.supportApiUrl,
data: { supportProduct: privates.config.supportProduct, supportBucket: privates.config.supportBucket, supportMethod: privates.config.supportMethod },
timeout: privates.ajaxTimeoutDelay,
beforeSend: function () {
if (obj.checkSupportAvailabilityTimeout != null) {
clearTimeout(obj.checkSupportAvailabilityTimeout);
}
obj.checkSupportAvailabilityTimeout = setTimeout(function () {
obj.suspendInterventionChecks = true;
obj.log('SERVICE FAILURE: ajax checkSupportAvailability timeout');
},
privates.ajaxTimeoutDelay-500);
},
complete: function () {
if (obj.checkSupportAvailabilityTimeout != null) {
clearTimeout(obj.checkSupportAvailabilityTimeout);
}
},
success: function(returnData){
obj.handleSupportReturn(returnData, bpsScore);
},
error: function () {}
});
}
this.checkSupportAvailabilityTimeout = null;
this.handleSupportReturn = function (returnData, bpsScore) {
obj.log('func: handleSupportReturn');
obj.log("returnData: available = "+returnData.available);
obj.log("returnData: wait = "+returnData.wait);
if(privates.config.interventionType == '2' && returnData.available == "true" && returnData.wait != 'long') {
obj.startStaticIntervention(bpsScore);
} else if(privates.config.interventionType == '1') {
if (returnData.available == "true" && returnData.wait == 'short') {
obj.startOnlineIntervention(bpsScore);
} else if (returnData.available == "false" || returnData.wait == 'medium') {
obj.startOfflineIntervention(bpsScore);
} else {
obj.log("returnData: wait time too long");
}
} else {
obj.log("returnData: wait time too long or no matching experience");
}
}
this.startOnlineIntervention = function (bpsScore) {
obj.log('func: startOnlineIntervention '+bpsScore);
obj.suspendInterventionChecks = true;
obj.interventionBase('online', bpsScore);
}
this.startOfflineIntervention = function (bpsScore) {
obj.log('func: startOfflineIntervention '+bpsScore);
obj.suspendInterventionChecks = true;
obj.interventionBase('offline', bpsScore);
}
this.startStaticIntervention = function (bpsScore) {
obj.log('func: startStaticIntervention '+bpsScore);
obj.suspendInterventionChecks = true;
obj.interventionTakeover(bpsScore);
}
this.interventionTakeover = function (bpsScore) {
obj.log('func: interventionTakeover');
if(privates.config.showInterventions == "true") {
jQuery("#modalBkg").css({'display':'block'}).click(function(){
jQuery(this).css({'display':'none'}).unbind('click');
jQuery("#ttsIntOffer").remove();
});
jQuery("body").append('<div id="ttsIntOffer" style="position: absolute; top: 95px; left: 50%; z-index: 99999; line-height: 1px; height: 308px; width: 458px; display: block; background: url('+ttsAssetsLocation+'help_center_v2prompt.png?v=1) no-repeat right top; cursor: pointer;"><div id="helpCenterLaunchB" style="position: absolute; top: 79px; right: 30px; width: 186px; height: 45px;"> </div></div>');
jQuery("#ttsIntOffer").click(function(){
jQuery("#modalBkg").css({'display':'none'}).unbind('click');
jQuery(this).remove();
});
jQuery("#helpCenterLaunchB").click(function(){
jQuery("#modalBkg").css({'display':'none'}).unbind('click');
jQuery("#ttsIntOffer").remove();
obj.getFAQHelp('verB');
});
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_offered', custom_1: 'overlay help center' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: interventionTakeover reported '+data);
},
error: function () {}
});
}
}
this.interventionBase = function (intType, bpsScore) {
if(privates.config.showInterventions == "true") {
jQuery("#helpContainer").css({"position":"relative"}).animate({"top": "120px"}, 500, function(){
jQuery("#rightRailContainer").append('<div id="ttsIntOffer" style="position: absolute; top: -40px; left: -4px; z-index: 99999; line-height: 1px; height: 200px; display: block;"><div class="tts_inner_offer_div" style="position: absolute; bottom: 0; left: 0; width: 258px;"><div style="height: 14px;"><img src="'+ttsAssetsLocation+'help_center_pop_top.png?v=1" /></div><div class="tts_middle" style="font-size: 17px; line-height: 20px; background: url('+ttsAssetsLocation+'help_center_pop_bg.png?v=1) no-repeat left top; padding: 0 20px;"></div><div style="height: 59px;"><img src="'+ttsAssetsLocation+'help_center_pop_bottom.png?v=1" /></div></div></div>');
if(typeof(privates.config.intContent.onlineOffer) == 'unefined') { privates.config.intContent.onlineOffer = "Can we help you? Would you like to chat with a live TurboTax Expert?"; }
if(typeof(privates.config.intContent.offlineOffer) == 'unefined') { privates.config.intContent.offlineOffer = "Need more help? Get answers fast in the TurboTax Help Center."; }
obj.log('func: interventionBase '+intType);
if (privates.animationTimeout != null) {
clearTimeout(privates.animationTimeout);
}
privates.animationTimeout = setTimeout(function(){
obj.offerTimeout();
}, 20000);
if(intType == 'online') {
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle").html('<p style="margin: 0; padding: 0;">'+privates.config.intContent.onlineOffer+'</p><div style="clear: both; height: 12px;"> </div><a style="font-size: 11px; color: #114A7E; width: 91px; height: 24px; padding: 0; line-height: 24px; display: block; float: left; text-align: center; background: url('+ttsAssetsLocation+'button_help_center.gif?v=1) no-repeat left top; text-decoration: none; margin-left: 10px; cursor: pointer;" onclick="javascript:tts.intervention.getAgentHelp();">Yes</a> <a style="font-size: 11px; color: #114A7E; width: 91px; height: 24px; padding: 0; line-height: 24px; display: block; float: left; text-align: center; background: url('+ttsAssetsLocation+'button_help_center.gif?v=1) no-repeat left top; text-decoration: none; margin-left: 25px; cursor: pointer;" onclick="javascript:tts.intervention.optOut();">No</a><div style="clear: both; height: 6px;"> </div>').fadeTo(250,1);
} else {
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle").html('<p style="margin: 0; padding: 0;">'+privates.config.intContent.offlineOffer+'</p><div style="clear: both; height: 12px;"> </div><a style="font-size: 11px; color: #114A7E; width: 91px; height: 24px; padding: 0; line-height: 24px; display: block; float: left; text-align: center; background: url('+ttsAssetsLocation+'button_help_center.gif?v=1) no-repeat left top; text-decoration: none; margin-left: 10px; cursor: pointer;" onclick="javascript:tts.intervention.getFAQHelp();">Get Help</a> <a style="font-size: 11px; color: #114A7E; width: 91px; height: 24px; padding: 0; line-height: 24px; display: block; float: left; text-align: center; background: url('+ttsAssetsLocation+'button_help_center.gif?v=1) no-repeat left top; text-decoration: none; margin-left: 25px; cursor: pointer;" onclick="javascript:tts.intervention.optOut();">No Thanks</a><div style="clear: both; height: 6px;"> </div>').fadeTo(250,1);
}
});
}
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_offered', custom_1: intType+' '+privates.config.supportMethod },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: interventionBase reported '+data);
},
error: function () {}
});
}
this.getAgentHelp = function () {
if(typeof(privates.config.intContent.onlineLinkOut) == 'unefined') { privates.config.intContent.onlineLinkOut = ttSupportDomain+"/support/contact/"; }
var ttsWindow = window.open(privates.config.intContent.onlineLinkOut, "ttsWindow", "scrollbars=yes,menubar=no,toolbar=no,location=no,width=500,height=500");
if (privates.animationTimeout != null) {
clearTimeout(privates.animationTimeout);
}
privates.animationTimeout = setTimeout(function(){
obj.closeOffering();
}, 2000);
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_accepted' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: getAgentHelp reported '+data);
},
error: function () {}
});
}
this.getFAQHelp = function (version) {
if(typeof(privates.config.intContent.offlineLinkOut) == 'unefined') { privates.config.intContent.offlineLinkOut = ttSupportDomain+"/support/landing-pages/onlinehelp.jsp"; }
var ttsWindow = window.open(privates.config.intContent.offlineLinkOut, "ttsWindow", "resizable=yes,scrollbars=yes,menubar=no,toolbar=no,location=no,width=500,height=500");
if (privates.animationTimeout != null) {
clearTimeout(privates.animationTimeout);
}
if(typeof(version) == 'undefined') {
privates.animationTimeout = setTimeout(function(){
obj.closeOffering();
}, 2000);
}
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_accepted' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: getFAQHelp reported '+data);
},
error: function () {}
});
}
this.offerTimeout = function () {
obj.log('func: offerTimeout');
if(typeof(privates.config.intContent.offerIgnored) == 'unefined') { privates.config.intContent.offerIgnored = "We are here when you need us, just click the button below."; }
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle a, #ttsIntOffer .tts_inner_offer_div .tts_middle div").slideUp(250);
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle p").fadeTo(250, 0, function(){
jQuery(this).html(privates.config.intContent.offerIgnored).fadeTo(250, 1);
});
if (privates.animationTimeout != null) {
clearTimeout(privates.animationTimeout);
}
privates.animationTimeout = setTimeout(function(){
obj.closeOffering();
}, 6000);
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_rejected' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: offerTimeout reported '+data);
},
error: function () {}
});
}
this.optOut = function () {
obj.log('func: optOut');
if(typeof(privates.config.intContent.offerDeclined) == 'unefined') { privates.config.intContent.offerDeclined = "No problem. We are here when you need us, just click the button below."; }
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle a, #ttsIntOffer .tts_inner_offer_div .tts_middle div").slideUp(250);
jQuery("#ttsIntOffer .tts_inner_offer_div .tts_middle p").fadeTo(250, 0, function(){
jQuery(this).html(privates.config.intContent.offerDeclined).fadeTo(250, 1);
});
if (privates.animationTimeout != null) {
clearTimeout(privates.animationTimeout);
}
privates.animationTimeout = setTimeout(function(){
obj.closeOffering();
}, 6000);
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl1+'/'+privates.predictionId+privates.config.bpsApiUrl3,
data: { event_type: 'action_rejected' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: optOut reported '+data);
},
error: function () {}
});
}
this.closeOffering = function () {
obj.log('func: closeOffering');
jQuery("#ttsIntOffer").fadeTo(250,0, function(){
jQuery(this).remove();
jQuery("#helpContainer").animate({"top": "0px"}, 500);
});
}
this.reportHardExit = function () {
obj.log('func: reportHardExit');
if(obj.suspendAllActivity == false) {
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl2,
data: { account: 'ttoty11', source: 'TTO', format: 'json', type: 'hard_exit', status_in_response: 'true' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: reportHardExit reported '+data);
},
error: function () {}
});
}
}
this.reportSoftExit = function () {
obj.log('func: reportSoftExit');
if(obj.suspendAllActivity == false) {
jQuery.ajax({
dataType: "jsonp",
url: privates.config.bpsApiUrl2,
data: { account: 'ttoty11', source: 'TTO', format: 'json', type: 'soft_exit', status_in_response: 'true' },
timeout: privates.ajaxTimeoutDelay,
success: function(data){
obj.log('func: reportSoftExit reported '+data);
},
error: function () {}
});
}
}
this.getCookie = function (cookieName) {
var dc = document.cookie;
var prefix = cookieName + "=";
var begin = dc.indexOf("; " + prefix);
if (begin == -1) {
begin = dc.indexOf(prefix);
if (begin != 0) return null;
} else begin += 2;
var end = dc.indexOf(";", begin);
if (end == -1) end = dc.length;
return unescape(dc.substring(begin + prefix.length, end));
}
this.log = function (passedMsg) {
if(privates.config.testLog) {
privates.config.loggingMethod(passedMsg);
}
}
}
})();
var tts = (tts || {});
tts.intervention = new TurboTaxSupport.Intervention();
} catch (e) {
if(typeof(TTOEventPubSub) != 'undefined' && typeof(UIError) != 'undefined') {
TTOEventPubSub.publishEvent(TTOEventPubSub.kEvt_ClientError, new UIError("TTS","JavaScript Error: "+e));
} else {
if(typeof(console) != 'undefined') { console.log('JavaScript Error: '+e); }
}
}
